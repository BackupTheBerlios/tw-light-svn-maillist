From yurand at berlios.de  Tue Aug  2 22:29:49 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Tue, 2 Aug 2005 22:29:49 +0200
Subject: [Tw-light-svn] r174 - in trunk: . gamedata/default_ini/ships gamedata/images/ships/shpearc3 gamedata/images/ships/shprogsq gamedata/images/ships/shpstaba
Message-ID: <200508022029.j72KTnRN026014@sheep.berlios.de>

Author: yurand
Date: 2005-08-02 22:29:47 +0200 (Tue, 02 Aug 2005)
New Revision: 174

Modified:
   trunk/gamedata/default_ini/ships/shprogsq.ini
   trunk/gamedata/images/ships/shpearc3/ship_p01.bmp
   trunk/gamedata/images/ships/shpearc3/ship_p02.bmp
   trunk/gamedata/images/ships/shpearc3/ship_p03.bmp
   trunk/gamedata/images/ships/shpearc3/ship_p04.bmp
   trunk/gamedata/images/ships/shpearc3/ship_p05.bmp
   trunk/gamedata/images/ships/shpearc3/ship_p06.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P01_PCX.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P02_PCX.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P03_PCX.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P04_PCX.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P05_PCX.bmp
   trunk/gamedata/images/ships/shprogsq/SHIP_P06_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P01_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P02_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P03_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P04_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P05_PCX.bmp
   trunk/gamedata/images/ships/shpstaba/SHIP_P06_PCX.bmp
   trunk/sources.lst
Log:
New icons for earthling_mark_III, rogues, shpstaba.
Thanks to Darryl Koster and Geoman

Modified: trunk/gamedata/default_ini/ships/shprogsq.ini
===================================================================
--- trunk/gamedata/default_ini/ships/shprogsq.ini	2005-07-28 03:28:09 UTC (rev 173)
+++ trunk/gamedata/default_ini/ships/shprogsq.ini	2005-08-02 20:29:47 UTC (rev 174)
@@ -1,5 +1,5 @@
 [Info]
-Origin = TWa
+Origin = TW
 TWCost = 11
 Name1 = Rogue
 Name2 = Squadron

Modified: trunk/gamedata/images/ships/shpearc3/ship_p01.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpearc3/ship_p02.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpearc3/ship_p03.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpearc3/ship_p04.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpearc3/ship_p05.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpearc3/ship_p06.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P01_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P02_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P03_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P04_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P05_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shprogsq/SHIP_P06_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P01_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P02_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P03_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P04_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P05_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpstaba/SHIP_P06_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/sources.lst
===================================================================
--- trunk/sources.lst	2005-07-28 03:28:09 UTC (rev 173)
+++ trunk/sources.lst	2005-08-02 20:29:47 UTC (rev 174)
@@ -1,141 +1,140 @@
-source/ais/c_input.cpp
-source/ais/c_other.cpp
-source/ais/c_wussie.cpp
-source/doxygen.cpp
-source/frame.cpp
-source/games/gamehierarchy.cpp
-source/games/gdefender.cpp
-source/games/gflmelee.cpp
-source/games/ggob.cpp
-source/generated/tml_wrap.cpp
-source/gui.cpp
-source/input.cpp
-source/libraries/agup/aalg.c
-source/libraries/agup/aase.c
-source/libraries/agup/abeos.c
-source/libraries/agup/abitmap.c
-source/libraries/agup/agtk.c
-source/libraries/agup/agup.c
-source/libraries/agup/ans.c
-source/libraries/agup/aphoton.c
-source/libraries/agup/awin95.c
-source/libraries/jpgalleg/decode.c
-source/libraries/jpgalleg/encode.c
-source/libraries/jpgalleg/io.c
-source/libraries/jpgalleg/jpgalleg.c
-source/melee/GobWarpOutTrail.cpp
-source/melee/manim.cpp
-source/melee/mcbodies.cpp
-source/melee/mcontrol.cpp
-source/melee/mfleet.cpp
-source/melee/mframe.cpp
-source/melee/mgame.cpp
-source/melee/mhelpers.cpp
-source/melee/mitems.cpp
-source/melee/mlog.cpp
-source/melee/mmain.cpp
-source/melee/mmath.cpp
-source/melee/mnet1.cpp
-source/melee/moptions.cpp
-source/melee/mship.cpp
-source/melee/mshot.cpp
-source/melee/mshpdata.cpp
-source/melee/mshppan.cpp
-source/melee/msprite.cpp
-source/melee/mtarget.cpp
-source/melee/mview.cpp
-source/melee/WarpOutTrail.cpp
-source/other/configrw.cpp
-source/other/dialogs.cpp
-source/other/fontmorph.cpp
-source/other/gup.cpp
-source/other/nullphas.cpp
-source/other/objanim.cpp
-source/other/orbit.cpp
-source/other/planet3d.cpp
-source/other/radar.cpp
-source/other/shippart.cpp
-source/other/starmap.cpp
-source/other/twconfig.cpp
-source/other/vbodies.cpp
-source/other/vtarget.cpp
-source/python/fileops.cpp
-source/python/game.cpp
-source/python/python_class.cpp
-source/sc1ships/shpandgu.cpp
-source/sc1ships/shparisk.cpp
-source/sc1ships/shpchebr.cpp
-source/sc1ships/shpearcr.cpp
-source/sc1ships/shpilwav.cpp
-source/sc1ships/shpkzedr.cpp
-source/sc1ships/shpmmrxf.cpp
-source/sc1ships/shpmycpo.cpp
-source/sc1ships/shpshosc.cpp
-source/sc1ships/shpspael.cpp
-source/sc1ships/shpsyrpe.cpp
-source/sc1ships/shpumgdr.cpp
-source/sc1ships/shpvuxin.cpp
-source/sc1ships/shpyehte.cpp
-source/sc2ships/shpchmav.cpp
-source/sc2ships/shpdruma.cpp
-source/sc2ships/shpkohma.cpp
-source/sc2ships/shpmeltr.cpp
-source/sc2ships/shporzne.cpp
-source/sc2ships/shppkufu.cpp
-source/sc2ships/shpslypr.cpp
-source/sc2ships/shpsupbl.cpp
-source/sc2ships/shpthrto.cpp
-source/sc2ships/shputwju.cpp
-source/sc2ships/shpzfpst.cpp
-source/scp.cpp
-source/ships/shpaktgu.cpp
-source/ships/shpalabc.cpp
-source/ships/shpbahbu.cpp
-source/ships/shpbipka.cpp
-source/ships/shpbogce.cpp
-source/ships/shpchoex.cpp
-source/ships/shpconca.cpp
-source/ships/shpconho.cpp
-source/ships/shpdragr.cpp
-source/ships/shpearc3.cpp
-source/ships/shpforsh.cpp
-source/ships/shpgarty.cpp
-source/ships/shpilwsp.cpp
-source/ships/shpkahbo.cpp
-source/ships/shprogsq.cpp
-source/ships/shpsamat.cpp
-source/ships/shpstaba.cpp
-source/ships/shptauar.cpp
-source/ships/shptauda.cpp
-source/ships/shptaume.cpp
-source/ships/shptausl.cpp
-source/ships/shptaust.cpp
-source/ships/shptauto.cpp
-source/ships/shpwolmi.cpp
-source/ships/shpyusra.cpp
-source/ships/shpzeksh.cpp
-source/tests/gameconfigtest.cpp
-source/tests/testdatapath.cpp
-source/tests/TestFleetEditor.cpp
-source/tests/testmain.cpp
-source/tml/eventmanager.cpp
-source/tml/gameaction.cpp
-source/tml/gameconfig.cpp
-source/tml/gamedialog.cpp
-source/tml/gameevent.cpp
-source/util/aarot.c
-source/util/aastr.c
-source/util/aautil.c
-source/util/base.cpp
-source/util/endian.cpp
-source/util/errors.cpp
-source/util/errors_c.c
-source/util/get_time.c
-source/util/history.cpp
-source/util/net_tcp.cpp
-source/util/pmask.c
-source/util/random.cpp
-source/util/round.c
-source/util/sound.cpp
-source/util/types.cpp
-source/util/vector2.cpp
+source/python/python_class.cpp
+source/python/fileops.cpp
+source/python/game.cpp
+source/other/starmap.cpp
+source/other/planet3d.cpp
+source/other/fontmorph.cpp
+source/other/vtarget.cpp
+source/other/configrw.cpp
+source/other/orbit.cpp
+source/other/objanim.cpp
+source/other/twconfig.cpp
+source/other/nullphas.cpp
+source/other/radar.cpp
+source/other/shippart.cpp
+source/other/vbodies.cpp
+source/other/gup.cpp
+source/other/dialogs.cpp
+source/ships/shpconca.cpp
+source/ships/shpkahbo.cpp
+source/ships/shpzeksh.cpp
+source/ships/shpgarty.cpp
+source/ships/shpbipka.cpp
+source/ships/shpwolmi.cpp
+source/ships/shptausl.cpp
+source/ships/shpstaba.cpp
+source/ships/shprogsq.cpp
+source/ships/shptauto.cpp
+source/ships/shpearc3.cpp
+source/ships/shptauda.cpp
+source/ships/shpilwsp.cpp
+source/ships/shpdragr.cpp
+source/ships/shptaust.cpp
+source/ships/shpalabc.cpp
+source/ships/shpyusra.cpp
+source/ships/shpsamat.cpp
+source/ships/shpconho.cpp
+source/ships/shpchoex.cpp
+source/ships/shpaktgu.cpp
+source/ships/shptaume.cpp
+source/ships/shptauar.cpp
+source/ships/shpbogce.cpp
+source/ships/shpbahbu.cpp
+source/ships/shpforsh.cpp
+source/melee/mship.cpp
+source/melee/mitems.cpp
+source/melee/manim.cpp
+source/melee/mmain.cpp
+source/melee/mtarget.cpp
+source/melee/mhelpers.cpp
+source/melee/msprite.cpp
+source/melee/mnet1.cpp
+source/melee/mshot.cpp
+source/melee/mframe.cpp
+source/melee/mgame.cpp
+source/melee/mlog.cpp
+source/melee/mshpdata.cpp
+source/melee/GobWarpOutTrail.cpp
+source/melee/WarpOutTrail.cpp
+source/melee/mshppan.cpp
+source/melee/mmath.cpp
+source/melee/moptions.cpp
+source/melee/mfleet.cpp
+source/melee/mcbodies.cpp
+source/melee/mview.cpp
+source/melee/mcontrol.cpp
+source/tml/gameconfig.cpp
+source/tml/gameaction.cpp
+source/tml/gamedialog.cpp
+source/tml/gameevent.cpp
+source/tml/eventmanager.cpp
+source/games/ggob.cpp
+source/games/gflmelee.cpp
+source/games/gdefender.cpp
+source/games/gamehierarchy.cpp
+source/sc1ships/shpchebr.cpp
+source/sc1ships/shpspael.cpp
+source/sc1ships/shpmycpo.cpp
+source/sc1ships/shparisk.cpp
+source/sc1ships/shpmmrxf.cpp
+source/sc1ships/shpvuxin.cpp
+source/sc1ships/shpearcr.cpp
+source/sc1ships/shpyehte.cpp
+source/sc1ships/shpumgdr.cpp
+source/sc1ships/shpandgu.cpp
+source/sc1ships/shpkzedr.cpp
+source/sc1ships/shpshosc.cpp
+source/sc1ships/shpilwav.cpp
+source/sc1ships/shpsyrpe.cpp
+source/sc2ships/shpmeltr.cpp
+source/sc2ships/shpsupbl.cpp
+source/sc2ships/shpzfpst.cpp
+source/sc2ships/shpdruma.cpp
+source/sc2ships/shpslypr.cpp
+source/sc2ships/shppkufu.cpp
+source/sc2ships/shporzne.cpp
+source/sc2ships/shpchmav.cpp
+source/sc2ships/shputwju.cpp
+source/sc2ships/shpkohma.cpp
+source/sc2ships/shpthrto.cpp
+source/generated/tml_wrap.cpp
+source/tests/gameconfigtest.cpp
+source/tests/testmain.cpp
+source/tests/testdatapath.cpp
+source/libraries/jpgalleg/decode.c
+source/libraries/jpgalleg/jpgalleg.c
+source/libraries/jpgalleg/io.c
+source/libraries/jpgalleg/encode.c
+source/libraries/agup/aalg.c
+source/libraries/agup/aphoton.c
+source/libraries/agup/aase.c
+source/libraries/agup/abitmap.c
+source/libraries/agup/awin95.c
+source/libraries/agup/ans.c
+source/libraries/agup/agtk.c
+source/libraries/agup/abeos.c
+source/libraries/agup/agup.c
+source/ais/c_wussie.cpp
+source/ais/c_other.cpp
+source/ais/c_input.cpp
+source/util/endian.cpp
+source/util/history.cpp
+source/util/types.cpp
+source/util/aarot.c
+source/util/base.cpp
+source/util/aastr.c
+source/util/pmask.c
+source/util/errors.cpp
+source/util/errors_c.c
+source/util/aautil.c
+source/util/random.cpp
+source/util/vector2.cpp
+source/util/round.c
+source/util/sound.cpp
+source/util/net_tcp.cpp
+source/util/get_time.c
+source/input.cpp
+source/doxygen.cpp
+source/gui.cpp
+source/scp.cpp
+source/frame.cpp



From yurand at berlios.de  Sat Aug  6 20:09:54 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Sat, 6 Aug 2005 20:09:54 +0200
Subject: [Tw-light-svn] r175 - in trunk: . Util/deditor gamedata/default_ini gamedata/games/test_game/dialogs gamedata/games/test_game/scripts gamedata/games/test_game/scripts/systems gamedata/python source/games source/melee source/other source/tml
Message-ID: <200508061809.j76I9s5v005274@sheep.berlios.de>

Author: yurand
Date: 2005-08-06 20:09:53 +0200 (Sat, 06 Aug 2005)
New Revision: 175

Added:
   trunk/Util/deditor/SConstruct
   trunk/gamedata/games/test_game/dialogs/chorali_commander.xml
   trunk/gamedata/games/test_game/scripts/flags.py
   trunk/gamedata/python/flags.py
   trunk/gamedata/python/quests.py
   trunk/source/other/gobwarpouttrail.cpp
   trunk/source/other/gobwarpouttrail.h
Removed:
   trunk/Util/deditor/gui.bat
   trunk/Util/deditor/lua/
   trunk/source/melee/GobWarpOutTrail.cpp
   trunk/source/melee/GobWarpOutTrail.h
Modified:
   trunk/SConstruct
   trunk/Util/deditor/application.cpp
   trunk/Util/deditor/dialog.xml
   trunk/Util/deditor/helpers.cpp
   trunk/Util/deditor/maindialog.h
   trunk/Util/deditor/maindialog.ui
   trunk/Util/deditor/mainwidget.cpp
   trunk/Util/deditor/xmlparser.cpp
   trunk/Util/deditor/xmlparser.h
   trunk/gamedata/default_ini/client.ini
   trunk/gamedata/games/test_game/dialogs/druuge.xml
   trunk/gamedata/games/test_game/dialogs/ixis_mining_station_commander.xml
   trunk/gamedata/games/test_game/dialogs/precursor_wrack_first_inspection.xml
   trunk/gamedata/games/test_game/dialogs/shpalabc.xml
   trunk/gamedata/games/test_game/dialogs/shpandgu.xml
   trunk/gamedata/games/test_game/dialogs/shparisk.xml
   trunk/gamedata/games/test_game/dialogs/shpbahbu.xml
   trunk/gamedata/games/test_game/dialogs/shpbipka.xml
   trunk/gamedata/games/test_game/dialogs/shpchmav.xml
   trunk/gamedata/games/test_game/dialogs/test_dialog.xml
   trunk/gamedata/games/test_game/dialogs/transport_please_help.xml
   trunk/gamedata/games/test_game/dialogs/transport_thanks.xml
   trunk/gamedata/games/test_game/dialogs/welcomecommander.xml
   trunk/gamedata/games/test_game/scripts/quests.py
   trunk/gamedata/games/test_game/scripts/start.py
   trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
   trunk/gamedata/games/test_game/scripts/systems/ixis.py
   trunk/gamedata/games/test_game/scripts/systems/narike.py
   trunk/gamedata/python/dialog.py
   trunk/gamedata/python/tml.py
   trunk/source/games/ggob.cpp
   trunk/source/games/ggob.h
   trunk/source/melee/mship.cpp
   trunk/source/tml/eventmanager.cpp
   trunk/source/tml/eventmanager.h
   trunk/source/tml/gameaction.cpp
   trunk/source/tml/gameaction.h
   trunk/source/tml/gameevent.cpp
   trunk/source/tml/gameevent.h
   trunk/sources.lst
Log:
Dialog editor updated to use QT 3
You can call python code in alien/player answers using {}
fixed issue #0000048  Pressing 'J' in Adventure mode without a system selected causes crash


Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/SConstruct	2005-08-06 18:09:53 UTC (rev 175)
@@ -56,6 +56,7 @@
   source/other/configrw.cpp
   source/other/dialogs.cpp
   source/other/fontmorph.cpp
+  source/other/gobwarpouttrail.cpp 
   source/other/gup.cpp
   source/other/nullphas.cpp
   source/other/objanim.cpp

Added: trunk/Util/deditor/SConstruct
===================================================================
--- trunk/Util/deditor/SConstruct	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/SConstruct	2005-08-06 18:09:53 UTC (rev 175)
@@ -0,0 +1,18 @@
+import os
+env = Environment(tools=['default','qt','mingw'])
+if str(Platform()) == "win32":
+    env.Append(CPPDEFINES=['WIN32'])
+    if env["CC"] == "cl":
+        env.AppendENVPath('PATH', os.environ['PATH'])
+        env.Append(LIBPATH=["#lua"])
+
+#env.Append(LIBS= ['lua','lualib'])
+env.Program('dedit', ['maindialog.ui',
+                      'application.cpp', 
+                      'helpers.cpp',
+                      'main.cpp',
+                      'mainwidget.cpp',
+                      'node.cpp',
+                      'xmlparser.cpp']
+              )
+

Modified: trunk/Util/deditor/application.cpp
===================================================================
--- trunk/Util/deditor/application.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/application.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -309,7 +309,7 @@
     evalanswerIcon = QPixmap( evalanswer_xpm );
 
 	QPopupMenu * test = new QPopupMenu( this );
-    menuBar()->insertItem( "&Test", test );
+    menuBar()->insertItem( "Test", test );
 
     id = test->insertItem( evalanswerIcon, "Evaluate answer",
 			   this, SLOT(evaluateAnswerSlot()), CTRL+Key_R );

Modified: trunk/Util/deditor/dialog.xml
===================================================================
--- trunk/Util/deditor/dialog.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/dialog.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,2 +1,3 @@
-<NODES><NODE id="0" name="Start" music="" background="a.png" alien_text="TW-Light Dialog Editor. 
-   &lt;br&gt; Test dialog" font="" text_location=""><PLAYER_ANSWER text="We come in peace" appear_condition="1"><ACTION condition="1" action="goto(&quot;2&quot;)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Die supid alien!" appear_condition="1"><ACTION condition="1" action="goto(&quot;1&quot;)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Batte" music="" background="" alien_text="You have bad manners, die" font="" text_location=""><PLAYER_ANSWER text="Ok!!" appear_condition="1"></PLAYER_ANSWER></NODE><NODE id="2" name="Bye" music="" background="a.png" alien_text="Have to go, sorry" font="" text_location=""><PLAYER_ANSWER text="Bye" appear_condition="1"></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG><ACTION condition="1" action="def abc():
+  print &quot;abc&quot;"></ACTION></START_DIALOG><END_DIALOG><ACTION condition="1" action=""></ACTION></END_DIALOG><NODES><NODE id="0" name="Start" music="" background="a.png" alien_text="TW-Light Dialog Editor. 
+   &lt;br&gt; Test dialog" font="" text_location=""><PLAYER_ANSWER text="We come in peace" appear_condition="1"><ACTION condition="1" action="goto(&quot;2&quot;)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Die supid alien!" appear_condition="1"><ACTION condition="1" action="goto(&quot;1&quot;)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Batte" music="" background="" alien_text="You have bad manners, die" font="" text_location=""><PLAYER_ANSWER text="Ok!!" appear_condition="1"></PLAYER_ANSWER></NODE><NODE id="2" name="Bye" music="" background="a.png" alien_text="Have to go, sorry" font="" text_location=""><PLAYER_ANSWER text="Bye" appear_condition="1"></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Deleted: trunk/Util/deditor/gui.bat
===================================================================
--- trunk/Util/deditor/gui.bat	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/gui.bat	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,5 +0,0 @@
-uic -o maindialog.h MainDialog.ui
-uic -i maindialog.h -o maindialog.cpp MainDialog.ui
-moc -o moc_maindialog.cpp maindialog.h
-moc -o moc_application.cpp application.h
-moc -o moc_node.cpp node.h

Modified: trunk/Util/deditor/helpers.cpp
===================================================================
--- trunk/Util/deditor/helpers.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/helpers.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -28,6 +28,6 @@
 	str.replace(QRegExp(">"),"&gt;");
 	str.replace(QRegExp("<"),"&lt;");
 	str.replace(QRegExp("\""),"&quot;");
-
+	str.replace(QRegExp("\n"),"&#10;");
 	return str;
 }

Modified: trunk/Util/deditor/maindialog.h
===================================================================
--- trunk/Util/deditor/maindialog.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/maindialog.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,8 +1,8 @@
 /****************************************************************************
 ** Form interface generated from reading ui file 'maindialog.ui'
 **
-** Created: Sat May 14 10:31:25 2005
-**      by: The User Interface Compiler ($Id: qt/main.cpp   3.3.3   edited Nov 24 2003 $)
+** Created: ?? 6. ??? 20:29:10 2005
+**      by: The User Interface Compiler ()
 **
 ** WARNING! All changes made in this file will be lost!
 ****************************************************************************/
@@ -21,11 +21,10 @@
 class QTextBrowser;
 class QLabel;
 class QMultiLineEdit;
-class QCheckBox;
 class QTabWidget;
 class QLineEdit;
 class QGroupBox;
-class QTable;
+class QTextEdit;
 class QListView;
 class QListViewItem;
 
@@ -37,13 +36,12 @@
     DialogEditorGenerated( QWidget* parent = 0, const char* name = 0, WFlags fl = 0 );
     ~DialogEditorGenerated();
 
-    QSplitter* splitter3;
-    QSplitter* splitter2;
-    QSplitter* splitter1;
+    QSplitter* splitter7;
+    QSplitter* splitter6;
     QTextBrowser* alienTextBrowser;
     QLabel* TextLabel4;
     QMultiLineEdit* commonMultiLineEdit;
-    QCheckBox* TestModeCheckBox;
+    QSplitter* splitter5;
     QTabWidget* TabWidget2;
     QWidget* tab;
     QLineEdit* textLocationLineEdit;
@@ -82,25 +80,26 @@
     QLineEdit* condition5LineEdit;
     QLabel* TextLabel11;
     QLineEdit* action5LineEdit;
-    QLabel* TextLabel3;
-    QLabel* TextLabel12;
-    QLabel* TextLabel13;
-    QTable* triggerTable;
+    QWidget* TabPage;
+    QSplitter* splitter14;
+    QLabel* textLabel1;
+    QTextEdit* startDialogCode_textEdit;
+    QLabel* textLabel1_2;
+    QTextEdit* endDialogCode_textEdit;
     QListView* nodeListView;
     QListView* answersListView;
 
 public slots:
-    virtual void answerChangedSlot(QListViewItem*);
-    virtual void answerPositionChanged(int);
-    virtual void nodeChangedSlot(QListViewItem* );
-    virtual void processAnswerSlot(QListViewItem*);
+    virtual void answerChangedSlot( QListViewItem * );
+    virtual void answerPositionChanged( int );
+    virtual void nodeChangedSlot( QListViewItem * );
+    virtual void processAnswerSlot( QListViewItem * );
     virtual void saveAnswer();
     virtual void saveNodeInfo();
 
 protected:
     QGridLayout* DialogEditorGeneratedLayout;
-    QVBoxLayout* Layout20;
-    QVBoxLayout* Layout14;
+    QVBoxLayout* layout14;
     QGridLayout* tabLayout;
     QGridLayout* Layout15;
     QSpacerItem* Spacer1;
@@ -114,8 +113,9 @@
     QHBoxLayout* Layout7;
     QHBoxLayout* Layout8;
     QHBoxLayout* Layout9;
-    QVBoxLayout* Layout19;
-    QHBoxLayout* Layout18;
+    QGridLayout* TabPageLayout;
+    QVBoxLayout* layout36;
+    QVBoxLayout* layout35;
 
 protected slots:
     virtual void languageChange();

Modified: trunk/Util/deditor/maindialog.ui
===================================================================
--- trunk/Util/deditor/maindialog.ui	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/maindialog.ui	2005-08-06 18:09:53 UTC (rev 175)
@@ -27,790 +27,778 @@
         </property>
         <widget class="QSplitter" row="0" column="0">
             <property name="name">
-                <cstring>splitter3</cstring>
+                <cstring>splitter7</cstring>
             </property>
+            <property name="maximumSize">
+                <size>
+                    <width>32767</width>
+                    <height>32767</height>
+                </size>
+            </property>
             <property name="orientation">
                 <enum>Vertical</enum>
             </property>
+            <property name="whatsThis" stdset="0">
+                <string>First column - trigger name, second - value</string>
+            </property>
             <widget class="QSplitter">
                 <property name="name">
-                    <cstring>splitter2</cstring>
+                    <cstring>splitter6</cstring>
                 </property>
                 <property name="orientation">
                     <enum>Horizontal</enum>
                 </property>
-                <widget class="QSplitter">
+                <widget class="QTextBrowser">
                     <property name="name">
-                        <cstring>splitter1</cstring>
+                        <cstring>alienTextBrowser</cstring>
                     </property>
-                    <property name="orientation">
-                        <enum>Horizontal</enum>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>7</hsizetype>
+                            <vsizetype>7</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
                     </property>
-                    <widget class="QLayoutWidget">
+                    <property name="minimumSize">
+                        <size>
+                            <width>200</width>
+                            <height>150</height>
+                        </size>
+                    </property>
+                    <property name="whatsThis" stdset="0">
+                        <string>Alian picture, and text here</string>
+                    </property>
+                </widget>
+                <widget class="QLayoutWidget">
+                    <property name="name">
+                        <cstring>layout14</cstring>
+                    </property>
+                    <vbox>
                         <property name="name">
-                            <cstring>Layout20</cstring>
+                            <cstring>unnamed</cstring>
                         </property>
-                        <vbox>
+                        <widget class="QLabel">
                             <property name="name">
+                                <cstring>TextLabel4</cstring>
+                            </property>
+                            <property name="text">
+                                <string>Place text here:</string>
+                            </property>
+                        </widget>
+                        <widget class="QMultiLineEdit">
+                            <property name="name">
+                                <cstring>commonMultiLineEdit</cstring>
+                            </property>
+                            <property name="minimumSize">
+                                <size>
+                                    <width>0</width>
+                                    <height>90</height>
+                                </size>
+                            </property>
+                            <property name="textFormat">
+                                <enum>AutoText</enum>
+                            </property>
+                            <property name="whatsThis" stdset="0">
+                                <string>Text in this edit can be set aso player or alian answer.</string>
+                            </property>
+                        </widget>
+                    </vbox>
+                </widget>
+            </widget>
+            <widget class="QSplitter">
+                <property name="name">
+                    <cstring>splitter5</cstring>
+                </property>
+                <property name="orientation">
+                    <enum>Horizontal</enum>
+                </property>
+                <widget class="QTabWidget">
+                    <property name="name">
+                        <cstring>TabWidget2</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>4</hsizetype>
+                            <vsizetype>4</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="minimumSize">
+                        <size>
+                            <width>200</width>
+                            <height>250</height>
+                        </size>
+                    </property>
+                    <property name="margin">
+                        <number>0</number>
+                    </property>
+                    <widget class="QWidget">
+                        <property name="name">
+                            <cstring>tab</cstring>
+                        </property>
+                        <attribute name="title">
+                            <string>Node</string>
+                        </attribute>
+                        <grid>
+                            <property name="name">
                                 <cstring>unnamed</cstring>
                             </property>
                             <property name="margin">
-                                <number>0</number>
+                                <number>11</number>
                             </property>
                             <property name="spacing">
                                 <number>6</number>
                             </property>
-                            <widget class="QTextBrowser">
+                            <widget class="QLayoutWidget" row="0" column="0">
                                 <property name="name">
-                                    <cstring>alienTextBrowser</cstring>
+                                    <cstring>Layout15</cstring>
                                 </property>
-                                <property name="sizePolicy">
-                                    <sizepolicy>
-                                        <hsizetype>7</hsizetype>
-                                        <vsizetype>7</vsizetype>
-                                        <horstretch>0</horstretch>
-                                        <verstretch>0</verstretch>
-                                    </sizepolicy>
-                                </property>
-                                <property name="minimumSize">
-                                    <size>
-                                        <width>200</width>
-                                        <height>200</height>
-                                    </size>
-                                </property>
-                                <property name="whatsThis" stdset="0">
-                                    <string>Alian picture, and text here</string>
-                                </property>
+                                <grid>
+                                    <property name="name">
+                                        <cstring>unnamed</cstring>
+                                    </property>
+                                    <property name="margin">
+                                        <number>0</number>
+                                    </property>
+                                    <property name="spacing">
+                                        <number>6</number>
+                                    </property>
+                                    <widget class="QLineEdit" row="5" column="1" rowspan="1" colspan="2">
+                                        <property name="name">
+                                            <cstring>textLocationLineEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignLeft</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Alien text location</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLineEdit" row="1" column="1" rowspan="1" colspan="2">
+                                        <property name="name">
+                                            <cstring>NodeNameLineEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignLeft</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Name is not used</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="4" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel1_3</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Font:</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Alien text font</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLineEdit" row="4" column="1" rowspan="1" colspan="2">
+                                        <property name="name">
+                                            <cstring>fontLineEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignLeft</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Alien text font</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="2" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel3_2</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Music</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Path to music file</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="0" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel1</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Node ID</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>unique identifier for node</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="5" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel2_3</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Text location:</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Alien text location</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="3" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel4_2</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Background</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Path to background picture</string>
+                                        </property>
+                                    </widget>
+                                    <spacer row="0" column="1">
+                                        <property name="name">
+                                            <cstring>Spacer1</cstring>
+                                        </property>
+                                        <property name="orientation">
+                                            <enum>Horizontal</enum>
+                                        </property>
+                                        <property name="sizeType">
+                                            <enum>Expanding</enum>
+                                        </property>
+                                        <property name="sizeHint">
+                                            <size>
+                                                <width>20</width>
+                                                <height>20</height>
+                                            </size>
+                                        </property>
+                                    </spacer>
+                                    <widget class="QLineEdit" row="2" column="1" rowspan="1" colspan="2">
+                                        <property name="name">
+                                            <cstring>MusicEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignLeft</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Path to music file</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLineEdit" row="3" column="1" rowspan="1" colspan="2">
+                                        <property name="name">
+                                            <cstring>BackgroundLineEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignLeft</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Path to background picture</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLabel" row="1" column="0">
+                                        <property name="name">
+                                            <cstring>TextLabel2</cstring>
+                                        </property>
+                                        <property name="text">
+                                            <string>Node Name</string>
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>Name is not used</string>
+                                        </property>
+                                    </widget>
+                                    <widget class="QLineEdit" row="0" column="2">
+                                        <property name="name">
+                                            <cstring>nodeIdLineEdit</cstring>
+                                        </property>
+                                        <property name="alignment">
+                                            <set>AlignRight</set>
+                                        </property>
+                                        <property name="hAlign" stdset="0">
+                                        </property>
+                                        <property name="whatsThis" stdset="0">
+                                            <string>unique identifier for node</string>
+                                        </property>
+                                    </widget>
+                                </grid>
                             </widget>
-                            <widget class="QLabel">
-                                <property name="name">
-                                    <cstring>TextLabel4</cstring>
-                                </property>
-                                <property name="text">
-                                    <string>Place text here:</string>
-                                </property>
-                            </widget>
-                            <widget class="QMultiLineEdit">
-                                <property name="name">
-                                    <cstring>commonMultiLineEdit</cstring>
-                                </property>
-                                <property name="minimumSize">
-                                    <size>
-                                        <width>0</width>
-                                        <height>90</height>
-                                    </size>
-                                </property>
-                                <property name="whatsThis" stdset="0">
-                                    <string>Text in this edit can be set aso player or alian answer.</string>
-                                </property>
-                            </widget>
-                        </vbox>
+                        </grid>
                     </widget>
-                    <widget class="QLayoutWidget">
+                    <widget class="QWidget">
                         <property name="name">
-                            <cstring>Layout14</cstring>
+                            <cstring>tab</cstring>
                         </property>
+                        <attribute name="title">
+                            <string>Answer</string>
+                        </attribute>
                         <vbox>
                             <property name="name">
                                 <cstring>unnamed</cstring>
                             </property>
                             <property name="margin">
-                                <number>0</number>
+                                <number>11</number>
                             </property>
                             <property name="spacing">
                                 <number>6</number>
                             </property>
-                            <widget class="QCheckBox">
+                            <widget class="QLayoutWidget">
                                 <property name="name">
-                                    <cstring>TestModeCheckBox</cstring>
+                                    <cstring>Layout12</cstring>
                                 </property>
-                                <property name="text">
-                                    <string>Test Mode (Hide not allowed answers)</string>
-                                </property>
-                            </widget>
-                            <widget class="QTabWidget">
-                                <property name="name">
-                                    <cstring>TabWidget2</cstring>
-                                </property>
-                                <property name="sizePolicy">
-                                    <sizepolicy>
-                                        <hsizetype>4</hsizetype>
-                                        <vsizetype>4</vsizetype>
-                                        <horstretch>0</horstretch>
-                                        <verstretch>0</verstretch>
-                                    </sizepolicy>
-                                </property>
-                                <property name="minimumSize">
-                                    <size>
-                                        <width>200</width>
-                                        <height>250</height>
-                                    </size>
-                                </property>
-                                <property name="margin">
-                                    <number>0</number>
-                                </property>
-                                <widget class="QWidget">
+                                <vbox>
                                     <property name="name">
-                                        <cstring>tab</cstring>
+                                        <cstring>unnamed</cstring>
                                     </property>
-                                    <attribute name="title">
-                                        <string>Node</string>
-                                    </attribute>
-                                    <grid>
+                                    <property name="margin">
+                                        <number>0</number>
+                                    </property>
+                                    <property name="spacing">
+                                        <number>6</number>
+                                    </property>
+                                    <widget class="QLayoutWidget">
                                         <property name="name">
-                                            <cstring>unnamed</cstring>
+                                            <cstring>Layout11</cstring>
                                         </property>
-                                        <property name="margin">
-                                            <number>11</number>
-                                        </property>
-                                        <property name="spacing">
-                                            <number>6</number>
-                                        </property>
-                                        <widget class="QLayoutWidget" row="0" column="0">
+                                        <hbox>
                                             <property name="name">
-                                                <cstring>Layout15</cstring>
+                                                <cstring>unnamed</cstring>
                                             </property>
-                                            <grid>
+                                            <property name="margin">
+                                                <number>0</number>
+                                            </property>
+                                            <property name="spacing">
+                                                <number>6</number>
+                                            </property>
+                                            <widget class="QLabel">
                                                 <property name="name">
-                                                    <cstring>unnamed</cstring>
+                                                    <cstring>TextLabel1_2</cstring>
                                                 </property>
-                                                <property name="margin">
-                                                    <number>0</number>
+                                                <property name="text">
+                                                    <string>Appear condition:</string>
                                                 </property>
-                                                <property name="spacing">
-                                                    <number>6</number>
+                                            </widget>
+                                            <widget class="QLineEdit">
+                                                <property name="name">
+                                                    <cstring>appearConditionLineEdit</cstring>
                                                 </property>
-                                                <widget class="QLineEdit" row="5" column="1" rowspan="1" colspan="2">
-                                                    <property name="name">
-                                                        <cstring>textLocationLineEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignLeft</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Alien text location</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLineEdit" row="1" column="1" rowspan="1" colspan="2">
-                                                    <property name="name">
-                                                        <cstring>NodeNameLineEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignLeft</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Name is not used</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="4" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel1_3</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Font:</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Alien text font</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLineEdit" row="4" column="1" rowspan="1" colspan="2">
-                                                    <property name="name">
-                                                        <cstring>fontLineEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignLeft</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Alien text font</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="2" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel3_2</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Music</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Path to music file</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="0" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel1</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Node ID</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>unique identifier for node</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="5" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel2_3</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Text location:</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Alien text location</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="3" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel4_2</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Background</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Path to background picture</string>
-                                                    </property>
-                                                </widget>
-                                                <spacer row="0" column="1">
-                                                    <property name="name">
-                                                        <cstring>Spacer1</cstring>
-                                                    </property>
-                                                    <property name="orientation">
-                                                        <enum>Horizontal</enum>
-                                                    </property>
-                                                    <property name="sizeType">
-                                                        <enum>Expanding</enum>
-                                                    </property>
-                                                    <property name="sizeHint">
-                                                        <size>
-                                                            <width>20</width>
-                                                            <height>20</height>
-                                                        </size>
-                                                    </property>
-                                                </spacer>
-                                                <widget class="QLineEdit" row="2" column="1" rowspan="1" colspan="2">
-                                                    <property name="name">
-                                                        <cstring>MusicEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignLeft</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Path to music file</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLineEdit" row="3" column="1" rowspan="1" colspan="2">
-                                                    <property name="name">
-                                                        <cstring>BackgroundLineEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignLeft</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Path to background picture</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLabel" row="1" column="0">
-                                                    <property name="name">
-                                                        <cstring>TextLabel2</cstring>
-                                                    </property>
-                                                    <property name="text">
-                                                        <string>Node Name</string>
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>Name is not used</string>
-                                                    </property>
-                                                </widget>
-                                                <widget class="QLineEdit" row="0" column="2">
-                                                    <property name="name">
-                                                        <cstring>nodeIdLineEdit</cstring>
-                                                    </property>
-                                                    <property name="alignment">
-                                                        <set>AlignRight</set>
-                                                    </property>
-                                                    <property name="hAlign" stdset="0">
-                                                    </property>
-                                                    <property name="whatsThis" stdset="0">
-                                                        <string>unique identifier for node</string>
-                                                    </property>
-                                                </widget>
-                                            </grid>
-                                        </widget>
-                                    </grid>
-                                </widget>
-                                <widget class="QWidget">
-                                    <property name="name">
-                                        <cstring>tab</cstring>
-                                    </property>
-                                    <attribute name="title">
-                                        <string>Answer</string>
-                                    </attribute>
-                                    <vbox>
+                                                <property name="whatsThis" stdset="0">
+                                                    <string>Answer will not show, if doesn.t match</string>
+                                                </property>
+                                            </widget>
+                                        </hbox>
+                                    </widget>
+                                    <widget class="QGroupBox">
                                         <property name="name">
-                                            <cstring>unnamed</cstring>
+                                            <cstring>GroupBox1</cstring>
                                         </property>
-                                        <property name="margin">
-                                            <number>11</number>
+                                        <property name="title">
+                                            <string>Actions</string>
                                         </property>
-                                        <property name="spacing">
-                                            <number>6</number>
-                                        </property>
-                                        <widget class="QLayoutWidget">
+                                        <hbox>
                                             <property name="name">
-                                                <cstring>Layout12</cstring>
+                                                <cstring>unnamed</cstring>
                                             </property>
-                                            <vbox>
+                                            <property name="margin">
+                                                <number>11</number>
+                                            </property>
+                                            <property name="spacing">
+                                                <number>6</number>
+                                            </property>
+                                            <widget class="QLayoutWidget">
                                                 <property name="name">
-                                                    <cstring>unnamed</cstring>
+                                                    <cstring>Layout10</cstring>
                                                 </property>
-                                                <property name="margin">
-                                                    <number>0</number>
-                                                </property>
-                                                <property name="spacing">
-                                                    <number>6</number>
-                                                </property>
-                                                <widget class="QLayoutWidget">
+                                                <vbox>
                                                     <property name="name">
-                                                        <cstring>Layout11</cstring>
+                                                        <cstring>unnamed</cstring>
                                                     </property>
-                                                    <hbox>
+                                                    <property name="margin">
+                                                        <number>0</number>
+                                                    </property>
+                                                    <property name="spacing">
+                                                        <number>6</number>
+                                                    </property>
+                                                    <widget class="QLayoutWidget">
                                                         <property name="name">
-                                                            <cstring>unnamed</cstring>
+                                                            <cstring>Layout5</cstring>
                                                         </property>
-                                                        <property name="margin">
-                                                            <number>0</number>
+                                                        <hbox>
+                                                            <property name="name">
+                                                                <cstring>unnamed</cstring>
+                                                            </property>
+                                                            <property name="margin">
+                                                                <number>0</number>
+                                                            </property>
+                                                            <property name="spacing">
+                                                                <number>6</number>
+                                                            </property>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel2_2</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>condition</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>condition1LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel7</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>do</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>action1LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                        </hbox>
+                                                    </widget>
+                                                    <widget class="QLayoutWidget">
+                                                        <property name="name">
+                                                            <cstring>Layout6</cstring>
                                                         </property>
-                                                        <property name="spacing">
-                                                            <number>6</number>
+                                                        <hbox>
+                                                            <property name="name">
+                                                                <cstring>unnamed</cstring>
+                                                            </property>
+                                                            <property name="margin">
+                                                                <number>0</number>
+                                                            </property>
+                                                            <property name="spacing">
+                                                                <number>6</number>
+                                                            </property>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel3_3</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>condition</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>condition2LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel8</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>do</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>action2LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                        </hbox>
+                                                    </widget>
+                                                    <widget class="QLayoutWidget">
+                                                        <property name="name">
+                                                            <cstring>Layout7</cstring>
                                                         </property>
-                                                        <widget class="QLabel">
+                                                        <hbox>
                                                             <property name="name">
-                                                                <cstring>TextLabel1_2</cstring>
+                                                                <cstring>unnamed</cstring>
                                                             </property>
-                                                            <property name="text">
-                                                                <string>Appear condition:</string>
+                                                            <property name="margin">
+                                                                <number>0</number>
                                                             </property>
-                                                        </widget>
-                                                        <widget class="QLineEdit">
+                                                            <property name="spacing">
+                                                                <number>6</number>
+                                                            </property>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel4_3</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>condition</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>condition3LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel9</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>do</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>action3LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                        </hbox>
+                                                    </widget>
+                                                    <widget class="QLayoutWidget">
+                                                        <property name="name">
+                                                            <cstring>Layout8</cstring>
+                                                        </property>
+                                                        <hbox>
                                                             <property name="name">
-                                                                <cstring>appearConditionLineEdit</cstring>
+                                                                <cstring>unnamed</cstring>
                                                             </property>
-                                                            <property name="whatsThis" stdset="0">
-                                                                <string>Answer will not show, if doesn.t match</string>
+                                                            <property name="margin">
+                                                                <number>0</number>
                                                             </property>
-                                                        </widget>
-                                                    </hbox>
-                                                </widget>
-                                                <widget class="QGroupBox">
-                                                    <property name="name">
-                                                        <cstring>GroupBox1</cstring>
-                                                    </property>
-                                                    <property name="title">
-                                                        <string>Actions</string>
-                                                    </property>
-                                                    <hbox>
+                                                            <property name="spacing">
+                                                                <number>6</number>
+                                                            </property>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel5</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>condition</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>condition4LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel10</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>do</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>action4LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                        </hbox>
+                                                    </widget>
+                                                    <widget class="QLayoutWidget">
                                                         <property name="name">
-                                                            <cstring>unnamed</cstring>
+                                                            <cstring>Layout9</cstring>
                                                         </property>
-                                                        <property name="margin">
-                                                            <number>11</number>
-                                                        </property>
-                                                        <property name="spacing">
-                                                            <number>6</number>
-                                                        </property>
-                                                        <widget class="QLayoutWidget">
+                                                        <hbox>
                                                             <property name="name">
-                                                                <cstring>Layout10</cstring>
+                                                                <cstring>unnamed</cstring>
                                                             </property>
-                                                            <vbox>
+                                                            <property name="margin">
+                                                                <number>0</number>
+                                                            </property>
+                                                            <property name="spacing">
+                                                                <number>6</number>
+                                                            </property>
+                                                            <widget class="QLabel">
                                                                 <property name="name">
-                                                                    <cstring>unnamed</cstring>
+                                                                    <cstring>TextLabel6</cstring>
                                                                 </property>
-                                                                <property name="margin">
-                                                                    <number>0</number>
+                                                                <property name="text">
+                                                                    <string>condition</string>
                                                                 </property>
-                                                                <property name="spacing">
-                                                                    <number>6</number>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>condition5LineEdit</cstring>
                                                                 </property>
-                                                                <widget class="QLayoutWidget">
-                                                                    <property name="name">
-                                                                        <cstring>Layout5</cstring>
-                                                                    </property>
-                                                                    <hbox>
-                                                                        <property name="name">
-                                                                            <cstring>unnamed</cstring>
-                                                                        </property>
-                                                                        <property name="margin">
-                                                                            <number>0</number>
-                                                                        </property>
-                                                                        <property name="spacing">
-                                                                            <number>6</number>
-                                                                        </property>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel2_2</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>condition</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>condition1LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel7</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>do</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>action1LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                    </hbox>
-                                                                </widget>
-                                                                <widget class="QLayoutWidget">
-                                                                    <property name="name">
-                                                                        <cstring>Layout6</cstring>
-                                                                    </property>
-                                                                    <hbox>
-                                                                        <property name="name">
-                                                                            <cstring>unnamed</cstring>
-                                                                        </property>
-                                                                        <property name="margin">
-                                                                            <number>0</number>
-                                                                        </property>
-                                                                        <property name="spacing">
-                                                                            <number>6</number>
-                                                                        </property>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel3_3</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>condition</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>condition2LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel8</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>do</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>action2LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                    </hbox>
-                                                                </widget>
-                                                                <widget class="QLayoutWidget">
-                                                                    <property name="name">
-                                                                        <cstring>Layout7</cstring>
-                                                                    </property>
-                                                                    <hbox>
-                                                                        <property name="name">
-                                                                            <cstring>unnamed</cstring>
-                                                                        </property>
-                                                                        <property name="margin">
-                                                                            <number>0</number>
-                                                                        </property>
-                                                                        <property name="spacing">
-                                                                            <number>6</number>
-                                                                        </property>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel4_3</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>condition</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>condition3LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel9</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>do</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>action3LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                    </hbox>
-                                                                </widget>
-                                                                <widget class="QLayoutWidget">
-                                                                    <property name="name">
-                                                                        <cstring>Layout8</cstring>
-                                                                    </property>
-                                                                    <hbox>
-                                                                        <property name="name">
-                                                                            <cstring>unnamed</cstring>
-                                                                        </property>
-                                                                        <property name="margin">
-                                                                            <number>0</number>
-                                                                        </property>
-                                                                        <property name="spacing">
-                                                                            <number>6</number>
-                                                                        </property>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel5</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>condition</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>condition4LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel10</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>do</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>action4LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                    </hbox>
-                                                                </widget>
-                                                                <widget class="QLayoutWidget">
-                                                                    <property name="name">
-                                                                        <cstring>Layout9</cstring>
-                                                                    </property>
-                                                                    <hbox>
-                                                                        <property name="name">
-                                                                            <cstring>unnamed</cstring>
-                                                                        </property>
-                                                                        <property name="margin">
-                                                                            <number>0</number>
-                                                                        </property>
-                                                                        <property name="spacing">
-                                                                            <number>6</number>
-                                                                        </property>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel6</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>condition</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>condition5LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLabel">
-                                                                            <property name="name">
-                                                                                <cstring>TextLabel11</cstring>
-                                                                            </property>
-                                                                            <property name="text">
-                                                                                <string>do</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                        <widget class="QLineEdit">
-                                                                            <property name="name">
-                                                                                <cstring>action5LineEdit</cstring>
-                                                                            </property>
-                                                                            <property name="whatsThis" stdset="0">
-                                                                                <string>if condition match, coresponding action will be evaluated</string>
-                                                                            </property>
-                                                                        </widget>
-                                                                    </hbox>
-                                                                </widget>
-                                                            </vbox>
-                                                        </widget>
-                                                    </hbox>
-                                                </widget>
-                                            </vbox>
-                                        </widget>
-                                    </vbox>
-                                </widget>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLabel">
+                                                                <property name="name">
+                                                                    <cstring>TextLabel11</cstring>
+                                                                </property>
+                                                                <property name="text">
+                                                                    <string>do</string>
+                                                                </property>
+                                                            </widget>
+                                                            <widget class="QLineEdit">
+                                                                <property name="name">
+                                                                    <cstring>action5LineEdit</cstring>
+                                                                </property>
+                                                                <property name="whatsThis" stdset="0">
+                                                                    <string>if condition match, coresponding action will be evaluated</string>
+                                                                </property>
+                                                            </widget>
+                                                        </hbox>
+                                                    </widget>
+                                                </vbox>
+                                            </widget>
+                                        </hbox>
+                                    </widget>
+                                </vbox>
                             </widget>
                         </vbox>
                     </widget>
-                </widget>
-                <widget class="QLayoutWidget">
-                    <property name="name">
-                        <cstring>Layout19</cstring>
-                    </property>
-                    <vbox>
+                    <widget class="QWidget">
                         <property name="name">
-                            <cstring>unnamed</cstring>
+                            <cstring>TabPage</cstring>
                         </property>
-                        <property name="margin">
-                            <number>0</number>
-                        </property>
-                        <property name="spacing">
-                            <number>6</number>
-                        </property>
-                        <widget class="QLayoutWidget">
+                        <attribute name="title">
+                            <string>Init/deinit</string>
+                        </attribute>
+                        <grid>
                             <property name="name">
-                                <cstring>Layout18</cstring>
+                                <cstring>unnamed</cstring>
                             </property>
-                            <hbox>
+                            <widget class="QSplitter" row="0" column="0">
                                 <property name="name">
-                                    <cstring>unnamed</cstring>
+                                    <cstring>splitter14</cstring>
                                 </property>
-                                <property name="margin">
-                                    <number>0</number>
+                                <property name="orientation">
+                                    <enum>Horizontal</enum>
                                 </property>
-                                <property name="spacing">
-                                    <number>6</number>
-                                </property>
-                                <widget class="QLabel">
+                                <widget class="QLayoutWidget">
                                     <property name="name">
-                                        <cstring>TextLabel3</cstring>
+                                        <cstring>layout36</cstring>
                                     </property>
-                                    <property name="text">
-                                        <string>Triggers:</string>
-                                    </property>
+                                    <vbox>
+                                        <property name="name">
+                                            <cstring>unnamed</cstring>
+                                        </property>
+                                        <widget class="QLabel">
+                                            <property name="name">
+                                                <cstring>textLabel1</cstring>
+                                            </property>
+                                            <property name="text">
+                                                <string>Start</string>
+                                            </property>
+                                        </widget>
+                                        <widget class="QTextEdit">
+                                            <property name="name">
+                                                <cstring>startDialogCode_textEdit</cstring>
+                                            </property>
+                                            <property name="toolTip" stdset="0">
+                                                <string>This code will be evaluated before start dialog</string>
+                                            </property>
+                                            <property name="whatsThis" stdset="0">
+                                                <string>This code will be evaluated before start dialog</string>
+                                            </property>
+                                        </widget>
+                                    </vbox>
                                 </widget>
-                                <widget class="QLabel">
+                                <widget class="QLayoutWidget">
                                     <property name="name">
-                                        <cstring>TextLabel12</cstring>
+                                        <cstring>layout35</cstring>
                                     </property>
-                                    <property name="text">
-                                        <string>Name</string>
-                                    </property>
+                                    <vbox>
+                                        <property name="name">
+                                            <cstring>unnamed</cstring>
+                                        </property>
+                                        <widget class="QLabel">
+                                            <property name="name">
+                                                <cstring>textLabel1_2</cstring>
+                                            </property>
+                                            <property name="text">
+                                                <string>End</string>
+                                            </property>
+                                        </widget>
+                                        <widget class="QTextEdit">
+                                            <property name="name">
+                                                <cstring>endDialogCode_textEdit</cstring>
+                                            </property>
+                                            <property name="toolTip" stdset="0">
+                                                <string>This code will be evaluated after finishing dialog</string>
+                                            </property>
+                                            <property name="whatsThis" stdset="0">
+                                                <string>This code will be evaluated after finishing dialog</string>
+                                            </property>
+                                        </widget>
+                                    </vbox>
                                 </widget>
-                                <widget class="QLabel">
-                                    <property name="name">
-                                        <cstring>TextLabel13</cstring>
-                                    </property>
-                                    <property name="text">
-                                        <string>Value</string>
-                                    </property>
-                                </widget>
-                            </hbox>
-                        </widget>
-                        <widget class="QTable">
-                            <property name="name">
-                                <cstring>triggerTable</cstring>
-                            </property>
-                            <property name="maximumSize">
-                                <size>
-                                    <width>200</width>
-                                    <height>32767</height>
-                                </size>
-                            </property>
-                            <property name="numRows">
-                                <number>6</number>
-                            </property>
-                            <property name="numCols">
-                                <number>6</number>
-                            </property>
-                            <property name="whatsThis" stdset="0">
-                                <string>First column - trigger name, second - value</string>
-                            </property>
-                        </widget>
-                        <widget class="QListView">
-                            <column>
-                                <property name="text">
-                                    <string>ID</string>
-                                </property>
-                                <property name="clickable">
-                                    <bool>true</bool>
-                                </property>
-                                <property name="resizable">
-                                    <bool>true</bool>
-                                </property>
-                            </column>
-                            <column>
-                                <property name="text">
-                                    <string>Name</string>
-                                </property>
-                                <property name="clickable">
-                                    <bool>true</bool>
-                                </property>
-                                <property name="resizable">
-                                    <bool>true</bool>
-                                </property>
-                            </column>
-                            <property name="name">
-                                <cstring>nodeListView</cstring>
-                            </property>
-                            <property name="sizePolicy">
-                                <sizepolicy>
-                                    <hsizetype>7</hsizetype>
-                                    <vsizetype>5</vsizetype>
-                                    <horstretch>0</horstretch>
-                                    <verstretch>0</verstretch>
-                                </sizepolicy>
-                            </property>
-                            <property name="maximumSize">
-                                <size>
-                                    <width>200</width>
-                                    <height>32767</height>
-                                </size>
-                            </property>
-                            <property name="whatsThis" stdset="0">
-                                <string>Browse nodes from here</string>
-                            </property>
-                        </widget>
-                    </vbox>
+                            </widget>
+                        </grid>
+                    </widget>
                 </widget>
+                <widget class="QListView">
+                    <column>
+                        <property name="text">
+                            <string>ID</string>
+                        </property>
+                        <property name="clickable">
+                            <bool>true</bool>
+                        </property>
+                        <property name="resizable">
+                            <bool>true</bool>
+                        </property>
+                    </column>
+                    <column>
+                        <property name="text">
+                            <string>Name</string>
+                        </property>
+                        <property name="clickable">
+                            <bool>true</bool>
+                        </property>
+                        <property name="resizable">
+                            <bool>true</bool>
+                        </property>
+                    </column>
+                    <property name="name">
+                        <cstring>nodeListView</cstring>
+                    </property>
+                    <property name="sizePolicy">
+                        <sizepolicy>
+                            <hsizetype>7</hsizetype>
+                            <vsizetype>5</vsizetype>
+                            <horstretch>0</horstretch>
+                            <verstretch>0</verstretch>
+                        </sizepolicy>
+                    </property>
+                    <property name="maximumSize">
+                        <size>
+                            <width>200</width>
+                            <height>32767</height>
+                        </size>
+                    </property>
+                    <property name="resizeMode">
+                        <enum>LastColumn</enum>
+                    </property>
+                    <property name="whatsThis" stdset="0">
+                        <string>Browse nodes from here</string>
+                    </property>
+                </widget>
             </widget>
             <widget class="QListView">
                 <column>
@@ -827,6 +815,18 @@
                 <property name="name">
                     <cstring>answersListView</cstring>
                 </property>
+                <property name="acceptDrops">
+                    <bool>true</bool>
+                </property>
+                <property name="frameShape">
+                    <enum>TabWidgetPanel</enum>
+                </property>
+                <property name="resizeMode">
+                    <enum>LastColumn</enum>
+                </property>
+                <property name="defaultRenameAction">
+                    <enum>Accept</enum>
+                </property>
                 <property name="whatsThis" stdset="0">
                     <string>Player Answers</string>
                 </property>
@@ -867,7 +867,6 @@
     <tabstop>BackgroundLineEdit</tabstop>
     <tabstop>commonMultiLineEdit</tabstop>
     <tabstop>nodeListView</tabstop>
-    <tabstop>triggerTable</tabstop>
     <tabstop>alienTextBrowser</tabstop>
     <tabstop>TabWidget2</tabstop>
     <tabstop>appearConditionLineEdit</tabstop>
@@ -882,11 +881,14 @@
     <tabstop>condition5LineEdit</tabstop>
     <tabstop>action5LineEdit</tabstop>
 </tabstops>
+<includes>
+    <include location="local" impldecl="in implementation">maindialog.ui.h</include>
+</includes>
 <slots>
-    <slot>answerChangedSlot(QListViewItem*)</slot>
-    <slot>answerPositionChanged(int)</slot>
-    <slot>nodeChangedSlot(QListViewItem* )</slot>
-    <slot>processAnswerSlot(QListViewItem*)</slot>
+    <slot>answerChangedSlot( QListViewItem * )</slot>
+    <slot>answerPositionChanged( int )</slot>
+    <slot>nodeChangedSlot( QListViewItem * )</slot>
+    <slot>processAnswerSlot( QListViewItem * )</slot>
     <slot>saveAnswer()</slot>
     <slot>saveNodeInfo()</slot>
 </slots>

Modified: trunk/Util/deditor/mainwidget.cpp
===================================================================
--- trunk/Util/deditor/mainwidget.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/mainwidget.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -24,340 +24,364 @@
 #include <unistd.h>
 #endif
 
-extern "C" {
-#	include "lua.h"
-#	include "lualib.h"
-#	include "lauxlib.h"
+/*extern "C" {
+#   include "lua.h"
+#   include "lualib.h"
+#   include "lauxlib.h"
 }
+  */
 
 DialogEditor::DialogEditor( QWidget* parent, const char* name, WFlags fl ): DialogEditorGenerated(parent, name, fl)
 {
-	WriteLog("DialogEditor::DialogEditor\n");
-	alienTextBrowser->setFrameStyle( QFrame::Panel | QFrame::Sunken );
-	alienTextBrowser->setText("<HTML><BODY><center><img width=\"100\" height=\"100\" src=\"./tw-logo.png\"><br>Alien text and picture will be here</center></BODY></HTML>");
-	alienTextBrowser->mimeSourceFactory()->setExtensionType("qml", "text/utf8");
+    WriteLog("DialogEditor::DialogEditor\n");
+    alienTextBrowser->setFrameStyle( QFrame::Panel | QFrame::Sunken );
+    alienTextBrowser->setText("<HTML><BODY><center><img width=\"100\" height=\"100\" src=\"./tw-logo.png\"><br>Alien text and picture will be here</center></BODY></HTML>");
+    alienTextBrowser->mimeSourceFactory()->setExtensionType("qml", "text/utf8");
 
-	CreateNewNode();
-	answersListView->setSorting(-1);
+    CreateNewNode();
+    answersListView->setSorting(-1);
 }
 
 DialogEditor::~DialogEditor()
 {
-	WriteLog("DialogEditor::~DialogEditor\n");
+    WriteLog("DialogEditor::~DialogEditor\n");
 }
 
 
 PlayerAnswer* DialogEditor::getPlayerAnswer(const QString& text)
 {
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	PlayerAnswer * a;
-	for(a = node->m_answers.first();
-			a; a = node->m_answers.next())
-		if(a->m_strText == text)
-			break;
-	assert(a&&"Answer was not found in node!!!");
-	return a;
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    PlayerAnswer * a;
+    for(a = node->m_answers.first();
+            a; a = node->m_answers.next())
+        if(a->m_strText == text)
+            break;
+    assert(a&&"Answer was not found in node!!!");
+    return a;
 }
 
 int DialogEditor::getPlayerAnswerPos(const QString& text)
 {
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	PlayerAnswer * a;
-	int pos = 0;
-	for(a = node->m_answers.first();
-			a; a = node->m_answers.next())
-			{
-				if(a->m_strText == text)
-					break;
-				pos++;
-			}
-	assert(a&&"Answer was not found in node!!!");
-	return pos;
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    PlayerAnswer * a;
+    int pos = 0;
+    for(a = node->m_answers.first();
+            a; a = node->m_answers.next())
+            {
+                if(a->m_strText == text)
+                    break;
+                pos++;
+            }
+    assert(a&&"Answer was not found in node!!!");
+    return pos;
 }
 
 void DialogEditor::removeAnswer()
-{		
-	WriteLog("DialogEditor::removeAnswer()\n");
-	QListViewItem * curAnsw = answersListView->currentItem();
-	if (!curAnsw)
-			return;
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	node->m_answers.remove(getPlayerAnswer(curAnsw->text(0)));
+{       
+    WriteLog("DialogEditor::removeAnswer()\n");
+    QListViewItem * curAnsw = answersListView->currentItem();
+    if (!curAnsw)
+            return;
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    node->m_answers.remove(getPlayerAnswer(curAnsw->text(0)));
 
-	delete curAnsw;
+    delete curAnsw;
 }
 
 void DialogEditor::removeNode()
 {
-	WriteLog("DialogEditor::removeNode()\n");
-	if(nodeListView->childCount()==1)
-		return;
-	
-	QListViewItem* item= nodeListView->currentItem();
-	QListViewItemIterator it( item );
-	it++;
-	if(it.current())
-	{
-		nodeListView->setCurrentItem(it.current());
-	}
-	else
-	{
-		QListViewItemIterator i( item );
-		i--;
-		nodeListView->setCurrentItem(i.current());
-	}
-	delete item;
+    WriteLog("DialogEditor::removeNode()\n");
+    if(nodeListView->childCount()==1)
+        return;
+    
+    QListViewItem* item= nodeListView->currentItem();
+    QListViewItemIterator it( item );
+    it++;
+    if(it.current())
+    {
+        nodeListView->setCurrentItem(it.current());
+    }
+    else
+    {
+        QListViewItemIterator i( item );
+        i--;
+        nodeListView->setCurrentItem(i.current());
+    }
+    delete item;
 }
 
 void DialogEditor::CreateNewNode()
 {
-	WriteLog("DialogEditor::CreateNewNode()\n");
-	int nodeCount = nodeListView->childCount();
-	
-	QString strId;
-	if (nodeCount)
-	{
-		int id = 0;
-		QListViewItem* item = nodeListView->firstChild ();
-		QListViewItemIterator it( item );
-		for(;it.current();it++)
-		{
-			if(it.current()->text(0).toInt()>id)
-				id = it.current()->text(0).toInt();
-		}
-		strId.sprintf("%d",id+1);
-	}
-	else
-	{
-		strId = "0";
-	}
-	NodeItem* critem = new NodeItem ( nodeListView ) ;
+    WriteLog("DialogEditor::CreateNewNode()\n");
+    int nodeCount = nodeListView->childCount();
+    
+    QString strId;
+    if (nodeCount)
+    {
+        int id = 0;
+        QListViewItem* item = nodeListView->firstChild ();
+        QListViewItemIterator it( item );
+        for(;it.current();it++)
+        {
+            if(it.current()->text(0).toInt()>id)
+                id = it.current()->text(0).toInt();
+        }
+        strId.sprintf("%d",id+1);
+    }
+    else
+    {
+        strId = "0";
+    }
+    NodeItem* critem = new NodeItem ( nodeListView ) ;
 
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	if(node)
-	{
-		critem->setFont(node->m_strFont);
-		critem->setPicture(node->m_strPicture);
-		critem->setTextLocation(node->m_strTextLocation);
-		critem->setMusic(node->m_strMusic);
-	}
-	critem->setName("New node name");
-	critem->setID( strId );
-	nodeListView->setCurrentItem(critem);
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    if(node)
+    {
+        critem->setFont(node->m_strFont);
+        critem->setPicture(node->m_strPicture);
+        critem->setTextLocation(node->m_strTextLocation);
+        critem->setMusic(node->m_strMusic);
+    }
+    critem->setName("New node name");
+    critem->setID( strId );
+    nodeListView->setCurrentItem(critem);
 }
 
 void DialogEditor::nodeChangedSlot(QListViewItem* i)
 {
-	WriteLog("DialogEditor::nodeChangedSlot\n");
-	NodeItem * node = (NodeItem*)i;
-	if (!i)
-		return;
+    WriteLog("DialogEditor::nodeChangedSlot\n");
+    NodeItem * node = (NodeItem*)i;
+    if (!i)
+        return;
 
-	// disconnect edits from previous
-	disconnect( nodeIdLineEdit,     0, 0, 0 );
-	disconnect( NodeNameLineEdit,   0, 0, 0 );
-	disconnect( MusicEdit,          0, 0, 0 );
-	disconnect( BackgroundLineEdit, 0, 0, 0 );
-	disconnect( textLocationLineEdit, 0, 0, 0 );
-	disconnect( fontLineEdit, 0, 0, 0 );
+    // disconnect edits from previous
+    disconnect( nodeIdLineEdit,     0, 0, 0 );
+    disconnect( NodeNameLineEdit,   0, 0, 0 );
+    disconnect( MusicEdit,          0, 0, 0 );
+    disconnect( BackgroundLineEdit, 0, 0, 0 );
+    disconnect( textLocationLineEdit, 0, 0, 0 );
+    disconnect( fontLineEdit, 0, 0, 0 );
 
-	connect( nodeIdLineEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setID(const QString&)));
-	connect( NodeNameLineEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setName(const QString&)));
-	connect( MusicEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setMusic(const QString&)));
-	connect( BackgroundLineEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setPicture(const QString&)));
-	connect( textLocationLineEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setTextLocation(const QString&)));
-	connect( fontLineEdit, SIGNAL( textChanged ( const QString&)), 
-		node, SLOT(setFont(const QString&)));
+    connect( nodeIdLineEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setID(const QString&)));
+    connect( NodeNameLineEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setName(const QString&)));
+    connect( MusicEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setMusic(const QString&)));
+    connect( BackgroundLineEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setPicture(const QString&)));
+    connect( textLocationLineEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setTextLocation(const QString&)));
+    connect( fontLineEdit, SIGNAL( textChanged ( const QString&)), 
+        node, SLOT(setFont(const QString&)));
 
-	nodeIdLineEdit      ->setText(node->text(0));
-	NodeNameLineEdit    ->setText(node->text(1));
-	MusicEdit           ->setText(node->m_strMusic);
-	BackgroundLineEdit  ->setText(node->m_strPicture);
-	textLocationLineEdit->setText(node->m_strTextLocation);
-	fontLineEdit        ->setText(node->m_strFont);
+    nodeIdLineEdit      ->setText(node->text(0));
+    NodeNameLineEdit    ->setText(node->text(1));
+    MusicEdit           ->setText(node->m_strMusic);
+    BackgroundLineEdit  ->setText(node->m_strPicture);
+    textLocationLineEdit->setText(node->m_strTextLocation);
+    fontLineEdit        ->setText(node->m_strFont);
 
-	// Set Browser
-	QString browserText;
-	browserText += "<HTML><BODY><CENTER>";
-	if(node->m_strPicture!= "")
-	{
-		browserText += QString("").sprintf("<img width=\"100\" height=\"100\""
-			"src=\"alien\" alt=\"Home\" border=\"0\"><br>");
-	}
+    // Set Browser
+    QString browserText;
+    browserText += "<HTML><BODY><CENTER>";
+    if(node->m_strPicture!= "")
+    {
+        browserText += QString("").sprintf("<img width=\"100\" height=\"100\""
+            "src=\"alien\" alt=\"Home\" border=\"0\"><br>");
+    }
 
-	browserText += node->m_strAlienText;
-	browserText += "</CENTER></BODY></HTML>";
+    browserText += node->m_strAlienText;
+    browserText += "</CENTER></BODY></HTML>";
 
-	alienTextBrowser->mimeSourceFactory()->setFilePath( QDir::currentDirPath() );
-	alienTextBrowser->mimeSourceFactory()->setImage("alien",QImage(BackgroundLineEdit->text()));
-	alienTextBrowser->setText(browserText);
+    alienTextBrowser->mimeSourceFactory()->setFilePath( QDir::currentDirPath() );
+    alienTextBrowser->mimeSourceFactory()->setImage("alien",QImage(BackgroundLineEdit->text()));
+    alienTextBrowser->setText(browserText);
 
-	// Set Answers
-	disconnectAnswer();
-	answersListView->clear();
-	for(PlayerAnswer * a = node->m_answers. last();
-		a; a = node->m_answers.prev())
-	{
-		if (script_check_condition(a->m_strAppearCondition) || !TestModeCheckBox->isChecked ())
-			QListViewItem * item = new QListViewItem(answersListView,a->m_strText);
-	//	answersListView     ->setCurrentItem(item);
-	}
+    // Set Answers
+    disconnectAnswer();
+    answersListView->clear();
+    for(PlayerAnswer * a = node->m_answers. last();
+        a; a = node->m_answers.prev())
+    {
+      if (script_check_condition(a->m_strAppearCondition) || 1/*!TestModeCheckBox->isChecked ()*/)
+            QListViewItem * item = new QListViewItem(answersListView,a->m_strText);
+    //  answersListView     ->setCurrentItem(item);
+    }
 }
 
 
 void DialogEditor::disconnectAnswer()
 {
-	WriteLog("DialogEditor::disconnectAnswer()\n");
-	disconnect(condition1LineEdit, 0, 0, 0);
-	condition1LineEdit->setText("");
-	condition1LineEdit->setEnabled(FALSE);
-	disconnect(condition2LineEdit, 0, 0, 0);
-	condition2LineEdit->setText("");
-	condition2LineEdit->setEnabled(FALSE);
-	disconnect(condition3LineEdit, 0, 0, 0);
-	condition3LineEdit->setText("");
-	condition3LineEdit->setEnabled(FALSE);
-	disconnect(condition4LineEdit, 0, 0, 0);
-	condition4LineEdit->setText("");
-	condition4LineEdit->setEnabled(FALSE);
-	disconnect(condition5LineEdit, 0, 0, 0);
-	condition5LineEdit->setText("");
-	condition5LineEdit->setEnabled(FALSE);
+    WriteLog("DialogEditor::disconnectAnswer()\n");
+    disconnect(condition1LineEdit, 0, 0, 0);
+    condition1LineEdit->setText("");
+    condition1LineEdit->setEnabled(FALSE);
+    disconnect(condition2LineEdit, 0, 0, 0);
+    condition2LineEdit->setText("");
+    condition2LineEdit->setEnabled(FALSE);
+    disconnect(condition3LineEdit, 0, 0, 0);
+    condition3LineEdit->setText("");
+    condition3LineEdit->setEnabled(FALSE);
+    disconnect(condition4LineEdit, 0, 0, 0);
+    condition4LineEdit->setText("");
+    condition4LineEdit->setEnabled(FALSE);
+    disconnect(condition5LineEdit, 0, 0, 0);
+    condition5LineEdit->setText("");
+    condition5LineEdit->setEnabled(FALSE);
 
-	disconnect(action1LineEdit, 0, 0, 0);
-	action1LineEdit->setText("");
-	action1LineEdit->setEnabled(FALSE);
-	disconnect(action2LineEdit, 0, 0, 0);
-	action2LineEdit->setText("");
-	action2LineEdit->setEnabled(FALSE);
-	disconnect(action3LineEdit, 0, 0, 0);
-	action3LineEdit->setText("");
-	action3LineEdit->setEnabled(FALSE);
-	disconnect(action4LineEdit, 0, 0, 0);
-	action4LineEdit->setText("");
-	action4LineEdit->setEnabled(FALSE);
-	disconnect(action5LineEdit, 0, 0, 0);
-	action5LineEdit->setText("");
-	action5LineEdit->setEnabled(FALSE);
+    disconnect(action1LineEdit, 0, 0, 0);
+    action1LineEdit->setText("");
+    action1LineEdit->setEnabled(FALSE);
+    disconnect(action2LineEdit, 0, 0, 0);
+    action2LineEdit->setText("");
+    action2LineEdit->setEnabled(FALSE);
+    disconnect(action3LineEdit, 0, 0, 0);
+    action3LineEdit->setText("");
+    action3LineEdit->setEnabled(FALSE);
+    disconnect(action4LineEdit, 0, 0, 0);
+    action4LineEdit->setText("");
+    action4LineEdit->setEnabled(FALSE);
+    disconnect(action5LineEdit, 0, 0, 0);
+    action5LineEdit->setText("");
+    action5LineEdit->setEnabled(FALSE);
 
-	disconnect(appearConditionLineEdit, 0, 0, 0);
-	appearConditionLineEdit->setText("");
-	appearConditionLineEdit->setEnabled(FALSE);
+    disconnect(appearConditionLineEdit, 0, 0, 0);
+    appearConditionLineEdit->setText("");
+    appearConditionLineEdit->setEnabled(FALSE);
 }
 
 
 void DialogEditor::answerChangedSlot(QListViewItem* item)
 {
-	WriteLog("DialogEditor::answerChangedSlot(QListViewItem* item)\n");
-	disconnectAnswer();
-	if(!item)
-	{
-		condition1LineEdit->setEnabled ( FALSE ) ;
-		return;
-	}
-	
+    WriteLog("DialogEditor::answerChangedSlot(QListViewItem* item)\n");
+    disconnectAnswer();
+    if(!item)
+    {
+        condition1LineEdit->setEnabled ( FALSE ) ;
+        return;
+    }
+    
 
-	PlayerAnswer * pa = getPlayerAnswer(item->text(0));
+    PlayerAnswer * pa = getPlayerAnswer(item->text(0));
 
-	connect( condition1LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setCondition1Line(const QString&)));
-	condition1LineEdit->setEnabled(TRUE);
-	connect( condition2LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setCondition2Line(const QString&)));
-	condition2LineEdit->setEnabled(TRUE);
-	connect( condition3LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setCondition3Line(const QString&)));
-	condition3LineEdit->setEnabled(TRUE);
-	connect( condition4LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setCondition4Line(const QString&)));
-	condition4LineEdit->setEnabled(TRUE);
-	connect( condition5LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setCondition5Line(const QString&)));
-	condition5LineEdit->setEnabled(TRUE);
+    connect( condition1LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setCondition1Line(const QString&)));
+    condition1LineEdit->setEnabled(TRUE);
+    connect( condition2LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setCondition2Line(const QString&)));
+    condition2LineEdit->setEnabled(TRUE);
+    connect( condition3LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setCondition3Line(const QString&)));
+    condition3LineEdit->setEnabled(TRUE);
+    connect( condition4LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setCondition4Line(const QString&)));
+    condition4LineEdit->setEnabled(TRUE);
+    connect( condition5LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setCondition5Line(const QString&)));
+    condition5LineEdit->setEnabled(TRUE);
 
-	connect( action1LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAction1Line(const QString&)));
-	action1LineEdit->setEnabled(TRUE);
-	connect( action2LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAction2Line(const QString&)));
-	action2LineEdit->setEnabled(TRUE);
-	connect( action3LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAction3Line(const QString&)));
-	action3LineEdit->setEnabled(TRUE);
-	connect( action4LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAction4Line(const QString&)));
-	action4LineEdit->setEnabled(TRUE);
-	connect( action5LineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAction5Line(const QString&)));
-	action5LineEdit->setEnabled(TRUE);
+    connect( action1LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAction1Line(const QString&)));
+    action1LineEdit->setEnabled(TRUE);
+    connect( action2LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAction2Line(const QString&)));
+    action2LineEdit->setEnabled(TRUE);
+    connect( action3LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAction3Line(const QString&)));
+    action3LineEdit->setEnabled(TRUE);
+    connect( action4LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAction4Line(const QString&)));
+    action4LineEdit->setEnabled(TRUE);
+    connect( action5LineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAction5Line(const QString&)));
+    action5LineEdit->setEnabled(TRUE);
 
-	connect( appearConditionLineEdit, SIGNAL( textChanged ( const QString&)), 
-		pa, SLOT(setAppearCondition(const QString&)));
-	appearConditionLineEdit->setEnabled(TRUE);
+    connect( appearConditionLineEdit, SIGNAL( textChanged ( const QString&)), 
+        pa, SLOT(setAppearCondition(const QString&)));
+    appearConditionLineEdit->setEnabled(TRUE);
 
-	condition1LineEdit->setText(pa->m_strCond[0]);
-	condition2LineEdit->setText(pa->m_strCond[1]);
-	condition3LineEdit->setText(pa->m_strCond[2]);
-	condition4LineEdit->setText(pa->m_strCond[3]);
-	condition5LineEdit->setText(pa->m_strCond[4]);
+    condition1LineEdit->setText(pa->m_strCond[0]);
+    condition2LineEdit->setText(pa->m_strCond[1]);
+    condition3LineEdit->setText(pa->m_strCond[2]);
+    condition4LineEdit->setText(pa->m_strCond[3]);
+    condition5LineEdit->setText(pa->m_strCond[4]);
 
-	action1LineEdit->setText(pa->m_strAct[0]);
-	action2LineEdit->setText(pa->m_strAct[1]);
-	action3LineEdit->setText(pa->m_strAct[2]);
-	action4LineEdit->setText(pa->m_strAct[3]);
-	action5LineEdit->setText(pa->m_strAct[4]);
+    action1LineEdit->setText(pa->m_strAct[0]);
+    action2LineEdit->setText(pa->m_strAct[1]);
+    action3LineEdit->setText(pa->m_strAct[2]);
+    action4LineEdit->setText(pa->m_strAct[3]);
+    action5LineEdit->setText(pa->m_strAct[4]);
 
-	appearConditionLineEdit->setText(pa->m_strAppearCondition);
+    appearConditionLineEdit->setText(pa->m_strAppearCondition);
 
-	commonMultiLineEdit->setText(item->text(0));
+    commonMultiLineEdit->setText(item->text(0));
 }
 
 QString DialogEditor::GetXML()
 {
-	WriteLog("DialogEditor::edited()\n");
-	QString strRes;
-	strRes += "<NODES>";
-	QListViewItem* item = nodeListView->firstChild ();
-	QListViewItemIterator it( item );
-	for(;it.current();it++)
-	{
-		NodeItem *item = (NodeItem*)it.current();
-		strRes += "<NODE id=\""   + TWEscapeXML(item->text(0)) + "\"";
-		strRes += " name=\""      + TWEscapeXML(item->text(1)) + "\"";
-		strRes += " music=\""     + TWEscapeXML(item->m_strMusic) + "\"";
-		strRes += " background=\""+ TWEscapeXML(item->m_strPicture) + "\"";
-		strRes += " alien_text=\""+ TWEscapeXML(item->m_strAlienText) + "\"";
-		strRes += " font=\""+ TWEscapeXML(item->m_strFont) + "\"";
-		strRes += " text_location=\""+ TWEscapeXML(item->m_strTextLocation) + "\"";
-		strRes += ">";
+    WriteLog("DialogEditor::edited()\n");
+    QString strRes;
+    strRes += "<DIALOG>";
 
+    strRes += "<START_DIALOG>";
+    if(!startDialogCode_textEdit->text().isEmpty())
+      {
+        strRes += "<ACTION ";
+        strRes += "condition=\"" + TWEscapeXML("1") + "\" ";
+        strRes += "action=\"" + TWEscapeXML(startDialogCode_textEdit->text()) + "\">";
+        strRes += "</ACTION>";
+      }
+    strRes += "</START_DIALOG>";
 
-		for(PlayerAnswer * a = item->m_answers.first();
-			a; a = item->m_answers.next())
-		{	
-			strRes +="<PLAYER_ANSWER ";
-			strRes +="text=\"" + TWEscapeXML(a->m_strText) + "\" ";
-			strRes +="appear_condition=\"" + TWEscapeXML(a->m_strAppearCondition) + "\">";
-			
-			for(int j=0;j<5;j++)
-				if( !(a->m_strCond[j].isEmpty()) && !(a->m_strAct[j].isEmpty()))
-				{
-					strRes += "<ACTION ";
-					strRes += "condition=\"" + TWEscapeXML(a->m_strCond[j]) + "\" ";
-					strRes += "action=\"" + TWEscapeXML(a->m_strAct[j]) + "\">";
-					strRes += "</ACTION>";
-				}
-			strRes +="</PLAYER_ANSWER>";
-		}
-		strRes += "</NODE>";
-	}
-	strRes += "</NODES>";
-	return strRes;
+    strRes += "<END_DIALOG>";
+    if(!startDialogCode_textEdit->text().isEmpty())
+      {
+        strRes += "<ACTION ";
+        strRes += "condition=\"" + TWEscapeXML("1") + "\" ";
+        strRes += "action=\"" + TWEscapeXML(endDialogCode_textEdit->text()) + "\">";
+        strRes += "</ACTION>";
+      }
+    strRes += "</END_DIALOG>";
+
+    strRes += "<NODES>";
+    QListViewItem* item = nodeListView->firstChild ();
+    QListViewItemIterator it( item );
+    for(;it.current();it++)
+    {
+        NodeItem *item = (NodeItem*)it.current();
+        strRes += "<NODE id=\""   + TWEscapeXML(item->text(0)) + "\"";
+        strRes += " name=\""      + TWEscapeXML(item->text(1)) + "\"";
+        strRes += " music=\""     + TWEscapeXML(item->m_strMusic) + "\"";
+        strRes += " background=\""+ TWEscapeXML(item->m_strPicture) + "\"";
+        strRes += " alien_text=\""+ TWEscapeXML(item->m_strAlienText) + "\"";
+        strRes += " font=\""+ TWEscapeXML(item->m_strFont) + "\"";
+        strRes += " text_location=\""+ TWEscapeXML(item->m_strTextLocation) + "\"";
+        strRes += ">";
+
+
+        for(PlayerAnswer * a = item->m_answers.first();
+            a; a = item->m_answers.next())
+        {   
+            strRes +="<PLAYER_ANSWER ";
+            strRes +="text=\"" + TWEscapeXML(a->m_strText) + "\" ";
+            strRes +="appear_condition=\"" + TWEscapeXML(a->m_strAppearCondition) + "\">";
+            
+            for(int j=0;j<5;j++)
+                if( !(a->m_strCond[j].isEmpty()) && !(a->m_strAct[j].isEmpty()))
+                {
+                    strRes += "<ACTION ";
+                    strRes += "condition=\"" + TWEscapeXML(a->m_strCond[j]) + "\" ";
+                    strRes += "action=\"" + TWEscapeXML(a->m_strAct[j]) + "\">";
+                    strRes += "</ACTION>";
+                }
+            strRes +="</PLAYER_ANSWER>";
+        }
+        strRes += "</NODE>";
+    }
+    strRes += "</NODES>";
+    strRes += "</DIALOG>";
+    return strRes;
 }
 
 void DialogEditor::loadDoc(QString fileName)
@@ -366,11 +390,11 @@
 
   if(fileName.find(".xml", 0, FALSE)==-1)
   {
-	  QString mes;
-	  mes.sprintf("file:\n%s\nDoes not have xml extension", (const char*)fileName);
+      QString mes;
+      mes.sprintf("file:\n%s\nDoes not have xml extension", (const char*)fileName);
 
-	  QMessageBox::warning (this, "TW-Light editor",
-			mes);
+      QMessageBox::warning (this, "TW-Light editor",
+            mes);
   }
 
   QFile f(fileName);
@@ -381,141 +405,143 @@
   reader.setContentHandler( &handler );
   reader.parse( source );
   if(nodeListView-> childCount ())
-	nodeListView->setCurrentItem( nodeListView->firstChild ());
+    nodeListView->setCurrentItem( nodeListView->firstChild ());
 }
 
 void DialogEditor::setAlienText()
 {
-	WriteLog("DialogEditor::setAlienText()\n");
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	node->m_strAlienText = commonMultiLineEdit->text();
-	nodeChangedSlot(node);
+    WriteLog("DialogEditor::setAlienText()\n");
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    node->m_strAlienText = commonMultiLineEdit->text();
+    nodeChangedSlot(node);
 }
 
 void DialogEditor::setPlayerAnswerText()
 {
-	WriteLog("DialogEditor::setPlayerAnswerText()\n");
-	QListViewItem * curAnsw = answersListView->currentItem();
-	if(!curAnsw)
-		return;
-	PlayerAnswer * pa = getPlayerAnswer(curAnsw->text(0));
-	pa->m_strText = commonMultiLineEdit->text();
-	curAnsw->setText(0, commonMultiLineEdit->text());
+    WriteLog("DialogEditor::setPlayerAnswerText()\n");
+    QListViewItem * curAnsw = answersListView->currentItem();
+    if(!curAnsw)
+        return;
+    PlayerAnswer * pa = getPlayerAnswer(curAnsw->text(0));
+    pa->m_strText = commonMultiLineEdit->text();
+    curAnsw->setText(0, commonMultiLineEdit->text());
 }
 
 void DialogEditor::AddPlayerAnswer()
 {
-	WriteLog("DialogEditor::AddPlayerAnswer()\n");
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	PlayerAnswer * item = new PlayerAnswer;
-	item->m_strText = commonMultiLineEdit->text();
-	item->m_strAppearCondition = "1";
+    WriteLog("DialogEditor::AddPlayerAnswer()\n");
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    PlayerAnswer * item = new PlayerAnswer;
+    item->m_strText = commonMultiLineEdit->text();
+    item->m_strAppearCondition = "1";
 
-	node->m_answers.append(item);
-	nodeChangedSlot(node);
+    node->m_answers.append(item);
+    nodeChangedSlot(node);
 }
 
 // To be implemented
 bool DialogEditor::script_check_condition(const QString & condition)
 {
-	WriteLog("DialogEditor::script_check_condition(QString & condition)\n");
-	return true;
+    WriteLog("DialogEditor::script_check_condition(QString & condition)\n");
+    return true;
 }
 
 NodeItem * DialogEditor::getNodeItem(const QString& id)
 {
-	WriteLog("DialogEditor::getNodeItem(QString& id)\n");
-	QListViewItem* item = nodeListView->firstChild ();
-	QListViewItemIterator it( item );
-	for(;it.current();it++)
-	{
-		if(it.current()->text(0) == id)
-			return (NodeItem *)it.current();
-	}
-	return NULL;
+    WriteLog("DialogEditor::getNodeItem(QString& id)\n");
+    QListViewItem* item = nodeListView->firstChild ();
+    QListViewItemIterator it( item );
+    for(;it.current();it++)
+    {
+        if(it.current()->text(0) == id)
+            return (NodeItem *)it.current();
+    }
+    return NULL;
 }
 
 
 void DialogEditor::processAnswerSlot(QListViewItem* item)
 {
-	WriteLog("DialogEditor::processAnswerSlot(QListViewItem* item)\n");
-	PlayerAnswer* answer = getPlayerAnswer(item->text(0));
-	for(int i=0;i<5;i++)
-	{
-			lua_State * L = lua_open();
-			lua_baselibopen(L);
-			lua_iolibopen(L);
-			lua_strlibopen(L);
-			lua_mathlibopen(L);
-			bool eva = lua_dostring(L, "function goto(id) gotoid = id; end");
-			eva = lua_dostring(L, answer->m_strAct[i]);
-			lua_getglobal(L, "gotoid");
-			if (lua_isstring(L, -1)) 
-			{
-				const char * id = lua_tostring(L, -1);
-				NodeItem * node = getNodeItem(QString(id));
-				if(node)
-					nodeListView->setCurrentItem(node);
-			}
-			lua_close(L);
-	}
+    WriteLog("DialogEditor::processAnswerSlot(QListViewItem* item)\n");
+    PlayerAnswer* answer = getPlayerAnswer(item->text(0));
+    for(int i=0;i<5;i++)
+    {
+    /*
+            lua_State * L = lua_open();
+            lua_baselibopen(L);
+            lua_iolibopen(L);
+            lua_strlibopen(L);
+            lua_mathlibopen(L);
+            bool eva = lua_dostring(L, "function goto(id) gotoid = id; end");
+            eva = lua_dostring(L, answer->m_strAct[i]);
+            lua_getglobal(L, "gotoid");
+            if (lua_isstring(L, -1)) 
+            {
+                const char * id = lua_tostring(L, -1);
+                NodeItem * node = getNodeItem(QString(id));
+                if(node)
+                    nodeListView->setCurrentItem(node);
+            }
+            lua_close(L);
+     */
+    }
 }
 
 void DialogEditor::answerUp()
 {
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	QListViewItem * item = answersListView->currentItem();
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    QListViewItem * item = answersListView->currentItem();
 
-	if(!node || !item)
-		return;
-	
-	int pos = getPlayerAnswerPos(item->text(0));
-	if(pos==0)
-		return;
-	
-	QString strText = item->text(0);
-	PlayerAnswer* answer = node->m_answers.take(pos);
-	node->m_answers.insert(pos-1, answer);
+    if(!node || !item)
+        return;
+    
+    int pos = getPlayerAnswerPos(item->text(0));
+    if(pos==0)
+        return;
+    
+    QString strText = item->text(0);
+    PlayerAnswer* answer = node->m_answers.take(pos);
+    node->m_answers.insert(pos-1, answer);
 
-	nodeChangedSlot(node);	
+    nodeChangedSlot(node);  
 
-	QListViewItemIterator it( answersListView->firstChild () );
-	for(;it.current();it++)
-	{
-		if(it.current()->text(0)==strText)
-		{
-			answersListView->setCurrentItem(it.current());
-			break;
-		}
-	}
+    QListViewItemIterator it( answersListView->firstChild () );
+    for(;it.current();it++)
+    {
+        if(it.current()->text(0)==strText)
+        {
+            answersListView->setCurrentItem(it.current());
+            break;
+        }
+    }
 }
 
 void DialogEditor::answerDown()
 {
-	NodeItem * node = (NodeItem*)nodeListView->currentItem();
-	QListViewItem * item = answersListView->currentItem();
-	
-	if(!node || !item)
-		return;
+    NodeItem * node = (NodeItem*)nodeListView->currentItem();
+    QListViewItem * item = answersListView->currentItem();
+    
+    if(!node || !item)
+        return;
 
-	int pos = getPlayerAnswerPos(item->text(0));
-	if(pos==node->m_answers.count()-1 )
-		return;
-	
-	QString strText = item->text(0);
+    int pos = getPlayerAnswerPos(item->text(0));
+    if(pos==node->m_answers.count()-1 )
+        return;
+    
+    QString strText = item->text(0);
 
-	PlayerAnswer* answer = node->m_answers.take(pos);
-	node->m_answers.insert(pos+1, answer);
+    PlayerAnswer* answer = node->m_answers.take(pos);
+    node->m_answers.insert(pos+1, answer);
 
-	nodeChangedSlot(node);	
-	QListViewItemIterator it( answersListView->firstChild () );
-	for(;it.current();it++)
-	{
-		if(it.current()->text(0)==strText)
-		{
-			answersListView->setCurrentItem(it.current());
-			break;
-		}
-	}
+    nodeChangedSlot(node);  
+    QListViewItemIterator it( answersListView->firstChild () );
+    for(;it.current();it++)
+    {
+        if(it.current()->text(0)==strText)
+        {
+            answersListView->setCurrentItem(it.current());
+            break;
+        }
+    }
 }
 

Modified: trunk/Util/deditor/xmlparser.cpp
===================================================================
--- trunk/Util/deditor/xmlparser.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/xmlparser.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,6 +1,7 @@
 #include "xmlparser.h"
-#include <iostream.h>
+#include <iostream>
 #include <qstring.h>
+#include <qtextedit.h>
 #include <qlineedit.h>
 #include <qmessagebox.h> 
 #include <assert.h>
@@ -29,7 +30,16 @@
                                     const QXmlAttributes& attr)
 {
 	WriteLog("XMLParser::startElement\n");
-	if (qName=="NODES")
+	if(qName=="DIALOG")
+	  {
+	  }
+	else if(qName=="START_DIALOG")
+	  {
+	  }
+	else if (qName=="END_DIALOG")
+	  {
+	  }
+	else if (qName=="NODES")
 	{
 	}
 	else if (qName=="NODE")
@@ -119,12 +129,6 @@
 	}
 	else if(qName=="ACTION")
 	{
-		assert(curAnswer);
-		int j;
-		for(j=0; j<5;j++)
-			if(curAnswer->m_strAct[j].isEmpty()&&
-			   curAnswer->m_strCond[j].isEmpty())
-			    break;
 		QString strCondition = "";
 		QString strAction    = "";
 		for(int i=0; i< attr.length();i++)
@@ -144,24 +148,44 @@
 				QString("Unknown attribute: ") + attr.localName(i));
 			}
 		}
-		curAnswer->m_strAct[j] = strAction;
-		curAnswer->m_strCond[j] = strCondition;
+		if(prev_node == "START_DIALOG")
+		  {
+		    m_dialogEditor->startDialogCode_textEdit->setText(strAction);
+		  }
+		else if(prev_node == "END_DIALOG")
+		  {
+		    m_dialogEditor->endDialogCode_textEdit->setText(strAction);
+		  }
+		else
+		  {	  
+		    assert(curAnswer);
+		    for(int j=0; j<5;j++)
+		      {
+			if(curAnswer->m_strAct[j].isEmpty()&&
+			   curAnswer->m_strCond[j].isEmpty())
+			  {
+			    curAnswer->m_strAct[j] = strAction;
+			    curAnswer->m_strCond[j] = strCondition;
+			    break;
+			  }
+		      }
+		  }
 	}
 	else
 	{
 		QMessageBox::warning (m_dialogEditor, "TW-Light editor",
 			QString("Unknown Node: ") + qName);
 	}
-
-    return TRUE;
+	prev_node = qName;
+	return TRUE;
 }
 
 bool XMLParser::endElement( const QString & namespaceURI, const QString & localName, const QString & qName ) 
 {
 	WriteLog("XMLParser::endElement\n");
 	if(qName=="NODES")
-	{
-	}
+	  {
+	  }
 	else if (qName=="NODE")
 	{
 		m_dialogEditor->nodeListView->setCurrentItem(curNode);
@@ -175,6 +199,15 @@
 	else if(qName=="ACTION")
 	{
 	}
+	else if (qName=="START_DIALOG")
+	  {
+	  }
+	else if(qName=="END_DIALOG")
+	  {
+	  }
+	else if(qName=="DIALOG")
+	  {
+	  }
 	else
 	{
 		QMessageBox::warning (m_dialogEditor, "TW-Light editor",

Modified: trunk/Util/deditor/xmlparser.h
===================================================================
--- trunk/Util/deditor/xmlparser.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/Util/deditor/xmlparser.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -15,6 +15,7 @@
 
 	NodeItem * curNode;
 	PlayerAnswer * curAnswer;
+	QString prev_node;
 public:
 	XMLParser(DialogEditor* editor);
     bool startDocument();

Modified: trunk/gamedata/default_ini/client.ini
===================================================================
--- trunk/gamedata/default_ini/client.ini	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/default_ini/client.ini	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,68 +1,68 @@
-[System]
-AutoUnload = 0
-
-[Video]
-ScreenWidth = 800
-ScreenHeight = 600
-
-BitsPerPixel = 32
-;valid = values are 8 (ugly), 15, 16, 24 (slow), and 32
-
-FullScreen = 1
-; = 0 = windowed, 1 = fullscreen
-
-;This will select the theme by its string name. The names for the non-bitmap
-;themes are: "GTK", "Win95", "Photon", "BeOS", "NeXTStep", "ASE", "Allegro".
-GuiTheme = Photon
-
-Gamma = 45
-;gamma = gamma correction, should be between 0 and 255
-
-
-
-[Sound]
-SoundVolume = 0.5
-MusicVolume = 0.5
-SoundBuffer = 1024
-
-
-[Planet]
-PlanetDimension = 3
-PlanetUsespec = 1
-
-[View]
-View = Enemy
-;determines = where the camera goes
-InterpolateFrames = 1
-;0 = low quality, 1 = high quality
-Mip_min = 0
-;from = 0 to 3?  0 = normal, 1 = low quality, 2 = very low quality, ...
-Mip_max = 10
-;from = 0 to 3?  0 = high quality, 99 = normal
-Mip_bias = 0
-;from = -3? to 3?  0 = normal, -1 = high quality, 1 = low quality, 2 = very low quality
-;(Hero, = Enemy, Enemy_Discrete, Split, Everything)
-MinimumFrameRate = 15.0
-; = determines the worst-case frameskipping (between 5 and 15 recommended)
-FPS_Time = 250
-; = milliseconds per time the FPS is updated.
-
-Key_zoomin = EQUALS
-Key_zoomout = MINUS
-Key_alter1 = 0
-Key_alter2 = 9
-
-
-[Rendering]
-AA_Mode = 35
-
-
-[Stars]
-quality = 5
-;recomended = quality settings are 1, 2, and 5
-
-
-[Menu]
-SelectGame = 0
-
-
+[System]
+AutoUnload = 0
+
+[Video]
+ScreenWidth = 800
+ScreenHeight = 600
+
+BitsPerPixel = 32
+;valid = values are 8 (ugly), 15, 16, 24 (slow), and 32
+
+FullScreen = 1
+; = 0 = windowed, 1 = fullscreen
+
+;This = will select the theme by its string name. The names for the non-bitmap
+;themes = are: "GTK", "Win95", "Photon", "BeOS", "NeXTStep", "ASE", "Allegro".
+GuiTheme = Photon
+
+Gamma = 45
+;gamma = gamma correction, should be between 0 and 255
+
+
+
+[Sound]
+SoundVolume = 0.500000
+MusicVolume = 0.500000
+SoundBuffer = 1024
+
+
+[Planet]
+PlanetDimension = 3
+PlanetUsespec = 1
+
+[View]
+View = Enemy
+;determines = where the camera goes
+InterpolateFrames = 1
+;0 = low quality, 1 = high quality
+Mip_min = 0
+;from = 0 to 3?  0 = normal, 1 = low quality, 2 = very low quality, ...
+Mip_max = 10
+;from = 0 to 3?  0 = high quality, 99 = normal
+Mip_bias = 0
+;from = -3? to 3?  0 = normal, -1 = high quality, 1 = low quality, 2 = very low quality
+;(Hero, = Enemy, Enemy_Discrete, Split, Everything)
+MinimumFrameRate = 15.0
+; = determines the worst-case frameskipping (between 5 and 15 recommended)
+FPS_Time = 250
+; = milliseconds per time the FPS is updated.
+
+Key_zoomin = EQUALS
+Key_zoomout = MINUS
+Key_alter1 = 0
+Key_alter2 = 9
+
+
+[Rendering]
+AA_Mode = 35
+
+
+[Stars]
+quality = 5
+;recomended = quality settings are 1, 2, and 5
+
+
+[Menu]
+SelectGame = 0
+
+

Added: trunk/gamedata/games/test_game/dialogs/chorali_commander.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/chorali_commander.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/chorali_commander.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -0,0 +1 @@
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="First welcome" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="We are Chorali. What do you want?" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Submit or die foolish creature" appear_condition="gflag.m2_status == MISSION_IN_PROGRESS"><ACTION condition="1" action="goto(1)"></ACTION><ACTION condition="1" action="gflag.m2_status = MISSION_COMPLETED"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Err... nothing, bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Ok" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Oh, ok... we're quite familiar with that arrangement." font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Tell me your secrets!" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" !
 name="Secrets" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Go to coordinates 1500,5000, you will find precursor wreck. " font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="That is help. You will live a bit longer" appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Bye" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="I hope you will die soon|Bye" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/druuge.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/druuge.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/druuge.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,4 +1,4 @@
-<DIALOG><START_NODES></START_NODES><NODES><NODE id="0" name="Meet Druuge" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are the Druuge of the Crimson Corporation. We have rightfully taken possesion of this area, and must ask you to cease tresspassing immediately." font="" text_location="(50,10)"><PLAYER_ANSWER text="These are Precursor artifacts. They aren't rightfully owned by anyone!" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Stand aside, Druuge. I have come to claim the bounty of this region." appear_condition="1"><ACTION condition="1" action="goto(7)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Oh, me? I was just passing through." appear_condition="1"><ACTION condition="1" action="goto(10)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="We lay claim" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Ha ha ha! We lay claim to these grou!
 nds under secion 577(d) of the Druuge Civil Code." font="" text_location="(50,10)"><PLAYER_ANSWER text="That's impossible! What is this code?" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="In that case, I lay claim to your lives under section 2(c) of the code of [Player_name]!" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="text of the law" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="I quote section 577(d), Article IX:
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Meet Druuge" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are the Druuge of the Crimson Corporation. We have rightfully taken possesion of this area, and must ask you to cease tresspassing immediately." font="" text_location="(50,10)"><PLAYER_ANSWER text="These are Precursor artifacts. They aren't rightfully owned by anyone!" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Stand aside, Druuge. I have come to claim the bounty of this region." appear_condition="1"><ACTION condition="1" action="goto(7)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Oh, me? I was just passing through." appear_condition="1"><ACTION condition="1" action="goto(10)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="We lay claim" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Ha ha ha!!
  We lay claim to these grounds under secion 577(d) of the Druuge Civil Code." font="" text_location="(50,10)"><PLAYER_ANSWER text="That's impossible! What is this code?" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="In that case, I lay claim to your lives under section 2(c) of the code of [Player_name]!" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="10" name="another route" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Very well. We ask that you find another route immedately, or we will be obligated to remove you from the premises ourselves." font="" text_location="(50,10)"><PLAYER_ANSWER text="I've thought of a new route already- my main cannons straight through your hull!" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Do not harm us, Druuge. We will find a way aroun!
 d." appear_condition="1"><ACTION condition="1" action="goto(9)!
 "></ACTI
ON></PLAYER_ANSWER></NODE><NODE id="11" name="(F) defend property" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are obligated to defend the property of the Crimson Corporation. You must die now. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog(1)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="text of the law" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="I quote section 577(d), Article IX:
 Finders keepers, losers weepers." font="" text_location="(50,10)"><PLAYER_ANSWER text="But I found it first! I've been to this wreck before!" appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Laws are made to be broken." appear_condition="1"><ACTION condition="1" action="goto(11)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="prove it" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Oh, did you? Well then, I suppose we'd better stand down, as long as you submitted a proper request for posession and scavenging to the Crimson Corporation Headquarters. " font="" text_location="(50,10)"><PLAYER_ANSWER text="Why, of course. You may go now." appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Er... no, I didn't." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER></NODE><NODE id="4" name="(F) forced to!
  eradicate" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Ahhh... that is a pity. As a dutiful employee of the Crimson 
 Corporation, I am forced to eradicate you and your crew for attempting 
-deliberate subterfuge under section 8808(b) of the Druuge Penal Code. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="check records" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="At once. But first, let me double-check our records." font="" text_location="(50,10)"><PLAYER_ANSWER text="No- wait! I didn't submit a request!" appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Go ahead. I'm sure you will find things in order." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="(F) prepare to die" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are not aware of this code, but we are obligated to defend the property of the Crimson Corporation at all costs. P!
 repare to die. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="7" name="refuse" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="I refuse. This salvage is property of the Crimson Corporation. You have one more chance to remove yourself from the premises before I am forced to do so myself." font="" text_location="(50,10)"><PLAYER_ANSWER text="Eat plasma, you gremlin-faced spawn of hell!" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Fine, I give up. The wreckage is yours." appear_condition="1"><ACTION condition="1" action="goto(9)"></ACTION></PLAYER_ANSWER></NODE><NODE id="8" name="(F) add your wreckage" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We will add your name to our Ledger of Hatred once your own demolished!
  hull floats besides the wreckage you seek! [Fight]" font="" t!
 ext_loca
tion="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="9" name="(E) leave" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="As it should be. Leave this place now, human, and do not return." font="" text_location="(50,10)"><PLAYER_ANSWER text="Goodbye, Druuge." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="10" name="another route" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="Very well. We ask that you find another route immedately, or we will be obligated to remove you from the premises ourselves." font="" text_location="(50,10)"><PLAYER_ANSWER text="I've thought of a new route already- my main cannons straight through your hull!" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Do not harm us, !
 Druuge. We will find a way around." appear_condition="1"><ACTION condition="1" action="goto(9)"></ACTION></PLAYER_ANSWER></NODE><NODE id="11" name="(F) defend property" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are obligated to defend the property of the Crimson Corporation. You must die now. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog(1)"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file
+deliberate subterfuge under section 8808(b) of the Druuge Penal Code. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="check records" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="At once. But first, let me double-check our records." font="" text_location="(50,10)"><PLAYER_ANSWER text="No- wait! I didn't submit a request!" appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Go ahead. I'm sure you will find things in order." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="(F) prepare to die" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We are not aware of this code, but we are obligated to defend the property of the Crimson Corporation at all costs. P!
 repare to die. [Fight]" font="" text_location="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="7" name="refuse" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="I refuse. This salvage is property of the Crimson Corporation. You have one more chance to remove yourself from the premises before I am forced to do so myself." font="" text_location="(50,10)"><PLAYER_ANSWER text="Eat plasma, you gremlin-faced spawn of hell!" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Fine, I give up. The wreckage is yours." appear_condition="1"><ACTION condition="1" action="goto(9)"></ACTION></PLAYER_ANSWER></NODE><NODE id="8" name="(F) add your wreckage" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="We will add your name to our Ledger of Hatred once your own demolished!
  hull floats besides the wreckage you seek! [Fight]" font="" t!
 ext_loca
tion="(50,10)"><PLAYER_ANSWER text="(end dialogue)" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="9" name="(E) leave" music="music/races/druuge.mod" background="images/alien/druuge.jpg" alien_text="As it should be. Leave this place now, human, and do not return." font="" text_location="(50,10)"><PLAYER_ANSWER text="Goodbye, Druuge." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/ixis_mining_station_commander.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/ixis_mining_station_commander.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/ixis_mining_station_commander.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<DIALOG><START_NODES></START_NODES><NODES><NODE id="0" name="Welcome to ixis mining station station" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Ixis mining station. How can I help you?" font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="I have some questions for you." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Never mind, I'll just be on my way." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="QuestionNexus" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Sure, I'm happy to share my knowledge with you." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="What can you tell me about the Chorali?" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="What are some points of interest in this system?" appear_!
 condition="1"><ACTION condition="1" action="goto(3)"></ACTION><ACTION condition="1" action="quests.add_druuge_guardians()"></ACTION><ACTION condition="1" action="tml.GameAction.save_flag('have_drax_open_device',1)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Chorali?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Hmm... mysterious creatures, they are. I ran into one in a bar planetside- it was made of pure energy. I found it a little wierd at first, but he turned out to be a friendly critter. Even bought me a drink." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="Umm, thanks. Gotta go." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Interesting. I have some more questions." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Wreck?" music="music/races/human.mod" background="images/alien/human.jpg" alien_t!
 ext="Hmm... A few months ago, a routine scouting mission disco!
 vered a 
Precursor wreck not far from here, at coordinates 1500,5000. Every vessel is completely sealed off, except for one. Unfortunately, it seems to be stripped of all its useful parts, as far as I can tell." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="A Precursor wreck! Excuse me, I must travel there at once!" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Fascinating. I have another question." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Welcome to ixis mining station station" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Ixis mining station. How can I help you?" font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="I have some questions for you." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Never mind, I'll just be on my way." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="QuestionNexus" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Sure, I'm happy to share my knowledge with you." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="What can you tell me about the Chorali?" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="What are some points of intere!
 st in this system?" appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Chorali?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Hmm... mysterious creatures, they are. I ran into one in a bar planetside- it was made of pure energy. I found it a little wierd at first, but he turned out to be a friendly critter. Even bought me a drink." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="Umm, thanks. Gotta go." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Interesting. I have some more questions." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Wreck?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Hmm... A few months ago, a routine scouting mission discovered a Precursor wreck not far from here, at coordinates 1500,5000. Ever!
 y vessel is completely sealed off, except for one. Unfortunate!
 ly, it s
eems to be stripped of all its useful parts, as far as I can tell." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="A Precursor wreck! Excuse me, I must travel there at once!" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Fascinating. I have another question." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/precursor_wrack_first_inspection.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/precursor_wrack_first_inspection.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/precursor_wrack_first_inspection.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="We have discovered precursor battleship" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="We have discovered precursor vessel. Unfortunately we can't get inside." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="Ok" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="We have discovered precursor battleship" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="We have discovered precursor vessel. Unfortunately we can't get inside." font="Earth" text_location="(50,10)"><PLAYER_ANSWER text="Ok" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shpalabc.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shpalabc.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shpalabc.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shpandgu.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shpandgu.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shpandgu.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shparisk.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shparisk.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shparisk.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shpbahbu.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shpbahbu.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shpbahbu.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shpbipka.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shpbipka.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shpbipka.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/shpchmav.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/shpchmav.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/shpchmav.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/test_dialog.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/test_dialog.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/test_dialog.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Begin" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="I am Black Spathi!" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="Can we chat a little?" appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="bye" music="music/races/spathi.mod" background="images/alien/SpathiMain.jpg" alien_text="No, we can't" font="Times" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/transport_please_help.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/transport_please_help.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/transport_please_help.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Help request" music="music/races/korah.mod" background="images/alien/estion.jpg" alien_text="SOS, Help, we have kohr-ah battle versel after us. Please do something about it or we are going to die" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="This is earth cruiser Tamerlan, I will help you." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Help request" music="music/races/korah.mod" background="images/alien/estion.jpg" alien_text="SOS, Help, we have kohr-ah battle versel after us. Please do something about it or we are going to die" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="This is earth cruiser Tamerlan, I will help you." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/transport_thanks.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/transport_thanks.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/transport_thanks.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="thanks for saving my sorry ass" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Thanks for saving my sorry ass." font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="It was my duty" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="thanks for saving my sorry ass" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Thanks for saving my sorry ass." font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="It was my duty" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/welcomecommander.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/welcomecommander.xml	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/dialogs/welcomecommander.xml	2005-08-06 18:09:53 UTC (rev 175)
@@ -1 +1 @@
-<NODES><NODE id="0" name="Welcome" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Charlys Sector, Captain.  I am Commander Jacques Haven, of Silcuu Station. Your ship will be a great addition to fleet here. Would you like some background information before you proceed with your first assignment? " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Yes, Commander. Information is always valuable." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="No, Commander. I'd like to get straight to my duties." appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Info" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="As you might have seen on your hyperspace map, there are three systems in the Charlys Sector; Narike, Ixis, and Gamma Onyx. It's mostly peaceful in Charlys, except for a few Ko!
 hr-Ah raiders and Ulzrak. We are having negotiatons to have a native, energy-based race known as the Chorali join the Alliance, and we are hoping to initiate them soon with the avian Drax race. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like to learn more about the Ulzrak." appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Chorali." appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Drax." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Ulzrak" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Ulzrak are a completely hostil!
 e race, that do not seem to have any purpose to their destruct!
 ion, as 
far as we can tell. They do not initiate contact before attacking. The only reason we know their name is froma salvaged computer database. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Chorali" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Chorali are energy-based creatures that mostly made of photons, liquid, and a thin normal matter shell, through which they interact with a normal environment. As a species, they're rather secretive about any technology or information they find, though it's said they are quite social amog themselves. They are also, as a species rather friendly, however. We're currently negoti!
 ating them joining the New Alliance. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="4" name="Drax" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="We haven't had much contact with the Drax so far, but from what we've heard they've had over a hundred million internal conflicts, and that's only during their spacefaring age. The only governments that succeed are very loosely tied ones, with very little law. It will likely be difficult getting even a preliminary treaty, with the number of factions working for different goals.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Comman!
 der." appear_condition="1"><ACTION condition="1" action="goto(!
 1)"></AC
TION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="Orders/Assignments" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You actually have a choice of assignments, Captain. You can choose to take a transport escort assignment to a mining operation in Ixis, where they need medical supplies. Or, you can negotiate with the Chorali, here in Narike.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'll escort the transport to Ixis. " appear_condition="not tml.GameAction.get_double_flag('escort_transport_accept')"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.escort_transport_to_ixis_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll negotiate with the Chorali." appear_condition="not tml.GameAction.get_double_flag('negotiate_with_choral!
 i_accept')"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="CHORALI_SELECTED=True"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="Good Luck!" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Good luck, Captain. Be careful, I wouldn't want to lose the newest addition to my fleet. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Thank you, Commander." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll execute my mission well, Commander, be sure of that. " appear_condition="1"><ACTION condition="1" action="endDialog() "></ACTION></PLAYER_ANSWER></NODE></NODES>
\ No newline at end of file
+<DIALOG><START_DIALOG><ACTION condition="1" action="m12_compl = gflag.m1_status == MISSION_COMPLETED or gflag.m2_status == MISSION_COMPLETED&#10;&#10;# Tell player to complete mission&#10;if gflag.m1_status == MISSION_IN_PROGRESS or gflag.m2_status == MISSION_IN_PROGRESS or gflag.m3_status == MISSION_IN_PROGRESS :&#10;  goto(7)&#10;&#10;if m12_compl:&#10;  goto(9)&#10;&#10;if m3_status == MISSION_COMPLETED:&#10;  goto(11)&#10;&#10;"></ACTION></START_DIALOG><END_DIALOG><ACTION condition="1" action=""></ACTION></END_DIALOG><NODES><NODE id="0" name="Welcome" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Charlys Sector, Captain.  I am Commander Jacques Haven, of Silcuu Station. Your ship will be a great addition to fleet here. Would you like some background information before you proceed with your first assignment? " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Yes, Commander. Information is always valuable." appea!
 r_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="No, Commander. I'd like to get straight to my duties." appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Info" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="As you might have seen on your hyperspace map, there are three systems in the Charlys Sector; Narike, Ixis, and Gamma Onyx. It's mostly peaceful in Charlys, except for a few Kohr-Ah raiders and Ulzrak. We are having negotiatons to have a native, energy-based race known as the Chorali join the Alliance, and we are hoping to initiate them soon with the avian Drax race. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like to learn more about the Ulzrak." appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Chorali." appear_condi!
 tion="1"><ACTION condition="1" action="goto(3)"></ACTION></PLA!
 YER_ANSW
ER><PLAYER_ANSWER text="I'd like to learn more about the Drax." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="10" name="Investigate wreck" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You should investigate precursor wreck" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly" appear_condition="gflag.m3_status != MISSION_COMPLETED"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="check_precursor_wreck_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I have already checked them." appear_condition="gflag.m3_status == MISSION_COMPLETED"><ACTION condition="1" action="goto(11)"></ACTION></PLAYER_ANSWER></NODE><NODE id="11" name="Zoq-Fot-Pik ambasador" music="music/races/!
 human.mod" background="images/alien/human.jpg" alien_text="You must escort Zoq-Fot-Pik ambassador to Gamma Onyx ." font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.zoq_fot_pik_ambassador_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Ulzrak" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Ulzrak are a completely hostile race, that do not seem to have any purpose to their destruction, as far as we can tell. They do not initiate contact before attacking. The only reason we know their name is froma salvaged computer database. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" a!
 ppear_condition="1"><ACTION condition="1" action="goto(5)"></A!
 CTION></
PLAYER_ANSWER></NODE><NODE id="3" name="Chorali" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Chorali are energy-based creatures that mostly made of photons, liquid, and a thin normal matter shell, through which they interact with a normal environment. As a species, they're rather secretive about any technology or information they find, though it's said they are quite social amog themselves. They are also, as a species rather friendly, however. We're currently negotiating them joining the New Alliance. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="4" name="Drax" music="music/races/human.mod" background="images/alien/h!
 uman.jpg" alien_text="We haven't had much contact with the Drax so far, but from what we've heard they've had over a hundred million internal conflicts, and that's only during their spacefaring age. The only governments that succeed are very loosely tied ones, with very little law. It will likely be difficult getting even a preliminary treaty, with the number of factions working for different goals.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="Orders/Assignments" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You actually have a choice of assignments, Captain. You can choose to take a transport escort assignment!
  to a mining operation in Ixis, where they need medical suppli!
 es. Or, 
you can negotiate with the Chorali, here in Narike.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'll escort the transport to Ixis. " appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.escort_transport_to_ixis_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll negotiate with the Chorali." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.negotiate_with_chorali_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="Good Luck!" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Good luck, Captain. Be careful, I wouldn't want to lose the newest addition to my fleet. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Thank you, Commander." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll execute my mission well, Commander, be sure of !
 that. " appear_condition="1"><ACTION condition="1" action="endDialog() "></ACTION></PLAYER_ANSWER></NODE><NODE id="7" name="Why are you here?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="I have assigned you on important mission. Why are you here?" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What was it again?" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="8" name="Are you dumb or something?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Are you dumb or something? {gflag.current_mission}" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Oh, bye." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="9" name="Good work" music="music/races/human.mod" background="images/a!
 lien/human.jpg" alien_text="Good work. About your next mission!
 ..." fon
t="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What is it?" appear_condition="1"><ACTION condition="1" action="10"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Added: trunk/gamedata/games/test_game/scripts/flags.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/flags.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/flags.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -0,0 +1,39 @@
+#
+# This file should contain all global flags the game is going to use
+# don't place anything else here
+#
+
+# some constants
+MISSION_CLEAN       = 0
+MISSION_IN_PROGRESS = 1
+MISSION_COMPLETED   = 2
+MISSION_FAILED      = 3
+
+class Flags:
+    # Mission 1 Escort transport
+    m1_status     = 0
+    m1_transport = -1 # Transport ship ID
+    m1_enemy     = -1 # attacker's ship
+    
+    # Mission 2 Negotiate with Chorali
+    m2_status     = 0
+    
+    # Mission 3 Investigate wreck
+    m3_status    = 0
+    
+    # Mission 4 Zoq-Fot-Pik ambassador
+    m4_status     = 0
+    
+    # Locations
+    ixis_mining_station = -1
+    ixis_chorali_station = -1
+    precursor_wreck_id   = -1
+    
+    # Know How
+    use_tin_device = 0
+    current_mission = ""
+    
+    # Items
+    tin_device     = 0
+    
+gflag = Flags()

Modified: trunk/gamedata/games/test_game/scripts/quests.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/quests.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/quests.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,90 +1,118 @@
 import tml,dialog,misc
+from flags import *
 
+# Mission1 Escort transport to Ixis star system
 
-# player choose to escort transport to Ixis star system
-
 def escort_transport_to_ixis_func():
-    tml.GameAction.save_flag('escort_transport_accept',1)
-    tml.GameAction.save_flag('escort_transport_to_ixis_mission_completeP', 0)
-    transport = tml.GameAction.add_ship('Ixis',
-                                        "choex", 1000, 1000, tml.GameAction.get_player_team())
-    tml.GameAction.save_flag('escort_transport_to_ixis_transport_id',transport )
-    tml.GameAction.go_to_location(transport, tml.GameAction.get_double_flag('ixis_mining_station base'), 50)
-    tml.EventManager.distanceLessThen(transport,
-                                      tml.GameAction.get_double_flag('ixis_mining_station base'),
-                                      100,  'escort_transport_to_ixis_mission_complete')
-    tml.EventManager.distanceLessThen(transport,
-                                      tml.GameAction.get_player_ship_id(),
+    if gflag.m1_status:
+        return
+    gflag.current_mission = """ You must escort our transport to Ixis minning station."""
+    gflag.m1_status = MISSION_IN_PROGRESS
+    
+    gflag.m1_transport = tml.GameAction.add_ship('Ixis',"choex", 3000, 3500, tml.GameAction.get_player_team())
+    
+    tml.GameAction.go_to_location(gflag.m1_transport, gflag.ixis_mining_station, 50)
+    tml.EventManager.distanceLessThen(gflag.m1_transport, gflag.ixis_mining_station, 100,
+                                      'escort_transport_to_ixis_mission_complete')
+    tml.EventManager.distanceLessThen(gflag.m1_transport, tml.GameAction.get_player_ship_id(),
                                       5000,  'escort_transport_to_ixis_ask_help_against_kohr_ah')
-    enemy = tml.GameAction.add_ship('Ixis',
-                                    "kzedr", 2000, 2000, tml.GameAction.get_enemy_team())
-    tml.GameAction.set_crew(enemy, 10)
+    tml.EventManager.shipDeathById(gflag.m1_transport,'escort_transport_death')
+    gflag.m1_enemy = tml.GameAction.add_ship('Ixis', "kzedr", 4000, 4000, tml.GameAction.get_enemy_team())
+    tml.GameAction.set_crew(gflag.m1_enemy, 10)
+    tml.GameAction.set_target(gflag.m1_enemy, gflag.m1_transport)
+    tml.EventManager.shipDeathById(gflag.m1_enemy,'escort_transport_enemy_death')
     tml.GameAction.print_message("HINT: use 'M' key to access star map", 15)
 
+def escort_transport_death():
+    if gflag.m1_status != MISSION_COMPLETED:
+        gflag.m1_status = MISSION_FAILED
+        print "Mission 1 failed"
+
+def escort_transport_enemy_death():
+    tml.GameAction.set_camera_mode('Hero')
+    
 def escort_transport_to_ixis_ask_help_against_kohr_ah():
     dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/transport_please_help.xml"))
-
+    tml.GameAction.set_target(tml.GameAction.get_player_ship_id(), gflag.m1_enemy)
+    tml.GameAction.set_camera_mode('Enemy')
+    
 def escort_transport_to_ixis_mission_complete():
-    tml.GameAction.save_flag('escort_transport_to_ixis_mission_completeP', 1)
-    tml.GameAction.remove_location(tml.GameAction.get_double_flag('escort_transport_to_ixis_transport_id'))
+    gflag.m1_status = MISSION_COMPLETED
+    tml.GameAction.remove_location(gflag.m1_transport)
     dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/transport_thanks.xml"))
+    print "Mission 1 completed"
+    
+############################################################################################################
+# Mission 2
+def negotiate_with_chorali_func():
+    gflag.m2_status = MISSION_IN_PROGRESS
+############################################################################################################
+# Mission 3
+def check_precursor_wreck_func():
+    if gflag.m1_status:
+        return
+    gflag.m3_status = MISSION_IN_PROGRESS
+    gflag.current_mission = """ You must investigate precursor wrack in Ixis star system."""
+def check_precursor_wreck_completed_func():
+    dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/precursor_wrack_first_inspection.xml"))
+    gflag.m3_status = MISSION_COMPLETED
 
 ############################################################################################################
 # Precursor wrack
 
-def start_precursor_wrack_mission():
-    tml.GameAction.save_flag('have_drax_open_device', 0)
-    tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-                                      tml.GameAction.get_player_ship_id(),
-                                      200,  'precursor_wrack_first_inspection')
-    id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-                                           tml.GameAction.get_player_ship_id(),
-                                           200,  'win_game_func')
-    tml.EventManager.AddEventCondition(id, 'check_has_drax_open_device')
+# def start_precursor_wrack_mission():
+#     tml.GameAction.save_flag('have_drax_open_device', 0)
+#     tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
+#                                       tml.GameAction.get_player_ship_id(),
+#                                       200,  'precursor_wrack_first_inspection')
+#     id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
+#                                            tml.GameAction.get_player_ship_id(),
+#                                            200,  'win_game_func')
+#     tml.EventManager.AddEventCondition(id, 'check_has_drax_open_device')
 
-def check_has_drax_open_device():
-    print "Check drax open device"
-    if tml.GameAction.get_double_flag('have_drax_open_device')>0:
-        return True
-    return False
+# def check_has_drax_open_device():
+#     print "Check drax open device"
+#     if tml.GameAction.get_double_flag('have_drax_open_device')>0:
+#         return True
+#     return False
 
-def precursor_wrack_first_inspection():
-    if not check_has_drax_open_device():
-        dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/precursor_wrack_first_inspection.xml"))
+# def precursor_wrack_first_inspection():
+#     if not check_has_drax_open_device():
+#         dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/precursor_wrack_first_inspection.xml"))
 
 
-def add_druuge_guardians():
-    id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-                                           tml.GameAction.get_player_ship_id(),
-                                           2500,  'druuge_this_is_crimson_corporation_property_now')
-    for i in xrange(1):
-        enemy = tml.GameAction.add_ship('Ixis',
-                                    "druma", 1500, 5000, tml.GameAction.get_enemy_team())
-        tml.GameAction.guard_location(enemy, tml.GameAction.get_double_flag('precursor_wrack_id'), 1500)
+# def add_druuge_guardians():
+#     id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
+#                                            tml.GameAction.get_player_ship_id(),
+#                                            2500,  'druuge_this_is_crimson_corporation_property_now')
+#     for i in xrange(1):
+#         enemy = tml.GameAction.add_ship('Ixis',
+#                                     "druma", 1500, 5000, tml.GameAction.get_enemy_team())
+#         tml.GameAction.guard_location(enemy, tml.GameAction.get_double_flag('precursor_wrack_id'), 1500)
 
     
         
-def druuge_this_is_crimson_corporation_property_now():
-    dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/druuge.xml"))
+# def druuge_this_is_crimson_corporation_property_now():
+#     dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/druuge.xml"))
 
 
-def win_game_func():
-    tml.GameAction.end_game()
-    congrat = []
-    congrat.append("""You win this little demo game""")
-    congrat.append("")
-    congrat.append("Programming:")
-    congrat.append("  Yura Semashko (Yurand)")
-    congrat.append("")
-    congrat.append("Dialogs:")
-    congrat.append("  FrungySnack")
-    congrat.append("  Halleck")
-    congrat.append("  Yura Semashko (Yurand)")
-    congrat.append("")
-    congrat.append("Please, consider help us with TW-Light: Legacies")
-    congrat.append("For detail check our site http://tw-light.berlios.de/")
-    tml.GameAction.scroll_text(misc.PyListStringToVector(congrat),"images/background.jpg")
-    pass
+# def win_game_func():
+#     tml.GameAction.end_game()
+#     congrat = []
+#     congrat.append("""You win this little demo game""")
+#     congrat.append("")
+#     congrat.append("Programming:")
+#     congrat.append("  Yura Semashko (Yurand)")
+#     congrat.append("")
+#     congrat.append("Dialogs:")
+#     congrat.append("  FrungySnack")
+#     congrat.append("  Halleck")
+#     congrat.append("  Yura Semashko (Yurand)")
+#     congrat.append("")
+#     congrat.append("Please, consider help us with TW-Light: Legacies")
+#     congrat.append("For detail check our site http://tw-light.berlios.de/")
+#     tml.GameAction.scroll_text(misc.PyListStringToVector(congrat),"images/background.jpg")
+#     pass
 
 ############################################################################################################
 

Modified: trunk/gamedata/games/test_game/scripts/start.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/start.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/start.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -4,30 +4,31 @@
 
 import tml, random
 from quests import *
+from flags import *
 
 # Add player to the game
-tml.GameAction.add_player('Narike', "earcr", 400, 400)
+tml.GameAction.add_player('Narike', "earcr", 500, 500)
 
 
 # Add new random enemy as time flow
 
 tml.EventManager.setRepeatableTimeEvent(30, "add_random_enemy_func")
-
 def add_random_enemy_func():
     if random.random()<0.1:
         tml.GameAction.add_ship(tml.GameAction.get_player_star_system(), "kohma", -1, -1, tml.GameAction.get_enemy_team())
     if random.random()<0.25:
         tml.GameAction.add_ship(tml.GameAction.get_player_star_system(), "ilwsp", -1, -1, tml.GameAction.get_enemy_team())
         
-
-#init values for quests
-tml.GameAction.save_flag('escort_transport_accept',0)
-tml.GameAction.save_flag('negotiate_with_chorali_accept',0)
-
+##########################################################################################################################
+        
 # Start quests
-start_precursor_wrack_mission()
+tml.EventManager.distanceLessThen(gflag.precursor_wreck_id,
+                                  tml.GameAction.get_player_ship_id(),
+                                  200,  'check_precursor_wreck_completed_func')
+#start_precursor_wrack_mission()
+#escort_transport_to_ixis_func()
 
-tml.EventManager.shipDeathByType('earcr', 'loose_game')
-def loose_game():
-    tml.GameAction.end_game()
+# tml.EventManager.shipDeathByType('earcr', 'loose_game')
+# def loose_game():
+#     tml.GameAction.end_game()
 

Modified: trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,4 +1,6 @@
 import tml
+from flags import *
+
 print "Init Gama Onyx star system"
 
 tml.GameAction.add_system('Gama Onyx',200, 200)

Modified: trunk/gamedata/games/test_game/scripts/systems/ixis.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/systems/ixis.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/systems/ixis.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,21 +1,29 @@
 import tml
 import random
 import math
+from flags import *
 print "Init Ixis star system"
 
 tml.GameAction.add_system('Ixis',50, 50)
 
 tml.GameAction.add_planet('Ixis','I', 1500, 1800)
+tml.GameAction.add_planet('Ixis','2', 5000, 5000)
 
-tml.GameAction.save_flag( 'ixis_mining_station base',
-                          tml.GameAction.add_orbiter_station('Ixis',
+gflag.ixis_mining_station = tml.GameAction.add_orbiter_station('Ixis',
                                                              'I',
                                                              'gob.dat',
                                                              'station0sprite',
                                                              'gob.dat#station0picture.bmp',
                                                              'earcr',
-                                                             'dialogs/ixis_mining_station_commander.xml'))
+                                                             'dialogs/ixis_mining_station_commander.xml')
 
+gflag.ixis_chorali_station = tml.GameAction.add_orbiter_station('Ixis',
+                                                             '2',
+                                                             'gob.dat',
+                                                             'station0sprite',
+                                                             'gob.dat#station0picture.bmp',
+                                                             'choex',
+                                                             'dialogs/chorali_commander.xml')
 for i in xrange(20):
     tml.GameAction.add_asteroid('Ixis')
 
@@ -26,7 +34,6 @@
 
 # Add Precursor ship wreck
 
-tml.GameAction.save_flag('precursor_wrack_id',
-                         tml.GameAction.add_ship('Ixis', "samat", 1500, 5000, tml.GameAction.get_enemy_team()))
-tml.GameAction.disable_weapon(tml.GameAction.get_double_flag('precursor_wrack_id'))
+gflag.precursor_wreck_id = tml.GameAction.add_ship('Ixis', "samat", 1500, 5000, tml.GameAction.get_enemy_team())
+tml.GameAction.disable_weapon(gflag.precursor_wreck_id)
 

Modified: trunk/gamedata/games/test_game/scripts/systems/narike.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/systems/narike.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/games/test_game/scripts/systems/narike.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,18 +1,16 @@
 import tml
+from flags import *
+
 print "Init Narike star system"
 
 tml.GameAction.add_system('Narike',220, 168)
-
 tml.GameAction.add_planet('Narike','Silcuu', 0, 0)
-
-tml.GameAction.save_flag( 'Narike Silcuu Base',
-                          tml.GameAction.add_orbiter_station('Narike',
+gflag.ixis_mining_station = tml.GameAction.add_orbiter_station('Narike',
                                                              'Silcuu',
                                                              'gob.dat',
                                                              'station0sprite',
                                                              'gob.dat#station0picture.bmp',
                                                              'earcr',
-                                                             'dialogs/welcomecommander.xml'))
-
+                                                             'dialogs/welcomecommander.xml')
 for i in xrange(20):
     tml.GameAction.add_asteroid('Narike')

Modified: trunk/gamedata/python/dialog.py
===================================================================
--- trunk/gamedata/python/dialog.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/python/dialog.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -16,7 +16,7 @@
 #  * runDialogString(str_xml) 
 #  * runDialogFile(file_path)
 
-import unittest, os
+import unittest, os, random, re
 import xml.parsers.expat
 
 """ For testing purpose we import fake TML implementation that provide the same API as
@@ -31,7 +31,9 @@
     import misc
 
 import quests
+from flags import *
 
+random.seed()
 g_cur_dialog = ""
 
 def runDialogString(str_xml):
@@ -49,7 +51,18 @@
 def endDialog():
     g_cur_dialog.endDialog()    
 #########################################################
+# Helpers functions
 
+def get_text(text):
+    tup = text.split('|')
+    return re.sub("{(.*?)}", lambda m: eval(m.group(1)), random.choice(tup))
+
+#########################################################
+class Local:
+    def __init__(self):
+        pass
+local = Local()
+
 class Action:
     def __init__(self,cond,eval):
         self.cond = cond     # should be true for evaluating action
@@ -64,7 +77,7 @@
     
 class PlayerAnswer(Action):
     def __init__(self,text,appear_condition,actions):
-        self.text         = text             # player answer text
+        self.text         = text              # player answer text
         self.cond         = appear_condition  # if true variant visible
         self.actions      = actions           # actions tuple that should run on evaluate
         
@@ -85,18 +98,26 @@
         self.player_answers = player_answers         # player Answers tuple
     def evaluate(self):
         tml.DialogApi.showAlienPicture(self.background)
-        tml.DialogApi.showText(self.alien_text, 0, self.text_location[0], self.text_location[1])
+        tml.DialogApi.showText(get_text(self.alien_text), 0, self.text_location[0], self.text_location[1])
         tml.GetSoundSystem().play_music(self.music)
         answers = filter(lambda x: x.checkCond(), self.player_answers)
         answ_texts = []
         for answer in answers:
-            answ_texts.append(answer.text)
+            answ_texts.append(get_text(answer.text))
         answers[tml.DialogApi.askPlayer(misc.PyListStringToVector(answ_texts))].evaluate()
         
 class Dialog:
-    def __init__(self, nodeset):
+    def __init__(self, startcond = (), endcond = (), nodeset = None):
         self.nodeset  = nodeset     # tuple with all dialog data, terminated by None object
         self.cur_node = nodeset[0]  # currently selectet node
+        global g_cur_dialog
+        g_cur_dialog = self
+        global local
+        local = Local()
+        self.start_cond = startcond
+        self.end_cond   = endcond
+        for act in self.start_cond:
+            act.evaluate()
     def doDialog(self): # run dialog untill selected node != None
         global g_cur_dialog
         g_cur_dialog = self
@@ -107,8 +128,10 @@
     def goto(self,id): # switch current node
         self.cur_node = filter(lambda x: x.id == id, self.nodeset)[0]
     def endDialog(self):
+        for act in self.end_cond:
+            act.evaluate()
         self.cur_node = None
-
+        
 class DialogLoader:
     """ This class can be used to transform dialog editor's XML files to Dialog objects
 
@@ -120,7 +143,6 @@
         self.p = xml.parsers.expat.ParserCreate()
         self.p.StartElementHandler    = self.start_element
         self.p.EndElementHandler      = self.end_element
-        self.p.CharacterDataHandler   = self.char_data
         self.python_code = ""
     def loadDialogString(self, dlg):
         self.python_code = ""
@@ -139,8 +161,6 @@
     def end_element(self, name):
         endMethod = getattr(self, 'end' + name)
         self.python_code += endMethod( name )
-    def char_data(self, data):
-        print 'Character data:', repr(data)
     ######################################################################
     def startACTION(self, name, attrs):
         return 'Action("""' + attrs['condition'] + '""","""'  + attrs['action'] + '"""),'
@@ -155,9 +175,13 @@
                attrs['font'] + '""",' + \
                attrs['text_location'] + ',('
     def startNODES(self, name, attrs):
-        return 'Dialog(('
+        return 'nodeset = ('
     def startDIALOG(self, name, attrs):
-        return ""
+        return "Dialog( "
+    def startSTART_DIALOG(self, name, attrs):
+        return " startcond = ("
+    def startEND_DIALOG(self, name, attrs):
+        return " endcond = ("
     def startSTART_NODES(self, name, attrs):
         return ""
     def startSTART_NODE(self, name, attrs):
@@ -172,6 +196,10 @@
         return ""
     def endDIALOG(self, name):
         return ""
+    def endSTART_DIALOG(self, name):
+        return "), "
+    def endEND_DIALOG(self, name):
+        return "), "
     def endSTART_NODES(self, name):
         return ""
     def endSTART_NODE(self, name):
@@ -219,18 +247,24 @@
         self.assertEqual(15, test_global_value)
 
 class TestDialogFunctions(unittest.TestCase):
+    start_cond = ()
+    end_cond   = ()
+    nodeset = (
+        Node(0, 'Node1','','','AlienText','',(50,10),
+             (PlayerAnswer('Answer1', '1', (Action('1', 'goto(1)'), )),
+              PlayerAnswer('Answer2', '1', (Action('1', 'endDialog()'),)
+                           )))
+        ,
+        Node(1, 'Node1','','','AlienText','',(50,10),
+             (PlayerAnswer('Answer3', '1', (Action('1', 'endDialog()'),)
+                           ),)),
+        ) 
+    def make_dialog(self, start_cond, end_cond, nodeset):
+        return Dialog(start_cond, end_cond, nodeset)
+    
     def setUp(self):
         tml.DialogApi.clearJornal()
-        self.dialog = Dialog( (
-            Node(0, 'Node1','','','AlienText','',(50,10),
-                 (PlayerAnswer('Answer1', '1', (Action('1', 'goto(1)'), )),
-                  PlayerAnswer('Answer2', '1', (Action('1', 'endDialog()'),)
-                               )))
-            ,
-            Node(1, 'Node1','','','AlienText','',(50,10),
-                 (PlayerAnswer('Answer3', '1', (Action('1', 'endDialog()'),)
-                               ),)),
-            )                         )
+        self.dialog = self.make_dialog( self.start_cond, self.end_cond, self.nodeset)
     def testGoto(self):
         self.dialog.goto(1)
         self.assertEqual(self.dialog.cur_node.id,1)
@@ -240,7 +274,16 @@
     def testDoDialog(self):
         self.dialog.doDialog()
         self.assertEqual(tml.DialogApi.getJornal(),"startDialog showAlienPicture showText play_music askPlayer showAlienPicture showText play_music askPlayer endDialog ")
-
+    def testStartCondition(self):
+        self.dialog = self.make_dialog( (Action('1', 'goto(1)'),), self.end_cond, self.nodeset)
+        self.dialog.doDialog()
+        self.assertEqual(tml.DialogApi.getJornal(),"startDialog showAlienPicture showText play_music askPlayer endDialog ")
+        pass
+    def testUsingLocalVar(self):
+        self.dialog = self.make_dialog( (Action('1', 'goto(1);local.abc=1'),), self.end_cond, self.nodeset)
+        self.assertEqual(1, local.abc)
+        pass
+    
 class TestDialogLoaderFunctions(unittest.TestCase):
     def setUp(self):
         tml.DialogApi.clearJornal()
@@ -276,7 +319,7 @@
     def testNodes(self):
         dlg_ldr = DialogLoader()
         dlg_ldr.start_element('NODES', {})
-        self.assertEqual('Dialog((',dlg_ldr.python_code)
+        self.assertEqual('nodeset = (',dlg_ldr.python_code)
     def testComplexTest(self):
         jornalString = "startDialog showAlienPicture showText play_music askPlayer showAlienPicture showText play_music askPlayer endDialog "
         f = open('test_dialog.xml','r')
@@ -287,7 +330,33 @@
         tml.DialogApi.clearJornal()
         DialogLoader().loadDialogFile('test_dialog.xml').doDialog()
         self.assertEqual(tml.DialogApi.getJornal(),jornalString)
-    
+    def testStartCondition(self):
+        dlg = DialogLoader().loadDialogFile('test_dialog.xml')
+        self.assertEqual(len(dlg.start_cond),2)
+        pass
+    def testStartCondition(self):
+        dlg = DialogLoader().loadDialogFile('test_dialog.xml')
+        self.assertEqual(len(dlg.end_cond),1)
+        pass
+
+class TestGetAlienTextFunction(unittest.TestCase):
+    def testSimpleRandom(self):
+        text = "Hi|Hello"
+        res = get_text(text)
+        self.assert_(res == "Hi" or res == "Hello")
+    def testSimpleRandomEmpty(self):
+        self.assertEqual(get_text(""),"")
+    def testTextWithCalledCode(self):
+        global test_player_name
+        test_player_name = "Yura"
+        text = "hi, {test_player_name}!"
+        self.assertEqual(get_text(text),"hi, Yura!")
+    def testTextWith2CalledCode(self):
+        global test_player_name
+        test_player_name = "Yura"
+        text = "hi, {test_player_name} {test_player_name}!"
+        self.assertEqual(get_text(text),"hi, Yura Yura!")
+
 if __name__ == '__main__':
     unittest.main()
 

Added: trunk/gamedata/python/flags.py
===================================================================

Added: trunk/gamedata/python/quests.py
===================================================================
--- trunk/gamedata/python/quests.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/python/quests.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -0,0 +1 @@
+# just to allow run unit tests from dialogs

Modified: trunk/gamedata/python/tml.py
===================================================================
--- trunk/gamedata/python/tml.py	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/gamedata/python/tml.py	2005-08-06 18:09:53 UTC (rev 175)
@@ -93,6 +93,8 @@
     if _newclass:scroll_text = staticmethod(_tml.GameAction_scroll_text)
     __swig_getmethods__["print_message"] = lambda x: _tml.GameAction_print_message
     if _newclass:print_message = staticmethod(_tml.GameAction_print_message)
+    __swig_getmethods__["set_camera_mode"] = lambda x: _tml.GameAction_set_camera_mode
+    if _newclass:set_camera_mode = staticmethod(_tml.GameAction_set_camera_mode)
     def __init__(self, *args):
         _swig_setattr(self, GameAction, 'this', _tml.new_GameAction(*args))
         _swig_setattr(self, GameAction, 'thisown', 1)
@@ -162,6 +164,8 @@
 
 GameAction_print_message = _tml.GameAction_print_message
 
+GameAction_set_camera_mode = _tml.GameAction_set_camera_mode
+
 class DialogApi(_object):
     __swig_setmethods__ = {}
     __setattr__ = lambda self, name, value: _swig_setattr(self, DialogApi, name, value)
@@ -253,8 +257,8 @@
     if _newclass:setRepeatableTimeEvent = staticmethod(_tml.EventManager_setRepeatableTimeEvent)
     __swig_getmethods__["disableEvent"] = lambda x: _tml.EventManager_disableEvent
     if _newclass:disableEvent = staticmethod(_tml.EventManager_disableEvent)
-    __swig_getmethods__["shipDeathByName"] = lambda x: _tml.EventManager_shipDeathByName
-    if _newclass:shipDeathByName = staticmethod(_tml.EventManager_shipDeathByName)
+    __swig_getmethods__["shipDeathById"] = lambda x: _tml.EventManager_shipDeathById
+    if _newclass:shipDeathById = staticmethod(_tml.EventManager_shipDeathById)
     __swig_getmethods__["shipDeathByType"] = lambda x: _tml.EventManager_shipDeathByType
     if _newclass:shipDeathByType = staticmethod(_tml.EventManager_shipDeathByType)
     __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
@@ -290,7 +294,7 @@
 
 EventManager_disableEvent = _tml.EventManager_disableEvent
 
-EventManager_shipDeathByName = _tml.EventManager_shipDeathByName
+EventManager_shipDeathById = _tml.EventManager_shipDeathById
 
 EventManager_shipDeathByType = _tml.EventManager_shipDeathByType
 

Modified: trunk/source/games/ggob.cpp
===================================================================
--- trunk/source/games/ggob.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/games/ggob.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -52,7 +52,7 @@
 #include "tml/eventmanager.h"
 #include "tml/gameaction.h"
 
-#include "melee/GobWarpOutTrail.h"
+#include "other/gobwarpouttrail.h"
 //#include "melee/WarpOutTrail.h"
 
 #define gobgame ((GobGame*)game)
@@ -94,7 +94,7 @@
 }
 
 ////////////////////////////////////////////////////////////////////////
-//				Gob stuff
+//              Gob stuff
 ////////////////////////////////////////////////////////////////////////
 
 GobAsteroid::GobAsteroid( Vector2 opos, double oangle, int ospeed)
@@ -135,7 +135,7 @@
     {
       GobPlayer *p = gobgame->get_player(source);
       if (p) 
-	p->buckazoids += 1;
+    p->buckazoids += 1;
     }
   return i;
 }
@@ -144,7 +144,7 @@
 {
   STACKTRACE;
   Animation *a = new Animation(this, pos,
-			       explosion, 0, explosion->frames(), time_ratio, get_depth());
+                   explosion, 0, explosion->frames(), time_ratio, get_depth());
   a->match_velocity(this);
   game->add(a);
 
@@ -202,16 +202,16 @@
   item.remove(gobplayer.ship);
   
   std::list<StarSystem*>::iterator sNew = std::find_if(_galaxy._stars.begin(), 
-						 _galaxy._stars.end(), 
-						 std::bind2nd(findStar(), name));
+                         _galaxy._stars.end(), 
+                         std::bind2nd(findStar(), name));
   if(sNew==_galaxy._stars.end())
     {
       tw_error("Star not found");
     }
 
   std::list<StarSystem*>::iterator sOld = std::find_if(_galaxy._stars.begin(), 
-						 _galaxy._stars.end(), 
-						 std::bind2nd(findStar(), _name));
+                         _galaxy._stars.end(), 
+                         std::bind2nd(findStar(), _name));
   if(sOld==_galaxy._stars.end())
     {
       tw_error("Star not found");
@@ -228,7 +228,7 @@
       remove(item.back());
       if(item.size()==psize)
       {
-	tw_error("!!!!@@!!@$##$%#$^%#$@#");
+    tw_error("!!!!@@!!@$##$%#$^%#$@#");
       }
       psize = item.size();
     }
@@ -268,11 +268,11 @@
   _player_panel->window->init(window);
   
   _player_panel->window->locate(
-			0,0.9,
-			0,0,
-			0,0.1,
-			0,0.25
-			);
+            0,0.9,
+            0,0,
+            0,0.1,
+            0,0.25
+            );
   _player_panel->set_depth(10);
   add(_player_panel);
 }
@@ -300,13 +300,13 @@
 {
   return;
   /*
-	double v;
-	Vector2 d = source->normal_pos() - space_center;
-	d = normalize(d + size/2, size) - size/2;
-	v = 1000;
-	if (space_zoom > 0.01) v = 500 + space_view_size.x / space_zoom / 4;
-	v = 1 + magnitude_sqr(d) / (v*v);
-	Game::play_sound(sample, source, iround(vol/v), freq);
+    double v;
+    Vector2 d = source->normal_pos() - space_center;
+    d = normalize(d + size/2, size) - size/2;
+    v = 1000;
+    if (space_zoom > 0.01) v = 500 + space_view_size.x / space_zoom / 4;
+    v = 1 + magnitude_sqr(d) / (v*v);
+    Game::play_sound(sample, source, iround(vol/v), freq);
   */
 }
 
@@ -348,7 +348,7 @@
 
   player_team = new_team();
   enemy_team  = new_team();
-	       
+           
 
   int server_players;
   tw_set_config_file("client.ini");
@@ -365,8 +365,8 @@
 
 
   for_each_file( (GameConfig::GetGameDirectory() + "scripts/systems/*.py").c_str(), 
-		 FA_ARCH|FA_RDONLY, 
-		 _exec_py_script, 0);
+         FA_ARCH|FA_RDONLY, 
+         _exec_py_script, 0);
   _galaxy._stars.remove(s);
   delete s;
   _exec_py_script(GameConfig::GetAbsolutePath("scripts/start.py").c_str(), 0, 0);
@@ -378,11 +378,11 @@
 
   this->change_view("Hero");
   view->window->locate(
-		       0,0,
-		       0,0,
-		       0,0.9,
-		       0,1
-		       );
+               0,0,
+               0,0,
+               0,0.9,
+               0,1
+               );
   return;
 }
 
@@ -426,18 +426,18 @@
   for(std::list<SpaceLocation*>::iterator i= item.begin(); i!= item.end();i++)
     {
       if(*i && (*i)->isPlanet() && (*i)->exists() && ((Planet*)(*i))->get_name() == name)
-	return (Planet*)(*i);
+    return (Planet*)(*i);
     }
   return NULL;
 }
 
 int GobGame::add_orbiter_station(const std::string& system, 
-			     const std::string& planet, 
-			     const std::string& gatafile,
-			     const std::string& station_sprite,
-			     const std::string& background_picture,
-			     const std::string& buildtype,
-			     const std::string& commander_dialog)
+                 const std::string& planet, 
+                 const std::string& gatafile,
+                 const std::string& station_sprite,
+                 const std::string& background_picture,
+                 const std::string& buildtype,
+                 const std::string& commander_dialog)
 {
   STACKTRACE;
   Planet* p = get_planet(planet);
@@ -470,8 +470,8 @@
   if (gobplayer.ship) 
     {
       message.print((int)msecs_per_fps, 15-i, "coordinates: %d x %d", 
-		    iround(gobplayer.ship->normal_pos().x), 
-		    iround(gobplayer.ship->normal_pos().y));
+            iround(gobplayer.ship->normal_pos().x), 
+            iround(gobplayer.ship->normal_pos().y));
     }
   message.print((int)msecs_per_fps, 15-i, "starbucks: %d", gobplayer.starbucks);
   message.print((int)msecs_per_fps, 15-i, "buckazoids: %d",gobplayer.buckazoids);
@@ -493,17 +493,17 @@
       e -= random() % (1 + game_time / (250 * 1000));
       if (0) ;
       else if (e >=12) 
-	next_add_new_enemy_time += 15000;
+    next_add_new_enemy_time += 15000;
       else if (e >= 7) 
-	next_add_new_enemy_time += 7000;
+    next_add_new_enemy_time += 7000;
       else if (e >= 4) 
-	next_add_new_enemy_time += 5000;
+    next_add_new_enemy_time += 5000;
       else if (e >= 2) 
-	next_add_new_enemy_time += 3000;
+    next_add_new_enemy_time += 3000;
       else if (e >= 1) 
-	next_add_new_enemy_time += 2000;
+    next_add_new_enemy_time += 2000;
       else 
-	next_add_new_enemy_time += 1000;
+    next_add_new_enemy_time += 1000;
     }
   Game::calculate();
   EventManager::calculate();
@@ -560,34 +560,18 @@
   STACKTRACE;
   switch (k >> 8) 
     {
-    case KEY_J: 
-      {
-	if(_name=="Arix")
-	  {
-	    add(GobWarpOutTrail::getGobWarpOutTrail(gobplayer.ship, "Beta", this));
-	    //switch_system("Beta");
-	  }
-	else
-	  {
-	    add(GobWarpOutTrail::getGobWarpOutTrail(gobplayer.ship, "Arix", this));
-	    //switch_system("Arix");
-	  }
-	
-	return true;
-      }
-      break;
     case KEY_M:
       {
-	add( GobWarpOutTrail::getGobWarpOutTrail(gobplayer.ship, _galaxy.select(), this));
-	//game->add( WarpOutTrail::getWarpOutTrail(gobplayer.ship) );
-	//switch_system(_galaxy.select());
-	videosystem->window.redraw();
-	return true;
+    add( GobWarpOutTrail::getGobWarpOutTrail(gobplayer.ship, _galaxy.select(), this));
+    //game->add( WarpOutTrail::getWarpOutTrail(gobplayer.ship) );
+    //switch_system(_galaxy.select());
+    videosystem->window.redraw();
+    return true;
       }
       break;
     default: 
       {
-	return GobGameBase::handle_key(k);
+    return GobGameBase::handle_key(k);
       }
       break;
     }
@@ -623,13 +607,13 @@
   int e = 99999;
   while (e >= num_enemy_types) {
 /*
-base	time	low		high
+base    time    low     high
 
-  1		.5		-0.1	3.7
-  10	5		2.62	7.47
-  50	25		5.89	14.24
- 100	50		8.1		17.3
- 200	100		11.01	26.49
+  1     .5      -0.1    3.7
+  10    5       2.62    7.47
+  50    25      5.89    14.24
+ 100    50      8.1     17.3
+ 200    100     11.01   26.49
 
 
 
@@ -645,7 +629,7 @@
     e = e;
   }
   Ship *ship = create_ship(channel_server, enemy_types[e], "WussieBot", 
-			   random(size), random(PI2), enemy_team);
+               random(size), random(PI2), enemy_team);
 
   int sb, bz;
   sb = 1 + e / 4;
@@ -678,7 +662,7 @@
   std::string cur_sys = _name;
   switch_system(system);
   Ship *ship = create_ship(channel_server, shptype.c_str(), "WussieBot", 
-			   pos, random(PI2), team);
+               pos, random(PI2), team);
   add(ship->get_ship_phaser());
   
   switch_system(cur_sys);
@@ -780,7 +764,7 @@
   for (i = 0; i < num_pairs; i += 1) 
     {
       if (!strcmp(pair_list[i].id, id)) 
-	return &pair_list[i];
+    return &pair_list[i];
     }
   return NULL;
 }
@@ -827,7 +811,7 @@
   if ((starbucks < price_starbucks) || (buckazoids < price_buckazoids)) 
     {
       if (game->is_local(gobgame->_player_control->channel)) 
-	alert("You don't have enough.", name, buffy1, "Cancel", NULL, 0, 0);
+    alert("You don't have enough.", name, buffy1, "Cancel", NULL, 0, 0);
       return 0;
     }
   int r = 0;
@@ -884,7 +868,7 @@
     {
       sprintf (buffy1, "You already have a %s", ntype->name);
       if (game->is_local(gobgame->_player_control->channel)) 
-	alert(buffy1, NULL, NULL, "&Cancel", NULL, 'c', 0);
+    alert(buffy1, NULL, NULL, "&Cancel", NULL, 'c', 0);
       return;
     }
   int ossb = (s->value_starbucks*3) / 4 + (s->ship->type->cost*1)/1;
@@ -897,25 +881,25 @@
     {
       int i = 0;
       if (game->is_local(gobgame->_player_control->channel))
-	i = alert(buffy1, buffy2, "Do you wish to buy it?", "Yeah!", "No", 'y', 'n');
+    i = alert(buffy1, buffy2, "Do you wish to buy it?", "Yeah!", "No", 'y', 'n');
       game->log_int(gobgame->_player_control->channel, i);
       if (i == 1) 
-	{
-	  s->starbucks -= nssb - ossb;
-	  s->buckazoids -= nsbz - osbz;
-	  s->new_ship(ntype);
-	}
+    {
+      s->starbucks -= nssb - ossb;
+      s->buckazoids -= nsbz - osbz;
+      s->new_ship(ntype);
     }
+    }
   else 
     {
       if (game->is_local(gobgame->_player_control->channel)) 
-	alert (buffy1, buffy2, "You don't have enough to buy it", "Cancel", NULL, 0, 0);
+    alert (buffy1, buffy2, "You don't have enough to buy it", "Cancel", NULL, 0, 0);
     }
   return;
 }
 
 GobStation::GobStation ( SpaceSprite *pic, SpaceLocation *orbit_me, const std::string& ship, 
-			 const std::string& background) : 
+             const std::string& background) : 
   Orbiter(pic, orbit_me, random() % 200 + 500) 
 {
   _build_type = ship;
@@ -956,110 +940,110 @@
     game->window->lock();
     aa_set_mode(AA_DITHER);
     aa_stretch_blit(background, game->window->surface, 
-		    0,0,background->w,background->h, 
-		    game->window->x,game->window->y,game->window->w, game->window->h);
+            0,0,background->w,background->h, 
+            game->window->x,game->window->y,game->window->w, game->window->h);
     game->window->unlock();
 
     sprintf(dialog_string[0], "%03d Starbucks  %03d Buckazoids", s->starbucks, s->buckazoids);
     int r = 0;
     if (game->is_local(gobgame->_player_control->channel)) 
       r = tw_do_dialog(game->window, station_dialog, STATION_DIALOG_DEPART);
-		game->log_int(gobgame->_player_control->channel, r);
-		switch (r) {
-		case STATION_DIALOG_UPGRADE: {
-		  upgrade_menu(this, s);
-				aa_set_mode(AA_DITHER);
-				aa_stretch_blit(background, game->window->surface, 
-						0,0,background->w,background->h, 
-						game->window->x,game->window->y,
-						game->window->w, game->window->h);
-		}
-		  break;
-		case STATION_DIALOG_NEWSHIP: 
-		  {
-		    buy_new_ship_menu(s);
-		  }
-		  break;
-		case STATION_DIALOG_REPAIR: 
-		  {
-		    if (s->ship->crew == s->ship->crew_max) 
-		      {
-			if (game->is_local(gobgame->_player_control->channel)) 
-			  alert("You don't need repairs", "", "", "Oh, okay", "I knew that", 0, 0);			
-			break;
-		      }
-		    int p = 0;
-		    if (game->is_local(gobgame->_player_control->channel)) 
-		      p = alert3("Which would you prefer", "to pay for your repairs", "", "1 &Starbuck", "1 &Buckazoid", "&Nothing!", 's', 'b', 'n');
-		    game->log_int(gobgame->_player_control->channel, p);
-		    switch (p) {
-		    case 1: 
-		      {
-			if (s->starbucks) 
-			  {
-			    s->starbucks -= 1;
-			    s->ship->crew = s->ship->crew_max;
-			  }
-			else 
-			  {
-			    if (game->is_local(gobgame->_player_control->channel)) 
-			      alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
-			  }
-		      }
-		      break;
-		    case 2: 
-		      {
-			if (s->buckazoids) 
-			  {
-			    s->buckazoids -= 1;
-			    s->ship->crew = s->ship->crew_max;
-			  }
-			else 
-			  {
-			    if (game->is_local(gobgame->_player_control->channel)) 
-			      alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
-			  }
-		      }
-		      break;
-		    case 3: 
-		      {
-			r = STATION_DIALOG_DEPART;
-		      }
-		      break;
-		    }
-		  }
-		  break;
-		case STATION_DIALOG_COMMANDER:
-		  {
-		    chat_with_player();
-		  }
-		  break;
-		}
-		if (r == STATION_DIALOG_DEPART) 
-		  break;
+        game->log_int(gobgame->_player_control->channel, r);
+        switch (r) {
+        case STATION_DIALOG_UPGRADE: {
+          upgrade_menu(this, s);
+                aa_set_mode(AA_DITHER);
+                aa_stretch_blit(background, game->window->surface, 
+                        0,0,background->w,background->h, 
+                        game->window->x,game->window->y,
+                        game->window->w, game->window->h);
+        }
+          break;
+        case STATION_DIALOG_NEWSHIP: 
+          {
+            buy_new_ship_menu(s);
+          }
+          break;
+        case STATION_DIALOG_REPAIR: 
+          {
+            if (s->ship->crew == s->ship->crew_max) 
+              {
+            if (game->is_local(gobgame->_player_control->channel)) 
+              alert("You don't need repairs", "", "", "Oh, okay", "I knew that", 0, 0);         
+            break;
+              }
+            int p = 0;
+            if (game->is_local(gobgame->_player_control->channel)) 
+              p = alert3("Which would you prefer", "to pay for your repairs", "", "1 &Starbuck", "1 &Buckazoid", "&Nothing!", 's', 'b', 'n');
+            game->log_int(gobgame->_player_control->channel, p);
+            switch (p) {
+            case 1: 
+              {
+            if (s->starbucks) 
+              {
+                s->starbucks -= 1;
+                s->ship->crew = s->ship->crew_max;
+              }
+            else 
+              {
+                if (game->is_local(gobgame->_player_control->channel)) 
+                  alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
+              }
+              }
+              break;
+            case 2: 
+              {
+            if (s->buckazoids) 
+              {
+                s->buckazoids -= 1;
+                s->ship->crew = s->ship->crew_max;
+              }
+            else 
+              {
+                if (game->is_local(gobgame->_player_control->channel)) 
+                  alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
+              }
+              }
+              break;
+            case 3: 
+              {
+            r = STATION_DIALOG_DEPART;
+              }
+              break;
+            }
+          }
+          break;
+        case STATION_DIALOG_COMMANDER:
+          {
+            chat_with_player();
+          }
+          break;
+        }
+        if (r == STATION_DIALOG_DEPART) 
+          break;
   }
   return;
 }
 void GobStation::inflict_damage(SpaceObject *other) {
   STACKTRACE;
-	SpaceObject::inflict_damage(other);
-	if (!other->isShip()) return;
-	GobPlayer *p = gobgame->get_player(other);
-	if (!p) return;
-	gobgame->pause();
-	char buffy[256];
-	int a;
-	sprintf(buffy, "First visited station %s at time", _build_type.c_str());
-	a = p->read_pair(buffy);
-	if (a == -1) p->write_pair(buffy, game->game_time);
-	sprintf(buffy, "Visited station %s N times", _build_type.c_str());
-	a = p->read_pair(buffy);
-	if (a == -1) a = 0;
-	p->write_pair(buffy, a+1);
-	station_screen(p);
-	gobgame->unpause();
-	return;
-	}
+    SpaceObject::inflict_damage(other);
+    if (!other->isShip()) return;
+    GobPlayer *p = gobgame->get_player(other);
+    if (!p) return;
+    gobgame->pause();
+    char buffy[256];
+    int a;
+    sprintf(buffy, "First visited station %s at time", _build_type.c_str());
+    a = p->read_pair(buffy);
+    if (a == -1) p->write_pair(buffy, game->game_time);
+    sprintf(buffy, "Visited station %s N times", _build_type.c_str());
+    a = p->read_pair(buffy);
+    if (a == -1) a = 0;
+    p->write_pair(buffy, a+1);
+    station_screen(p);
+    gobgame->unpause();
+    return;
+    }
 
 
 
@@ -1067,15 +1051,15 @@
 int upgrade_index[999];
 GobPlayer *upgrade_list_for;
 char *upgradeListboxGetter(int index, int *list_size) {
-	static char tmp[150];
-	if(index < 0) {
-		*list_size = num_upgrade_indexes;
-		return NULL;
-		}
-	int i = upgrade_index[index];
-	sprintf(tmp, "%1d %3d s$ / %3d b$  :  %s", upgrade_list_for->upgrade_list[i]->num, upgrade_list_for->upgrade_list[i]->starbucks, upgrade_list_for->upgrade_list[i]->buckazoids, upgrade_list_for->upgrade_list[i]->name);
-	return tmp;
-	}
+    static char tmp[150];
+    if(index < 0) {
+        *list_size = num_upgrade_indexes;
+        return NULL;
+        }
+    int i = upgrade_index[index];
+    sprintf(tmp, "%1d %3d s$ / %3d b$  :  %s", upgrade_list_for->upgrade_list[i]->num, upgrade_list_for->upgrade_list[i]->starbucks, upgrade_list_for->upgrade_list[i]->buckazoids, upgrade_list_for->upgrade_list[i]->name);
+    return tmp;
+    }
 #define UPGRADE_DIALOG_EXIT 0
 #define UPGRADE_DIALOG_LIST 3
 static DIALOG upgrade_dialog[] =
@@ -1099,8 +1083,8 @@
     int j = 0;
     for (i = 0; gs->upgrade_list[i]; i += 1) {
       if (gs->upgrade_list[i]->update(gs->ship, station, gs)) {
-	upgrade_index[j] = i;
-	j += 1;
+    upgrade_index[j] = i;
+    j += 1;
       }
     }
     num_upgrade_indexes = j;
@@ -1108,162 +1092,163 @@
     if (game->is_local(gobgame->_player_control->channel))
       m = tw_do_dialog(game->window, upgrade_dialog, UPGRADE_DIALOG_EXIT);
     game->log_int(gobgame->_player_control->channel, m);
-		if (m == UPGRADE_DIALOG_EXIT) return;
-		if (m == UPGRADE_DIALOG_LIST) {
-			int i = 0;
-			if (game->is_local(gobgame->_player_control->channel))
-				i = upgrade_dialog[UPGRADE_DIALOG_LIST].d1;
-			game->log_int(gobgame->_player_control->channel, i);
-			i = upgrade_index[i];
-			Upgrade *u = gs->upgrade_list[i];
-			if (gs->charge(u->name, u->starbucks, u->buckazoids)) {
-				u->execute(gs->ship, station, gs);
-				u->charge(gs);
-				}
-			}
-		}
-	return;
-	}
+        if (m == UPGRADE_DIALOG_EXIT) return;
+        if (m == UPGRADE_DIALOG_LIST) {
+            int i = 0;
+            if (game->is_local(gobgame->_player_control->channel))
+                i = upgrade_dialog[UPGRADE_DIALOG_LIST].d1;
+            game->log_int(gobgame->_player_control->channel, i);
+            i = upgrade_index[i];
+            Upgrade *u = gs->upgrade_list[i];
+            if (gs->charge(u->name, u->starbucks, u->buckazoids)) {
+                u->execute(gs->ship, station, gs);
+                u->charge(gs);
+                }
+            }
+        }
+    return;
+    }
 
 GobDefender::GobDefender ( Ship *ship) 
 : SpaceObject (ship, ship->normal_pos(), 0, gobgame->defenderSprite)
 {
-	base_phase = 0;
-	next_shoot_time = 0;
-	collide_flag_anyone = 0;
+    base_phase = 0;
+    next_shoot_time = 0;
+    collide_flag_anyone = 0;
 }
 void GobDefender::calculate() {
   STACKTRACE;
-	SpaceObject::calculate();
-	if (!ship) {
-		die();
-		return;
-	}
-	if (next_shoot_time < gobgame->game_time) {
-		SpaceObject *target = NULL;
-		Query q;
-		q.begin(this, OBJECT_LAYERS &~ bit(LAYER_SHIPS), 300);
-		while (q.currento && !target) {
-			if (!q.currento->sameTeam(ship)) {
-				SpaceLine *l = new PointLaser ( 
-					this, palette_color[4], 2, 150, 
-					this, q.currento
-					);
-				add(l);
-				if (l->exists()) target = q.currento;
-			}
-			q.next();
-		}
-		if (target) {
-			next_shoot_time = gobgame->game_time + 400;
-		}
-	}
-	double a = base_phase + (gobgame->game_time % 120000) * ( PI2 / 1000.0) / 6;
-	angle = normalize(a,PI2);
-	pos = normalize(ship->normal_pos() + 270 * unit_vector ( angle ));
-	return;
+    SpaceObject::calculate();
+    if (!ship) {
+        die();
+        return;
+    }
+    if (next_shoot_time < gobgame->game_time) {
+        SpaceObject *target = NULL;
+        Query q;
+        q.begin(this, OBJECT_LAYERS &~ bit(LAYER_SHIPS), 300);
+        while (q.currento && !target) {
+            if (!q.currento->sameTeam(ship)) {
+                SpaceLine *l = new PointLaser ( 
+                    this, palette_color[4], 2, 150, 
+                    this, q.currento
+                    );
+                add(l);
+                if (l->exists()) target = q.currento;
+            }
+            q.next();
+        }
+        if (target) {
+            next_shoot_time = gobgame->game_time + 400;
+        }
+    }
+    double a = base_phase + (gobgame->game_time % 120000) * ( PI2 / 1000.0) / 6;
+    angle = normalize(a,PI2);
+    pos = normalize(ship->normal_pos() + 270 * unit_vector ( angle ));
+    return;
 }
 
 RainbowRift::RainbowRift () 
 //: SpaceLocation ( NULL, 12800, 12800, 0) 
 : SpaceLocation ( NULL, random(map_size), 0) 
 {
-	int i;
-	collide_flag_sameship = 0;
-	collide_flag_sameteam = 0;
-	collide_flag_anyone = 0;
-	for (i = n*6-6; i < n*6+2; i += 1) {
-		p[i] = 75 + random(150.0);
-	}
-	for (i = 0; i < n; i += 1) {
-		squiggle();
-	}
-	next_time = game->game_time;
-	next_time2 = game->game_time;
+    int i;
+    collide_flag_sameship = 0;
+    collide_flag_sameteam = 0;
+    collide_flag_anyone = 0;
+    for (i = n*6-6; i < n*6+2; i += 1) {
+        p[i] = 75 + random(150.0);
+    }
+    for (i = 0; i < n; i += 1) {
+        squiggle();
+    }
+    next_time = game->game_time;
+    next_time2 = game->game_time;
 }
 void RainbowRift::animate( Frame *frame ) {
   STACKTRACE;
-	Vector2 s;
-	s = corner(pos, Vector2(300,300));
-	if ((s.x < -500) || (s.x > space_view_size.x + 500) || 
-		(s.y < -500) || (s.y > space_view_size.y + 500))
-		return;
-	int b[n*6+2];
-	int i;
-	for (i = 0; i < n*6+2; i += 2) { 
-		b[i] = iround(s.x + p[i] * space_zoom);
-		b[i+1] = iround(s.y + p[i+1] * space_zoom);
-	}
-	for (i = 0; i < n; i += 1) {
-		RGB tc = c[n-i-1];
-		int a = tw_color(tc.r, tc.g, tc.b);
-		spline ( frame->surface, &b[i*6], a );
-	}
-	frame->add_box ( 
-		iround(s.x - 2), iround(s.y -2), 
-		iround(300 * space_zoom+5), iround(300 * space_zoom+5)
-		);
-	return;
+    Vector2 s;
+    s = corner(pos, Vector2(300,300));
+    if ((s.x < -500) || (s.x > space_view_size.x + 500) || 
+        (s.y < -500) || (s.y > space_view_size.y + 500))
+        return;
+    int b[n*6+2];
+    int i;
+    for (i = 0; i < n*6+2; i += 2) { 
+        b[i] = iround(s.x + p[i] * space_zoom);
+        b[i+1] = iround(s.y + p[i+1] * space_zoom);
+    }
+    for (i = 0; i < n; i += 1) {
+        RGB tc = c[n-i-1];
+        int a = tw_color(tc.r, tc.g, tc.b);
+        spline ( frame->surface, &b[i*6], a );
+    }
+    frame->add_box ( 
+        iround(s.x - 2), iround(s.y -2), 
+        iround(300 * space_zoom+5), iround(300 * space_zoom+5)
+        );
+    return;
 }
 void RainbowRift::squiggle() {
   STACKTRACE;
-	int i;
-	int m = n*6+2;
-	for (i = 0; i < m - 6; i += 1) {
-		p[i] = p[i+6];
-	}
-	p[m-6] = p[m-8] * 2 - p[m-10];
-	p[m-5] = p[m-7] * 2 - p[m-9];
-	p[m-4] = 75 + random(150.0);
-	p[m-3] = 75 + random(150.0);
-	p[m-2] = 75 + random(150.0);
-	p[m-1] = 75 + random(150.0);
-	for (i = 0; i < n-1; i += 1) {
-		c[i] = c[i+1];
-	}
-	int r, g, b;
-	r = int(game->game_time * 0.5) % 360;
-	hsv_to_rgb( r, 1.0, 1.0, &r, &g, &b );
-	c[n-1].r = r;
-	c[n-1].g = g;
-	c[n-1].b = b;
-	return;
+    int i;
+    int m = n*6+2;
+    for (i = 0; i < m - 6; i += 1) {
+        p[i] = p[i+6];
+    }
+    p[m-6] = p[m-8] * 2 - p[m-10];
+    p[m-5] = p[m-7] * 2 - p[m-9];
+    p[m-4] = 75 + random(150.0);
+    p[m-3] = 75 + random(150.0);
+    p[m-2] = 75 + random(150.0);
+    p[m-1] = 75 + random(150.0);
+    for (i = 0; i < n-1; i += 1) {
+        c[i] = c[i+1];
+    }
+    int r, g, b;
+    r = int(game->game_time * 0.5) % 360;
+    hsv_to_rgb( r, 1.0, 1.0, &r, &g, &b );
+    c[n-1].r = r;
+    c[n-1].g = g;
+    c[n-1].b = b;
+    return;
 }
 void RainbowRift::calculate() {
   STACKTRACE;
-	while (game->game_time > next_time) {
-		next_time += 25;
-		squiggle();
-	}
-	while (game->game_time > next_time2) {
-		next_time2 += random() % 10000;
-		Query q;
-		for (q.begin(this, bit(LAYER_SHIPS), 40); q.current; q.next()) {
-			GobPlayer *p = gobgame->get_player(q.currento);
-			if (q.currento == p->ship) {
-				int i = 0;
-				i = gobgame->_player_control->choose_ship(game->window, "You found the Rainbow Rift!", reference_fleet);
-				game->log_int(gobgame->_player_control->channel, i);
-				if (i == -1) 
-				  i = random(reference_fleet->getSize());
-				game->redraw();
-				if (reference_fleet->getShipType(i) == p->ship->type) {
-					p->starbucks += random() % 80;
-					p->buckazoids += random() % 80;
-					game->add(new RainbowRift());
-				}
-				else {
-					p->starbucks += random() % (1+p->value_starbucks);
-					p->buckazoids += random() % (1+p->value_buckazoids);
-					p->new_ship(reference_fleet->getShipType(i));
-				}
-				die();
-			}
-		}
-	}
-	return;
+    while (game->game_time > next_time) {
+        next_time += 25;
+        squiggle();
+    }
+    while (game->game_time > next_time2) {
+        next_time2 += random() % 10000;
+        Query q;
+        for (q.begin(this, bit(LAYER_SHIPS), 40); q.current; q.next()) {
+            GobPlayer *p = gobgame->get_player(q.currento);
+            if (q.currento == p->ship) {
+                int i = 0;
+                i = gobgame->_player_control->choose_ship(game->window, "You found the Rainbow Rift!", reference_fleet);
+                game->log_int(gobgame->_player_control->channel, i);
+                if (i == -1) 
+                  i = random(reference_fleet->getSize());
+                game->redraw();
+                if (reference_fleet->getShipType(i) == p->ship->type) {
+                    p->starbucks += random() % 80;
+                    p->buckazoids += random() % 80;
+                    game->add(new RainbowRift());
+                }
+                else {
+                    p->starbucks += random() % (1+p->value_starbucks);
+                    p->buckazoids += random() % (1+p->value_buckazoids);
+                    p->new_ship(reference_fleet->getShipType(i));
+                }
+                die();
+            }
+        }
+    }
+    return;
 }
 
+
 int GobGame::add_gobplayer(const std::string& system, const std::string& shptype, Vector2 pos)
 {
   STACKTRACE;

Modified: trunk/source/games/ggob.h
===================================================================
--- trunk/source/games/ggob.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/games/ggob.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -26,7 +26,7 @@
 #include "gamehierarchy.h"
 #include "other/starmap.h"
 
-#include "melee/GobWarpOutTrail.h"
+#include "other/gobwarpouttrail.h"
 
 class Upgrade;
 class GobStation;
@@ -174,7 +174,7 @@
   virtual Planet* get_planet(const std::string& name);
 
   virtual void prepare();
-  //	protected:
+  //    protected:
   virtual void fps ();
   
 
@@ -205,12 +205,12 @@
 
  public:
   int add_orbiter_station(const std::string& system, 
-			   const std::string& planet, 
-			   const std::string& gatafile,
-			   const std::string& station_sprite,
-			   const std::string& background_picture,
-			   const std::string& buildtype,
-			   const std::string& commander_dialog);
+               const std::string& planet, 
+               const std::string& gatafile,
+               const std::string& station_sprite,
+               const std::string& background_picture,
+               const std::string& buildtype,
+               const std::string& commander_dialog);
 };
 
 /// Station where player can buy upgrades and repair his ship

Deleted: trunk/source/melee/GobWarpOutTrail.cpp
===================================================================
--- trunk/source/melee/GobWarpOutTrail.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/melee/GobWarpOutTrail.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,83 +0,0 @@
-/*
-This file is part of "TW-Light" 
-                    http://tw-light.berlios.de/
-Copyright (C) 2001-2004  TimeWarp development team
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-*/
-
-#include "melee/mship.h" // for Ship class
-#include "melee/WarpOutTrail.h"
-#include "melee/GobWarpOutTrail.h"
-#include "games/ggob.h"
-
-#include <string>
-
-GobWarpEffect::GobWarpEffect(const std::string & targetSystem, GobGame * gobGame) :
-  targetSystem(targetSystem),
-  gobGame(gobGame)
-{
-  STACKTRACE;
-}
-
-void GobWarpEffect::startEffect() {
-  STACKTRACE;
-  //yB! should uncomment this when we know there is only one call to this per
-  //instance of GobWarpEffect.  Currently, this keeps getting called
-  //gobGame->item.remove(gobGame->gobplayer.ship);
-  printf("GobWarpEffect::startEffect()\n");
-}
-  
-void GobWarpEffect::endEffect() {
-  STACKTRACE;
-  gobGame->switch_system(targetSystem);
-  printf("GobWarpEffect::endEffect()\n");
-}
-
-
-GobWarpOutTrail::GobWarpOutTrail(
-		 const std::string & targetSystem,
-		 GobGame * gobGame,
-		 SpaceLocation *creator, Vector2 pos, Vector2 rel_pos, 
-		 Ship *ship, SpaceSprite *sprite, int osprite_index, int *ocolors, 
-		 int onum_colors, int ofsize, int steps, int step_time) :
-	 WarpOutTrail(creator, pos, rel_pos, 
-	 ship, sprite, osprite_index, ocolors, 
-	 onum_colors, ofsize, steps, step_time, new GobWarpEffect(targetSystem, gobGame))
-{
-  STACKTRACE;
-}
-
-GobWarpOutTrail * GobWarpOutTrail::getGobWarpOutTrail(Ship * ship, 
-	const std::string & targetSystem,
-	GobGame * gobGame)
-{
-  STACKTRACE;
-  if (!ship) {
-  	tw_error("In getGobWarpOutTrail(), parameter ship was null");
-  	return NULL;
-  }
-  return new GobWarpOutTrail(
-		    targetSystem,
-		    gobGame, 
-		    ship,
-		    ship->pos + unit_vector(ship->get_angle()) * 0 * ship->get_size().x,
-		    unit_vector(ship->get_angle()) * PHASE_MAX * ship->get_size().x,
-		    ship, 
-		    ship->get_sprite(), 
-		    ship->get_sprite_index(), 
-		    inverse_hot_color, 
-		    INVERSE_HOT_COLORS,
-		    PHASE_DELAY, 
-		    PHASE_MAX, 
-		    PHASE_DELAY
-		    );
-}

Deleted: trunk/source/melee/GobWarpOutTrail.h
===================================================================
--- trunk/source/melee/GobWarpOutTrail.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/melee/GobWarpOutTrail.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,100 +0,0 @@
-/*
-This file is part of "TW-Light" 
-                    http://tw-light.berlios.de/
-Copyright (C) 2001-2004  TimeWarp development team
-
-This program is free software; you can redistribute it and/or modify
-it under the terms of the GNU General Public License as published by
-the Free Software Foundation; either version 2 of the License, or
-(at your option) any later version.
-
-This program is distributed in the hope that it will be useful,
-but WITHOUT ANY WARRANTY; without even the implied warranty of
-MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-GNU General Public License for more details.
-*/
-
-#ifndef GobWarpOutTrail_Header
-#define GobWarpOutTrail_Header
-
-#include "melee/mship.h" //for Ship class
-#include "melee/WarpOutTrail.h"
-#include "games/ggob.h"
-
-#include <string>
-
-/**
- * 
- */
-class GobWarpEffect : public WarpEffect {
-protected:
-  std::string targetSystem;
-  GobGame * gobGame;
-  
-public:
-  GobWarpEffect(const std::string & targetSystem, GobGame * gobGame);
-
-  /**
-   * Removes the ship from play.
-   */
-  virtual void startEffect();
-  
-  /**
-   * Moves the ship to the star system specified in the constructor.
-   */ 
-  virtual void endEffect();
-
-};
-
-/**
- * Used when the player warps out of one system and into another.
- */  
-class GobWarpOutTrail : public WarpOutTrail {
-
-protected:
-
-  /**
-   * Creates a warp out trail.  At the begining of this effect, the ship is
-   * removed from its current star system.  At the end of this effect, the ship
-   * is placed in the target star system.
-   * 
-   * @param targetSystem the name of the star system to warp to
-   * @param the instance of GobGame
-   * @param creator
-   * @param pos
-   * @param rel_pos
-   * @param ship
-   * @param sprite
-   * @param osprite_index
-   * @param ocolors
-   * @param onum_colors
-   * @param ofsize
-   * @param steps
-   * @param step_time
-   * 
-   * @see WarpOutTrail::WarpOutTrail()
-   */ 
-  GobWarpOutTrail(const std::string & targetSystem,
-		  GobGame * gobGame,
-		  SpaceLocation *creator, Vector2 pos, Vector2 rel_pos, 
-		  Ship *ship, SpaceSprite *sprite, int osprite_index, int *ocolors, 
-		  int onum_colors, int ofsize, int steps, int step_time);
-
-public:
-
-  /**
-   * Constructs a trail such that the player will end up at the specified 
-   * system at the end of the effect.
-   * 
-   * @param the ship to move to the star system
-   * @param system the name of the star system the player wishes to travel to.
-   * @param the instance of GobGame
-   */ 
-  static GobWarpOutTrail * GobWarpOutTrail::getGobWarpOutTrail(Ship * ship, 
-	const std::string & targetSystem,
-	GobGame * gobGame);
-
-};
-
-
-#endif

Modified: trunk/source/melee/mship.cpp
===================================================================
--- trunk/source/melee/mship.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/melee/mship.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -445,7 +445,7 @@
     twl::EventList::iterator i = event.begin();
     while(i!=event.end())
       {
-	i = twl::has_event(i,event.end(),TGameEventType::SHIP_DEATH_BY_NAME );
+	i = twl::has_event(i,event.end(),TGameEventType::SHIP_DEATH_BY_ID );
 	if(i!=event.end())
 	  {
 	    (*i)->trigger();

Copied: trunk/source/other/gobwarpouttrail.cpp (from rev 174, trunk/source/melee/GobWarpOutTrail.cpp)
===================================================================
--- trunk/source/melee/GobWarpOutTrail.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/other/gobwarpouttrail.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -0,0 +1,83 @@
+/*
+This file is part of "TW-Light" 
+                    http://tw-light.berlios.de/
+Copyright (C) 2001-2004  TimeWarp development team
+
+This program is free software; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+GNU General Public License for more details.
+*/
+
+#include "melee/mship.h" // for Ship class
+#include "melee/WarpOutTrail.h"
+#include "gobwarpouttrail.h"
+#include "games/ggob.h"
+
+#include <string>
+
+GobWarpEffect::GobWarpEffect(const std::string & targetSystem, GobGame * gobGame) :
+  targetSystem(targetSystem),
+  gobGame(gobGame)
+{
+  STACKTRACE;
+}
+
+void GobWarpEffect::startEffect() {
+  STACKTRACE;
+  //yB! should uncomment this when we know there is only one call to this per
+  //instance of GobWarpEffect.  Currently, this keeps getting called
+  //gobGame->item.remove(gobGame->gobplayer.ship);
+  printf("GobWarpEffect::startEffect()\n");
+}
+  
+void GobWarpEffect::endEffect() {
+  STACKTRACE;
+  gobGame->switch_system(targetSystem);
+  printf("GobWarpEffect::endEffect()\n");
+}
+
+
+GobWarpOutTrail::GobWarpOutTrail(
+         const std::string & targetSystem,
+         GobGame * gobGame,
+         SpaceLocation *creator, Vector2 pos, Vector2 rel_pos, 
+         Ship *ship, SpaceSprite *sprite, int osprite_index, int *ocolors, 
+         int onum_colors, int ofsize, int steps, int step_time) :
+     WarpOutTrail(creator, pos, rel_pos, 
+     ship, sprite, osprite_index, ocolors, 
+     onum_colors, ofsize, steps, step_time, new GobWarpEffect(targetSystem, gobGame))
+{
+  STACKTRACE;
+}
+
+GobWarpOutTrail * GobWarpOutTrail::getGobWarpOutTrail(Ship * ship, 
+    const std::string & targetSystem,
+    GobGame * gobGame)
+{
+  STACKTRACE;
+  if (!ship) {
+    tw_error("In getGobWarpOutTrail(), parameter ship was null");
+    return NULL;
+  }
+  return new GobWarpOutTrail(
+            targetSystem,
+            gobGame, 
+            ship,
+            ship->pos + unit_vector(ship->get_angle()) * 0 * ship->get_size().x,
+            unit_vector(ship->get_angle()) * PHASE_MAX * ship->get_size().x,
+            ship, 
+            ship->get_sprite(), 
+            ship->get_sprite_index(), 
+            inverse_hot_color, 
+            INVERSE_HOT_COLORS,
+            PHASE_DELAY, 
+            PHASE_MAX, 
+            PHASE_DELAY
+            );
+}

Copied: trunk/source/other/gobwarpouttrail.h (from rev 174, trunk/source/melee/GobWarpOutTrail.h)

Modified: trunk/source/tml/eventmanager.cpp
===================================================================
--- trunk/source/tml/eventmanager.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/eventmanager.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -90,19 +90,17 @@
 }
 
 
-int EventManager::shipDeathByName(const std::string& name, const std::string& script )
+int EventManager::shipDeathById(double id, const std::string& script )
 {
   STACKTRACE;
   int ret = -1;
-  for(std::list<SpaceLocation*>::iterator i = gobgame->item.begin(); i!= gobgame->item.end();i++)
+  SpaceLocation* l  =  twl::get_location((int)id);
+  if(l)
     {
-      if( (*i)->exists() && (*i)->isShip() && ((Ship*)(*i))->get_ship_name()==name)
-	{
-	  TEventShipDeathByName* e = new TEventShipDeathByName();
-	  ret = e->setUp(script);
-	  boost::shared_ptr<TGameEvent> ev (e);
-	  (*i)->add_event(ev);
-	}
+      TEventShipDeathById* e = new TEventShipDeathById();
+      ret = e->setUp(script);
+      boost::shared_ptr<TGameEvent> ev (e);
+      (l)->add_event(ev);
     }
   return ret;
 }

Modified: trunk/source/tml/eventmanager.h
===================================================================
--- trunk/source/tml/eventmanager.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/eventmanager.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -54,9 +54,9 @@
 
   /// Call function script when ship named 'name' die
   ///
-  /// @param name   - unique name of the ship
+  /// @param id     - ship ID
   /// @param script - function to call
-  static int shipDeathByName(const std::string& name, const std::string& script );
+  static int shipDeathById(double, const std::string& script );
   
   /// Call function script when ship whose type type die
   ///

Modified: trunk/source/tml/gameaction.cpp
===================================================================
--- trunk/source/tml/gameaction.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/gameaction.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -22,6 +22,7 @@
 #include "games/ggob.h"
 #include "melee/mship.h"
 #include "melee/mview.h"
+#include "melee/mcontrol.h"
 
 #include <map>
 #include <iostream>
@@ -144,9 +145,9 @@
   SpaceLocation* l  =  twl::get_location((int)who);
   SpaceLocation* l2  =  twl::get_location((int)to);
   
-  if(l)
+  if(l&&l->isShip()&&l2)
     {
-      l->set_target((SpaceObject*)l2);
+      ((Ship*)l)->control->target = (SpaceObject*)l2;
     }
 }
 
@@ -281,3 +282,16 @@
 {
   message.print(time*1000, 2, "%s", text.c_str());
 }
+
+void GameAction::set_camera_mode(const std::string& mode)
+{
+  if(mode == "Hero" ||
+     mode == "Enemy")
+    {
+      game->change_view(mode.c_str());
+    }
+  else
+    {
+      tw_error( (std::string("Requesting unknown camera mode : ") + mode).c_str());
+    }
+}

Modified: trunk/source/tml/gameaction.h
===================================================================
--- trunk/source/tml/gameaction.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/gameaction.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -197,6 +197,7 @@
   /// @time how long to display
   static void print_message(const std::string& text, int time);
 
+  static void set_camera_mode(const std::string& mode);
 };
 
 

Modified: trunk/source/tml/gameevent.cpp
===================================================================
--- trunk/source/tml/gameevent.cpp	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/gameevent.cpp	2005-08-06 18:09:53 UTC (rev 175)
@@ -145,11 +145,11 @@
 }
 
 
-TEventShipDeathByName::~TEventShipDeathByName()
+TEventShipDeathById::~TEventShipDeathById()
 {
 }
 
-int TEventShipDeathByName::setUp(const std::string& script)
+int TEventShipDeathById::setUp(const std::string& script)
 {
   STACKTRACE;
   _script = script;

Modified: trunk/source/tml/gameevent.h
===================================================================
--- trunk/source/tml/gameevent.h	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/source/tml/gameevent.h	2005-08-06 18:09:53 UTC (rev 175)
@@ -32,7 +32,7 @@
       UNKNOWN,
       SINGLE_TIME,
       REPEATABLE_TIME,
-      SHIP_DEATH_BY_NAME,
+      SHIP_DEATH_BY_ID,
       SHIP_DEATH_BY_TYPE,
       DISTANCE,
       MOVE,
@@ -128,16 +128,16 @@
 
 typedef TOneTimeEvent TEventShipDeathByNameBase;
 /// Unsupported event 
-class TEventShipDeathByName : public TEventShipDeathByNameBase
+class TEventShipDeathById : public TEventShipDeathByNameBase
 {
  public:
-  virtual ~TEventShipDeathByName();
+  virtual ~TEventShipDeathById();
   /// setup event 
   ///
   /// @param script function to call
   /// @return event id
   virtual int setUp(const std::string& script);
-  virtual int type(){return TGameEventType::SHIP_DEATH_BY_NAME;}
+  virtual int type(){return TGameEventType::SHIP_DEATH_BY_ID;}
 };
 
 typedef TGameEvent TEventShipDeathByTypeBase;

Modified: trunk/sources.lst
===================================================================
--- trunk/sources.lst	2005-08-02 20:29:47 UTC (rev 174)
+++ trunk/sources.lst	2005-08-06 18:09:53 UTC (rev 175)
@@ -1,140 +0,0 @@
-source/python/python_class.cpp
-source/python/fileops.cpp
-source/python/game.cpp
-source/other/starmap.cpp
-source/other/planet3d.cpp
-source/other/fontmorph.cpp
-source/other/vtarget.cpp
-source/other/configrw.cpp
-source/other/orbit.cpp
-source/other/objanim.cpp
-source/other/twconfig.cpp
-source/other/nullphas.cpp
-source/other/radar.cpp
-source/other/shippart.cpp
-source/other/vbodies.cpp
-source/other/gup.cpp
-source/other/dialogs.cpp
-source/ships/shpconca.cpp
-source/ships/shpkahbo.cpp
-source/ships/shpzeksh.cpp
-source/ships/shpgarty.cpp
-source/ships/shpbipka.cpp
-source/ships/shpwolmi.cpp
-source/ships/shptausl.cpp
-source/ships/shpstaba.cpp
-source/ships/shprogsq.cpp
-source/ships/shptauto.cpp
-source/ships/shpearc3.cpp
-source/ships/shptauda.cpp
-source/ships/shpilwsp.cpp
-source/ships/shpdragr.cpp
-source/ships/shptaust.cpp
-source/ships/shpalabc.cpp
-source/ships/shpyusra.cpp
-source/ships/shpsamat.cpp
-source/ships/shpconho.cpp
-source/ships/shpchoex.cpp
-source/ships/shpaktgu.cpp
-source/ships/shptaume.cpp
-source/ships/shptauar.cpp
-source/ships/shpbogce.cpp
-source/ships/shpbahbu.cpp
-source/ships/shpforsh.cpp
-source/melee/mship.cpp
-source/melee/mitems.cpp
-source/melee/manim.cpp
-source/melee/mmain.cpp
-source/melee/mtarget.cpp
-source/melee/mhelpers.cpp
-source/melee/msprite.cpp
-source/melee/mnet1.cpp
-source/melee/mshot.cpp
-source/melee/mframe.cpp
-source/melee/mgame.cpp
-source/melee/mlog.cpp
-source/melee/mshpdata.cpp
-source/melee/GobWarpOutTrail.cpp
-source/melee/WarpOutTrail.cpp
-source/melee/mshppan.cpp
-source/melee/mmath.cpp
-source/melee/moptions.cpp
-source/melee/mfleet.cpp
-source/melee/mcbodies.cpp
-source/melee/mview.cpp
-source/melee/mcontrol.cpp
-source/tml/gameconfig.cpp
-source/tml/gameaction.cpp
-source/tml/gamedialog.cpp
-source/tml/gameevent.cpp
-source/tml/eventmanager.cpp
-source/games/ggob.cpp
-source/games/gflmelee.cpp
-source/games/gdefender.cpp
-source/games/gamehierarchy.cpp
-source/sc1ships/shpchebr.cpp
-source/sc1ships/shpspael.cpp
-source/sc1ships/shpmycpo.cpp
-source/sc1ships/shparisk.cpp
-source/sc1ships/shpmmrxf.cpp
-source/sc1ships/shpvuxin.cpp
-source/sc1ships/shpearcr.cpp
-source/sc1ships/shpyehte.cpp
-source/sc1ships/shpumgdr.cpp
-source/sc1ships/shpandgu.cpp
-source/sc1ships/shpkzedr.cpp
-source/sc1ships/shpshosc.cpp
-source/sc1ships/shpilwav.cpp
-source/sc1ships/shpsyrpe.cpp
-source/sc2ships/shpmeltr.cpp
-source/sc2ships/shpsupbl.cpp
-source/sc2ships/shpzfpst.cpp
-source/sc2ships/shpdruma.cpp
-source/sc2ships/shpslypr.cpp
-source/sc2ships/shppkufu.cpp
-source/sc2ships/shporzne.cpp
-source/sc2ships/shpchmav.cpp
-source/sc2ships/shputwju.cpp
-source/sc2ships/shpkohma.cpp
-source/sc2ships/shpthrto.cpp
-source/generated/tml_wrap.cpp
-source/tests/gameconfigtest.cpp
-source/tests/testmain.cpp
-source/tests/testdatapath.cpp
-source/libraries/jpgalleg/decode.c
-source/libraries/jpgalleg/jpgalleg.c
-source/libraries/jpgalleg/io.c
-source/libraries/jpgalleg/encode.c
-source/libraries/agup/aalg.c
-source/libraries/agup/aphoton.c
-source/libraries/agup/aase.c
-source/libraries/agup/abitmap.c
-source/libraries/agup/awin95.c
-source/libraries/agup/ans.c
-source/libraries/agup/agtk.c
-source/libraries/agup/abeos.c
-source/libraries/agup/agup.c
-source/ais/c_wussie.cpp
-source/ais/c_other.cpp
-source/ais/c_input.cpp
-source/util/endian.cpp
-source/util/history.cpp
-source/util/types.cpp
-source/util/aarot.c
-source/util/base.cpp
-source/util/aastr.c
-source/util/pmask.c
-source/util/errors.cpp
-source/util/errors_c.c
-source/util/aautil.c
-source/util/random.cpp
-source/util/vector2.cpp
-source/util/round.c
-source/util/sound.cpp
-source/util/net_tcp.cpp
-source/util/get_time.c
-source/input.cpp
-source/doxygen.cpp
-source/gui.cpp
-source/scp.cpp
-source/frame.cpp



From yurand at berlios.de  Tue Aug  9 00:49:26 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Tue, 9 Aug 2005 00:49:26 +0200
Subject: [Tw-light-svn] r176 - in trunk: gamedata/default_ini source/generated source/melee
Message-ID: <200508082249.j78MnQVM028506@sheep.berlios.de>

Author: yurand
Date: 2005-08-09 00:49:04 +0200 (Tue, 09 Aug 2005)
New Revision: 176

Modified:
   trunk/gamedata/default_ini/client.ini
   trunk/source/generated/tml_wrap.cpp
   trunk/source/melee/mgame.cpp
   trunk/source/melee/mgame.h
Log:
Fixed "not redraw after showing menu" bug

Modified: trunk/gamedata/default_ini/client.ini
===================================================================
--- trunk/gamedata/default_ini/client.ini	2005-08-06 18:09:53 UTC (rev 175)
+++ trunk/gamedata/default_ini/client.ini	2005-08-08 22:49:04 UTC (rev 176)
@@ -2,13 +2,13 @@
 AutoUnload = 0
 
 [Video]
-ScreenWidth = 800
-ScreenHeight = 600
+ScreenWidth = 640
+ScreenHeight = 480
 
 BitsPerPixel = 32
 ;valid = values are 8 (ugly), 15, 16, 24 (slow), and 32
 
-FullScreen = 1
+FullScreen = 0
 ; = 0 = windowed, 1 = fullscreen
 
 ;This = will select the theme by its string name. The names for the non-bitmap
@@ -21,8 +21,8 @@
 
 
 [Sound]
-SoundVolume = 0.500000
-MusicVolume = 0.500000
+SoundVolume = 0.110000
+MusicVolume = 0.110000
 SoundBuffer = 1024
 
 

Modified: trunk/source/generated/tml_wrap.cpp
===================================================================
--- trunk/source/generated/tml_wrap.cpp	2005-08-06 18:09:53 UTC (rev 175)
+++ trunk/source/generated/tml_wrap.cpp	2005-08-08 22:49:04 UTC (rev 176)
@@ -3905,6 +3905,36 @@
 }
 
 
+static PyObject *_wrap_GameAction_set_camera_mode(PyObject *, PyObject *args) {
+    PyObject *resultobj;
+    std::string *arg1 = 0 ;
+    int res1 = 0 ;
+    PyObject * obj0 = 0 ;
+    
+    if(!PyArg_ParseTuple(args,(char *)"O:GameAction_set_camera_mode",&obj0)) goto fail;
+    {
+        std::string *ptr = (std::string *)0;
+        res1 = SWIG_AsPtr_std_string(obj0, &ptr);
+        if (!res1) {
+            if (!PyErr_Occurred())
+            SWIG_type_error("std::string", obj0);
+        } else if (!ptr) {
+            SWIG_null_ref("std::string");
+        }
+        if (SWIG_arg_fail(1)) SWIG_fail;
+        arg1 = ptr;
+    }
+    GameAction::set_camera_mode((std::string const &)*arg1);
+    
+    Py_INCREF(Py_None); resultobj = Py_None;
+    if (res1 == SWIG_NEWOBJ) delete arg1;
+    return resultobj;
+    fail:
+    if (res1 == SWIG_NEWOBJ) delete arg1;
+    return NULL;
+}
+
+
 static PyObject *_wrap_new_GameAction(PyObject *, PyObject *args) {
     PyObject *resultobj;
     GameAction *result;
@@ -4338,28 +4368,19 @@
 }
 
 
-static PyObject *_wrap_EventManager_shipDeathByName(PyObject *, PyObject *args) {
+static PyObject *_wrap_EventManager_shipDeathById(PyObject *, PyObject *args) {
     PyObject *resultobj;
-    std::string *arg1 = 0 ;
+    double arg1 ;
     std::string *arg2 = 0 ;
     int result;
-    int res1 = 0 ;
     int res2 = 0 ;
     PyObject * obj0 = 0 ;
     PyObject * obj1 = 0 ;
     
-    if(!PyArg_ParseTuple(args,(char *)"OO:EventManager_shipDeathByName",&obj0,&obj1)) goto fail;
+    if(!PyArg_ParseTuple(args,(char *)"OO:EventManager_shipDeathById",&obj0,&obj1)) goto fail;
     {
-        std::string *ptr = (std::string *)0;
-        res1 = SWIG_AsPtr_std_string(obj0, &ptr);
-        if (!res1) {
-            if (!PyErr_Occurred())
-            SWIG_type_error("std::string", obj0);
-        } else if (!ptr) {
-            SWIG_null_ref("std::string");
-        }
+        arg1 = (double)(SWIG_As_double(obj0)); 
         if (SWIG_arg_fail(1)) SWIG_fail;
-        arg1 = ptr;
     }
     {
         std::string *ptr = (std::string *)0;
@@ -4373,16 +4394,14 @@
         if (SWIG_arg_fail(2)) SWIG_fail;
         arg2 = ptr;
     }
-    result = (int)EventManager::shipDeathByName((std::string const &)*arg1,(std::string const &)*arg2);
+    result = (int)EventManager::shipDeathById(arg1,(std::string const &)*arg2);
     
     {
         resultobj = SWIG_From_int((int)(result)); 
     }
-    if (res1 == SWIG_NEWOBJ) delete arg1;
     if (res2 == SWIG_NEWOBJ) delete arg2;
     return resultobj;
     fail:
-    if (res1 == SWIG_NEWOBJ) delete arg1;
     if (res2 == SWIG_NEWOBJ) delete arg2;
     return NULL;
 }
@@ -6368,6 +6387,7 @@
 	 { (char *)"GameAction_end_game", _wrap_GameAction_end_game, METH_VARARGS, NULL},
 	 { (char *)"GameAction_scroll_text", _wrap_GameAction_scroll_text, METH_VARARGS, NULL},
 	 { (char *)"GameAction_print_message", _wrap_GameAction_print_message, METH_VARARGS, NULL},
+	 { (char *)"GameAction_set_camera_mode", _wrap_GameAction_set_camera_mode, METH_VARARGS, NULL},
 	 { (char *)"new_GameAction", _wrap_new_GameAction, METH_VARARGS, NULL},
 	 { (char *)"delete_GameAction", _wrap_delete_GameAction, METH_VARARGS, NULL},
 	 { (char *)"GameAction_swigregister", GameAction_swigregister, METH_VARARGS, NULL},
@@ -6389,7 +6409,7 @@
 	 { (char *)"EventManager_setSingleTimeEvent", _wrap_EventManager_setSingleTimeEvent, METH_VARARGS, NULL},
 	 { (char *)"EventManager_setRepeatableTimeEvent", _wrap_EventManager_setRepeatableTimeEvent, METH_VARARGS, NULL},
 	 { (char *)"EventManager_disableEvent", _wrap_EventManager_disableEvent, METH_VARARGS, NULL},
-	 { (char *)"EventManager_shipDeathByName", _wrap_EventManager_shipDeathByName, METH_VARARGS, NULL},
+	 { (char *)"EventManager_shipDeathById", _wrap_EventManager_shipDeathById, METH_VARARGS, NULL},
 	 { (char *)"EventManager_shipDeathByType", _wrap_EventManager_shipDeathByType, METH_VARARGS, NULL},
 	 { (char *)"EventManager_distanceMoreThen", _wrap_EventManager_distanceMoreThen, METH_VARARGS, NULL},
 	 { (char *)"EventManager_distanceLessThen", _wrap_EventManager_distanceLessThen, METH_VARARGS, NULL},

Modified: trunk/source/melee/mgame.cpp
===================================================================
--- trunk/source/melee/mgame.cpp	2005-08-06 18:09:53 UTC (rev 175)
+++ trunk/source/melee/mgame.cpp	2005-08-08 22:49:04 UTC (rev 176)
@@ -1159,6 +1159,7 @@
 bool Game::handle_key(int k) 
 {
   STACKTRACE;
+  
   switch (k >> 8) 
     {
     case KEY_H:
@@ -1175,6 +1176,7 @@
 	pause();
 	showHelpText();
 	unpause();
+	redraw();
 	return true;
       }
       break;
@@ -1183,6 +1185,7 @@
 	pause();
 	Save(home_ini_full_path(".savegame"));
 	unpause();
+	redraw();
 	return true;
       }
       break;
@@ -1191,6 +1194,7 @@
 	pause();
 	Load(home_ini_full_path(".savegame"));
 	unpause();
+	redraw();
 	return true;
       }
       break;
@@ -1199,6 +1203,7 @@
 	pause();
 	options_menu(this);
 	unpause();
+	redraw();
 	return true;
       }
       break;
@@ -1259,6 +1264,7 @@
 	pause();
 	GameMenu();
 	unpause();
+	redraw();
 	return true;
       }
     case KEY_F12: 
@@ -1311,7 +1317,7 @@
   return _game_state;
 }
 
-void Game::setGameDone(const int done)
+void Game::setGameDone(int done)
 {
   STACKTRACE; 
   _game_state = done; 

Modified: trunk/source/melee/mgame.h
===================================================================
--- trunk/source/melee/mgame.h	2005-08-06 18:09:53 UTC (rev 175)
+++ trunk/source/melee/mgame.h	2005-08-08 22:49:04 UTC (rev 176)
@@ -178,7 +178,7 @@
  public:
   /// sets whether the game is done, according to the rules for the
   /// gametype.
-  virtual void setGameDone(const int done);
+  virtual void setGameDone(int done);
 
   /// gets if the game is done.  Will wait a few seconds for dramatic effect.
   virtual int isGameDone();



From yurand at berlios.de  Thu Aug 11 20:24:31 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Thu, 11 Aug 2005 20:24:31 +0200
Subject: [Tw-light-svn] r177 - trunk/source/ais
Message-ID: <200508111824.j7BIOVEt024134@sheep.berlios.de>

Author: yurand
Date: 2005-08-11 20:24:24 +0200 (Thu, 11 Aug 2005)
New Revision: 177

Modified:
   trunk/source/ais/c_wussie.cpp
Log:
Fixed  issue 0000052 in ais/c_wussie.cpp, there's a use of !j as an array index. Because j is an integer, !j will lead to a value of -1 if j is originally 0. This is not correct.

Modified: trunk/source/ais/c_wussie.cpp
===================================================================
--- trunk/source/ais/c_wussie.cpp	2005-08-08 22:49:04 UTC (rev 176)
+++ trunk/source/ais/c_wussie.cpp	2005-08-11 18:24:24 UTC (rev 177)
@@ -567,7 +567,7 @@
 	  }
 	if (option_type[state][j][i] == OPTION_PRECEDENCE)
 	  if (fireoption[j] && (!dontfireoption[j]))
-	    dontfireoption[(!j)] = TRUE;
+	    dontfireoption[(j)] = TRUE;
 	if (option_type[state][j][i] == OPTION_ALWAYS_WHEN_FULL)
 	  if (ship->batt >= ship->batt_max)
 	    {



From yurand at berlios.de  Sun Aug 14 04:23:26 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Sun, 14 Aug 2005 04:23:26 +0200
Subject: [Tw-light-svn] r178 - in trunk: . Util/deditor
Message-ID: <200508140223.j7E2NQTK005470@sheep.berlios.de>

Author: yurand
Date: 2005-08-14 04:23:14 +0200 (Sun, 14 Aug 2005)
New Revision: 178

Modified:
   trunk/Util/deditor/maindialog.h
   trunk/Util/deditor/mainwidget.cpp
   trunk/sources.lst
Log:
Restored choose answer by double click feature in deditor

Modified: trunk/Util/deditor/maindialog.h
===================================================================
--- trunk/Util/deditor/maindialog.h	2005-08-11 18:24:24 UTC (rev 177)
+++ trunk/Util/deditor/maindialog.h	2005-08-14 02:23:14 UTC (rev 178)
@@ -1,7 +1,7 @@
 /****************************************************************************
 ** Form interface generated from reading ui file 'maindialog.ui'
 **
-** Created: ?? 6. ??? 20:29:10 2005
+** Created: ?? 14. ??? 05:02:43 2005
 **      by: The User Interface Compiler ()
 **
 ** WARNING! All changes made in this file will be lost!

Modified: trunk/Util/deditor/mainwidget.cpp
===================================================================
--- trunk/Util/deditor/mainwidget.cpp	2005-08-11 18:24:24 UTC (rev 177)
+++ trunk/Util/deditor/mainwidget.cpp	2005-08-14 02:23:14 UTC (rev 178)
@@ -12,6 +12,7 @@
 #include <qdir.h>
 #include <qcheckbox.h>
 #include <qspinbox.h>
+#include <qregexp.h>
 
 #include <assert.h>
 
@@ -466,6 +467,15 @@
     PlayerAnswer* answer = getPlayerAnswer(item->text(0));
     for(int i=0;i<5;i++)
     {
+       QRegExp rx( "goto\\(*\\s*(\\d+)\\)*");
+       if ( rx.search( answer->m_strAct[i] ) != -1 ) 
+       {
+         NodeItem * node = getNodeItem(rx.cap( 1 ));
+                if(node)
+                    nodeListView->setCurrentItem(node);
+       }
+    }
+        
     /*
             lua_State * L = lua_open();
             lua_baselibopen(L);
@@ -484,7 +494,6 @@
             }
             lua_close(L);
      */
-    }
 }
 
 void DialogEditor::answerUp()

Modified: trunk/sources.lst
===================================================================
--- trunk/sources.lst	2005-08-11 18:24:24 UTC (rev 177)
+++ trunk/sources.lst	2005-08-14 02:23:14 UTC (rev 178)
@@ -0,0 +1,140 @@
+source/python/python_class.cpp
+source/python/fileops.cpp
+source/python/game.cpp
+source/other/starmap.cpp
+source/other/planet3d.cpp
+source/other/gobwarpouttrail.cpp
+source/other/fontmorph.cpp
+source/other/vtarget.cpp
+source/other/configrw.cpp
+source/other/orbit.cpp
+source/other/objanim.cpp
+source/other/twconfig.cpp
+source/other/nullphas.cpp
+source/other/radar.cpp
+source/other/shippart.cpp
+source/other/vbodies.cpp
+source/other/gup.cpp
+source/other/dialogs.cpp
+source/ships/shpconca.cpp
+source/ships/shpkahbo.cpp
+source/ships/shpzeksh.cpp
+source/ships/shpgarty.cpp
+source/ships/shpbipka.cpp
+source/ships/shpwolmi.cpp
+source/ships/shptausl.cpp
+source/ships/shpstaba.cpp
+source/ships/shprogsq.cpp
+source/ships/shptauto.cpp
+source/ships/shpearc3.cpp
+source/ships/shptauda.cpp
+source/ships/shpilwsp.cpp
+source/ships/shpdragr.cpp
+source/ships/shptaust.cpp
+source/ships/shpalabc.cpp
+source/ships/shpyusra.cpp
+source/ships/shpsamat.cpp
+source/ships/shpconho.cpp
+source/ships/shpchoex.cpp
+source/ships/shpaktgu.cpp
+source/ships/shptaume.cpp
+source/ships/shptauar.cpp
+source/ships/shpbogce.cpp
+source/ships/shpbahbu.cpp
+source/ships/shpforsh.cpp
+source/melee/mcontrol.cpp
+source/melee/mship.cpp
+source/melee/mitems.cpp
+source/melee/manim.cpp
+source/melee/mmain.cpp
+source/melee/mtarget.cpp
+source/melee/mhelpers.cpp
+source/melee/mgame.cpp
+source/melee/msprite.cpp
+source/melee/mnet1.cpp
+source/melee/mshot.cpp
+source/melee/mframe.cpp
+source/melee/mlog.cpp
+source/melee/mshpdata.cpp
+source/melee/WarpOutTrail.cpp
+source/melee/mshppan.cpp
+source/melee/mmath.cpp
+source/melee/moptions.cpp
+source/melee/mfleet.cpp
+source/melee/mcbodies.cpp
+source/melee/mview.cpp
+source/tml/gameconfig.cpp
+source/tml/eventmanager.cpp
+source/tml/gameaction.cpp
+source/tml/gamedialog.cpp
+source/tml/gameevent.cpp
+source/games/ggob.cpp
+source/games/gflmelee.cpp
+source/games/gdefender.cpp
+source/games/gamehierarchy.cpp
+source/sc1ships/shpchebr.cpp
+source/sc1ships/shpspael.cpp
+source/sc1ships/shpmycpo.cpp
+source/sc1ships/shparisk.cpp
+source/sc1ships/shpmmrxf.cpp
+source/sc1ships/shpvuxin.cpp
+source/sc1ships/shpearcr.cpp
+source/sc1ships/shpyehte.cpp
+source/sc1ships/shpumgdr.cpp
+source/sc1ships/shpandgu.cpp
+source/sc1ships/shpkzedr.cpp
+source/sc1ships/shpshosc.cpp
+source/sc1ships/shpilwav.cpp
+source/sc1ships/shpsyrpe.cpp
+source/sc2ships/shpmeltr.cpp
+source/sc2ships/shpsupbl.cpp
+source/sc2ships/shpzfpst.cpp
+source/sc2ships/shpdruma.cpp
+source/sc2ships/shpslypr.cpp
+source/sc2ships/shppkufu.cpp
+source/sc2ships/shporzne.cpp
+source/sc2ships/shpchmav.cpp
+source/sc2ships/shputwju.cpp
+source/sc2ships/shpkohma.cpp
+source/sc2ships/shpthrto.cpp
+source/generated/tml_wrap.cpp
+source/tests/gameconfigtest.cpp
+source/tests/testmain.cpp
+source/tests/testdatapath.cpp
+source/libraries/jpgalleg/decode.c
+source/libraries/jpgalleg/jpgalleg.c
+source/libraries/jpgalleg/io.c
+source/libraries/jpgalleg/encode.c
+source/libraries/agup/aalg.c
+source/libraries/agup/aphoton.c
+source/libraries/agup/aase.c
+source/libraries/agup/abitmap.c
+source/libraries/agup/awin95.c
+source/libraries/agup/ans.c
+source/libraries/agup/agtk.c
+source/libraries/agup/abeos.c
+source/libraries/agup/agup.c
+source/ais/c_wussie.cpp
+source/ais/c_other.cpp
+source/ais/c_input.cpp
+source/util/endian.cpp
+source/util/history.cpp
+source/util/types.cpp
+source/util/aarot.c
+source/util/base.cpp
+source/util/aastr.c
+source/util/pmask.c
+source/util/errors.cpp
+source/util/errors_c.c
+source/util/aautil.c
+source/util/random.cpp
+source/util/vector2.cpp
+source/util/round.c
+source/util/sound.cpp
+source/util/net_tcp.cpp
+source/util/get_time.c
+source/input.cpp
+source/doxygen.cpp
+source/gui.cpp
+source/scp.cpp
+source/frame.cpp



From yurand at berlios.de  Sun Aug 14 22:15:00 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Sun, 14 Aug 2005 22:15:00 +0200
Subject: [Tw-light-svn] r179 - in trunk/gamedata: games/test_game/dialogs games/test_game/scripts games/test_game/scripts/systems images/alien
Message-ID: <200508142015.j7EKF01i013916@sheep.berlios.de>

Author: yurand
Date: 2005-08-14 22:14:57 +0200 (Sun, 14 Aug 2005)
New Revision: 179

Added:
   trunk/gamedata/images/alien/drax.jpg
Modified:
   trunk/gamedata/games/test_game/dialogs/chorali_commander.xml
   trunk/gamedata/games/test_game/dialogs/welcomecommander.xml
   trunk/gamedata/games/test_game/scripts/flags.py
   trunk/gamedata/games/test_game/scripts/quests.py
   trunk/gamedata/games/test_game/scripts/start.py
   trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
Log:
Narike commander now remember about missions he send you to

Modified: trunk/gamedata/games/test_game/dialogs/chorali_commander.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/chorali_commander.xml	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/dialogs/chorali_commander.xml	2005-08-14 20:14:57 UTC (rev 179)
@@ -1 +1 @@
-<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="First welcome" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="We are Chorali. What do you want?" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Submit or die foolish creature" appear_condition="gflag.m2_status == MISSION_IN_PROGRESS"><ACTION condition="1" action="goto(1)"></ACTION><ACTION condition="1" action="gflag.m2_status = MISSION_COMPLETED"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Err... nothing, bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Ok" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Oh, ok... we're quite familiar with that arrangement." font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Tell me your secrets!" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" !
 name="Secrets" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Go to coordinates 1500,5000, you will find precursor wreck. " font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="That is help. You will live a bit longer" appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Bye" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="I hope you will die soon|Bye" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="First welcome" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="We are Chorali. What do you want?" font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Submit or die foolish creature" appear_condition="gflag.m2_status == MISSION_IN_PROGRESS"><ACTION condition="1" action="goto(1)"></ACTION><ACTION condition="1" action="gflag.m2_status = MISSION_COMPLETED"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Err... nothing, bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Ok" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Oh, ok... we're quite familiar with that arrangement." font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="Tell me your secrets!" appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" !
 name="Secrets" music="music/races/human.mod" background="images/alien/estion.jpg" alien_text="Go to coordinates 1500,5000, you will find precursor wreck. " font="Estion" text_location="(50,10)"><PLAYER_ANSWER text="That is help. You will live a bit longer" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/dialogs/welcomecommander.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/welcomecommander.xml	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/dialogs/welcomecommander.xml	2005-08-14 20:14:57 UTC (rev 179)
@@ -1 +1 @@
-<DIALOG><START_DIALOG><ACTION condition="1" action="m12_compl = gflag.m1_status == MISSION_COMPLETED or gflag.m2_status == MISSION_COMPLETED&#10;&#10;# Tell player to complete mission&#10;if gflag.m1_status == MISSION_IN_PROGRESS or gflag.m2_status == MISSION_IN_PROGRESS or gflag.m3_status == MISSION_IN_PROGRESS :&#10;  goto(7)&#10;&#10;if m12_compl:&#10;  goto(9)&#10;&#10;if m3_status == MISSION_COMPLETED:&#10;  goto(11)&#10;&#10;"></ACTION></START_DIALOG><END_DIALOG><ACTION condition="1" action=""></ACTION></END_DIALOG><NODES><NODE id="0" name="Welcome" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Charlys Sector, Captain.  I am Commander Jacques Haven, of Silcuu Station. Your ship will be a great addition to fleet here. Would you like some background information before you proceed with your first assignment? " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Yes, Commander. Information is always valuable." appea!
 r_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="No, Commander. I'd like to get straight to my duties." appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Info" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="As you might have seen on your hyperspace map, there are three systems in the Charlys Sector; Narike, Ixis, and Gamma Onyx. It's mostly peaceful in Charlys, except for a few Kohr-Ah raiders and Ulzrak. We are having negotiatons to have a native, energy-based race known as the Chorali join the Alliance, and we are hoping to initiate them soon with the avian Drax race. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like to learn more about the Ulzrak." appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Chorali." appear_condi!
 tion="1"><ACTION condition="1" action="goto(3)"></ACTION></PLA!
 YER_ANSW
ER><PLAYER_ANSWER text="I'd like to learn more about the Drax." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="10" name="Investigate wreck" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You should investigate precursor wreck" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly" appear_condition="gflag.m3_status != MISSION_COMPLETED"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="check_precursor_wreck_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I have already checked them." appear_condition="gflag.m3_status == MISSION_COMPLETED"><ACTION condition="1" action="goto(11)"></ACTION></PLAYER_ANSWER></NODE><NODE id="11" name="Zoq-Fot-Pik ambasador" music="music/races/!
 human.mod" background="images/alien/human.jpg" alien_text="You must escort Zoq-Fot-Pik ambassador to Gamma Onyx ." font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.zoq_fot_pik_ambassador_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Ulzrak" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Ulzrak are a completely hostile race, that do not seem to have any purpose to their destruction, as far as we can tell. They do not initiate contact before attacking. The only reason we know their name is froma salvaged computer database. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" a!
 ppear_condition="1"><ACTION condition="1" action="goto(5)"></A!
 CTION></
PLAYER_ANSWER></NODE><NODE id="3" name="Chorali" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Chorali are energy-based creatures that mostly made of photons, liquid, and a thin normal matter shell, through which they interact with a normal environment. As a species, they're rather secretive about any technology or information they find, though it's said they are quite social amog themselves. They are also, as a species rather friendly, however. We're currently negotiating them joining the New Alliance. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="4" name="Drax" music="music/races/human.mod" background="images/alien/h!
 uman.jpg" alien_text="We haven't had much contact with the Drax so far, but from what we've heard they've had over a hundred million internal conflicts, and that's only during their spacefaring age. The only governments that succeed are very loosely tied ones, with very little law. It will likely be difficult getting even a preliminary treaty, with the number of factions working for different goals.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="Orders/Assignments" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You actually have a choice of assignments, Captain. You can choose to take a transport escort assignment!
  to a mining operation in Ixis, where they need medical suppli!
 es. Or, 
you can negotiate with the Chorali, here in Narike.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'll escort the transport to Ixis. " appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.escort_transport_to_ixis_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll negotiate with the Chorali." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.negotiate_with_chorali_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="Good Luck!" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Good luck, Captain. Be careful, I wouldn't want to lose the newest addition to my fleet. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Thank you, Commander." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll execute my mission well, Commander, be sure of !
 that. " appear_condition="1"><ACTION condition="1" action="endDialog() "></ACTION></PLAYER_ANSWER></NODE><NODE id="7" name="Why are you here?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="I have assigned you on important mission. Why are you here?" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What was it again?" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="8" name="Are you dumb or something?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Are you dumb or something? {gflag.current_mission}" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Oh, bye." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="9" name="Good work" music="music/races/human.mod" background="images/a!
 lien/human.jpg" alien_text="Good work. About your next mission!
 ..." fon
t="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What is it?" appear_condition="1"><ACTION condition="1" action="10"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file
+<DIALOG><START_DIALOG><ACTION condition="1" action="missions = [gflag.m1_status, gflag.m2_status, gflag.m3_status, gflag.m4_status]&#10;&#10;if not gflag.wasAtSilcuuStation:&#10;  gflag.wasAtSilcuuStatio = 1&#10;  goto(0)&#10;if MISSION_IN_PROGRESS in missions:&#10;  goto(7)&#10;&#10;if MISSION_FAILED in missions:&#10;  goto(13)&#10;&#10;if gflag.m1_status == MISSION_COMPLETED:&#10;  gflag.m1_status = MISSION_REWARDED&#10;  goto(9)&#10;&#10;if gflag.m2_status == MISSION_COMPLETED:&#10;  gflag.m2_status = MISSION_REWARDED&#10;  goto(9)  &#10;&#10;if gflag.m3_status == MISSION_COMPLETED:&#10;  gflag.m3_status = MISSION_REWARDED&#10;  goto(9)  &#10;&#10;if gflag.m4_status == MISSION_COMPLETED:&#10;  gflag.m4_status = MISSION_REWARDED&#10;  goto(9)  &#10;"></ACTION></START_DIALOG><END_DIALOG><ACTION condition="1" action=""></ACTION></END_DIALOG><NODES><NODE id="0" name="Welcome" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Welcome to the Charlys!
  Sector, Captain.  I am Commander Jacques Haven, of Silcuu Station. Your ship will be a great addition to fleet here. Would you like some background information before you proceed with your first assignment? " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Yes, Commander. Information is always valuable." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="No, Commander. I'd like to get straight to my duties." appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Info" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="As you might have seen on your hyperspace map, there are three systems in the Charlys Sector; Narike, Ixis, and Gamma Onyx. It's mostly peaceful in Charlys, except for a few Kohr-Ah raiders and Ulzrak. We are having negotiatons to have a native, energy-based race known as the Chorali join the Alliance, and we !
 are hoping to initiate them soon with the avian Drax race. " f!
 ont="Ear
thling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like to learn more about the Ulzrak." appear_condition="1"><ACTION condition="1" action="goto(2)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Chorali." appear_condition="1"><ACTION condition="1" action="goto(3)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'd like to learn more about the Drax." appear_condition="1"><ACTION condition="1" action="goto(4)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="2" name="Ulzrak" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Ulzrak are a completely hostile race, that do not seem to have any purpose to their destruction, as far as we can tell. They do not initiate contact before attacking. The only reason we know their name is froma salvaged computer databas!
 e. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="3" name="Chorali" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="The Chorali are energy-based creatures that mostly made of photons, liquid, and a thin normal matter shell, through which they interact with a normal environment. As a species, they're rather secretive about any technology or information they find, though it's said they are quite social amog themselves. They are also, as a species rather friendly, however. We're currently negotiating them joining the New Alliance. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, C!
 ommander." appear_condition="1"><ACTION condition="1" action="!
 goto(1)"
></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="4" name="Drax" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="We haven't had much contact with the Drax so far, but from what we've heard they've had over a hundred million internal conflicts, and that's only during their spacefaring age. The only governments that succeed are very loosely tied ones, with very little law. It will likely be difficult getting even a preliminary treaty, with the number of factions working for different goals.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'd like some more general info, Commander." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="That's enough information for now. What are my orders?" appear_condition="1"><ACTION condition!
 ="1" action="goto(5)"></ACTION></PLAYER_ANSWER></NODE><NODE id="5" name="Orders/Assignments" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You actually have a choice of assignments, Captain. You can choose to take a transport escort assignment to a mining operation in Ixis, where they need medical supplies. Or, you can negotiate with the Chorali, here in Narike.  " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I'll escort the transport to Ixis. " appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.escort_transport_to_ixis_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll negotiate with the Chorali." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.negotiate_with_chorali_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="6" name="Good Luck!" music="music/races/human.mod" background="images/alien/human.jpg" alie!
 n_text="Good luck, Captain. Be careful, I wouldn't want to los!
 e the ne
west addition to my fleet. " font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Thank you, Commander." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I'll execute my mission well, Commander, be sure of that. " appear_condition="1"><ACTION condition="1" action="endDialog() "></ACTION></PLAYER_ANSWER></NODE><NODE id="7" name="Why are you here?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="I have assigned you on important mission. Why are you here?" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What was it again?" appear_condition="1"><ACTION condition="1" action="goto(8)"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="8" name="Are you dumb or something?" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Are you dumb or somet!
 hing? {gflag.current_mission}" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Oh, bye." appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION></PLAYER_ANSWER></NODE><NODE id="9" name="Good work" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="Good work. About your next mission..." font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="What is it?" appear_condition="1"><ACTION condition="gflag.m1_status == MISSION_REWARDED or gflag.m2_status == MISSION_REWARDED" action="goto(10)"></ACTION><ACTION condition="gflag.m3_status == MISSION_REWARDED" action="goto(11)"></ACTION><ACTION condition="gflag.m4_status == MISSION_REWARDED" action="goto(12)"></ACTION></PLAYER_ANSWER></NODE><NODE id="10" name="Investigate wreck" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You should investigate precursor wreck" font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly!
 " appear_condition="gflag.m3_status != MISSION_COMPLETED"><ACT!
 ION cond
ition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.check_precursor_wreck_func()"></ACTION></PLAYER_ANSWER><PLAYER_ANSWER text="I have already checked them." appear_condition="gflag.m3_status == MISSION_COMPLETED"><ACTION condition="1" action="goto(11)"></ACTION></PLAYER_ANSWER></NODE><NODE id="11" name="Zoq-Fot-Pik ambasador" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You must escort Zoq-Fot-Pik ambassador to Gamma Onyx ." font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="I will fly imideatly" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.zoq_fot_pik_ambassador_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="12" name="Capture precursor battleship" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="You should find out how to break into the Precursor Wreck and capture valueable precursor's equipment." font="Earthling" tex!
 t_location="(50,10)"><PLAYER_ANSWER text="Yes, sir" appear_condition="1"><ACTION condition="1" action="goto(6)"></ACTION><ACTION condition="1" action="quests.capture_precursor_battleship_func()"></ACTION></PLAYER_ANSWER></NODE><NODE id="13" name="Penalty" music="music/races/human.mod" background="images/alien/human.jpg" alien_text="I am very sorry captain, but the penalty for not compliting yuor tasks is DEATH." font="Earthling" text_location="(50,10)"><PLAYER_ANSWER text="Oh, no!!!!!!" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION><ACTION condition="1" action="tml.GameAction.end_game()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/scripts/flags.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/flags.py	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/scripts/flags.py	2005-08-14 20:14:57 UTC (rev 179)
@@ -7,9 +7,12 @@
 MISSION_CLEAN       = 0
 MISSION_IN_PROGRESS = 1
 MISSION_COMPLETED   = 2
-MISSION_FAILED      = 3
+MISSION_REWARDED    = 3
+MISSION_FAILED      = 4
 
 class Flags:
+    wasAtSilcuuStation = 0 # captain ever visit Silcuu Station
+
     # Mission 1 Escort transport
     m1_status     = 0
     m1_transport = -1 # Transport ship ID
@@ -25,7 +28,7 @@
     m4_status     = 0
     
     # Locations
-    ixis_mining_station = -1
+    ixis_mining_station  = -1
     ixis_chorali_station = -1
     precursor_wreck_id   = -1
     

Modified: trunk/gamedata/games/test_game/scripts/quests.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/quests.py	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/scripts/quests.py	2005-08-14 20:14:57 UTC (rev 179)
@@ -4,8 +4,6 @@
 # Mission1 Escort transport to Ixis star system
 
 def escort_transport_to_ixis_func():
-    if gflag.m1_status:
-        return
     gflag.current_mission = """ You must escort our transport to Ixis minning station."""
     gflag.m1_status = MISSION_IN_PROGRESS
     
@@ -46,73 +44,74 @@
 # Mission 2
 def negotiate_with_chorali_func():
     gflag.m2_status = MISSION_IN_PROGRESS
+    
 ############################################################################################################
 # Mission 3
 def check_precursor_wreck_func():
-    if gflag.m1_status:
-        return
     gflag.m3_status = MISSION_IN_PROGRESS
     gflag.current_mission = """ You must investigate precursor wrack in Ixis star system."""
+    tml.EventManager.distanceLessThen(gflag.precursor_wreck_id,
+                                  tml.GameAction.get_player_ship_id(),
+                                  200,  'check_precursor_wreck_completed_func')
+
 def check_precursor_wreck_completed_func():
     dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/precursor_wrack_first_inspection.xml"))
     gflag.m3_status = MISSION_COMPLETED
 
 ############################################################################################################
-# Precursor wrack
+# Mission 4
+def zoq_fot_pik_ambassador_func():
+    gflag.current_mission = """ You must escort Zoq-Fot-Pik ambassador."""
+    gflag.m4_status = MISSION_IN_PROGRESS
+    gflag.m4_status = MISSION_COMPLETED
+    
+############################################################################################################
+# Mission 5
+def capture_precursor_battleship_func():
+    gflag.current_mission = """ You must capture precursor wrack  in Ixis star system."""
+    gflag.m5_status = MISSION_IN_PROGRESS
+    id = tml.EventManager.distanceLessThen(gflag.precursor_wreck_id,
+                                            tml.GameAction.get_player_ship_id(),
+                                            200,  'capture_precursor_battleship_complete')
+    add_druuge_guardians()
+    
+def add_druuge_guardians():
+    id = tml.EventManager.distanceLessThen(gflag.precursor_wreck_id,
+                                           tml.GameAction.get_player_ship_id(),
+                                           2500,  'druuge_this_is_crimson_corporation_property_now')
+    for i in xrange(1):
+        enemy = tml.GameAction.add_ship('Ixis',
+                                        "druma", 1500, 5000, tml.GameAction.get_enemy_team())
+        tml.GameAction.guard_location(enemy, gflag.precursor_wreck_id, 1500)
 
-# def start_precursor_wrack_mission():
-#     tml.GameAction.save_flag('have_drax_open_device', 0)
-#     tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-#                                       tml.GameAction.get_player_ship_id(),
-#                                       200,  'precursor_wrack_first_inspection')
-#     id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-#                                            tml.GameAction.get_player_ship_id(),
-#                                            200,  'win_game_func')
-#     tml.EventManager.AddEventCondition(id, 'check_has_drax_open_device')
+def druuge_this_is_crimson_corporation_property_now():
+    dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/druuge.xml"))
 
-# def check_has_drax_open_device():
-#     print "Check drax open device"
-#     if tml.GameAction.get_double_flag('have_drax_open_device')>0:
-#         return True
-#     return False
-
-# def precursor_wrack_first_inspection():
-#     if not check_has_drax_open_device():
-#         dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/precursor_wrack_first_inspection.xml"))
-
-
-# def add_druuge_guardians():
-#     id = tml.EventManager.distanceLessThen(tml.GameAction.get_double_flag('precursor_wrack_id'),
-#                                            tml.GameAction.get_player_ship_id(),
-#                                            2500,  'druuge_this_is_crimson_corporation_property_now')
-#     for i in xrange(1):
-#         enemy = tml.GameAction.add_ship('Ixis',
-#                                     "druma", 1500, 5000, tml.GameAction.get_enemy_team())
-#         tml.GameAction.guard_location(enemy, tml.GameAction.get_double_flag('precursor_wrack_id'), 1500)
-
+def capture_precursor_battleship_complete():
+    gflag.m5_status = MISSION_COMPLETED
+    win_game_func()
     
-        
-# def druuge_this_is_crimson_corporation_property_now():
-#     dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/druuge.xml"))
 
+def win_game_func():
+    tml.GameAction.end_game()
+    congrat = []
+    congrat.append("""You win this little demo game""")
+    congrat.append("")
+    congrat.append("Programming:")
+    congrat.append("  Yura Semashko (Yurand)")
+    congrat.append("")
+    congrat.append("Dialogs:")
+    congrat.append("  FrungySnack")
+    congrat.append("  Halleck")
+    congrat.append("  Yura Semashko (Yurand)")
+    congrat.append("")
+    congrat.append("Art")
+    congrat.append("  Tiina Aumala")
+    congrat.append("")
+    congrat.append("Please, consider help us with TW-Light: Legacies")
+    congrat.append("For detail check our site http://tw-light.berlios.de/")
+    tml.GameAction.scroll_text(misc.PyListStringToVector(congrat),"images/background.jpg")
+    pass
 
-# def win_game_func():
-#     tml.GameAction.end_game()
-#     congrat = []
-#     congrat.append("""You win this little demo game""")
-#     congrat.append("")
-#     congrat.append("Programming:")
-#     congrat.append("  Yura Semashko (Yurand)")
-#     congrat.append("")
-#     congrat.append("Dialogs:")
-#     congrat.append("  FrungySnack")
-#     congrat.append("  Halleck")
-#     congrat.append("  Yura Semashko (Yurand)")
-#     congrat.append("")
-#     congrat.append("Please, consider help us with TW-Light: Legacies")
-#     congrat.append("For detail check our site http://tw-light.berlios.de/")
-#     tml.GameAction.scroll_text(misc.PyListStringToVector(congrat),"images/background.jpg")
-#     pass
-
 ############################################################################################################
 

Modified: trunk/gamedata/games/test_game/scripts/start.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/start.py	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/scripts/start.py	2005-08-14 20:14:57 UTC (rev 179)
@@ -22,9 +22,9 @@
 ##########################################################################################################################
         
 # Start quests
-tml.EventManager.distanceLessThen(gflag.precursor_wreck_id,
-                                  tml.GameAction.get_player_ship_id(),
-                                  200,  'check_precursor_wreck_completed_func')
+
+#capture_precursor_battleship_func()
+
 #start_precursor_wrack_mission()
 #escort_transport_to_ixis_func()
 

Modified: trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-14 02:23:14 UTC (rev 178)
+++ trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-14 20:14:57 UTC (rev 179)
@@ -12,7 +12,7 @@
                            'station0sprite',
                            'gob.dat#station0picture.bmp',
                            'dragr',
-                           'dialogs/welcomecommander.xml')
+                           'dialogs/drax.xml')
 
 for i in xrange(20):
     tml.GameAction.add_asteroid('Gama Onyx')

Added: trunk/gamedata/images/alien/drax.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/gamedata/images/alien/drax.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From yurand at berlios.de  Mon Aug 15 21:18:32 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Mon, 15 Aug 2005 21:18:32 +0200
Subject: [Tw-light-svn] r180 - in trunk: . gamedata/games/test_game/scripts gamedata/python source/generated source/tml
Message-ID: <200508151918.j7FJIWgS005496@sheep.berlios.de>

Author: yurand
Date: 2005-08-15 21:18:30 +0200 (Mon, 15 Aug 2005)
New Revision: 180

Modified:
   trunk/SConstruct
   trunk/gamedata/games/test_game/scripts/start.py
   trunk/gamedata/python/tml.py
   trunk/source/generated/tml.py
   trunk/source/generated/tml_wrap.cpp
   trunk/source/tml/eventmanager.cpp
   trunk/source/tml/eventmanager.h
   trunk/source/tml/gameevent.cpp
   trunk/source/tml/gameevent.h
Log:
Added JumpToSystem event.

Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/SConstruct	2005-08-15 19:18:30 UTC (rev 180)
@@ -238,6 +238,7 @@
         env.Append(CPPPATH=["#msvc-libs/include","msvc-libs/include/SDL"])
         env.Append(LIBPATH=["#msvc-libs/lib"])
         env.Append(CPPFLAGS=['/GX','/MD']) 
+        #env.Append(LINKFLAGS=['/SUBSYSTEM:CONSOLE']) 
     else:
         env.Append(CPPPATH=["#mingw-libs/include","mingw-libs/include/SDL"])
         env.Append(LIBPATH=["#mingw-libs/lib"])

Modified: trunk/gamedata/games/test_game/scripts/start.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/start.py	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/gamedata/games/test_game/scripts/start.py	2005-08-15 19:18:30 UTC (rev 180)
@@ -20,7 +20,12 @@
         tml.GameAction.add_ship(tml.GameAction.get_player_star_system(), "ilwsp", -1, -1, tml.GameAction.get_enemy_team())
         
 ##########################################################################################################################
-        
+
+tml.EventManager.jumpToSystem('Ixis', 'print_hello_world')
+
+def print_hello_world():
+    print "Hello world Jump to system works"
+
 # Start quests
 
 #capture_precursor_battleship_func()

Modified: trunk/gamedata/python/tml.py
===================================================================
--- trunk/gamedata/python/tml.py	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/gamedata/python/tml.py	2005-08-15 19:18:30 UTC (rev 180)
@@ -1,374 +1,396 @@
-# This file was created automatically by SWIG.
-# Don't modify this file, modify the SWIG interface instead.
-# This file is compatible with both classic and new-style classes.
-
-import _tml
-
-def _swig_setattr(self,class_type,name,value):
-    if (name == "this"):
-        if isinstance(value, class_type):
-            self.__dict__[name] = value.this
-            if hasattr(value,"thisown"): self.__dict__["thisown"] = value.thisown
-            del value.thisown
-            return
-    method = class_type.__swig_setmethods__.get(name,None)
-    if method: return method(self,value)
-    self.__dict__[name] = value
-
-def _swig_getattr(self,class_type,name):
-    method = class_type.__swig_getmethods__.get(name,None)
-    if method: return method(self)
-    raise AttributeError,name
-
-import types
-try:
-    _object = types.ObjectType
-    _newclass = 1
-except AttributeError:
-    class _object : pass
-    _newclass = 0
-del types
-
-
-class GameAction(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, GameAction, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, GameAction, name)
-    def __repr__(self):
-        return "<C GameAction instance at %s>" % (self.this,)
-    __swig_getmethods__["clean"] = lambda x: _tml.GameAction_clean
-    if _newclass:clean = staticmethod(_tml.GameAction_clean)
-    __swig_getmethods__["add_system"] = lambda x: _tml.GameAction_add_system
-    if _newclass:add_system = staticmethod(_tml.GameAction_add_system)
-    __swig_getmethods__["add_planet"] = lambda x: _tml.GameAction_add_planet
-    if _newclass:add_planet = staticmethod(_tml.GameAction_add_planet)
-    __swig_getmethods__["add_orbiter_station"] = lambda x: _tml.GameAction_add_orbiter_station
-    if _newclass:add_orbiter_station = staticmethod(_tml.GameAction_add_orbiter_station)
-    __swig_getmethods__["add_asteroid"] = lambda x: _tml.GameAction_add_asteroid
-    if _newclass:add_asteroid = staticmethod(_tml.GameAction_add_asteroid)
-    __swig_getmethods__["add_player"] = lambda x: _tml.GameAction_add_player
-    if _newclass:add_player = staticmethod(_tml.GameAction_add_player)
-    __swig_getmethods__["add_ship"] = lambda x: _tml.GameAction_add_ship
-    if _newclass:add_ship = staticmethod(_tml.GameAction_add_ship)
-    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
-    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
-    __swig_getmethods__["get_string_flag"] = lambda x: _tml.GameAction_get_string_flag
-    if _newclass:get_string_flag = staticmethod(_tml.GameAction_get_string_flag)
-    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
-    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
-    __swig_getmethods__["get_double_flag"] = lambda x: _tml.GameAction_get_double_flag
-    if _newclass:get_double_flag = staticmethod(_tml.GameAction_get_double_flag)
-    __swig_getmethods__["get_player_ship_id"] = lambda x: _tml.GameAction_get_player_ship_id
-    if _newclass:get_player_ship_id = staticmethod(_tml.GameAction_get_player_ship_id)
-    __swig_getmethods__["get_player_star_system"] = lambda x: _tml.GameAction_get_player_star_system
-    if _newclass:get_player_star_system = staticmethod(_tml.GameAction_get_player_star_system)
-    __swig_getmethods__["set_target"] = lambda x: _tml.GameAction_set_target
-    if _newclass:set_target = staticmethod(_tml.GameAction_set_target)
-    __swig_getmethods__["disable_weapon"] = lambda x: _tml.GameAction_disable_weapon
-    if _newclass:disable_weapon = staticmethod(_tml.GameAction_disable_weapon)
-    __swig_getmethods__["enable_weapon"] = lambda x: _tml.GameAction_enable_weapon
-    if _newclass:enable_weapon = staticmethod(_tml.GameAction_enable_weapon)
-    __swig_getmethods__["go_to_point"] = lambda x: _tml.GameAction_go_to_point
-    if _newclass:go_to_point = staticmethod(_tml.GameAction_go_to_point)
-    __swig_getmethods__["go_to_location"] = lambda x: _tml.GameAction_go_to_location
-    if _newclass:go_to_location = staticmethod(_tml.GameAction_go_to_location)
-    __swig_getmethods__["guard_location"] = lambda x: _tml.GameAction_guard_location
-    if _newclass:guard_location = staticmethod(_tml.GameAction_guard_location)
-    __swig_getmethods__["guard_point"] = lambda x: _tml.GameAction_guard_point
-    if _newclass:guard_point = staticmethod(_tml.GameAction_guard_point)
-    __swig_getmethods__["set_ship_team"] = lambda x: _tml.GameAction_set_ship_team
-    if _newclass:set_ship_team = staticmethod(_tml.GameAction_set_ship_team)
-    __swig_getmethods__["get_enemy_team"] = lambda x: _tml.GameAction_get_enemy_team
-    if _newclass:get_enemy_team = staticmethod(_tml.GameAction_get_enemy_team)
-    __swig_getmethods__["get_player_team"] = lambda x: _tml.GameAction_get_player_team
-    if _newclass:get_player_team = staticmethod(_tml.GameAction_get_player_team)
-    __swig_getmethods__["remove_location"] = lambda x: _tml.GameAction_remove_location
-    if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
-    __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
-    if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
-    __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
-    if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
-    __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
-    if _newclass:scroll_text = staticmethod(_tml.GameAction_scroll_text)
-    __swig_getmethods__["print_message"] = lambda x: _tml.GameAction_print_message
-    if _newclass:print_message = staticmethod(_tml.GameAction_print_message)
-    __swig_getmethods__["set_camera_mode"] = lambda x: _tml.GameAction_set_camera_mode
-    if _newclass:set_camera_mode = staticmethod(_tml.GameAction_set_camera_mode)
-    def __init__(self, *args):
-        _swig_setattr(self, GameAction, 'this', _tml.new_GameAction(*args))
-        _swig_setattr(self, GameAction, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_GameAction):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class GameActionPtr(GameAction):
-    def __init__(self, this):
-        _swig_setattr(self, GameAction, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, GameAction, 'thisown', 0)
-        _swig_setattr(self, GameAction,self.__class__,GameAction)
-_tml.GameAction_swigregister(GameActionPtr)
-
-GameAction_clean = _tml.GameAction_clean
-
-GameAction_add_system = _tml.GameAction_add_system
-
-GameAction_add_planet = _tml.GameAction_add_planet
-
-GameAction_add_orbiter_station = _tml.GameAction_add_orbiter_station
-
-GameAction_add_asteroid = _tml.GameAction_add_asteroid
-
-GameAction_add_player = _tml.GameAction_add_player
-
-GameAction_add_ship = _tml.GameAction_add_ship
-
-GameAction_get_string_flag = _tml.GameAction_get_string_flag
-
-GameAction_save_flag = _tml.GameAction_save_flag
-
-GameAction_get_double_flag = _tml.GameAction_get_double_flag
-
-GameAction_get_player_ship_id = _tml.GameAction_get_player_ship_id
-
-GameAction_get_player_star_system = _tml.GameAction_get_player_star_system
-
-GameAction_set_target = _tml.GameAction_set_target
-
-GameAction_disable_weapon = _tml.GameAction_disable_weapon
-
-GameAction_enable_weapon = _tml.GameAction_enable_weapon
-
-GameAction_go_to_point = _tml.GameAction_go_to_point
-
-GameAction_go_to_location = _tml.GameAction_go_to_location
-
-GameAction_guard_location = _tml.GameAction_guard_location
-
-GameAction_guard_point = _tml.GameAction_guard_point
-
-GameAction_set_ship_team = _tml.GameAction_set_ship_team
-
-GameAction_get_enemy_team = _tml.GameAction_get_enemy_team
-
-GameAction_get_player_team = _tml.GameAction_get_player_team
-
-GameAction_remove_location = _tml.GameAction_remove_location
-
-GameAction_set_crew = _tml.GameAction_set_crew
-
-GameAction_end_game = _tml.GameAction_end_game
-
-GameAction_scroll_text = _tml.GameAction_scroll_text
-
-GameAction_print_message = _tml.GameAction_print_message
-
-GameAction_set_camera_mode = _tml.GameAction_set_camera_mode
-
-class DialogApi(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, DialogApi, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, DialogApi, name)
-    def __repr__(self):
-        return "<C DialogApi instance at %s>" % (self.this,)
-    __swig_getmethods__["startDialog"] = lambda x: _tml.DialogApi_startDialog
-    if _newclass:startDialog = staticmethod(_tml.DialogApi_startDialog)
-    __swig_getmethods__["endDialog"] = lambda x: _tml.DialogApi_endDialog
-    if _newclass:endDialog = staticmethod(_tml.DialogApi_endDialog)
-    __swig_getmethods__["askPlayer"] = lambda x: _tml.DialogApi_askPlayer
-    if _newclass:askPlayer = staticmethod(_tml.DialogApi_askPlayer)
-    __swig_getmethods__["showText"] = lambda x: _tml.DialogApi_showText
-    if _newclass:showText = staticmethod(_tml.DialogApi_showText)
-    __swig_getmethods__["showAlienPicture"] = lambda x: _tml.DialogApi_showAlienPicture
-    if _newclass:showAlienPicture = staticmethod(_tml.DialogApi_showAlienPicture)
-    def __init__(self, *args):
-        _swig_setattr(self, DialogApi, 'this', _tml.new_DialogApi(*args))
-        _swig_setattr(self, DialogApi, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_DialogApi):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class DialogApiPtr(DialogApi):
-    def __init__(self, this):
-        _swig_setattr(self, DialogApi, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, DialogApi, 'thisown', 0)
-        _swig_setattr(self, DialogApi,self.__class__,DialogApi)
-_tml.DialogApi_swigregister(DialogApiPtr)
-
-DialogApi_startDialog = _tml.DialogApi_startDialog
-
-DialogApi_endDialog = _tml.DialogApi_endDialog
-
-DialogApi_askPlayer = _tml.DialogApi_askPlayer
-
-DialogApi_showText = _tml.DialogApi_showText
-
-DialogApi_showAlienPicture = _tml.DialogApi_showAlienPicture
-
-class GameConfig(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, GameConfig, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, GameConfig, name)
-    def __repr__(self):
-        return "<C GameConfig instance at %s>" % (self.this,)
-    __swig_getmethods__["SetGameDirectory"] = lambda x: _tml.GameConfig_SetGameDirectory
-    if _newclass:SetGameDirectory = staticmethod(_tml.GameConfig_SetGameDirectory)
-    __swig_getmethods__["GetGameDirectory"] = lambda x: _tml.GameConfig_GetGameDirectory
-    if _newclass:GetGameDirectory = staticmethod(_tml.GameConfig_GetGameDirectory)
-    __swig_getmethods__["GetAbsolutePath"] = lambda x: _tml.GameConfig_GetAbsolutePath
-    if _newclass:GetAbsolutePath = staticmethod(_tml.GameConfig_GetAbsolutePath)
-    def __init__(self, *args):
-        _swig_setattr(self, GameConfig, 'this', _tml.new_GameConfig(*args))
-        _swig_setattr(self, GameConfig, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_GameConfig):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class GameConfigPtr(GameConfig):
-    def __init__(self, this):
-        _swig_setattr(self, GameConfig, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, GameConfig, 'thisown', 0)
-        _swig_setattr(self, GameConfig,self.__class__,GameConfig)
-_tml.GameConfig_swigregister(GameConfigPtr)
-
-GameConfig_SetGameDirectory = _tml.GameConfig_SetGameDirectory
-
-GameConfig_GetGameDirectory = _tml.GameConfig_GetGameDirectory
-
-GameConfig_GetAbsolutePath = _tml.GameConfig_GetAbsolutePath
-
-class EventManager(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, EventManager, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, EventManager, name)
-    def __repr__(self):
-        return "<C EventManager instance at %s>" % (self.this,)
-    __swig_getmethods__["clean"] = lambda x: _tml.EventManager_clean
-    if _newclass:clean = staticmethod(_tml.EventManager_clean)
-    __swig_getmethods__["setSingleTimeEvent"] = lambda x: _tml.EventManager_setSingleTimeEvent
-    if _newclass:setSingleTimeEvent = staticmethod(_tml.EventManager_setSingleTimeEvent)
-    __swig_getmethods__["setRepeatableTimeEvent"] = lambda x: _tml.EventManager_setRepeatableTimeEvent
-    if _newclass:setRepeatableTimeEvent = staticmethod(_tml.EventManager_setRepeatableTimeEvent)
-    __swig_getmethods__["disableEvent"] = lambda x: _tml.EventManager_disableEvent
-    if _newclass:disableEvent = staticmethod(_tml.EventManager_disableEvent)
-    __swig_getmethods__["shipDeathById"] = lambda x: _tml.EventManager_shipDeathById
-    if _newclass:shipDeathById = staticmethod(_tml.EventManager_shipDeathById)
-    __swig_getmethods__["shipDeathByType"] = lambda x: _tml.EventManager_shipDeathByType
-    if _newclass:shipDeathByType = staticmethod(_tml.EventManager_shipDeathByType)
-    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
-    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
-    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
-    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
-    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
-    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
-    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
-    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
-    __swig_getmethods__["AddEventCondition"] = lambda x: _tml.EventManager_AddEventCondition
-    if _newclass:AddEventCondition = staticmethod(_tml.EventManager_AddEventCondition)
-    def __init__(self, *args):
-        _swig_setattr(self, EventManager, 'this', _tml.new_EventManager(*args))
-        _swig_setattr(self, EventManager, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_EventManager):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class EventManagerPtr(EventManager):
-    def __init__(self, this):
-        _swig_setattr(self, EventManager, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, EventManager, 'thisown', 0)
-        _swig_setattr(self, EventManager,self.__class__,EventManager)
-_tml.EventManager_swigregister(EventManagerPtr)
-
-EventManager_clean = _tml.EventManager_clean
-
-EventManager_setSingleTimeEvent = _tml.EventManager_setSingleTimeEvent
-
-EventManager_setRepeatableTimeEvent = _tml.EventManager_setRepeatableTimeEvent
-
-EventManager_disableEvent = _tml.EventManager_disableEvent
-
-EventManager_shipDeathById = _tml.EventManager_shipDeathById
-
-EventManager_shipDeathByType = _tml.EventManager_shipDeathByType
-
-EventManager_distanceMoreThen = _tml.EventManager_distanceMoreThen
-
-EventManager_distanceLessThen = _tml.EventManager_distanceLessThen
-
-EventManager_AddEventCondition = _tml.EventManager_AddEventCondition
-
-class SoundSystem(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, SoundSystem, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, SoundSystem, name)
-    def __repr__(self):
-        return "<C SoundSystem instance at %s>" % (self.this,)
-    def __init__(self, *args):
-        _swig_setattr(self, SoundSystem, 'this', _tml.new_SoundSystem(*args))
-        _swig_setattr(self, SoundSystem, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_SoundSystem):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-    def play_music(*args): return _tml.SoundSystem_play_music(*args)
-    def play_sound(*args): return _tml.SoundSystem_play_sound(*args)
-    def stop_sound(*args): return _tml.SoundSystem_stop_sound(*args)
-    def set_music_volume(*args): return _tml.SoundSystem_set_music_volume(*args)
-    def set_sound_volume(*args): return _tml.SoundSystem_set_sound_volume(*args)
-    def load_music_volume(*args): return _tml.SoundSystem_load_music_volume(*args)
-    def load_sound_volume(*args): return _tml.SoundSystem_load_sound_volume(*args)
-    def playing_music(*args): return _tml.SoundSystem_playing_music(*args)
-    def playing_music_file(*args): return _tml.SoundSystem_playing_music_file(*args)
-
-class SoundSystemPtr(SoundSystem):
-    def __init__(self, this):
-        _swig_setattr(self, SoundSystem, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, SoundSystem, 'thisown', 0)
-        _swig_setattr(self, SoundSystem,self.__class__,SoundSystem)
-_tml.SoundSystem_swigregister(SoundSystemPtr)
-
-
-GetSoundSystem = _tml.GetSoundSystem
-class vectorString(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, vectorString, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, vectorString, name)
-    def __repr__(self):
-        return "<C std::vector<(std::string)> instance at %s>" % (self.this,)
-    def __init__(self, *args):
-        _swig_setattr(self, vectorString, 'this', _tml.new_vectorString(*args))
-        _swig_setattr(self, vectorString, 'thisown', 1)
-    def __len__(*args): return _tml.vectorString___len__(*args)
-    def __nonzero__(*args): return _tml.vectorString___nonzero__(*args)
-    def clear(*args): return _tml.vectorString_clear(*args)
-    def append(*args): return _tml.vectorString_append(*args)
-    def pop(*args): return _tml.vectorString_pop(*args)
-    def __getitem__(*args): return _tml.vectorString___getitem__(*args)
-    def __getslice__(*args): return _tml.vectorString___getslice__(*args)
-    def __setitem__(*args): return _tml.vectorString___setitem__(*args)
-    def __setslice__(*args): return _tml.vectorString___setslice__(*args)
-    def __delitem__(*args): return _tml.vectorString___delitem__(*args)
-    def __delslice__(*args): return _tml.vectorString___delslice__(*args)
-    def __del__(self, destroy=_tml.delete_vectorString):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class vectorStringPtr(vectorString):
-    def __init__(self, this):
-        _swig_setattr(self, vectorString, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, vectorString, 'thisown', 0)
-        _swig_setattr(self, vectorString,self.__class__,vectorString)
-_tml.vectorString_swigregister(vectorStringPtr)
-cvar = _tml.cvar
-
-
+# This file was created automatically by SWIG.
+# Don't modify this file, modify the SWIG interface instead.
+# This file is compatible with both classic and new-style classes.
+
+import _tml
+
+def _swig_setattr_nondynamic(self,class_type,name,value,static=1):
+    if (name == "this"):
+        if isinstance(value, class_type):
+            self.__dict__[name] = value.this
+            if hasattr(value,"thisown"): self.__dict__["thisown"] = value.thisown
+            del value.thisown
+            return
+    method = class_type.__swig_setmethods__.get(name,None)
+    if method: return method(self,value)
+    if (not static) or hasattr(self,name) or (name == "thisown"):
+        self.__dict__[name] = value
+    else:
+        raise AttributeError("You cannot add attributes to %s" % self)
+
+def _swig_setattr(self,class_type,name,value):
+    return _swig_setattr_nondynamic(self,class_type,name,value,0)
+
+def _swig_getattr(self,class_type,name):
+    method = class_type.__swig_getmethods__.get(name,None)
+    if method: return method(self)
+    raise AttributeError,name
+
+import types
+try:
+    _object = types.ObjectType
+    _newclass = 1
+except AttributeError:
+    class _object : pass
+    _newclass = 0
+del types
+
+
+class GameAction(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, GameAction, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, GameAction, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ GameAction instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["clean"] = lambda x: _tml.GameAction_clean
+    if _newclass:clean = staticmethod(_tml.GameAction_clean)
+    __swig_getmethods__["add_system"] = lambda x: _tml.GameAction_add_system
+    if _newclass:add_system = staticmethod(_tml.GameAction_add_system)
+    __swig_getmethods__["add_planet"] = lambda x: _tml.GameAction_add_planet
+    if _newclass:add_planet = staticmethod(_tml.GameAction_add_planet)
+    __swig_getmethods__["add_orbiter_station"] = lambda x: _tml.GameAction_add_orbiter_station
+    if _newclass:add_orbiter_station = staticmethod(_tml.GameAction_add_orbiter_station)
+    __swig_getmethods__["add_asteroid"] = lambda x: _tml.GameAction_add_asteroid
+    if _newclass:add_asteroid = staticmethod(_tml.GameAction_add_asteroid)
+    __swig_getmethods__["add_player"] = lambda x: _tml.GameAction_add_player
+    if _newclass:add_player = staticmethod(_tml.GameAction_add_player)
+    __swig_getmethods__["add_ship"] = lambda x: _tml.GameAction_add_ship
+    if _newclass:add_ship = staticmethod(_tml.GameAction_add_ship)
+    __swig_getmethods__["get_string_flag"] = lambda x: _tml.GameAction_get_string_flag
+    if _newclass:get_string_flag = staticmethod(_tml.GameAction_get_string_flag)
+    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
+    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
+    __swig_getmethods__["get_double_flag"] = lambda x: _tml.GameAction_get_double_flag
+    if _newclass:get_double_flag = staticmethod(_tml.GameAction_get_double_flag)
+    __swig_getmethods__["get_player_ship_id"] = lambda x: _tml.GameAction_get_player_ship_id
+    if _newclass:get_player_ship_id = staticmethod(_tml.GameAction_get_player_ship_id)
+    __swig_getmethods__["get_player_star_system"] = lambda x: _tml.GameAction_get_player_star_system
+    if _newclass:get_player_star_system = staticmethod(_tml.GameAction_get_player_star_system)
+    __swig_getmethods__["set_target"] = lambda x: _tml.GameAction_set_target
+    if _newclass:set_target = staticmethod(_tml.GameAction_set_target)
+    __swig_getmethods__["disable_weapon"] = lambda x: _tml.GameAction_disable_weapon
+    if _newclass:disable_weapon = staticmethod(_tml.GameAction_disable_weapon)
+    __swig_getmethods__["enable_weapon"] = lambda x: _tml.GameAction_enable_weapon
+    if _newclass:enable_weapon = staticmethod(_tml.GameAction_enable_weapon)
+    __swig_getmethods__["go_to_point"] = lambda x: _tml.GameAction_go_to_point
+    if _newclass:go_to_point = staticmethod(_tml.GameAction_go_to_point)
+    __swig_getmethods__["go_to_location"] = lambda x: _tml.GameAction_go_to_location
+    if _newclass:go_to_location = staticmethod(_tml.GameAction_go_to_location)
+    __swig_getmethods__["guard_location"] = lambda x: _tml.GameAction_guard_location
+    if _newclass:guard_location = staticmethod(_tml.GameAction_guard_location)
+    __swig_getmethods__["guard_point"] = lambda x: _tml.GameAction_guard_point
+    if _newclass:guard_point = staticmethod(_tml.GameAction_guard_point)
+    __swig_getmethods__["set_ship_team"] = lambda x: _tml.GameAction_set_ship_team
+    if _newclass:set_ship_team = staticmethod(_tml.GameAction_set_ship_team)
+    __swig_getmethods__["get_enemy_team"] = lambda x: _tml.GameAction_get_enemy_team
+    if _newclass:get_enemy_team = staticmethod(_tml.GameAction_get_enemy_team)
+    __swig_getmethods__["get_player_team"] = lambda x: _tml.GameAction_get_player_team
+    if _newclass:get_player_team = staticmethod(_tml.GameAction_get_player_team)
+    __swig_getmethods__["remove_location"] = lambda x: _tml.GameAction_remove_location
+    if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
+    __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
+    if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
+    __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
+    if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
+    __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
+    if _newclass:scroll_text = staticmethod(_tml.GameAction_scroll_text)
+    __swig_getmethods__["print_message"] = lambda x: _tml.GameAction_print_message
+    if _newclass:print_message = staticmethod(_tml.GameAction_print_message)
+    __swig_getmethods__["set_camera_mode"] = lambda x: _tml.GameAction_set_camera_mode
+    if _newclass:set_camera_mode = staticmethod(_tml.GameAction_set_camera_mode)
+    def __init__(self, *args):
+        _swig_setattr(self, GameAction, 'this', _tml.new_GameAction(*args))
+        _swig_setattr(self, GameAction, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_GameAction):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class GameActionPtr(GameAction):
+    def __init__(self, this):
+        _swig_setattr(self, GameAction, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, GameAction, 'thisown', 0)
+        _swig_setattr(self, GameAction,self.__class__,GameAction)
+_tml.GameAction_swigregister(GameActionPtr)
+
+GameAction_clean = _tml.GameAction_clean
+
+GameAction_add_system = _tml.GameAction_add_system
+
+GameAction_add_planet = _tml.GameAction_add_planet
+
+GameAction_add_orbiter_station = _tml.GameAction_add_orbiter_station
+
+GameAction_add_asteroid = _tml.GameAction_add_asteroid
+
+GameAction_add_player = _tml.GameAction_add_player
+
+GameAction_add_ship = _tml.GameAction_add_ship
+
+GameAction_get_string_flag = _tml.GameAction_get_string_flag
+
+GameAction_save_flag = _tml.GameAction_save_flag
+
+GameAction_get_double_flag = _tml.GameAction_get_double_flag
+
+GameAction_get_player_ship_id = _tml.GameAction_get_player_ship_id
+
+GameAction_get_player_star_system = _tml.GameAction_get_player_star_system
+
+GameAction_set_target = _tml.GameAction_set_target
+
+GameAction_disable_weapon = _tml.GameAction_disable_weapon
+
+GameAction_enable_weapon = _tml.GameAction_enable_weapon
+
+GameAction_go_to_point = _tml.GameAction_go_to_point
+
+GameAction_go_to_location = _tml.GameAction_go_to_location
+
+GameAction_guard_location = _tml.GameAction_guard_location
+
+GameAction_guard_point = _tml.GameAction_guard_point
+
+GameAction_set_ship_team = _tml.GameAction_set_ship_team
+
+GameAction_get_enemy_team = _tml.GameAction_get_enemy_team
+
+GameAction_get_player_team = _tml.GameAction_get_player_team
+
+GameAction_remove_location = _tml.GameAction_remove_location
+
+GameAction_set_crew = _tml.GameAction_set_crew
+
+GameAction_end_game = _tml.GameAction_end_game
+
+GameAction_scroll_text = _tml.GameAction_scroll_text
+
+GameAction_print_message = _tml.GameAction_print_message
+
+GameAction_set_camera_mode = _tml.GameAction_set_camera_mode
+
+class DialogApi(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, DialogApi, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, DialogApi, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ DialogApi instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["startDialog"] = lambda x: _tml.DialogApi_startDialog
+    if _newclass:startDialog = staticmethod(_tml.DialogApi_startDialog)
+    __swig_getmethods__["endDialog"] = lambda x: _tml.DialogApi_endDialog
+    if _newclass:endDialog = staticmethod(_tml.DialogApi_endDialog)
+    __swig_getmethods__["askPlayer"] = lambda x: _tml.DialogApi_askPlayer
+    if _newclass:askPlayer = staticmethod(_tml.DialogApi_askPlayer)
+    __swig_getmethods__["showText"] = lambda x: _tml.DialogApi_showText
+    if _newclass:showText = staticmethod(_tml.DialogApi_showText)
+    __swig_getmethods__["showAlienPicture"] = lambda x: _tml.DialogApi_showAlienPicture
+    if _newclass:showAlienPicture = staticmethod(_tml.DialogApi_showAlienPicture)
+    def __init__(self, *args):
+        _swig_setattr(self, DialogApi, 'this', _tml.new_DialogApi(*args))
+        _swig_setattr(self, DialogApi, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_DialogApi):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class DialogApiPtr(DialogApi):
+    def __init__(self, this):
+        _swig_setattr(self, DialogApi, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, DialogApi, 'thisown', 0)
+        _swig_setattr(self, DialogApi,self.__class__,DialogApi)
+_tml.DialogApi_swigregister(DialogApiPtr)
+
+DialogApi_startDialog = _tml.DialogApi_startDialog
+
+DialogApi_endDialog = _tml.DialogApi_endDialog
+
+DialogApi_askPlayer = _tml.DialogApi_askPlayer
+
+DialogApi_showText = _tml.DialogApi_showText
+
+DialogApi_showAlienPicture = _tml.DialogApi_showAlienPicture
+
+class GameConfig(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, GameConfig, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, GameConfig, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ GameConfig instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["SetGameDirectory"] = lambda x: _tml.GameConfig_SetGameDirectory
+    if _newclass:SetGameDirectory = staticmethod(_tml.GameConfig_SetGameDirectory)
+    __swig_getmethods__["GetGameDirectory"] = lambda x: _tml.GameConfig_GetGameDirectory
+    if _newclass:GetGameDirectory = staticmethod(_tml.GameConfig_GetGameDirectory)
+    __swig_getmethods__["GetAbsolutePath"] = lambda x: _tml.GameConfig_GetAbsolutePath
+    if _newclass:GetAbsolutePath = staticmethod(_tml.GameConfig_GetAbsolutePath)
+    def __init__(self, *args):
+        _swig_setattr(self, GameConfig, 'this', _tml.new_GameConfig(*args))
+        _swig_setattr(self, GameConfig, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_GameConfig):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class GameConfigPtr(GameConfig):
+    def __init__(self, this):
+        _swig_setattr(self, GameConfig, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, GameConfig, 'thisown', 0)
+        _swig_setattr(self, GameConfig,self.__class__,GameConfig)
+_tml.GameConfig_swigregister(GameConfigPtr)
+
+GameConfig_SetGameDirectory = _tml.GameConfig_SetGameDirectory
+
+GameConfig_GetGameDirectory = _tml.GameConfig_GetGameDirectory
+
+GameConfig_GetAbsolutePath = _tml.GameConfig_GetAbsolutePath
+
+class EventManager(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, EventManager, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, EventManager, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ EventManager instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["clean"] = lambda x: _tml.EventManager_clean
+    if _newclass:clean = staticmethod(_tml.EventManager_clean)
+    __swig_getmethods__["setSingleTimeEvent"] = lambda x: _tml.EventManager_setSingleTimeEvent
+    if _newclass:setSingleTimeEvent = staticmethod(_tml.EventManager_setSingleTimeEvent)
+    __swig_getmethods__["setRepeatableTimeEvent"] = lambda x: _tml.EventManager_setRepeatableTimeEvent
+    if _newclass:setRepeatableTimeEvent = staticmethod(_tml.EventManager_setRepeatableTimeEvent)
+    __swig_getmethods__["disableEvent"] = lambda x: _tml.EventManager_disableEvent
+    if _newclass:disableEvent = staticmethod(_tml.EventManager_disableEvent)
+    __swig_getmethods__["shipDeathById"] = lambda x: _tml.EventManager_shipDeathById
+    if _newclass:shipDeathById = staticmethod(_tml.EventManager_shipDeathById)
+    __swig_getmethods__["shipDeathByType"] = lambda x: _tml.EventManager_shipDeathByType
+    if _newclass:shipDeathByType = staticmethod(_tml.EventManager_shipDeathByType)
+    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
+    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
+    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
+    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
+    __swig_getmethods__["jumpToSystem"] = lambda x: _tml.EventManager_jumpToSystem
+    if _newclass:jumpToSystem = staticmethod(_tml.EventManager_jumpToSystem)
+    __swig_getmethods__["AddEventCondition"] = lambda x: _tml.EventManager_AddEventCondition
+    if _newclass:AddEventCondition = staticmethod(_tml.EventManager_AddEventCondition)
+    def __init__(self, *args):
+        _swig_setattr(self, EventManager, 'this', _tml.new_EventManager(*args))
+        _swig_setattr(self, EventManager, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_EventManager):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class EventManagerPtr(EventManager):
+    def __init__(self, this):
+        _swig_setattr(self, EventManager, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, EventManager, 'thisown', 0)
+        _swig_setattr(self, EventManager,self.__class__,EventManager)
+_tml.EventManager_swigregister(EventManagerPtr)
+
+EventManager_clean = _tml.EventManager_clean
+
+EventManager_setSingleTimeEvent = _tml.EventManager_setSingleTimeEvent
+
+EventManager_setRepeatableTimeEvent = _tml.EventManager_setRepeatableTimeEvent
+
+EventManager_disableEvent = _tml.EventManager_disableEvent
+
+EventManager_shipDeathById = _tml.EventManager_shipDeathById
+
+EventManager_shipDeathByType = _tml.EventManager_shipDeathByType
+
+EventManager_distanceMoreThen = _tml.EventManager_distanceMoreThen
+
+EventManager_distanceLessThen = _tml.EventManager_distanceLessThen
+
+EventManager_jumpToSystem = _tml.EventManager_jumpToSystem
+
+EventManager_AddEventCondition = _tml.EventManager_AddEventCondition
+
+class SoundSystem(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, SoundSystem, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, SoundSystem, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ SoundSystem instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    def __init__(self, *args):
+        _swig_setattr(self, SoundSystem, 'this', _tml.new_SoundSystem(*args))
+        _swig_setattr(self, SoundSystem, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_SoundSystem):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+    def play_music(*args): return _tml.SoundSystem_play_music(*args)
+    def play_sound(*args): return _tml.SoundSystem_play_sound(*args)
+    def stop_sound(*args): return _tml.SoundSystem_stop_sound(*args)
+    def set_music_volume(*args): return _tml.SoundSystem_set_music_volume(*args)
+    def set_sound_volume(*args): return _tml.SoundSystem_set_sound_volume(*args)
+    def load_music_volume(*args): return _tml.SoundSystem_load_music_volume(*args)
+    def load_sound_volume(*args): return _tml.SoundSystem_load_sound_volume(*args)
+    def playing_music(*args): return _tml.SoundSystem_playing_music(*args)
+    def playing_music_file(*args): return _tml.SoundSystem_playing_music_file(*args)
+
+class SoundSystemPtr(SoundSystem):
+    def __init__(self, this):
+        _swig_setattr(self, SoundSystem, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, SoundSystem, 'thisown', 0)
+        _swig_setattr(self, SoundSystem,self.__class__,SoundSystem)
+_tml.SoundSystem_swigregister(SoundSystemPtr)
+
+
+GetSoundSystem = _tml.GetSoundSystem
+class vectorString(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, vectorString, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, vectorString, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ std::vector<std::string > instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    def empty(*args): return _tml.vectorString_empty(*args)
+    def size(*args): return _tml.vectorString_size(*args)
+    def clear(*args): return _tml.vectorString_clear(*args)
+    def swap(*args): return _tml.vectorString_swap(*args)
+    def get_allocator(*args): return _tml.vectorString_get_allocator(*args)
+    def pop_back(*args): return _tml.vectorString_pop_back(*args)
+    def __init__(self, *args):
+        _swig_setattr(self, vectorString, 'this', _tml.new_vectorString(*args))
+        _swig_setattr(self, vectorString, 'thisown', 1)
+    def push_back(*args): return _tml.vectorString_push_back(*args)
+    def front(*args): return _tml.vectorString_front(*args)
+    def back(*args): return _tml.vectorString_back(*args)
+    def assign(*args): return _tml.vectorString_assign(*args)
+    def resize(*args): return _tml.vectorString_resize(*args)
+    def reserve(*args): return _tml.vectorString_reserve(*args)
+    def capacity(*args): return _tml.vectorString_capacity(*args)
+    def __nonzero__(*args): return _tml.vectorString___nonzero__(*args)
+    def __len__(*args): return _tml.vectorString___len__(*args)
+    def pop(*args): return _tml.vectorString_pop(*args)
+    def __getslice__(*args): return _tml.vectorString___getslice__(*args)
+    def __setslice__(*args): return _tml.vectorString___setslice__(*args)
+    def __delslice__(*args): return _tml.vectorString___delslice__(*args)
+    def __delitem__(*args): return _tml.vectorString___delitem__(*args)
+    def __getitem__(*args): return _tml.vectorString___getitem__(*args)
+    def __setitem__(*args): return _tml.vectorString___setitem__(*args)
+    def append(*args): return _tml.vectorString_append(*args)
+    def __del__(self, destroy=_tml.delete_vectorString):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class vectorStringPtr(vectorString):
+    def __init__(self, this):
+        _swig_setattr(self, vectorString, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, vectorString, 'thisown', 0)
+        _swig_setattr(self, vectorString,self.__class__,vectorString)
+_tml.vectorString_swigregister(vectorStringPtr)
+cvar = _tml.cvar
+
+

Modified: trunk/source/generated/tml.py
===================================================================
--- trunk/source/generated/tml.py	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/generated/tml.py	2005-08-15 19:18:30 UTC (rev 180)
@@ -1,370 +1,396 @@
-# This file was created automatically by SWIG.
-# Don't modify this file, modify the SWIG interface instead.
-# This file is compatible with both classic and new-style classes.
-
-import _tml
-
-def _swig_setattr(self,class_type,name,value):
-    if (name == "this"):
-        if isinstance(value, class_type):
-            self.__dict__[name] = value.this
-            if hasattr(value,"thisown"): self.__dict__["thisown"] = value.thisown
-            del value.thisown
-            return
-    method = class_type.__swig_setmethods__.get(name,None)
-    if method: return method(self,value)
-    self.__dict__[name] = value
-
-def _swig_getattr(self,class_type,name):
-    method = class_type.__swig_getmethods__.get(name,None)
-    if method: return method(self)
-    raise AttributeError,name
-
-import types
-try:
-    _object = types.ObjectType
-    _newclass = 1
-except AttributeError:
-    class _object : pass
-    _newclass = 0
-del types
-
-
-class GameAction(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, GameAction, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, GameAction, name)
-    def __repr__(self):
-        return "<C GameAction instance at %s>" % (self.this,)
-    __swig_getmethods__["clean"] = lambda x: _tml.GameAction_clean
-    if _newclass:clean = staticmethod(_tml.GameAction_clean)
-    __swig_getmethods__["add_system"] = lambda x: _tml.GameAction_add_system
-    if _newclass:add_system = staticmethod(_tml.GameAction_add_system)
-    __swig_getmethods__["add_planet"] = lambda x: _tml.GameAction_add_planet
-    if _newclass:add_planet = staticmethod(_tml.GameAction_add_planet)
-    __swig_getmethods__["add_orbiter_station"] = lambda x: _tml.GameAction_add_orbiter_station
-    if _newclass:add_orbiter_station = staticmethod(_tml.GameAction_add_orbiter_station)
-    __swig_getmethods__["add_asteroid"] = lambda x: _tml.GameAction_add_asteroid
-    if _newclass:add_asteroid = staticmethod(_tml.GameAction_add_asteroid)
-    __swig_getmethods__["add_player"] = lambda x: _tml.GameAction_add_player
-    if _newclass:add_player = staticmethod(_tml.GameAction_add_player)
-    __swig_getmethods__["add_ship"] = lambda x: _tml.GameAction_add_ship
-    if _newclass:add_ship = staticmethod(_tml.GameAction_add_ship)
-    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
-    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
-    __swig_getmethods__["get_string_flag"] = lambda x: _tml.GameAction_get_string_flag
-    if _newclass:get_string_flag = staticmethod(_tml.GameAction_get_string_flag)
-    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
-    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
-    __swig_getmethods__["get_double_flag"] = lambda x: _tml.GameAction_get_double_flag
-    if _newclass:get_double_flag = staticmethod(_tml.GameAction_get_double_flag)
-    __swig_getmethods__["get_player_ship_id"] = lambda x: _tml.GameAction_get_player_ship_id
-    if _newclass:get_player_ship_id = staticmethod(_tml.GameAction_get_player_ship_id)
-    __swig_getmethods__["get_player_star_system"] = lambda x: _tml.GameAction_get_player_star_system
-    if _newclass:get_player_star_system = staticmethod(_tml.GameAction_get_player_star_system)
-    __swig_getmethods__["set_target"] = lambda x: _tml.GameAction_set_target
-    if _newclass:set_target = staticmethod(_tml.GameAction_set_target)
-    __swig_getmethods__["disable_weapon"] = lambda x: _tml.GameAction_disable_weapon
-    if _newclass:disable_weapon = staticmethod(_tml.GameAction_disable_weapon)
-    __swig_getmethods__["enable_weapon"] = lambda x: _tml.GameAction_enable_weapon
-    if _newclass:enable_weapon = staticmethod(_tml.GameAction_enable_weapon)
-    __swig_getmethods__["go_to_point"] = lambda x: _tml.GameAction_go_to_point
-    if _newclass:go_to_point = staticmethod(_tml.GameAction_go_to_point)
-    __swig_getmethods__["go_to_location"] = lambda x: _tml.GameAction_go_to_location
-    if _newclass:go_to_location = staticmethod(_tml.GameAction_go_to_location)
-    __swig_getmethods__["guard_location"] = lambda x: _tml.GameAction_guard_location
-    if _newclass:guard_location = staticmethod(_tml.GameAction_guard_location)
-    __swig_getmethods__["guard_point"] = lambda x: _tml.GameAction_guard_point
-    if _newclass:guard_point = staticmethod(_tml.GameAction_guard_point)
-    __swig_getmethods__["set_ship_team"] = lambda x: _tml.GameAction_set_ship_team
-    if _newclass:set_ship_team = staticmethod(_tml.GameAction_set_ship_team)
-    __swig_getmethods__["get_enemy_team"] = lambda x: _tml.GameAction_get_enemy_team
-    if _newclass:get_enemy_team = staticmethod(_tml.GameAction_get_enemy_team)
-    __swig_getmethods__["get_player_team"] = lambda x: _tml.GameAction_get_player_team
-    if _newclass:get_player_team = staticmethod(_tml.GameAction_get_player_team)
-    __swig_getmethods__["remove_location"] = lambda x: _tml.GameAction_remove_location
-    if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
-    __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
-    if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
-    __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
-    if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
-    __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
-    if _newclass:scroll_text = staticmethod(_tml.GameAction_scroll_text)
-    __swig_getmethods__["print_message"] = lambda x: _tml.GameAction_print_message
-    if _newclass:print_message = staticmethod(_tml.GameAction_print_message)
-    def __init__(self, *args):
-        _swig_setattr(self, GameAction, 'this', _tml.new_GameAction(*args))
-        _swig_setattr(self, GameAction, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_GameAction):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class GameActionPtr(GameAction):
-    def __init__(self, this):
-        _swig_setattr(self, GameAction, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, GameAction, 'thisown', 0)
-        _swig_setattr(self, GameAction,self.__class__,GameAction)
-_tml.GameAction_swigregister(GameActionPtr)
-
-GameAction_clean = _tml.GameAction_clean
-
-GameAction_add_system = _tml.GameAction_add_system
-
-GameAction_add_planet = _tml.GameAction_add_planet
-
-GameAction_add_orbiter_station = _tml.GameAction_add_orbiter_station
-
-GameAction_add_asteroid = _tml.GameAction_add_asteroid
-
-GameAction_add_player = _tml.GameAction_add_player
-
-GameAction_add_ship = _tml.GameAction_add_ship
-
-GameAction_get_string_flag = _tml.GameAction_get_string_flag
-
-GameAction_save_flag = _tml.GameAction_save_flag
-
-GameAction_get_double_flag = _tml.GameAction_get_double_flag
-
-GameAction_get_player_ship_id = _tml.GameAction_get_player_ship_id
-
-GameAction_get_player_star_system = _tml.GameAction_get_player_star_system
-
-GameAction_set_target = _tml.GameAction_set_target
-
-GameAction_disable_weapon = _tml.GameAction_disable_weapon
-
-GameAction_enable_weapon = _tml.GameAction_enable_weapon
-
-GameAction_go_to_point = _tml.GameAction_go_to_point
-
-GameAction_go_to_location = _tml.GameAction_go_to_location
-
-GameAction_guard_location = _tml.GameAction_guard_location
-
-GameAction_guard_point = _tml.GameAction_guard_point
-
-GameAction_set_ship_team = _tml.GameAction_set_ship_team
-
-GameAction_get_enemy_team = _tml.GameAction_get_enemy_team
-
-GameAction_get_player_team = _tml.GameAction_get_player_team
-
-GameAction_remove_location = _tml.GameAction_remove_location
-
-GameAction_set_crew = _tml.GameAction_set_crew
-
-GameAction_end_game = _tml.GameAction_end_game
-
-GameAction_scroll_text = _tml.GameAction_scroll_text
-
-GameAction_print_message = _tml.GameAction_print_message
-
-class DialogApi(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, DialogApi, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, DialogApi, name)
-    def __repr__(self):
-        return "<C DialogApi instance at %s>" % (self.this,)
-    __swig_getmethods__["startDialog"] = lambda x: _tml.DialogApi_startDialog
-    if _newclass:startDialog = staticmethod(_tml.DialogApi_startDialog)
-    __swig_getmethods__["endDialog"] = lambda x: _tml.DialogApi_endDialog
-    if _newclass:endDialog = staticmethod(_tml.DialogApi_endDialog)
-    __swig_getmethods__["askPlayer"] = lambda x: _tml.DialogApi_askPlayer
-    if _newclass:askPlayer = staticmethod(_tml.DialogApi_askPlayer)
-    __swig_getmethods__["showText"] = lambda x: _tml.DialogApi_showText
-    if _newclass:showText = staticmethod(_tml.DialogApi_showText)
-    __swig_getmethods__["showAlienPicture"] = lambda x: _tml.DialogApi_showAlienPicture
-    if _newclass:showAlienPicture = staticmethod(_tml.DialogApi_showAlienPicture)
-    def __init__(self, *args):
-        _swig_setattr(self, DialogApi, 'this', _tml.new_DialogApi(*args))
-        _swig_setattr(self, DialogApi, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_DialogApi):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class DialogApiPtr(DialogApi):
-    def __init__(self, this):
-        _swig_setattr(self, DialogApi, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, DialogApi, 'thisown', 0)
-        _swig_setattr(self, DialogApi,self.__class__,DialogApi)
-_tml.DialogApi_swigregister(DialogApiPtr)
-
-DialogApi_startDialog = _tml.DialogApi_startDialog
-
-DialogApi_endDialog = _tml.DialogApi_endDialog
-
-DialogApi_askPlayer = _tml.DialogApi_askPlayer
-
-DialogApi_showText = _tml.DialogApi_showText
-
-DialogApi_showAlienPicture = _tml.DialogApi_showAlienPicture
-
-class GameConfig(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, GameConfig, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, GameConfig, name)
-    def __repr__(self):
-        return "<C GameConfig instance at %s>" % (self.this,)
-    __swig_getmethods__["SetGameDirectory"] = lambda x: _tml.GameConfig_SetGameDirectory
-    if _newclass:SetGameDirectory = staticmethod(_tml.GameConfig_SetGameDirectory)
-    __swig_getmethods__["GetGameDirectory"] = lambda x: _tml.GameConfig_GetGameDirectory
-    if _newclass:GetGameDirectory = staticmethod(_tml.GameConfig_GetGameDirectory)
-    __swig_getmethods__["GetAbsolutePath"] = lambda x: _tml.GameConfig_GetAbsolutePath
-    if _newclass:GetAbsolutePath = staticmethod(_tml.GameConfig_GetAbsolutePath)
-    def __init__(self, *args):
-        _swig_setattr(self, GameConfig, 'this', _tml.new_GameConfig(*args))
-        _swig_setattr(self, GameConfig, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_GameConfig):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class GameConfigPtr(GameConfig):
-    def __init__(self, this):
-        _swig_setattr(self, GameConfig, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, GameConfig, 'thisown', 0)
-        _swig_setattr(self, GameConfig,self.__class__,GameConfig)
-_tml.GameConfig_swigregister(GameConfigPtr)
-
-GameConfig_SetGameDirectory = _tml.GameConfig_SetGameDirectory
-
-GameConfig_GetGameDirectory = _tml.GameConfig_GetGameDirectory
-
-GameConfig_GetAbsolutePath = _tml.GameConfig_GetAbsolutePath
-
-class EventManager(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, EventManager, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, EventManager, name)
-    def __repr__(self):
-        return "<C EventManager instance at %s>" % (self.this,)
-    __swig_getmethods__["clean"] = lambda x: _tml.EventManager_clean
-    if _newclass:clean = staticmethod(_tml.EventManager_clean)
-    __swig_getmethods__["setSingleTimeEvent"] = lambda x: _tml.EventManager_setSingleTimeEvent
-    if _newclass:setSingleTimeEvent = staticmethod(_tml.EventManager_setSingleTimeEvent)
-    __swig_getmethods__["setRepeatableTimeEvent"] = lambda x: _tml.EventManager_setRepeatableTimeEvent
-    if _newclass:setRepeatableTimeEvent = staticmethod(_tml.EventManager_setRepeatableTimeEvent)
-    __swig_getmethods__["disableEvent"] = lambda x: _tml.EventManager_disableEvent
-    if _newclass:disableEvent = staticmethod(_tml.EventManager_disableEvent)
-    __swig_getmethods__["shipDeathByName"] = lambda x: _tml.EventManager_shipDeathByName
-    if _newclass:shipDeathByName = staticmethod(_tml.EventManager_shipDeathByName)
-    __swig_getmethods__["shipDeathByType"] = lambda x: _tml.EventManager_shipDeathByType
-    if _newclass:shipDeathByType = staticmethod(_tml.EventManager_shipDeathByType)
-    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
-    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
-    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
-    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
-    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
-    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
-    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
-    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
-    __swig_getmethods__["AddEventCondition"] = lambda x: _tml.EventManager_AddEventCondition
-    if _newclass:AddEventCondition = staticmethod(_tml.EventManager_AddEventCondition)
-    def __init__(self, *args):
-        _swig_setattr(self, EventManager, 'this', _tml.new_EventManager(*args))
-        _swig_setattr(self, EventManager, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_EventManager):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class EventManagerPtr(EventManager):
-    def __init__(self, this):
-        _swig_setattr(self, EventManager, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, EventManager, 'thisown', 0)
-        _swig_setattr(self, EventManager,self.__class__,EventManager)
-_tml.EventManager_swigregister(EventManagerPtr)
-
-EventManager_clean = _tml.EventManager_clean
-
-EventManager_setSingleTimeEvent = _tml.EventManager_setSingleTimeEvent
-
-EventManager_setRepeatableTimeEvent = _tml.EventManager_setRepeatableTimeEvent
-
-EventManager_disableEvent = _tml.EventManager_disableEvent
-
-EventManager_shipDeathByName = _tml.EventManager_shipDeathByName
-
-EventManager_shipDeathByType = _tml.EventManager_shipDeathByType
-
-EventManager_distanceMoreThen = _tml.EventManager_distanceMoreThen
-
-EventManager_distanceLessThen = _tml.EventManager_distanceLessThen
-
-EventManager_AddEventCondition = _tml.EventManager_AddEventCondition
-
-class SoundSystem(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, SoundSystem, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, SoundSystem, name)
-    def __repr__(self):
-        return "<C SoundSystem instance at %s>" % (self.this,)
-    def __init__(self, *args):
-        _swig_setattr(self, SoundSystem, 'this', _tml.new_SoundSystem(*args))
-        _swig_setattr(self, SoundSystem, 'thisown', 1)
-    def __del__(self, destroy=_tml.delete_SoundSystem):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-    def play_music(*args): return _tml.SoundSystem_play_music(*args)
-    def play_sound(*args): return _tml.SoundSystem_play_sound(*args)
-    def stop_sound(*args): return _tml.SoundSystem_stop_sound(*args)
-    def set_music_volume(*args): return _tml.SoundSystem_set_music_volume(*args)
-    def set_sound_volume(*args): return _tml.SoundSystem_set_sound_volume(*args)
-    def load_music_volume(*args): return _tml.SoundSystem_load_music_volume(*args)
-    def load_sound_volume(*args): return _tml.SoundSystem_load_sound_volume(*args)
-    def playing_music(*args): return _tml.SoundSystem_playing_music(*args)
-    def playing_music_file(*args): return _tml.SoundSystem_playing_music_file(*args)
-
-class SoundSystemPtr(SoundSystem):
-    def __init__(self, this):
-        _swig_setattr(self, SoundSystem, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, SoundSystem, 'thisown', 0)
-        _swig_setattr(self, SoundSystem,self.__class__,SoundSystem)
-_tml.SoundSystem_swigregister(SoundSystemPtr)
-
-
-GetSoundSystem = _tml.GetSoundSystem
-class vectorString(_object):
-    __swig_setmethods__ = {}
-    __setattr__ = lambda self, name, value: _swig_setattr(self, vectorString, name, value)
-    __swig_getmethods__ = {}
-    __getattr__ = lambda self, name: _swig_getattr(self, vectorString, name)
-    def __repr__(self):
-        return "<C std::vector<(std::string)> instance at %s>" % (self.this,)
-    def __init__(self, *args):
-        _swig_setattr(self, vectorString, 'this', _tml.new_vectorString(*args))
-        _swig_setattr(self, vectorString, 'thisown', 1)
-    def __len__(*args): return _tml.vectorString___len__(*args)
-    def __nonzero__(*args): return _tml.vectorString___nonzero__(*args)
-    def clear(*args): return _tml.vectorString_clear(*args)
-    def append(*args): return _tml.vectorString_append(*args)
-    def pop(*args): return _tml.vectorString_pop(*args)
-    def __getitem__(*args): return _tml.vectorString___getitem__(*args)
-    def __getslice__(*args): return _tml.vectorString___getslice__(*args)
-    def __setitem__(*args): return _tml.vectorString___setitem__(*args)
-    def __setslice__(*args): return _tml.vectorString___setslice__(*args)
-    def __delitem__(*args): return _tml.vectorString___delitem__(*args)
-    def __delslice__(*args): return _tml.vectorString___delslice__(*args)
-    def __del__(self, destroy=_tml.delete_vectorString):
-        try:
-            if self.thisown: destroy(self)
-        except: pass
-
-class vectorStringPtr(vectorString):
-    def __init__(self, this):
-        _swig_setattr(self, vectorString, 'this', this)
-        if not hasattr(self,"thisown"): _swig_setattr(self, vectorString, 'thisown', 0)
-        _swig_setattr(self, vectorString,self.__class__,vectorString)
-_tml.vectorString_swigregister(vectorStringPtr)
-cvar = _tml.cvar
-
-
+# This file was created automatically by SWIG.
+# Don't modify this file, modify the SWIG interface instead.
+# This file is compatible with both classic and new-style classes.
+
+import _tml
+
+def _swig_setattr_nondynamic(self,class_type,name,value,static=1):
+    if (name == "this"):
+        if isinstance(value, class_type):
+            self.__dict__[name] = value.this
+            if hasattr(value,"thisown"): self.__dict__["thisown"] = value.thisown
+            del value.thisown
+            return
+    method = class_type.__swig_setmethods__.get(name,None)
+    if method: return method(self,value)
+    if (not static) or hasattr(self,name) or (name == "thisown"):
+        self.__dict__[name] = value
+    else:
+        raise AttributeError("You cannot add attributes to %s" % self)
+
+def _swig_setattr(self,class_type,name,value):
+    return _swig_setattr_nondynamic(self,class_type,name,value,0)
+
+def _swig_getattr(self,class_type,name):
+    method = class_type.__swig_getmethods__.get(name,None)
+    if method: return method(self)
+    raise AttributeError,name
+
+import types
+try:
+    _object = types.ObjectType
+    _newclass = 1
+except AttributeError:
+    class _object : pass
+    _newclass = 0
+del types
+
+
+class GameAction(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, GameAction, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, GameAction, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ GameAction instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["clean"] = lambda x: _tml.GameAction_clean
+    if _newclass:clean = staticmethod(_tml.GameAction_clean)
+    __swig_getmethods__["add_system"] = lambda x: _tml.GameAction_add_system
+    if _newclass:add_system = staticmethod(_tml.GameAction_add_system)
+    __swig_getmethods__["add_planet"] = lambda x: _tml.GameAction_add_planet
+    if _newclass:add_planet = staticmethod(_tml.GameAction_add_planet)
+    __swig_getmethods__["add_orbiter_station"] = lambda x: _tml.GameAction_add_orbiter_station
+    if _newclass:add_orbiter_station = staticmethod(_tml.GameAction_add_orbiter_station)
+    __swig_getmethods__["add_asteroid"] = lambda x: _tml.GameAction_add_asteroid
+    if _newclass:add_asteroid = staticmethod(_tml.GameAction_add_asteroid)
+    __swig_getmethods__["add_player"] = lambda x: _tml.GameAction_add_player
+    if _newclass:add_player = staticmethod(_tml.GameAction_add_player)
+    __swig_getmethods__["add_ship"] = lambda x: _tml.GameAction_add_ship
+    if _newclass:add_ship = staticmethod(_tml.GameAction_add_ship)
+    __swig_getmethods__["get_string_flag"] = lambda x: _tml.GameAction_get_string_flag
+    if _newclass:get_string_flag = staticmethod(_tml.GameAction_get_string_flag)
+    __swig_getmethods__["save_flag"] = lambda x: _tml.GameAction_save_flag
+    if _newclass:save_flag = staticmethod(_tml.GameAction_save_flag)
+    __swig_getmethods__["get_double_flag"] = lambda x: _tml.GameAction_get_double_flag
+    if _newclass:get_double_flag = staticmethod(_tml.GameAction_get_double_flag)
+    __swig_getmethods__["get_player_ship_id"] = lambda x: _tml.GameAction_get_player_ship_id
+    if _newclass:get_player_ship_id = staticmethod(_tml.GameAction_get_player_ship_id)
+    __swig_getmethods__["get_player_star_system"] = lambda x: _tml.GameAction_get_player_star_system
+    if _newclass:get_player_star_system = staticmethod(_tml.GameAction_get_player_star_system)
+    __swig_getmethods__["set_target"] = lambda x: _tml.GameAction_set_target
+    if _newclass:set_target = staticmethod(_tml.GameAction_set_target)
+    __swig_getmethods__["disable_weapon"] = lambda x: _tml.GameAction_disable_weapon
+    if _newclass:disable_weapon = staticmethod(_tml.GameAction_disable_weapon)
+    __swig_getmethods__["enable_weapon"] = lambda x: _tml.GameAction_enable_weapon
+    if _newclass:enable_weapon = staticmethod(_tml.GameAction_enable_weapon)
+    __swig_getmethods__["go_to_point"] = lambda x: _tml.GameAction_go_to_point
+    if _newclass:go_to_point = staticmethod(_tml.GameAction_go_to_point)
+    __swig_getmethods__["go_to_location"] = lambda x: _tml.GameAction_go_to_location
+    if _newclass:go_to_location = staticmethod(_tml.GameAction_go_to_location)
+    __swig_getmethods__["guard_location"] = lambda x: _tml.GameAction_guard_location
+    if _newclass:guard_location = staticmethod(_tml.GameAction_guard_location)
+    __swig_getmethods__["guard_point"] = lambda x: _tml.GameAction_guard_point
+    if _newclass:guard_point = staticmethod(_tml.GameAction_guard_point)
+    __swig_getmethods__["set_ship_team"] = lambda x: _tml.GameAction_set_ship_team
+    if _newclass:set_ship_team = staticmethod(_tml.GameAction_set_ship_team)
+    __swig_getmethods__["get_enemy_team"] = lambda x: _tml.GameAction_get_enemy_team
+    if _newclass:get_enemy_team = staticmethod(_tml.GameAction_get_enemy_team)
+    __swig_getmethods__["get_player_team"] = lambda x: _tml.GameAction_get_player_team
+    if _newclass:get_player_team = staticmethod(_tml.GameAction_get_player_team)
+    __swig_getmethods__["remove_location"] = lambda x: _tml.GameAction_remove_location
+    if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
+    __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
+    if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
+    __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
+    if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
+    __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
+    if _newclass:scroll_text = staticmethod(_tml.GameAction_scroll_text)
+    __swig_getmethods__["print_message"] = lambda x: _tml.GameAction_print_message
+    if _newclass:print_message = staticmethod(_tml.GameAction_print_message)
+    __swig_getmethods__["set_camera_mode"] = lambda x: _tml.GameAction_set_camera_mode
+    if _newclass:set_camera_mode = staticmethod(_tml.GameAction_set_camera_mode)
+    def __init__(self, *args):
+        _swig_setattr(self, GameAction, 'this', _tml.new_GameAction(*args))
+        _swig_setattr(self, GameAction, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_GameAction):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class GameActionPtr(GameAction):
+    def __init__(self, this):
+        _swig_setattr(self, GameAction, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, GameAction, 'thisown', 0)
+        _swig_setattr(self, GameAction,self.__class__,GameAction)
+_tml.GameAction_swigregister(GameActionPtr)
+
+GameAction_clean = _tml.GameAction_clean
+
+GameAction_add_system = _tml.GameAction_add_system
+
+GameAction_add_planet = _tml.GameAction_add_planet
+
+GameAction_add_orbiter_station = _tml.GameAction_add_orbiter_station
+
+GameAction_add_asteroid = _tml.GameAction_add_asteroid
+
+GameAction_add_player = _tml.GameAction_add_player
+
+GameAction_add_ship = _tml.GameAction_add_ship
+
+GameAction_get_string_flag = _tml.GameAction_get_string_flag
+
+GameAction_save_flag = _tml.GameAction_save_flag
+
+GameAction_get_double_flag = _tml.GameAction_get_double_flag
+
+GameAction_get_player_ship_id = _tml.GameAction_get_player_ship_id
+
+GameAction_get_player_star_system = _tml.GameAction_get_player_star_system
+
+GameAction_set_target = _tml.GameAction_set_target
+
+GameAction_disable_weapon = _tml.GameAction_disable_weapon
+
+GameAction_enable_weapon = _tml.GameAction_enable_weapon
+
+GameAction_go_to_point = _tml.GameAction_go_to_point
+
+GameAction_go_to_location = _tml.GameAction_go_to_location
+
+GameAction_guard_location = _tml.GameAction_guard_location
+
+GameAction_guard_point = _tml.GameAction_guard_point
+
+GameAction_set_ship_team = _tml.GameAction_set_ship_team
+
+GameAction_get_enemy_team = _tml.GameAction_get_enemy_team
+
+GameAction_get_player_team = _tml.GameAction_get_player_team
+
+GameAction_remove_location = _tml.GameAction_remove_location
+
+GameAction_set_crew = _tml.GameAction_set_crew
+
+GameAction_end_game = _tml.GameAction_end_game
+
+GameAction_scroll_text = _tml.GameAction_scroll_text
+
+GameAction_print_message = _tml.GameAction_print_message
+
+GameAction_set_camera_mode = _tml.GameAction_set_camera_mode
+
+class DialogApi(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, DialogApi, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, DialogApi, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ DialogApi instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["startDialog"] = lambda x: _tml.DialogApi_startDialog
+    if _newclass:startDialog = staticmethod(_tml.DialogApi_startDialog)
+    __swig_getmethods__["endDialog"] = lambda x: _tml.DialogApi_endDialog
+    if _newclass:endDialog = staticmethod(_tml.DialogApi_endDialog)
+    __swig_getmethods__["askPlayer"] = lambda x: _tml.DialogApi_askPlayer
+    if _newclass:askPlayer = staticmethod(_tml.DialogApi_askPlayer)
+    __swig_getmethods__["showText"] = lambda x: _tml.DialogApi_showText
+    if _newclass:showText = staticmethod(_tml.DialogApi_showText)
+    __swig_getmethods__["showAlienPicture"] = lambda x: _tml.DialogApi_showAlienPicture
+    if _newclass:showAlienPicture = staticmethod(_tml.DialogApi_showAlienPicture)
+    def __init__(self, *args):
+        _swig_setattr(self, DialogApi, 'this', _tml.new_DialogApi(*args))
+        _swig_setattr(self, DialogApi, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_DialogApi):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class DialogApiPtr(DialogApi):
+    def __init__(self, this):
+        _swig_setattr(self, DialogApi, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, DialogApi, 'thisown', 0)
+        _swig_setattr(self, DialogApi,self.__class__,DialogApi)
+_tml.DialogApi_swigregister(DialogApiPtr)
+
+DialogApi_startDialog = _tml.DialogApi_startDialog
+
+DialogApi_endDialog = _tml.DialogApi_endDialog
+
+DialogApi_askPlayer = _tml.DialogApi_askPlayer
+
+DialogApi_showText = _tml.DialogApi_showText
+
+DialogApi_showAlienPicture = _tml.DialogApi_showAlienPicture
+
+class GameConfig(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, GameConfig, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, GameConfig, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ GameConfig instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["SetGameDirectory"] = lambda x: _tml.GameConfig_SetGameDirectory
+    if _newclass:SetGameDirectory = staticmethod(_tml.GameConfig_SetGameDirectory)
+    __swig_getmethods__["GetGameDirectory"] = lambda x: _tml.GameConfig_GetGameDirectory
+    if _newclass:GetGameDirectory = staticmethod(_tml.GameConfig_GetGameDirectory)
+    __swig_getmethods__["GetAbsolutePath"] = lambda x: _tml.GameConfig_GetAbsolutePath
+    if _newclass:GetAbsolutePath = staticmethod(_tml.GameConfig_GetAbsolutePath)
+    def __init__(self, *args):
+        _swig_setattr(self, GameConfig, 'this', _tml.new_GameConfig(*args))
+        _swig_setattr(self, GameConfig, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_GameConfig):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class GameConfigPtr(GameConfig):
+    def __init__(self, this):
+        _swig_setattr(self, GameConfig, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, GameConfig, 'thisown', 0)
+        _swig_setattr(self, GameConfig,self.__class__,GameConfig)
+_tml.GameConfig_swigregister(GameConfigPtr)
+
+GameConfig_SetGameDirectory = _tml.GameConfig_SetGameDirectory
+
+GameConfig_GetGameDirectory = _tml.GameConfig_GetGameDirectory
+
+GameConfig_GetAbsolutePath = _tml.GameConfig_GetAbsolutePath
+
+class EventManager(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, EventManager, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, EventManager, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ EventManager instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    __swig_getmethods__["clean"] = lambda x: _tml.EventManager_clean
+    if _newclass:clean = staticmethod(_tml.EventManager_clean)
+    __swig_getmethods__["setSingleTimeEvent"] = lambda x: _tml.EventManager_setSingleTimeEvent
+    if _newclass:setSingleTimeEvent = staticmethod(_tml.EventManager_setSingleTimeEvent)
+    __swig_getmethods__["setRepeatableTimeEvent"] = lambda x: _tml.EventManager_setRepeatableTimeEvent
+    if _newclass:setRepeatableTimeEvent = staticmethod(_tml.EventManager_setRepeatableTimeEvent)
+    __swig_getmethods__["disableEvent"] = lambda x: _tml.EventManager_disableEvent
+    if _newclass:disableEvent = staticmethod(_tml.EventManager_disableEvent)
+    __swig_getmethods__["shipDeathById"] = lambda x: _tml.EventManager_shipDeathById
+    if _newclass:shipDeathById = staticmethod(_tml.EventManager_shipDeathById)
+    __swig_getmethods__["shipDeathByType"] = lambda x: _tml.EventManager_shipDeathByType
+    if _newclass:shipDeathByType = staticmethod(_tml.EventManager_shipDeathByType)
+    __swig_getmethods__["distanceMoreThen"] = lambda x: _tml.EventManager_distanceMoreThen
+    if _newclass:distanceMoreThen = staticmethod(_tml.EventManager_distanceMoreThen)
+    __swig_getmethods__["distanceLessThen"] = lambda x: _tml.EventManager_distanceLessThen
+    if _newclass:distanceLessThen = staticmethod(_tml.EventManager_distanceLessThen)
+    __swig_getmethods__["jumpToSystem"] = lambda x: _tml.EventManager_jumpToSystem
+    if _newclass:jumpToSystem = staticmethod(_tml.EventManager_jumpToSystem)
+    __swig_getmethods__["AddEventCondition"] = lambda x: _tml.EventManager_AddEventCondition
+    if _newclass:AddEventCondition = staticmethod(_tml.EventManager_AddEventCondition)
+    def __init__(self, *args):
+        _swig_setattr(self, EventManager, 'this', _tml.new_EventManager(*args))
+        _swig_setattr(self, EventManager, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_EventManager):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class EventManagerPtr(EventManager):
+    def __init__(self, this):
+        _swig_setattr(self, EventManager, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, EventManager, 'thisown', 0)
+        _swig_setattr(self, EventManager,self.__class__,EventManager)
+_tml.EventManager_swigregister(EventManagerPtr)
+
+EventManager_clean = _tml.EventManager_clean
+
+EventManager_setSingleTimeEvent = _tml.EventManager_setSingleTimeEvent
+
+EventManager_setRepeatableTimeEvent = _tml.EventManager_setRepeatableTimeEvent
+
+EventManager_disableEvent = _tml.EventManager_disableEvent
+
+EventManager_shipDeathById = _tml.EventManager_shipDeathById
+
+EventManager_shipDeathByType = _tml.EventManager_shipDeathByType
+
+EventManager_distanceMoreThen = _tml.EventManager_distanceMoreThen
+
+EventManager_distanceLessThen = _tml.EventManager_distanceLessThen
+
+EventManager_jumpToSystem = _tml.EventManager_jumpToSystem
+
+EventManager_AddEventCondition = _tml.EventManager_AddEventCondition
+
+class SoundSystem(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, SoundSystem, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, SoundSystem, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ SoundSystem instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    def __init__(self, *args):
+        _swig_setattr(self, SoundSystem, 'this', _tml.new_SoundSystem(*args))
+        _swig_setattr(self, SoundSystem, 'thisown', 1)
+    def __del__(self, destroy=_tml.delete_SoundSystem):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+    def play_music(*args): return _tml.SoundSystem_play_music(*args)
+    def play_sound(*args): return _tml.SoundSystem_play_sound(*args)
+    def stop_sound(*args): return _tml.SoundSystem_stop_sound(*args)
+    def set_music_volume(*args): return _tml.SoundSystem_set_music_volume(*args)
+    def set_sound_volume(*args): return _tml.SoundSystem_set_sound_volume(*args)
+    def load_music_volume(*args): return _tml.SoundSystem_load_music_volume(*args)
+    def load_sound_volume(*args): return _tml.SoundSystem_load_sound_volume(*args)
+    def playing_music(*args): return _tml.SoundSystem_playing_music(*args)
+    def playing_music_file(*args): return _tml.SoundSystem_playing_music_file(*args)
+
+class SoundSystemPtr(SoundSystem):
+    def __init__(self, this):
+        _swig_setattr(self, SoundSystem, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, SoundSystem, 'thisown', 0)
+        _swig_setattr(self, SoundSystem,self.__class__,SoundSystem)
+_tml.SoundSystem_swigregister(SoundSystemPtr)
+
+
+GetSoundSystem = _tml.GetSoundSystem
+class vectorString(_object):
+    __swig_setmethods__ = {}
+    __setattr__ = lambda self, name, value: _swig_setattr(self, vectorString, name, value)
+    __swig_getmethods__ = {}
+    __getattr__ = lambda self, name: _swig_getattr(self, vectorString, name)
+    def __repr__(self):
+        return "<%s.%s; proxy of C++ std::vector<std::string > instance at %s>" % (self.__class__.__module__, self.__class__.__name__, self.this,)
+    def empty(*args): return _tml.vectorString_empty(*args)
+    def size(*args): return _tml.vectorString_size(*args)
+    def clear(*args): return _tml.vectorString_clear(*args)
+    def swap(*args): return _tml.vectorString_swap(*args)
+    def get_allocator(*args): return _tml.vectorString_get_allocator(*args)
+    def pop_back(*args): return _tml.vectorString_pop_back(*args)
+    def __init__(self, *args):
+        _swig_setattr(self, vectorString, 'this', _tml.new_vectorString(*args))
+        _swig_setattr(self, vectorString, 'thisown', 1)
+    def push_back(*args): return _tml.vectorString_push_back(*args)
+    def front(*args): return _tml.vectorString_front(*args)
+    def back(*args): return _tml.vectorString_back(*args)
+    def assign(*args): return _tml.vectorString_assign(*args)
+    def resize(*args): return _tml.vectorString_resize(*args)
+    def reserve(*args): return _tml.vectorString_reserve(*args)
+    def capacity(*args): return _tml.vectorString_capacity(*args)
+    def __nonzero__(*args): return _tml.vectorString___nonzero__(*args)
+    def __len__(*args): return _tml.vectorString___len__(*args)
+    def pop(*args): return _tml.vectorString_pop(*args)
+    def __getslice__(*args): return _tml.vectorString___getslice__(*args)
+    def __setslice__(*args): return _tml.vectorString___setslice__(*args)
+    def __delslice__(*args): return _tml.vectorString___delslice__(*args)
+    def __delitem__(*args): return _tml.vectorString___delitem__(*args)
+    def __getitem__(*args): return _tml.vectorString___getitem__(*args)
+    def __setitem__(*args): return _tml.vectorString___setitem__(*args)
+    def append(*args): return _tml.vectorString_append(*args)
+    def __del__(self, destroy=_tml.delete_vectorString):
+        try:
+            if self.thisown: destroy(self)
+        except: pass
+
+
+class vectorStringPtr(vectorString):
+    def __init__(self, this):
+        _swig_setattr(self, vectorString, 'this', this)
+        if not hasattr(self,"thisown"): _swig_setattr(self, vectorString, 'thisown', 0)
+        _swig_setattr(self, vectorString,self.__class__,vectorString)
+_tml.vectorString_swigregister(vectorStringPtr)
+cvar = _tml.cvar
+
+

Modified: trunk/source/generated/tml_wrap.cpp
===================================================================
--- trunk/source/generated/tml_wrap.cpp	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/generated/tml_wrap.cpp	2005-08-15 19:18:30 UTC (rev 180)
@@ -1,6 +1,6 @@
 /* ----------------------------------------------------------------------------
  * This file was automatically generated by SWIG (http://www.swig.org).
- * Version 1.3.24
+ * Version 1.3.25
  * 
  * This file is not intended to be easily readable and contains a number of 
  * coding conventions designed to improve portability and efficiency. Do not make
@@ -26,16 +26,74 @@
 };
 #endif
 
+/***********************************************************************
+ *
+ *  This section contains generic SWIG labels for method/variable
+ *  declarations/attributes, and other compiler dependent labels.
+ *
+ ************************************************************************/
 
-#ifndef SWIG_TEMPLATE_DISAMBIGUATOR
-#  if defined(__SUNPRO_CC) 
-#    define SWIG_TEMPLATE_DISAMBIGUATOR template
+/* template workaround for compilers that cannot correctly implement the C++ standard */
+#ifndef SWIGTEMPLATEDISAMBIGUATOR
+#  if defined(__SUNPRO_CC) && (__SUNPRO_CC <= 0x560)
+#    define SWIGTEMPLATEDISAMBIGUATOR template
 #  else
-#    define SWIG_TEMPLATE_DISAMBIGUATOR 
+#    define SWIGTEMPLATEDISAMBIGUATOR 
 #  endif
 #endif
 
+/* inline attribute */
+#ifndef SWIGINLINE
+# if defined(__cplusplus) || (defined(__GNUC__) && !defined(__STRICT_ANSI__))
+#   define SWIGINLINE inline
+# else
+#   define SWIGINLINE
+# endif
+#endif
 
+/* attribute recognised by some compilers to avoid 'unused' warnings */
+#ifndef SWIGUNUSED
+# if defined(__GNUC__) || defined(__ICC)
+#   define SWIGUNUSED __attribute__ ((unused)) 
+# else
+#   define SWIGUNUSED 
+# endif
+#endif
+
+/* internal SWIG method */
+#ifndef SWIGINTERN
+# define SWIGINTERN static SWIGUNUSED
+#endif
+
+/* internal inline SWIG method */
+#ifndef SWIGINTERNINLINE
+# define SWIGINTERNINLINE SWIGINTERN SWIGINLINE
+#endif
+
+/* exporting methods for Windows DLLs */
+#ifndef SWIGEXPORT
+# if defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__)
+#   if defined(STATIC_LINKED)
+#     define SWIGEXPORT
+#   else
+#     define SWIGEXPORT __declspec(dllexport)
+#   endif
+# else
+#   define SWIGEXPORT
+# endif
+#endif
+
+/* calling conventions for Windows */
+#ifndef SWIGSTDCALL
+# if defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__)
+#   define SWIGSTDCALL __stdcall
+# else
+#   define SWIGSTDCALL
+# endif 
+#endif
+
+
+
 #include <Python.h>
 
 /***********************************************************************
@@ -48,27 +106,17 @@
 
 /* This should only be incremented when either the layout of swig_type_info changes,
    or for whatever reason, the runtime changes incompatibly */
-#define SWIG_RUNTIME_VERSION "1"
+#define SWIG_RUNTIME_VERSION "2"
 
 /* define SWIG_TYPE_TABLE_NAME as "SWIG_TYPE_TABLE" */
 #ifdef SWIG_TYPE_TABLE
-#define SWIG_QUOTE_STRING(x) #x
-#define SWIG_EXPAND_AND_QUOTE_STRING(x) SWIG_QUOTE_STRING(x)
-#define SWIG_TYPE_TABLE_NAME SWIG_EXPAND_AND_QUOTE_STRING(SWIG_TYPE_TABLE)
+# define SWIG_QUOTE_STRING(x) #x
+# define SWIG_EXPAND_AND_QUOTE_STRING(x) SWIG_QUOTE_STRING(x)
+# define SWIG_TYPE_TABLE_NAME SWIG_EXPAND_AND_QUOTE_STRING(SWIG_TYPE_TABLE)
 #else
-#define SWIG_TYPE_TABLE_NAME
+# define SWIG_TYPE_TABLE_NAME
 #endif
 
-#include <string.h>
-
-#ifndef SWIGINLINE
-#if defined(__cplusplus) || (defined(__GNUC__) && !defined(__STRICT_ANSI__))
-#  define SWIGINLINE inline
-#else
-#  define SWIGINLINE
-#endif
-#endif
-
 /*
   You can use the SWIGRUNTIME and SWIGRUNTIMEINLINE macros for
   creating a static or dynamic library from the swig runtime code.
@@ -77,13 +125,17 @@
   But only do this if is strictly necessary, ie, if you have problems
   with your compiler or so.
 */
+
 #ifndef SWIGRUNTIME
-#define SWIGRUNTIME static
+# define SWIGRUNTIME SWIGINTERN
 #endif
+
 #ifndef SWIGRUNTIMEINLINE
-#define SWIGRUNTIMEINLINE SWIGRUNTIME SWIGINLINE
+# define SWIGRUNTIMEINLINE SWIGRUNTIME SWIGINLINE
 #endif
 
+#include <string.h>
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -91,16 +143,36 @@
 typedef void *(*swig_converter_func)(void *);
 typedef struct swig_type_info *(*swig_dycast_func)(void **);
 
+/* Structure to store inforomation on one type */
 typedef struct swig_type_info {
-  const char             *name;
-  swig_converter_func     converter;
-  const char             *str;
-  void                   *clientdata;
-  swig_dycast_func        dcast;
-  struct swig_type_info  *next;
-  struct swig_type_info  *prev;
+  const char             *name;			/* mangled name of this type */
+  const char             *str;			/* human readable name of this type */
+  swig_dycast_func        dcast;		/* dynamic cast function down a hierarchy */
+  struct swig_cast_info  *cast;			/* linked list of types that can cast into this type */
+  void                   *clientdata;		/* language specific type data */
 } swig_type_info;
 
+/* Structure to store a type and conversion function used for casting */
+typedef struct swig_cast_info {
+  swig_type_info         *type;			/* pointer to type that is equivalent to this type */
+  swig_converter_func     converter;		/* function to cast the void pointers */
+  struct swig_cast_info  *next;			/* pointer to next cast in linked list */
+  struct swig_cast_info  *prev;			/* pointer to the previous cast */
+} swig_cast_info;
+
+/* Structure used to store module information
+ * Each module generates one structure like this, and the runtime collects
+ * all of these structures and stores them in a circularly linked list.*/
+typedef struct swig_module_info {
+  swig_type_info         **types;		/* Array of pointers to swig_type_info structures that are in this module */
+  size_t                 size;		        /* Number of types in this module */
+  struct swig_module_info *next;		/* Pointer to next element in circularly linked list */
+  swig_type_info         **type_initial;	/* Array of initially generated type structures */
+  swig_cast_info         **cast_initial;	/* Array of initially generated casting structures */
+  void                    *clientdata;		/* Language specific module data */
+} swig_module_info;
+
+
 /* 
   Compare two type names skipping the space characters, therefore
   "char*" == "char *" and "Class<int>" == "Class<int >", etc.
@@ -114,13 +186,14 @@
   for (;(f1 != l1) && (f2 != l2); ++f1, ++f2) {
     while ((*f1 == ' ') && (f1 != l1)) ++f1;
     while ((*f2 == ' ') && (f2 != l2)) ++f2;
-    if (*f1 != *f2) return *f1 - *f2;
+    if (*f1 != *f2) return (int)(*f1 - *f2);
   }
   return (l1 - f1) - (l2 - f2);
 }
 
 /*
   Check type equivalence in a name list like <name1>|<name2>|...
+  Return 0 if not equal, 1 if equal
 */
 SWIGRUNTIME int
 SWIG_TypeEquiv(const char *nb, const char *tb) {
@@ -131,96 +204,73 @@
     for (nb = ne; *ne; ++ne) {
       if (*ne == '|') break;
     }
-    equiv = SWIG_TypeNameComp(nb, ne, tb, te) == 0;
+    equiv = (SWIG_TypeNameComp(nb, ne, tb, te) == 0) ? 1 : 0;
     if (*ne) ++ne;
   }
   return equiv;
 }
 
 /*
-  Register a type mapping with the type-checking
+  Check type equivalence in a name list like <name1>|<name2>|...
+  Return 0 if equal, -1 if nb < tb, 1 if nb > tb
 */
-SWIGRUNTIME swig_type_info *
-SWIG_TypeRegisterTL(swig_type_info **tl, swig_type_info *ti) {
-  swig_type_info *tc, *head, *ret, *next;
-  /* Check to see if this type has already been registered */
-  tc = *tl;
-  while (tc) {
-    /* check simple type equivalence */
-    int typeequiv = (strcmp(tc->name, ti->name) == 0);   
-    /* check full type equivalence, resolving typedefs */
-    if (!typeequiv) {
-      /* only if tc is not a typedef (no '|' on it) */
-      if (tc->str && ti->str && !strstr(tc->str,"|")) {
-	typeequiv = SWIG_TypeEquiv(ti->str,tc->str);
-      }
+SWIGRUNTIME int
+SWIG_TypeCompare(const char *nb, const char *tb) {
+  int equiv = 0;
+  const char* te = tb + strlen(tb);
+  const char* ne = nb;
+  while (!equiv && *ne) {
+    for (nb = ne; *ne; ++ne) {
+      if (*ne == '|') break;
     }
-    if (typeequiv) {
-      /* Already exists in the table.  Just add additional types to the list */
-      if (ti->clientdata) tc->clientdata = ti->clientdata;
-      head = tc;
-      next = tc->next;
-      goto l1;
-    }
-    tc = tc->prev;
+    equiv = (SWIG_TypeNameComp(nb, ne, tb, te) == 0) ? 1 : 0;
+    if (*ne) ++ne;
   }
-  head = ti;
-  next = 0;
+  return equiv;
+}
 
-  /* Place in list */
-  ti->prev = *tl;
-  *tl = ti;
 
-  /* Build linked lists */
-  l1:
-  ret = head;
-  tc = ti + 1;
-  /* Patch up the rest of the links */
-  while (tc->name) {
-    head->next = tc;
-    tc->prev = head;
-    head = tc;
-    tc++;
-  }
-  if (next) next->prev = head;
-  head->next = next;
+/* think of this as a c++ template<> or a scheme macro */
+#define SWIG_TypeCheck_Template(comparison, ty)         \
+  if (ty) {                                             \
+    swig_cast_info *iter = ty->cast;                    \
+    while (iter) {                                      \
+      if (comparison) {                                 \
+        if (iter == ty->cast) return iter;              \
+        /* Move iter to the top of the linked list */   \
+        iter->prev->next = iter->next;                  \
+        if (iter->next)                                 \
+          iter->next->prev = iter->prev;                \
+        iter->next = ty->cast;                          \
+        iter->prev = 0;                                 \
+        if (ty->cast) ty->cast->prev = iter;            \
+        ty->cast = iter;                                \
+        return iter;                                    \
+      }                                                 \
+      iter = iter->next;                                \
+    }                                                   \
+  }                                                     \
+  return 0
 
-  return ret;
-}
-
 /*
   Check the typename
 */
-SWIGRUNTIME swig_type_info *
+SWIGRUNTIME swig_cast_info *
 SWIG_TypeCheck(const char *c, swig_type_info *ty) {
-  swig_type_info *s;
-  if (!ty) return 0;        /* Void pointer */
-  s = ty->next;             /* First element always just a name */
-  do {
-    if (strcmp(s->name,c) == 0) {
-      if (s == ty->next) return s;
-      /* Move s to the top of the linked list */
-      s->prev->next = s->next;
-      if (s->next) {
-        s->next->prev = s->prev;
-      }
-      /* Insert s as second element in the list */
-      s->next = ty->next;
-      if (ty->next) ty->next->prev = s;
-      ty->next = s;
-      s->prev = ty;
-      return s;
-    }
-    s = s->next;
-  } while (s && (s != ty->next));
-  return 0;
+  SWIG_TypeCheck_Template(strcmp(iter->type->name, c) == 0, ty);
 }
 
+/* Same as previous function, except strcmp is replaced with a pointer comparison */
+SWIGRUNTIME swig_cast_info *
+SWIG_TypeCheckStruct(swig_type_info *from, swig_type_info *into) {
+  SWIG_TypeCheck_Template(iter->type == from, into);
+}
+
 /*
   Cast a pointer up an inheritance hierarchy
 */
 SWIGRUNTIMEINLINE void *
-SWIG_TypeCast(swig_type_info *ty, void *ptr) {
+SWIG_TypeCast(swig_cast_info *ty, void *ptr) {
   return ((!ty) || (!ty->converter)) ? ptr : (*ty->converter)(ptr);
 }
 
@@ -267,54 +317,114 @@
     return type->name;
 }
 
+/* 
+   Set the clientdata field for a type
+*/
+SWIGRUNTIME void
+SWIG_TypeClientData(swig_type_info *ti, void *clientdata) {
+  if (!ti->clientdata) {
+    swig_cast_info *cast = ti->cast;
+    /* if (ti->clientdata == clientdata) return; */
+    ti->clientdata = clientdata;
+    
+    while (cast) {
+      if (!cast->converter)
+	SWIG_TypeClientData(cast->type, clientdata);
+      cast = cast->next;
+    }
+  }
+}
+
 /*
-  Search for a swig_type_info structure
+  Search for a swig_type_info structure only by mangled name
+  Search is a O(log #types)
+  
+  We start searching at module start, and finish searching when start == end.  
+  Note: if start == end at the beginning of the function, we go all the way around
+  the circular list.
 */
 SWIGRUNTIME swig_type_info *
-SWIG_TypeQueryTL(swig_type_info *tl, const char *name) {
-  swig_type_info *ty = tl;
-  while (ty) {
-    if (ty->str && (SWIG_TypeEquiv(ty->str,name))) return ty;
-    if (ty->name && (strcmp(name,ty->name) == 0)) return ty;
-    ty = ty->prev;
-  }
+SWIG_MangledTypeQueryModule(swig_module_info *start, 
+                            swig_module_info *end, 
+		            const char *name) {
+  swig_module_info *iter = start;
+  do {
+    if (iter->size) {
+      register size_t l = 0;
+      register size_t r = iter->size - 1;
+      do {
+	/* since l+r >= 0, we can (>> 1) instead (/ 2) */
+	register size_t i = (l + r) >> 1; 
+	const char *iname = iter->types[i]->name;
+	if (iname) {
+	  register int compare = strcmp(name, iname);
+	  if (compare == 0) {	    
+	    return iter->types[i];
+	  } else if (compare < 0) {
+	    if (i) {
+	      r = i - 1;
+	    } else {
+	      break;
+	    }
+	  } else if (compare > 0) {
+	    l = i + 1;
+	  }
+	} else {
+	  break; /* should never happen */
+	}
+      } while (l <= r);
+    }
+    iter = iter->next;
+  } while (iter != end);
   return 0;
 }
 
-/* 
-   Set the clientdata field for a type
+/*
+  Search for a swig_type_info structure for either a mangled name or a human readable name.
+  It first searches the mangled names of the types, which is a O(log #types)
+  If a type is not found it then searches the human readable names, which is O(#types).
+  
+  We start searching at module start, and finish searching when start == end.  
+  Note: if start == end at the beginning of the function, we go all the way around
+  the circular list.
 */
-SWIGRUNTIME void
-SWIG_TypeClientDataTL(swig_type_info *tl, swig_type_info *ti, void *clientdata) {
-  swig_type_info *tc, *equiv;
-  if (ti->clientdata) return;
-  /* if (ti->clientdata == clientdata) return; */
-  ti->clientdata = clientdata;
-  equiv = ti->next;
-  while (equiv) {
-    if (!equiv->converter) {
-      tc = tl;
-      while (tc) {
-        if ((strcmp(tc->name, equiv->name) == 0))
-          SWIG_TypeClientDataTL(tl,tc,clientdata);
-        tc = tc->prev;
+SWIGRUNTIME swig_type_info *
+SWIG_TypeQueryModule(swig_module_info *start, 
+                     swig_module_info *end, 
+		     const char *name) {
+  /* STEP 1: Search the name field using binary search */
+  swig_type_info *ret = SWIG_MangledTypeQueryModule(start, end, name);
+  if (ret) {
+    return ret;
+  } else {
+    /* STEP 2: If the type hasn't been found, do a complete search
+       of the str field (the human readable name) */
+    swig_module_info *iter = start;
+    do {
+      register size_t i = 0;
+      for (; i < iter->size; ++i) {
+	if (iter->types[i]->str && (SWIG_TypeEquiv(iter->types[i]->str, name)))
+	  return iter->types[i];
       }
-    }
-    equiv = equiv->next;
+      iter = iter->next;
+    } while (iter != end);
   }
+  
+  /* neither found a match */
+  return 0;
 }
 
+
 /* 
    Pack binary data into a string
 */
 SWIGRUNTIME char *
 SWIG_PackData(char *c, void *ptr, size_t sz) {
-  static char hex[17] = "0123456789abcdef";
-  unsigned char *u = (unsigned char *) ptr;
-  const unsigned char *eu =  u + sz;
-  register unsigned char uu;
+  static const char hex[17] = "0123456789abcdef";
+  register const unsigned char *u = (unsigned char *) ptr;
+  register const unsigned char *eu =  u + sz;
   for (; u != eu; ++u) {
-    uu = *u;
+    register unsigned char uu = *u;
     *(c++) = hex[(uu & 0xf0) >> 4];
     *(c++) = hex[uu & 0xf];
   }
@@ -327,9 +437,9 @@
 SWIGRUNTIME const char *
 SWIG_UnpackData(const char *c, void *ptr, size_t sz) {
   register unsigned char *u = (unsigned char *) ptr;
-  register const unsigned char *eu =  u + sz;
+  register const unsigned char *eu = u + sz;
   for (; u != eu; ++u) {
-    register int d = *(c++);
+    register char d = *(c++);
     register unsigned char uu = 0;
     if ((d >= '0') && (d <= '9'))
       uu = ((d - '0') << 4);
@@ -349,30 +459,6 @@
   return c;
 }
 
-/*
-  This function will propagate the clientdata field of type to any new
-  swig_type_info structures that have been added into the list of
-  equivalent types.  It is like calling SWIG_TypeClientData(type,
-  clientdata) a second time.
-*/
-SWIGRUNTIME void
-SWIG_PropagateClientDataTL(swig_type_info *tl, swig_type_info *type) {
-  swig_type_info *equiv = type->next;
-  swig_type_info *tc;
-  if (!type->clientdata) return;
-  while (equiv) {
-    if (!equiv->converter) {
-      tc = tl;
-      while (tc) {
-        if ((strcmp(tc->name, equiv->name) == 0) && !tc->clientdata)
-          SWIG_TypeClientDataTL(tl,tc, type->clientdata);
-        tc = tc->prev;
-      }
-    }
-    equiv = equiv->next;
-  }
-}
-
 /* 
    Pack 'void *' into a string buffer.
 */
@@ -432,78 +518,6 @@
 }
 #endif
 
-/***********************************************************************
- * common.swg
- *
- *     This file contains generic SWIG runtime support for pointer
- *     type checking as well as a few commonly used macros to control
- *     external linkage.
- *
- * Author : David Beazley (beazley at cs.uchicago.edu)
- *
- * Copyright (c) 1999-2000, The University of Chicago
- * 
- * This file may be freely redistributed without license or fee provided
- * this copyright message remains intact.
- ************************************************************************/
-
-
-#if defined(_WIN32) || defined(__WIN32__) || defined(__CYGWIN__)
-#  if !defined(STATIC_LINKED)
-#    define SWIGEXPORT(a) __declspec(dllexport) a
-#  else
-#    define SWIGEXPORT(a) a
-#  endif
-#else
-#  define SWIGEXPORT(a) a
-#endif
-
-#ifdef __cplusplus
-extern "C" {
-#endif
-
-
-/*************************************************************************/
-
-
-/* The static type info list */
-
-static swig_type_info *swig_type_list = 0;
-static swig_type_info **swig_type_list_handle = &swig_type_list;
-  
-
-/* Register a type mapping with the type-checking */
-static swig_type_info *
-SWIG_TypeRegister(swig_type_info *ti) {
-  return SWIG_TypeRegisterTL(swig_type_list_handle, ti);
-}
-
-/* Search for a swig_type_info structure */
-static swig_type_info *
-SWIG_TypeQuery(const char *name) {
-  return SWIG_TypeQueryTL(*swig_type_list_handle, name);
-}
-
-/* Set the clientdata field for a type */
-static void
-SWIG_TypeClientData(swig_type_info *ti, void *clientdata) {
-  SWIG_TypeClientDataTL(*swig_type_list_handle, ti, clientdata);
-}
-
-/* This function will propagate the clientdata field of type to
-* any new swig_type_info structures that have been added into the list
-* of equivalent types.  It is like calling
-* SWIG_TypeClientData(type, clientdata) a second time.
-*/
-static void
-SWIG_PropagateClientData(swig_type_info *type) {
-  SWIG_PropagateClientDataTL(*swig_type_list_handle, type);
-}
-
-#ifdef __cplusplus
-}
-#endif
-
 /* -----------------------------------------------------------------------------
  * SWIG API. Portion that goes into the runtime
  * ----------------------------------------------------------------------------- */
@@ -517,18 +531,13 @@
  * ----------------------------------------------------------------------------- */
 
 #ifndef SWIGINTERN
-#define SWIGINTERN static 
+#  define SWIGINTERN static SWIGUNUSED
 #endif
 
-#ifndef SWIGINTERNSHORT
-#ifdef __cplusplus
-#define SWIGINTERNSHORT static inline 
-#else /* C case */
-#define SWIGINTERNSHORT static 
-#endif /* __cplusplus */
+#ifndef SWIGINTERNINLINE
+#  define SWIGINTERNINLINE SWIGINTERN SWIGINLINE
 #endif
 
-
 /*
   Exception handling in wrappers
 */
@@ -599,6 +608,9 @@
 #define SWIG_ConvertPacked(obj, ptr, sz, ty, flags)   SWIG_Python_ConvertPacked(obj, ptr, sz, ty, flags)
 #define SWIG_NewPackedObj(ptr, sz, type)              SWIG_Python_NewPackedObj(ptr, sz, type)
 
+/* Runtime API */
+#define SWIG_GetModule(clientdata) SWIG_Python_GetModule()
+#define SWIG_SetModule(clientdata, pointer) SWIG_Python_SetModule(pointer)
 
 /* -----------------------------------------------------------------------------
  * Pointer declarations
@@ -617,6 +629,11 @@
 #define SWIG_POINTER_DISOWN        0x2
 
 
+/* Add PyOS_snprintf for old Pythons */
+#if PY_VERSION_HEX < 0x02020000
+#define PyOS_snprintf snprintf
+#endif
+
 #ifdef __cplusplus
 extern "C" {
 #endif
@@ -624,7 +641,6 @@
 /* -----------------------------------------------------------------------------
  * Create a new pointer string 
  * ----------------------------------------------------------------------------- */
-
 #ifndef SWIG_BUFFER_SIZE
 #define SWIG_BUFFER_SIZE 1024
 #endif
@@ -647,6 +663,7 @@
 PySwigObject_print(PySwigObject *v, FILE *fp, int flags)
 {
   char result[SWIG_BUFFER_SIZE];
+  flags = flags;
   if (SWIG_PackVoidPtr(result, v->ptr, v->desc, sizeof(result))) {
     fputs("<Swig Object at ", fp); fputs(result, fp); fputs(">", fp);
     return 0; 
@@ -674,27 +691,35 @@
 SWIGRUNTIME PyObject *
 PySwigObject_long(PySwigObject *v)
 {
-  return PyLong_FromUnsignedLong((unsigned long) v->ptr);
+  return PyLong_FromVoidPtr(v->ptr);
 }
 
 SWIGRUNTIME PyObject *
+PySwigObject_format(const char* fmt, PySwigObject *v)
+{
+  PyObject *res = NULL;
+  PyObject *args = PyTuple_New(1);
+  if (args && (PyTuple_SetItem(args, 0, PySwigObject_long(v)) == 0)) {
+    PyObject *ofmt = PyString_FromString(fmt);
+    if (ofmt) {
+      res = PyString_Format(ofmt,args);
+      Py_DECREF(ofmt);
+    }
+    Py_DECREF(args);
+  }  
+  return res;
+}
+
+SWIGRUNTIME PyObject *
 PySwigObject_oct(PySwigObject *v)
 {
-  char buf[100];
-  unsigned long x = (unsigned long)v->ptr;
-  if (x == 0)
-    strcpy(buf, "0");
-  else
-    PyOS_snprintf(buf, sizeof(buf), "0%lo", x);
-  return PyString_FromString(buf);
+  return PySwigObject_format("%o",v);
 }
 
 SWIGRUNTIME PyObject *
 PySwigObject_hex(PySwigObject *v)
 {
-  char buf[100];
-  PyOS_snprintf(buf, sizeof(buf), "0x%lx", (unsigned long)v->ptr);
-  return PyString_FromString(buf);
+  return PySwigObject_format("%x",v);
 }
 
 SWIGRUNTIME int
@@ -702,11 +727,11 @@
 {
   int c = strcmp(v->desc, w->desc);
   if (c) {
-    return c;
+    return (c > 0) ? 1 : -1;
   } else {
     void *i = v->ptr;
     void *j = w->ptr;
-    return (i < j) ? -1 : (i > j) ? 1 : 0;
+    return (i < j) ? -1 : ((i > j) ? 1 : 0);
   }
 }
 
@@ -717,8 +742,8 @@
 }
 
 SWIGRUNTIME PyTypeObject*
-PySwigObject_GetType() {
-  static char PySwigObject_Type__doc__[] = 
+PySwigObject_type(void) {
+  static char pyswigobject_type__doc__[] = 
     "Swig object carries a C/C++ instance pointer";
   
   static PyNumberMethods PySwigObject_as_number = {
@@ -750,14 +775,17 @@
 #endif
   };
 
-  static int type_init = 0;  
-  static PyTypeObject PySwigObject_Type;
-
+  static PyTypeObject pyswigobject_type
+#if !defined(__cplusplus)
+  ;  
+  static int type_init = 0;
   if (!type_init) {
-    PyTypeObject tmp = {
+    PyTypeObject tmp
+#endif
+    = {
     PyObject_HEAD_INIT(&PyType_Type)
     0,					/*ob_size*/
-    "PySwigObject",			/*tp_name*/
+    (char *)"PySwigObject",		/*tp_name*/
     sizeof(PySwigObject),		/*tp_basicsize*/
     0,					/*tp_itemsize*/
     /* methods */
@@ -774,8 +802,8 @@
     (ternaryfunc)0,			/*tp_call*/
     (reprfunc)PySwigObject_str,		/*tp_str*/
     /* Space for future expansion */
-    0L,0L,0L,0L,
-    PySwigObject_Type__doc__, 	        /* Documentation string */
+    0,0,0,0,
+    pyswigobject_type__doc__, 	        /* Documentation string */
 #if PY_VERSION_HEX >= 0x02000000
     0,                                  /* tp_traverse */
     0,                                  /* tp_clear */
@@ -794,21 +822,22 @@
     0,0,0,0                             /* tp_alloc -> tp_next */
 #endif
     };
-
-    PySwigObject_Type = tmp;
+#if !defined(__cplusplus)
+    pyswigobject_type = tmp;
     type_init = 1;
   }
-
-  return &PySwigObject_Type;
+#endif
+  return &pyswigobject_type;
 }
 
 SWIGRUNTIME PyObject *
 PySwigObject_FromVoidPtrAndDesc(void *ptr, const char *desc)
 {
-  PySwigObject *self = PyObject_NEW(PySwigObject, PySwigObject_GetType());
-  if (self == NULL) return NULL;
-  self->ptr = ptr;
-  self->desc = desc;
+  PySwigObject *self = PyObject_NEW(PySwigObject, PySwigObject_type());
+  if (self) {
+    self->ptr = ptr;
+    self->desc = desc;
+  }
   return (PyObject *)self;
 }
 
@@ -826,7 +855,7 @@
 
 SWIGRUNTIMEINLINE int
 PySwigObject_Check(PyObject *op) {
-  return ((op)->ob_type == PySwigObject_GetType()) 
+  return ((op)->ob_type == PySwigObject_type()) 
     || (strcmp((op)->ob_type->tp_name,"PySwigObject") == 0);
 }
 
@@ -845,6 +874,7 @@
 PySwigPacked_print(PySwigPacked *v, FILE *fp, int flags)
 {
   char result[SWIG_BUFFER_SIZE];
+  flags = flags;
   fputs("<Swig Packed ", fp); 
   if (SWIG_PackDataName(result, v->pack, v->size, 0, sizeof(result))) {
     fputs("at ", fp); 
@@ -882,11 +912,11 @@
 {
   int c = strcmp(v->desc, w->desc);
   if (c) {
-    return c;
+    return (c > 0) ? 1 : -1;
   } else {
     size_t i = v->size;
     size_t j = w->size;
-    int s = (i < j) ? -1 : (i > j) ? 1 : 0;
+    int s = (i < j) ? -1 : ((i > j) ? 1 : 0);
     return s ? s : strncmp((char *)v->pack, (char *)w->pack, 2*v->size);
   }
 }
@@ -899,17 +929,20 @@
 }
 
 SWIGRUNTIME PyTypeObject*
-PySwigPacked_GetType() {
-  static char PySwigPacked_Type__doc__[] = 
+PySwigPacked_type(void) {
+  static char pyswigpacked_type__doc__[] = 
     "Swig object carries a C/C++ instance pointer";
-  static int type_init = 0;
-  
-  static PyTypeObject PySwigPacked_Type;
+  static PyTypeObject pyswigpacked_type
+#if !defined(__cplusplus)
+  ;
+  static int type_init = 0;  
   if (!type_init) {
-    PyTypeObject tmp = {
+    PyTypeObject tmp
+#endif
+    = {
     PyObject_HEAD_INIT(&PyType_Type)
     0,					/*ob_size*/
-    "PySwigPacked",			/*tp_name*/
+    (char *)"PySwigPacked",		/*tp_name*/
     sizeof(PySwigPacked),		/*tp_basicsize*/
     0,					/*tp_itemsize*/
     /* methods */
@@ -926,8 +959,8 @@
     (ternaryfunc)0,			/*tp_call*/
     (reprfunc)PySwigPacked_str,		/*tp_str*/
     /* Space for future expansion */
-    0L,0L,0L,0L,
-    PySwigPacked_Type__doc__, 	        /* Documentation string */
+    0,0,0,0,
+    pyswigpacked_type__doc__, 	        /* Documentation string */
 #if PY_VERSION_HEX >= 0x02000000
     0,                                  /* tp_traverse */
     0,                                  /* tp_clear */
@@ -946,29 +979,30 @@
     0,0,0,0                             /* tp_alloc -> tp_next */
 #endif
     };
-
-    PySwigPacked_Type = tmp;
+#if !defined(__cplusplus)
+    pyswigpacked_type = tmp;
     type_init = 1;
   }
-  
-      
-
-  return &PySwigPacked_Type;
+#endif
+  return &pyswigpacked_type;
 }
 
 SWIGRUNTIME PyObject *
 PySwigPacked_FromDataAndDesc(void *ptr, size_t size, const char *desc)
 {
-  PySwigPacked *self = PyObject_NEW(PySwigPacked, PySwigPacked_GetType());
+  PySwigPacked *self = PyObject_NEW(PySwigPacked, PySwigPacked_type());
   if (self == NULL) {
     return NULL;
   } else {
     void *pack = malloc(size);
-    memcpy(pack, ptr, size);
-    self->pack = pack;
-    self->desc = desc;
-    self->size = size;
-    return (PyObject *) self;
+    if (pack) {
+      memcpy(pack, ptr, size);
+      self->pack = pack;
+      self->desc = desc;
+      self->size = size;
+      return (PyObject *) self;
+    }
+    return NULL;
   }
 }
 
@@ -989,7 +1023,7 @@
 
 SWIGRUNTIMEINLINE int
 PySwigPacked_Check(PyObject *op) {
-  return ((op)->ob_type == PySwigPacked_GetType()) 
+  return ((op)->ob_type == PySwigPacked_type()) 
     || (strcmp((op)->ob_type->tp_name,"PySwigPacked") == 0);
 }
 
@@ -1016,7 +1050,7 @@
 {
   if (type) {
 #if defined(SWIG_COBJECT_TYPES)
-    if (PySwigObject_Check(obj)) {
+    if (obj && PySwigObject_Check(obj)) {
       const char *otype = (const char *) PySwigObject_GetDesc(obj);
       if (otype) {
 	PyErr_Format(PyExc_TypeError, "a '%s' is expected, 'PySwigObject(%s)' is received",
@@ -1037,7 +1071,7 @@
 	  PyErr_Format(PyExc_TypeError, "a '%s' is expected, '%s' is received",
 		       type, otype);
 	}
-	Py_DECREF(str);
+	Py_XDECREF(str);
 	return;
       }
     }   
@@ -1088,7 +1122,7 @@
   if (PyErr_Occurred()) {
     /* add information about failing argument */
     char mesg[256];
-    sprintf(mesg, "argument number %d:", argnum);
+    PyOS_snprintf(mesg, sizeof(mesg), "argument number %d:", argnum);
     return SWIG_Python_AddErrMesg(mesg, 1);
   } else {
     return 0;
@@ -1103,7 +1137,7 @@
 /* Convert a pointer value */
 SWIGRUNTIME int
 SWIG_Python_ConvertPtr(PyObject *obj, void **ptr, swig_type_info *ty, int flags) {
-  swig_type_info *tc;
+  swig_cast_info *tc;
   const char *c = 0;
   static PyObject *SWIG_this = 0;
   int    newref = 0;
@@ -1154,7 +1188,6 @@
 #endif
 
 type_check:
-
   if (ty) {
     tc = SWIG_TypeCheck(c,ty);
     if (!tc) goto type_error;
@@ -1162,7 +1195,6 @@
   } else {
     *ptr = vptr;
   }
-
   if ((pyobj) && (flags & SWIG_POINTER_DISOWN)) {
     PyObject_SetAttrString(pyobj,(char*)"thisown",Py_False);
   }
@@ -1177,7 +1209,7 @@
       char *doc = (((PyCFunctionObject *)obj) -> m_ml -> ml_doc);
       c = doc ? strstr(doc, "swig_ptr: ") : 0;
       if (c) {
-	c = SWIG_UnpackVoidPtr(c + 10, &vptr, ty->name);
+	c = ty ? SWIG_UnpackVoidPtr(c + 10, &vptr, ty->name) : 0;
 	if (!c) goto type_error;
 	goto type_check;
       }
@@ -1210,7 +1242,7 @@
 /* Convert a packed value value */
 SWIGRUNTIME int
 SWIG_Python_ConvertPacked(PyObject *obj, void *ptr, size_t sz, swig_type_info *ty, int flags) {
-  swig_type_info *tc;
+  swig_cast_info *tc;
   const char *c = 0;
 
 #if defined(SWIG_COBJECT_TYPES) && !defined(SWIG_COBJECT_PYTHON)
@@ -1244,6 +1276,12 @@
 SWIGRUNTIME PyObject *
 SWIG_Python_NewPointerObj(void *ptr, swig_type_info *type, int own) {
   PyObject *robj = 0;
+  if (!type) {
+    if (!PyErr_Occurred()) {
+      PyErr_Format(PyExc_TypeError, "Swig: null type passed to NewPointerObj");
+    }
+    return robj;
+  }
   if (!ptr) {
     Py_INCREF(Py_None);
     return Py_None;
@@ -1301,8 +1339,8 @@
 void *SWIG_ReturnGlobalTypeList(void *);
 #endif
 
-SWIGRUNTIME swig_type_info **
-SWIG_Python_GetTypeListHandle() {
+SWIGRUNTIME swig_module_info *
+SWIG_Python_GetModule(void) {
   static void *type_pointer = (void *)0;
   /* first check if module already created */
   if (!type_pointer) {
@@ -1317,20 +1355,21 @@
     }
   }
 #endif
-  return (swig_type_info **) type_pointer;
+  return (swig_module_info *) type_pointer;
 }
 
-/*
-  Search for a swig_type_info structure
- */
-SWIGRUNTIMEINLINE swig_type_info *
-SWIG_Python_GetTypeList() {
-  swig_type_info **tlh = SWIG_Python_GetTypeListHandle();
-  return tlh ? *tlh : (swig_type_info*)0;
+SWIGRUNTIME void
+SWIG_Python_SetModule(swig_module_info *swig_module) {
+  static PyMethodDef swig_empty_runtime_method_table[] = { {NULL, NULL, 0, NULL} };/* Sentinel */
+
+  PyObject *module = Py_InitModule((char*)"swig_runtime_data" SWIG_RUNTIME_VERSION,
+				   swig_empty_runtime_method_table);
+  PyObject *pointer = PyCObject_FromVoidPtr((void *) swig_module, NULL);
+  if (pointer && module) {
+    PyModule_AddObject(module, (char*)"type_pointer" SWIG_TYPE_TABLE_NAME, pointer);
+  }
 }
 
-#define SWIG_Runtime_GetTypeList SWIG_Python_GetTypeList 
-
 #ifdef __cplusplus
 }
 #endif
@@ -1338,23 +1377,26 @@
 
 /* -------- TYPES TABLE (BEGIN) -------- */
 
-#define  SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t swig_types[0] 
-#define  SWIGTYPE_std__size_t swig_types[1] 
-#define  SWIGTYPE_size_t swig_types[2] 
-#define  SWIGTYPE_p_EventManager swig_types[3] 
-#define  SWIGTYPE_p_allocator_type swig_types[4] 
-#define  SWIGTYPE_p_size_type swig_types[5] 
-#define  SWIGTYPE_p_char swig_types[6] 
-#define  SWIGTYPE_p_GameConfig swig_types[7] 
-#define  SWIGTYPE_p_GameAction swig_types[8] 
-#define  SWIGTYPE_p_value_type swig_types[9] 
-#define  SWIGTYPE_p_difference_type swig_types[10] 
-#define  SWIGTYPE_std__ptrdiff_t swig_types[11] 
-#define  SWIGTYPE_ptrdiff_t swig_types[12] 
-#define  SWIGTYPE_p_DialogApi swig_types[13] 
-#define  SWIGTYPE_p_SoundSystem swig_types[14] 
-#define  SWIGTYPE_p_std__allocatorTstd__string_t swig_types[15] 
-static swig_type_info *swig_types[17];
+#define SWIGTYPE_p_DialogApi swig_types[0]
+#define SWIGTYPE_p_EventManager swig_types[1]
+#define SWIGTYPE_p_GameAction swig_types[2]
+#define SWIGTYPE_p_GameConfig swig_types[3]
+#define SWIGTYPE_p_SoundSystem swig_types[4]
+#define SWIGTYPE_p_allocator_type swig_types[5]
+#define SWIGTYPE_p_char swig_types[6]
+#define SWIGTYPE_p_difference_type swig_types[7]
+#define SWIGTYPE_p_size_type swig_types[8]
+#define SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t swig_types[9]
+#define SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type swig_types[10]
+#define SWIGTYPE_p_value_type swig_types[11]
+#define SWIGTYPE_ptrdiff_t swig_types[12]
+#define SWIGTYPE_size_t swig_types[13]
+#define SWIGTYPE_std__ptrdiff_t swig_types[14]
+#define SWIGTYPE_std__size_t swig_types[15]
+static swig_type_info *swig_types[16];
+static swig_module_info swig_module = {swig_types, 16, 0, 0, 0, 0};
+#define SWIG_TypeQuery(name) SWIG_TypeQueryModule(&swig_module, &swig_module, name)
+#define SWIG_MangledTypeQuery(name) SWIG_MangledTypeQueryModule(&swig_module, &swig_module, name)
 
 /* -------- TYPES TABLE (END) -------- */
 
@@ -1476,7 +1518,7 @@
 }
 
 
-SWIGINTERNSHORT double
+SWIGINTERNINLINE double
 SWIG_As_double(PyObject* obj)
 {
   double v;
@@ -1490,7 +1532,7 @@
 }
 
   
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_Check_double(PyObject* obj)
 {
   return SWIG_AsVal_double(obj, (double*)0);
@@ -1502,18 +1544,19 @@
 /*@@*/
 
 
-SWIGINTERNSHORT PyObject *
+SWIGINTERNINLINE PyObject *
 SWIG_FromCharArray(const char* carray, size_t size)
 {
   if (size > INT_MAX) {
-    return Py_None;    
+    return SWIG_NewPointerObj((char *)(carray), 
+			      SWIG_TypeQuery("char *"), 0);
   } else {
     return PyString_FromStringAndSize(carray, (int)(size));
   }
 }
 
 
-SWIGINTERNSHORT PyObject*
+SWIGINTERNINLINE PyObject*
   SWIG_From_std_string(const std::string& s)
   {
     return SWIG_FromCharArray(s.data(), s.size());
@@ -1597,7 +1640,7 @@
   return 0;    
 }
 #else
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
   SWIG_AsVal_int(PyObject *obj, int *val)
 {
   return SWIG_AsVal_long(obj,(long*)val);
@@ -1605,7 +1648,7 @@
 #endif
 
 
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_As_int(PyObject* obj)
 {
   int v;
@@ -1619,7 +1662,7 @@
 }
 
   
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_Check_int(PyObject* obj)
 {
   return SWIG_AsVal_int(obj, (int*)0);
@@ -1651,7 +1694,7 @@
 }
 
 
-SWIGINTERNSHORT bool
+SWIGINTERNINLINE bool
 SWIG_As_bool(PyObject* obj)
 {
   bool v;
@@ -1665,14 +1708,14 @@
 }
 
   
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_Check_bool(PyObject* obj)
 {
   return SWIG_AsVal_bool(obj, (bool*)0);
 }
 
 
-SWIGINTERNSHORT PyObject*
+SWIGINTERNINLINE PyObject*
   SWIG_From_bool(bool value)
 {
   PyObject *obj = value ? Py_True : Py_False;
@@ -1705,7 +1748,7 @@
 #define  SWIG_UnknownError  99
 
 
-static void SWIG_exception_(int code, const char *msg) {
+SWIGINTERN void SWIG_exception_(int code, const char *msg) {
   switch(code) {
   case SWIG_MemoryError:
     PyErr_SetString(PyExc_MemoryError,msg);
@@ -1760,7 +1803,7 @@
   {
     std::string* s;
     int res = SWIG_AsPtr_std_string(obj, &s);
-    if (res && s) {
+    if ((res != 0) && s) {
       if (val) *val = *s;
       if (res == SWIG_NEWOBJ) delete s;
       return res;
@@ -1904,7 +1947,7 @@
       if (val) {
 	Type *p = 0;
 	int res = traits_asptr<Type>::asptr(obj, &p);
-	if (res && p) {
+	if ((res != 0) && p) {
 	  typedef typename noconst_traits<Type>::noconst_type noconst_type;
 	  *(const_cast<noconst_type*>(val)) = *p;
 	  if (res == SWIG_NEWOBJ) delete p;
@@ -1913,7 +1956,7 @@
 	  return false;
 	}
       } else {
-	return traits_asptr<Type>::asptr(obj, (Type **)(0));
+	return traits_asptr<Type>::asptr(obj, (Type **)(0)) ? true : false;
       }
     }
   };
@@ -1931,14 +1974,14 @@
 	  return false;
 	}
       } else {
-	return traits_asptr<Type>::asptr(obj, (Type **)(0));
+	return traits_asptr<Type>::asptr(obj, (Type **)(0)) ? true : false;
       }
     }
   };
   
   template <class Type>
   inline bool asval(PyObject *obj, Type *val) {
-    return traits_asval<Type>::asval(obj, val);
+    return traits_asval<Type>::asval(obj, val) ? true : false;
   }
 
   template <class Type> 
@@ -1959,8 +2002,8 @@
   struct traits_as<Type, pointer_category> {
     static Type as(PyObject *obj, bool throw_error) {
       Type *v = 0;      
-      int res = (obj ? traits_asptr<Type>::asptr(obj, &v) : 0) && v;
-      if (res) {
+      int res = (obj ? traits_asptr<Type>::asptr(obj, &v) : 0);
+      if (res && v) {
 	if (res == SWIG_NEWOBJ) {
 	  Type r(*v);
 	  delete v;
@@ -2166,11 +2209,12 @@
 	return swig::as<T>(item, true);
       } catch (std::exception& e) {
 	char msg[1024];
-	sprintf(msg,"in sequence element %d", _index);
+	PyOS_snprintf(msg, sizeof(msg), "in sequence element %d ", _index);
 	if (!PyErr_Occurred()) {
 	  SWIG_type_error(swig::type_name<T>(), item);
 	}
 	SWIG_append_errmsg(msg);
+	SWIG_append_errmsg(e.what());
 	throw;
       }
     }
@@ -2360,7 +2404,7 @@
 	if (!swig::check<value_type>(item)) {
 	  if (set_err) {
 	    char msg[1024];
-	    sprintf(msg,"in sequence element %d", i);
+	    PyOS_snprintf(msg, sizeof(msg), "in sequence element %d", i);
 	    SWIG_type_error(swig::type_name<value_type>(), item);
 	    SWIG_append_errmsg(msg);
 	  }
@@ -2452,8 +2496,7 @@
 	} else {
 	  PyErr_SetString(PyExc_OverflowError,
 			  "sequence size not valid in python");
-	  Py_INCREF(Py_None);
-	  return Py_None;
+	  return NULL;
 	}
       }
     };
@@ -2487,7 +2530,7 @@
       }
     
 
-SWIGINTERNSHORT PyObject* 
+SWIGINTERNINLINE PyObject* 
   SWIG_From_unsigned_SS_long(unsigned long value)
 {
   return (value > LONG_MAX) ?
@@ -2523,7 +2566,7 @@
 }
 
 
-SWIGINTERNSHORT unsigned long
+SWIGINTERNINLINE unsigned long
 SWIG_As_unsigned_SS_long(PyObject* obj)
 {
   unsigned long v;
@@ -2537,7 +2580,7 @@
 }
 
   
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_Check_unsigned_SS_long(PyObject* obj)
 {
   return SWIG_AsVal_unsigned_SS_long(obj, (unsigned long*)0);
@@ -2557,7 +2600,7 @@
       return x;
     }
 
-SWIGINTERNSHORT long
+SWIGINTERNINLINE long
 SWIG_As_long(PyObject* obj)
 {
   long v;
@@ -2571,7 +2614,7 @@
 }
 
   
-SWIGINTERNSHORT int
+SWIGINTERNINLINE int
 SWIG_Check_long(PyObject* obj)
 {
   return SWIG_AsVal_long(obj, (long*)0);
@@ -2602,7 +2645,7 @@
 extern "C" {
 #endif
 static PyObject *_wrap_GameAction_clean(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_clean")) goto fail;
     GameAction::clean();
@@ -2615,7 +2658,7 @@
 
 
 static PyObject *_wrap_GameAction_add_system(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     double arg3 ;
@@ -2657,7 +2700,7 @@
 
 
 static PyObject *_wrap_GameAction_add_planet(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     double arg3 ;
@@ -2719,7 +2762,7 @@
 
 
 static PyObject *_wrap_GameAction_add_orbiter_station(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     std::string *arg3 = 0 ;
@@ -2854,7 +2897,7 @@
 
 
 static PyObject *_wrap_GameAction_add_asteroid__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     double arg3 ;
@@ -2911,7 +2954,7 @@
 
 
 static PyObject *_wrap_GameAction_add_asteroid__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     double arg3 ;
@@ -2962,7 +3005,7 @@
 
 
 static PyObject *_wrap_GameAction_add_asteroid__SWIG_2(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     double arg3 ;
@@ -3007,7 +3050,7 @@
 
 
 static PyObject *_wrap_GameAction_add_asteroid__SWIG_3(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     int result;
@@ -3046,7 +3089,7 @@
 
 
 static PyObject *_wrap_GameAction_add_asteroid__SWIG_4(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int result;
     int res1 = 0 ;
@@ -3159,7 +3202,7 @@
 
 
 static PyObject *_wrap_GameAction_add_player(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     double arg3 ;
@@ -3221,7 +3264,7 @@
 
 
 static PyObject *_wrap_GameAction_add_ship(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     double arg3 ;
@@ -3289,7 +3332,7 @@
 
 
 static PyObject *_wrap_GameAction_save_flag__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     int res1 = 0 ;
@@ -3336,7 +3379,7 @@
 
 
 static PyObject *_wrap_GameAction_get_string_flag(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string result;
     int res1 = 0 ;
@@ -3369,7 +3412,7 @@
 
 
 static PyObject *_wrap_GameAction_save_flag__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double arg2 ;
     int res1 = 0 ;
@@ -3440,7 +3483,7 @@
 
 
 static PyObject *_wrap_GameAction_get_double_flag(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     double result;
     int res1 = 0 ;
@@ -3473,7 +3516,7 @@
 
 
 static PyObject *_wrap_GameAction_get_player_ship_id(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double result;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_get_player_ship_id")) goto fail;
@@ -3489,7 +3532,7 @@
 
 
 static PyObject *_wrap_GameAction_get_player_star_system(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string result;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_get_player_star_system")) goto fail;
@@ -3505,7 +3548,7 @@
 
 
 static PyObject *_wrap_GameAction_set_target(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     PyObject * obj0 = 0 ;
@@ -3530,7 +3573,7 @@
 
 
 static PyObject *_wrap_GameAction_disable_weapon(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     PyObject * obj0 = 0 ;
     
@@ -3549,7 +3592,7 @@
 
 
 static PyObject *_wrap_GameAction_enable_weapon(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     PyObject * obj0 = 0 ;
     
@@ -3568,7 +3611,7 @@
 
 
 static PyObject *_wrap_GameAction_go_to_point(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -3608,7 +3651,7 @@
 
 
 static PyObject *_wrap_GameAction_go_to_location(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -3642,7 +3685,7 @@
 
 
 static PyObject *_wrap_GameAction_guard_location(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -3676,7 +3719,7 @@
 
 
 static PyObject *_wrap_GameAction_guard_point(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -3716,7 +3759,7 @@
 
 
 static PyObject *_wrap_GameAction_set_ship_team(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     PyObject * obj0 = 0 ;
@@ -3741,7 +3784,7 @@
 
 
 static PyObject *_wrap_GameAction_get_enemy_team(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     int result;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_get_enemy_team")) goto fail;
@@ -3757,7 +3800,7 @@
 
 
 static PyObject *_wrap_GameAction_get_player_team(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     int result;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_get_player_team")) goto fail;
@@ -3773,7 +3816,7 @@
 
 
 static PyObject *_wrap_GameAction_remove_location(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     PyObject * obj0 = 0 ;
     
@@ -3792,7 +3835,7 @@
 
 
 static PyObject *_wrap_GameAction_set_crew(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     PyObject * obj0 = 0 ;
@@ -3817,7 +3860,7 @@
 
 
 static PyObject *_wrap_GameAction_end_game(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     
     if(!PyArg_ParseTuple(args,(char *)":GameAction_end_game")) goto fail;
     GameAction::end_game();
@@ -3830,8 +3873,8 @@
 
 
 static PyObject *_wrap_GameAction_scroll_text(PyObject *, PyObject *args) {
-    PyObject *resultobj;
-    std::vector<std::string > *arg1 = 0 ;
+    PyObject *resultobj = NULL;
+    std::vector<std::string,std::allocator<std::string > > *arg1 = 0 ;
     std::string *arg2 = 0 ;
     int res2 = 0 ;
     PyObject * obj0 = 0 ;
@@ -3842,7 +3885,7 @@
         SWIG_Python_ConvertPtr(obj0, (void **)&arg1, SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t, SWIG_POINTER_EXCEPTION | 0);
         if (SWIG_arg_fail(1)) SWIG_fail;
         if (arg1 == NULL) {
-            SWIG_null_ref("std::vector<std::string >");
+            SWIG_null_ref("std::vector<std::string,std::allocator<std::string > >");
         }
         if (SWIG_arg_fail(1)) SWIG_fail;
     }
@@ -3858,7 +3901,7 @@
         if (SWIG_arg_fail(2)) SWIG_fail;
         arg2 = ptr;
     }
-    GameAction::scroll_text((std::vector<std::string > const &)*arg1,(std::string const &)*arg2);
+    GameAction::scroll_text((std::vector<std::string,std::allocator<std::string > > const &)*arg1,(std::string const &)*arg2);
     
     Py_INCREF(Py_None); resultobj = Py_None;
     if (res2 == SWIG_NEWOBJ) delete arg2;
@@ -3870,7 +3913,7 @@
 
 
 static PyObject *_wrap_GameAction_print_message(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int arg2 ;
     int res1 = 0 ;
@@ -3906,7 +3949,7 @@
 
 
 static PyObject *_wrap_GameAction_set_camera_mode(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int res1 = 0 ;
     PyObject * obj0 = 0 ;
@@ -3936,7 +3979,7 @@
 
 
 static PyObject *_wrap_new_GameAction(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     GameAction *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_GameAction")) goto fail;
@@ -3950,7 +3993,7 @@
 
 
 static PyObject *_wrap_delete_GameAction(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     GameAction *arg1 = (GameAction *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -3974,7 +4017,7 @@
     return Py_BuildValue((char *)"");
 }
 static PyObject *_wrap_DialogApi_startDialog(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     
     if(!PyArg_ParseTuple(args,(char *)":DialogApi_startDialog")) goto fail;
     DialogApi::startDialog();
@@ -3987,7 +4030,7 @@
 
 
 static PyObject *_wrap_DialogApi_endDialog(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     
     if(!PyArg_ParseTuple(args,(char *)":DialogApi_endDialog")) goto fail;
     DialogApi::endDialog();
@@ -4000,8 +4043,8 @@
 
 
 static PyObject *_wrap_DialogApi_askPlayer(PyObject *, PyObject *args) {
-    PyObject *resultobj;
-    std::vector<std::string > *arg1 = 0 ;
+    PyObject *resultobj = NULL;
+    std::vector<std::string,std::allocator<std::string > > *arg1 = 0 ;
     int result;
     PyObject * obj0 = 0 ;
     
@@ -4010,11 +4053,11 @@
         SWIG_Python_ConvertPtr(obj0, (void **)&arg1, SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t, SWIG_POINTER_EXCEPTION | 0);
         if (SWIG_arg_fail(1)) SWIG_fail;
         if (arg1 == NULL) {
-            SWIG_null_ref("std::vector<std::string >");
+            SWIG_null_ref("std::vector<std::string,std::allocator<std::string > >");
         }
         if (SWIG_arg_fail(1)) SWIG_fail;
     }
-    result = (int)DialogApi::askPlayer((std::vector<std::string > const &)*arg1);
+    result = (int)DialogApi::askPlayer((std::vector<std::string,std::allocator<std::string > > const &)*arg1);
     
     {
         resultobj = SWIG_From_int((int)(result)); 
@@ -4026,7 +4069,7 @@
 
 
 static PyObject *_wrap_DialogApi_showText(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int arg2 ;
     int arg3 ;
@@ -4074,7 +4117,7 @@
 
 
 static PyObject *_wrap_DialogApi_showAlienPicture(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int res1 = 0 ;
     PyObject * obj0 = 0 ;
@@ -4104,7 +4147,7 @@
 
 
 static PyObject *_wrap_new_DialogApi(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     DialogApi *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_DialogApi")) goto fail;
@@ -4118,7 +4161,7 @@
 
 
 static PyObject *_wrap_delete_DialogApi(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     DialogApi *arg1 = (DialogApi *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -4142,7 +4185,7 @@
     return Py_BuildValue((char *)"");
 }
 static PyObject *_wrap_GameConfig_SetGameDirectory(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     int res1 = 0 ;
     PyObject * obj0 = 0 ;
@@ -4172,7 +4215,7 @@
 
 
 static PyObject *_wrap_GameConfig_GetGameDirectory(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string result;
     
     if(!PyArg_ParseTuple(args,(char *)":GameConfig_GetGameDirectory")) goto fail;
@@ -4188,7 +4231,7 @@
 
 
 static PyObject *_wrap_GameConfig_GetAbsolutePath(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string result;
     int res1 = 0 ;
@@ -4221,7 +4264,7 @@
 
 
 static PyObject *_wrap_new_GameConfig(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     GameConfig *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_GameConfig")) goto fail;
@@ -4235,7 +4278,7 @@
 
 
 static PyObject *_wrap_delete_GameConfig(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     GameConfig *arg1 = (GameConfig *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -4259,7 +4302,7 @@
     return Py_BuildValue((char *)"");
 }
 static PyObject *_wrap_EventManager_clean(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     
     if(!PyArg_ParseTuple(args,(char *)":EventManager_clean")) goto fail;
     EventManager::clean();
@@ -4272,7 +4315,7 @@
 
 
 static PyObject *_wrap_EventManager_setSingleTimeEvent(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     std::string *arg2 = 0 ;
     int result;
@@ -4311,7 +4354,7 @@
 
 
 static PyObject *_wrap_EventManager_setRepeatableTimeEvent(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     std::string *arg2 = 0 ;
     int result;
@@ -4350,7 +4393,7 @@
 
 
 static PyObject *_wrap_EventManager_disableEvent(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     PyObject * obj0 = 0 ;
     
@@ -4369,7 +4412,7 @@
 
 
 static PyObject *_wrap_EventManager_shipDeathById(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     std::string *arg2 = 0 ;
     int result;
@@ -4408,7 +4451,7 @@
 
 
 static PyObject *_wrap_EventManager_shipDeathByType(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::string *arg1 = 0 ;
     std::string *arg2 = 0 ;
     int result;
@@ -4458,7 +4501,7 @@
 
 
 static PyObject *_wrap_EventManager_distanceMoreThen__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -4515,7 +4558,7 @@
 
 
 static PyObject *_wrap_EventManager_distanceLessThen__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -4572,7 +4615,7 @@
 
 
 static PyObject *_wrap_EventManager_distanceMoreThen__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -4673,7 +4716,7 @@
 
 
 static PyObject *_wrap_EventManager_distanceLessThen__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     double arg2 ;
     double arg3 ;
@@ -4773,8 +4816,58 @@
 }
 
 
+static PyObject *_wrap_EventManager_jumpToSystem(PyObject *, PyObject *args) {
+    PyObject *resultobj = NULL;
+    std::string *arg1 = 0 ;
+    std::string *arg2 = 0 ;
+    int result;
+    int res1 = 0 ;
+    int res2 = 0 ;
+    PyObject * obj0 = 0 ;
+    PyObject * obj1 = 0 ;
+    
+    if(!PyArg_ParseTuple(args,(char *)"OO:EventManager_jumpToSystem",&obj0,&obj1)) goto fail;
+    {
+        std::string *ptr = (std::string *)0;
+        res1 = SWIG_AsPtr_std_string(obj0, &ptr);
+        if (!res1) {
+            if (!PyErr_Occurred())
+            SWIG_type_error("std::string", obj0);
+        } else if (!ptr) {
+            SWIG_null_ref("std::string");
+        }
+        if (SWIG_arg_fail(1)) SWIG_fail;
+        arg1 = ptr;
+    }
+    {
+        std::string *ptr = (std::string *)0;
+        res2 = SWIG_AsPtr_std_string(obj1, &ptr);
+        if (!res2) {
+            if (!PyErr_Occurred())
+            SWIG_type_error("std::string", obj1);
+        } else if (!ptr) {
+            SWIG_null_ref("std::string");
+        }
+        if (SWIG_arg_fail(2)) SWIG_fail;
+        arg2 = ptr;
+    }
+    result = (int)EventManager::jumpToSystem((std::string const &)*arg1,(std::string const &)*arg2);
+    
+    {
+        resultobj = SWIG_From_int((int)(result)); 
+    }
+    if (res1 == SWIG_NEWOBJ) delete arg1;
+    if (res2 == SWIG_NEWOBJ) delete arg2;
+    return resultobj;
+    fail:
+    if (res1 == SWIG_NEWOBJ) delete arg1;
+    if (res2 == SWIG_NEWOBJ) delete arg2;
+    return NULL;
+}
+
+
 static PyObject *_wrap_EventManager_AddEventCondition(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     double arg1 ;
     std::string *arg2 = 0 ;
     int res2 = 0 ;
@@ -4810,7 +4903,7 @@
 
 
 static PyObject *_wrap_new_EventManager(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     EventManager *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_EventManager")) goto fail;
@@ -4824,7 +4917,7 @@
 
 
 static PyObject *_wrap_delete_EventManager(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     EventManager *arg1 = (EventManager *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -4848,7 +4941,7 @@
     return Py_BuildValue((char *)"");
 }
 static PyObject *_wrap_new_SoundSystem__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     bool arg1 ;
     SoundSystem *result;
     PyObject * obj0 = 0 ;
@@ -4868,13 +4961,13 @@
 
 
 static PyObject *_wrap_new_SoundSystem__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_SoundSystem")) goto fail;
     result = (SoundSystem *)new SoundSystem();
     
-    resultobj = SWIG_NewPointerObj((void*)(result), SWIGTYPE_p_SoundSystem, 0);
+    resultobj = SWIG_NewPointerObj((void*)(result), SWIGTYPE_p_SoundSystem, 1);
     return resultobj;
     fail:
     return NULL;
@@ -4907,7 +5000,7 @@
 
 
 static PyObject *_wrap_delete_SoundSystem(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -4924,7 +5017,7 @@
 
 
 static PyObject *_wrap_SoundSystem_play_music__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string arg2 ;
     int arg3 ;
@@ -4962,7 +5055,7 @@
 
 
 static PyObject *_wrap_SoundSystem_play_music__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string arg2 ;
     PyObject * obj0 = 0 ;
@@ -5048,7 +5141,7 @@
 
 
 static PyObject *_wrap_SoundSystem_play_sound__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string arg2 ;
     double arg3 ;
@@ -5086,7 +5179,7 @@
 
 
 static PyObject *_wrap_SoundSystem_play_sound__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string arg2 ;
     PyObject * obj0 = 0 ;
@@ -5172,7 +5265,7 @@
 
 
 static PyObject *_wrap_SoundSystem_stop_sound(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string arg2 ;
     PyObject * obj0 = 0 ;
@@ -5204,7 +5297,7 @@
 
 
 static PyObject *_wrap_SoundSystem_set_music_volume(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     double arg2 ;
     PyObject * obj0 = 0 ;
@@ -5227,7 +5320,7 @@
 
 
 static PyObject *_wrap_SoundSystem_set_sound_volume(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     double arg2 ;
     PyObject * obj0 = 0 ;
@@ -5250,7 +5343,7 @@
 
 
 static PyObject *_wrap_SoundSystem_load_music_volume(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     double result;
     PyObject * obj0 = 0 ;
@@ -5270,7 +5363,7 @@
 
 
 static PyObject *_wrap_SoundSystem_load_sound_volume(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     double result;
     PyObject * obj0 = 0 ;
@@ -5290,7 +5383,7 @@
 
 
 static PyObject *_wrap_SoundSystem_playing_music(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     bool result;
     PyObject * obj0 = 0 ;
@@ -5310,7 +5403,7 @@
 
 
 static PyObject *_wrap_SoundSystem_playing_music_file(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *arg1 = (SoundSystem *) 0 ;
     std::string result;
     PyObject * obj0 = 0 ;
@@ -5350,7 +5443,7 @@
 
 
 static PyObject *_wrap_tw_sound_get(void) {
-    PyObject *pyobj;
+    PyObject *pyobj = NULL;
     
     pyobj = SWIG_NewPointerObj((void *)(tw_sound), SWIGTYPE_p_SoundSystem, 0);
     return pyobj;
@@ -5358,7 +5451,7 @@
 
 
 static PyObject *_wrap_GetSoundSystem(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     SoundSystem *result;
     
     if(!PyArg_ParseTuple(args,(char *)":GetSoundSystem")) goto fail;
@@ -5372,7 +5465,7 @@
 
 
 static PyObject *_wrap_new_vectorString__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *result;
     
     if(!PyArg_ParseTuple(args,(char *)":new_vectorString")) goto fail;
@@ -5386,7 +5479,7 @@
 
 
 static PyObject *_wrap_new_vectorString__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = 0 ;
     std::vector<std::string > *result;
     int res1 = 0 ;
@@ -5417,7 +5510,7 @@
 
 
 static PyObject *_wrap_vectorString_empty(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     bool result;
     PyObject * obj0 = 0 ;
@@ -5437,7 +5530,7 @@
 
 
 static PyObject *_wrap_vectorString_size(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type result;
     PyObject * obj0 = 0 ;
@@ -5457,7 +5550,7 @@
 
 
 static PyObject *_wrap_vectorString_clear(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -5474,7 +5567,7 @@
 
 
 static PyObject *_wrap_vectorString_swap(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string > *arg2 = 0 ;
     PyObject * obj0 = 0 ;
@@ -5501,7 +5594,7 @@
 
 
 static PyObject *_wrap_vectorString_get_allocator(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     SwigValueWrapper<std::allocator<std::string > > result;
     PyObject * obj0 = 0 ;
@@ -5514,7 +5607,7 @@
     {
         std::vector<std::string >::allocator_type * resultptr;
         resultptr = new std::vector<std::string >::allocator_type((std::vector<std::string >::allocator_type &)(result));
-        resultobj = SWIG_NewPointerObj((void *)(resultptr), SWIGTYPE_p_std__allocatorTstd__string_t, 1);
+        resultobj = SWIG_NewPointerObj((void *)(resultptr), SWIGTYPE_p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type, 1);
     }
     return resultobj;
     fail:
@@ -5523,7 +5616,7 @@
 
 
 static PyObject *_wrap_new_vectorString__SWIG_2(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string >::size_type arg1 ;
     std::vector<std::string > *result;
     PyObject * obj0 = 0 ;
@@ -5543,7 +5636,7 @@
 
 
 static PyObject *_wrap_vectorString_pop_back(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -5560,7 +5653,7 @@
 
 
 static PyObject *_wrap_vectorString_resize__SWIG_0(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type arg2 ;
     PyObject * obj0 = 0 ;
@@ -5583,7 +5676,7 @@
 
 
 static PyObject *_wrap_new_vectorString__SWIG_3(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string >::size_type arg1 ;
     std::vector<std::string >::value_type *arg2 = 0 ;
     std::vector<std::string > *result;
@@ -5662,7 +5755,7 @@
 
 
 static PyObject *_wrap_vectorString_push_back(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::value_type *arg2 = 0 ;
     int res2 = 0 ;
@@ -5696,7 +5789,7 @@
 
 
 static PyObject *_wrap_vectorString_front(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::value_type *result;
     PyObject * obj0 = 0 ;
@@ -5719,7 +5812,7 @@
 
 
 static PyObject *_wrap_vectorString_back(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::value_type *result;
     PyObject * obj0 = 0 ;
@@ -5742,7 +5835,7 @@
 
 
 static PyObject *_wrap_vectorString_assign(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type arg2 ;
     std::vector<std::string >::value_type *arg3 = 0 ;
@@ -5782,7 +5875,7 @@
 
 
 static PyObject *_wrap_vectorString_resize__SWIG_1(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type arg2 ;
     std::vector<std::string >::value_type *arg3 = 0 ;
@@ -5876,7 +5969,7 @@
 
 
 static PyObject *_wrap_vectorString_reserve(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type arg2 ;
     PyObject * obj0 = 0 ;
@@ -5899,7 +5992,7 @@
 
 
 static PyObject *_wrap_vectorString_capacity(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type result;
     PyObject * obj0 = 0 ;
@@ -5919,7 +6012,7 @@
 
 
 static PyObject *_wrap_vectorString___nonzero__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     bool result;
     PyObject * obj0 = 0 ;
@@ -5939,7 +6032,7 @@
 
 
 static PyObject *_wrap_vectorString___len__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::size_type result;
     PyObject * obj0 = 0 ;
@@ -5959,7 +6052,7 @@
 
 
 static PyObject *_wrap_vectorString_pop(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::value_type result;
     PyObject * obj0 = 0 ;
@@ -5978,7 +6071,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -5996,7 +6089,7 @@
 
 
 static PyObject *_wrap_vectorString___getslice__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     std::vector<std::string >::difference_type arg3 ;
@@ -6027,7 +6120,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6043,7 +6136,7 @@
 
 
 static PyObject *_wrap_vectorString___setslice__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     std::vector<std::string >::difference_type arg3 ;
@@ -6095,7 +6188,7 @@
                 SWIG_fail;
             }      
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6113,7 +6206,7 @@
 
 
 static PyObject *_wrap_vectorString___delslice__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     std::vector<std::string >::difference_type arg3 ;
@@ -6143,7 +6236,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6159,7 +6252,7 @@
 
 
 static PyObject *_wrap_vectorString___delitem__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     PyObject * obj0 = 0 ;
@@ -6183,7 +6276,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6199,7 +6292,7 @@
 
 
 static PyObject *_wrap_vectorString___getitem__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     std::vector<std::string >::value_type *result;
@@ -6227,7 +6320,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6245,7 +6338,7 @@
 
 
 static PyObject *_wrap_vectorString___setitem__(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::difference_type arg2 ;
     std::vector<std::string >::value_type *arg3 = 0 ;
@@ -6284,7 +6377,7 @@
                 SWIG_fail;
             }
         }
-        /*@c:\\swig\\Lib\\exception.i,336,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
+        /*@c:\\swig\\Lib\\exception.i,341,SWIG_CATCH_UNKNOWN@*/  catch (std::exception& e) {
             SWIG_exception(SWIG_SystemError, e.what() );
         }
         catch (...) {
@@ -6302,7 +6395,7 @@
 
 
 static PyObject *_wrap_vectorString_append(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     std::vector<std::string >::value_type *arg2 = 0 ;
     int res2 = 0 ;
@@ -6336,7 +6429,7 @@
 
 
 static PyObject *_wrap_delete_vectorString(PyObject *, PyObject *args) {
-    PyObject *resultobj;
+    PyObject *resultobj = NULL;
     std::vector<std::string > *arg1 = (std::vector<std::string > *) 0 ;
     PyObject * obj0 = 0 ;
     
@@ -6413,6 +6506,7 @@
 	 { (char *)"EventManager_shipDeathByType", _wrap_EventManager_shipDeathByType, METH_VARARGS, NULL},
 	 { (char *)"EventManager_distanceMoreThen", _wrap_EventManager_distanceMoreThen, METH_VARARGS, NULL},
 	 { (char *)"EventManager_distanceLessThen", _wrap_EventManager_distanceLessThen, METH_VARARGS, NULL},
+	 { (char *)"EventManager_jumpToSystem", _wrap_EventManager_jumpToSystem, METH_VARARGS, NULL},
 	 { (char *)"EventManager_AddEventCondition", _wrap_EventManager_AddEventCondition, METH_VARARGS, NULL},
 	 { (char *)"new_EventManager", _wrap_new_EventManager, METH_VARARGS, NULL},
 	 { (char *)"delete_EventManager", _wrap_delete_EventManager, METH_VARARGS, NULL},
@@ -6462,44 +6556,79 @@
 
 /* -------- TYPE CONVERSION AND EQUIVALENCE RULES (BEGIN) -------- */
 
-static swig_type_info _swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t[] = {{"_p_std__vectorTstd__string_std__allocatorTstd__string_t_t", 0, "std::vector<std::string > *", 0, 0, 0, 0},{"_p_std__vectorTstd__string_std__allocatorTstd__string_t_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__std__size_t[] = {{"_std__size_t", 0, "std::size_t", 0, 0, 0, 0},{"_std__size_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__size_t[] = {{"_size_t", 0, "size_t", 0, 0, 0, 0},{"_size_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_EventManager[] = {{"_p_EventManager", 0, "EventManager *", 0, 0, 0, 0},{"_p_EventManager", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_allocator_type[] = {{"_p_allocator_type", 0, "allocator_type *", 0, 0, 0, 0},{"_p_allocator_type", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_size_type[] = {{"_p_size_type", 0, "size_type *", 0, 0, 0, 0},{"_p_size_type", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_char[] = {{"_p_char", 0, "char *", 0, 0, 0, 0},{"_p_char", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_GameConfig[] = {{"_p_GameConfig", 0, "GameConfig *", 0, 0, 0, 0},{"_p_GameConfig", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_GameAction[] = {{"_p_GameAction", 0, "GameAction *", 0, 0, 0, 0},{"_p_GameAction", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_value_type[] = {{"_p_value_type", 0, "value_type *", 0, 0, 0, 0},{"_p_value_type", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_difference_type[] = {{"_p_difference_type", 0, "difference_type *", 0, 0, 0, 0},{"_p_difference_type", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__std__ptrdiff_t[] = {{"_std__ptrdiff_t", 0, "std::ptrdiff_t", 0, 0, 0, 0},{"_std__ptrdiff_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__ptrdiff_t[] = {{"_ptrdiff_t", 0, "ptrdiff_t", 0, 0, 0, 0},{"_ptrdiff_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_DialogApi[] = {{"_p_DialogApi", 0, "DialogApi *", 0, 0, 0, 0},{"_p_DialogApi", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_SoundSystem[] = {{"_p_SoundSystem", 0, "SoundSystem *", 0, 0, 0, 0},{"_p_SoundSystem", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
-static swig_type_info _swigt__p_std__allocatorTstd__string_t[] = {{"_p_std__allocatorTstd__string_t", 0, "std::allocator<std::string > *|std::vector<std::string >::allocator_type *", 0, 0, 0, 0},{"_p_std__allocatorTstd__string_t", 0, 0, 0, 0, 0, 0},{0, 0, 0, 0, 0, 0, 0}};
+static swig_type_info _swigt__p_DialogApi = {"_p_DialogApi", "DialogApi *", 0, 0, 0};
+static swig_type_info _swigt__p_EventManager = {"_p_EventManager", "EventManager *", 0, 0, 0};
+static swig_type_info _swigt__p_GameAction = {"_p_GameAction", "GameAction *", 0, 0, 0};
+static swig_type_info _swigt__p_GameConfig = {"_p_GameConfig", "GameConfig *", 0, 0, 0};
+static swig_type_info _swigt__p_SoundSystem = {"_p_SoundSystem", "SoundSystem *", 0, 0, 0};
+static swig_type_info _swigt__p_allocator_type = {"_p_allocator_type", "allocator_type *", 0, 0, 0};
+static swig_type_info _swigt__p_char = {"_p_char", "char *", 0, 0, 0};
+static swig_type_info _swigt__p_difference_type = {"_p_difference_type", "difference_type *", 0, 0, 0};
+static swig_type_info _swigt__p_size_type = {"_p_size_type", "size_type *", 0, 0, 0};
+static swig_type_info _swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t = {"_p_std__vectorTstd__string_std__allocatorTstd__string_t_t", "std::vector<std::string > *", 0, 0, 0};
+static swig_type_info _swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type = {"_p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type", "std::allocator<std::string > *|std::vector<std::string >::allocator_type *", 0, 0, 0};
+static swig_type_info _swigt__p_value_type = {"_p_value_type", "value_type *", 0, 0, 0};
+static swig_type_info _swigt__ptrdiff_t = {"_ptrdiff_t", "ptrdiff_t", 0, 0, 0};
+static swig_type_info _swigt__size_t = {"_size_t", "size_t", 0, 0, 0};
+static swig_type_info _swigt__std__ptrdiff_t = {"_std__ptrdiff_t", "std::ptrdiff_t", 0, 0, 0};
+static swig_type_info _swigt__std__size_t = {"_std__size_t", "std::size_t", 0, 0, 0};
 
-static swig_type_info *swig_types_initial[] = {
-_swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t, 
-_swigt__std__size_t, 
-_swigt__size_t, 
-_swigt__p_EventManager, 
-_swigt__p_allocator_type, 
-_swigt__p_size_type, 
-_swigt__p_char, 
-_swigt__p_GameConfig, 
-_swigt__p_GameAction, 
-_swigt__p_value_type, 
-_swigt__p_difference_type, 
-_swigt__std__ptrdiff_t, 
-_swigt__ptrdiff_t, 
-_swigt__p_DialogApi, 
-_swigt__p_SoundSystem, 
-_swigt__p_std__allocatorTstd__string_t, 
-0
+static swig_type_info *swig_type_initial[] = {
+  &_swigt__p_DialogApi,
+  &_swigt__p_EventManager,
+  &_swigt__p_GameAction,
+  &_swigt__p_GameConfig,
+  &_swigt__p_SoundSystem,
+  &_swigt__p_allocator_type,
+  &_swigt__p_char,
+  &_swigt__p_difference_type,
+  &_swigt__p_size_type,
+  &_swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t,
+  &_swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type,
+  &_swigt__p_value_type,
+  &_swigt__ptrdiff_t,
+  &_swigt__size_t,
+  &_swigt__std__ptrdiff_t,
+  &_swigt__std__size_t,
 };
 
+static swig_cast_info _swigc__p_DialogApi[] = {  {&_swigt__p_DialogApi, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_EventManager[] = {  {&_swigt__p_EventManager, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_GameAction[] = {  {&_swigt__p_GameAction, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_GameConfig[] = {  {&_swigt__p_GameConfig, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_SoundSystem[] = {  {&_swigt__p_SoundSystem, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_allocator_type[] = {  {&_swigt__p_allocator_type, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_char[] = {  {&_swigt__p_char, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_difference_type[] = {  {&_swigt__p_difference_type, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_size_type[] = {  {&_swigt__p_size_type, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_std__vectorTstd__string_std__allocatorTstd__string_t_t[] = {  {&_swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type[] = {  {&_swigt__p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__p_value_type[] = {  {&_swigt__p_value_type, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__ptrdiff_t[] = {  {&_swigt__ptrdiff_t, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__size_t[] = {  {&_swigt__size_t, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__std__ptrdiff_t[] = {  {&_swigt__std__ptrdiff_t, 0, 0, 0},{0, 0, 0, 0}};
+static swig_cast_info _swigc__std__size_t[] = {  {&_swigt__std__size_t, 0, 0, 0},{0, 0, 0, 0}};
 
+static swig_cast_info *swig_cast_initial[] = {
+  _swigc__p_DialogApi,
+  _swigc__p_EventManager,
+  _swigc__p_GameAction,
+  _swigc__p_GameConfig,
+  _swigc__p_SoundSystem,
+  _swigc__p_allocator_type,
+  _swigc__p_char,
+  _swigc__p_difference_type,
+  _swigc__p_size_type,
+  _swigc__p_std__vectorTstd__string_std__allocatorTstd__string_t_t,
+  _swigc__p_std__vectorTstd__string_std__allocatorTstd__string_t_t__allocator_type,
+  _swigc__p_value_type,
+  _swigc__ptrdiff_t,
+  _swigc__size_t,
+  _swigc__std__ptrdiff_t,
+  _swigc__std__size_t,
+};
+
+
 /* -------- TYPE CONVERSION AND EQUIVALENCE RULES (END) -------- */
 
 static swig_const_info swig_const_table[] = {
@@ -6508,12 +6637,161 @@
 #ifdef __cplusplus
 }
 #endif
+/*************************************************************************
+ * Type initialization:
+ * This problem is tough by the requirement that no dynamic 
+ * memory is used. Also, since swig_type_info structures store pointers to 
+ * swig_cast_info structures and swig_cast_info structures store pointers back
+ * to swig_type_info structures, we need some lookup code at initialization. 
+ * The idea is that swig generates all the structures that are needed. 
+ * The runtime then collects these partially filled structures. 
+ * The SWIG_InitializeModule function takes these initial arrays out of 
+ * swig_module, and does all the lookup, filling in the swig_module.types
+ * array with the correct data and linking the correct swig_cast_info
+ * structures together.
 
+ * The generated swig_type_info structures are assigned staticly to an initial 
+ * array. We just loop though that array, and handle each type individually.
+ * First we lookup if this type has been already loaded, and if so, use the
+ * loaded structure instead of the generated one. Then we have to fill in the
+ * cast linked list. The cast data is initially stored in something like a
+ * two-dimensional array. Each row corresponds to a type (there are the same
+ * number of rows as there are in the swig_type_initial array). Each entry in
+ * a column is one of the swig_cast_info structures for that type.
+ * The cast_initial array is actually an array of arrays, because each row has
+ * a variable number of columns. So to actually build the cast linked list,
+ * we find the array of casts associated with the type, and loop through it 
+ * adding the casts to the list. The one last trick we need to do is making
+ * sure the type pointer in the swig_cast_info struct is correct.
 
+ * First off, we lookup the cast->type name to see if it is already loaded. 
+ * There are three cases to handle:
+ *  1) If the cast->type has already been loaded AND the type we are adding
+ *     casting info to has not been loaded (it is in this module), THEN we
+ *     replace the cast->type pointer with the type pointer that has already
+ *     been loaded.
+ *  2) If BOTH types (the one we are adding casting info to, and the 
+ *     cast->type) are loaded, THEN the cast info has already been loaded by
+ *     the previous module so we just ignore it.
+ *  3) Finally, if cast->type has not already been loaded, then we add that
+ *     swig_cast_info to the linked list (because the cast->type) pointer will
+ *     be correct.
+**/
+
 #ifdef __cplusplus
 extern "C" {
 #endif
     
+    SWIGRUNTIME void
+    SWIG_InitializeModule(void *clientdata) {
+        swig_type_info *type, *ret;
+        swig_cast_info *cast;
+        size_t i;
+        swig_module_info *module_head;
+        static int init_run = 0;
+        
+        clientdata = clientdata;
+        
+        if (init_run) return;
+        init_run = 1;
+        
+        /* Initialize the swig_module */
+        swig_module.type_initial = swig_type_initial;
+        swig_module.cast_initial = swig_cast_initial;
+        
+        /* Try and load any already created modules */
+        module_head = SWIG_GetModule(clientdata);
+        if (module_head) {
+            swig_module.next = module_head->next;
+            module_head->next = &swig_module;
+        } else {
+            /* This is the first module loaded */
+            swig_module.next = &swig_module;
+            SWIG_SetModule(clientdata, &swig_module);
+        }
+        
+        /* Now work on filling in swig_module.types */
+        for (i = 0; i < swig_module.size; ++i) {
+            type = 0;
+            
+            /* if there is another module already loaded */
+            if (swig_module.next != &swig_module) {
+                type = SWIG_MangledTypeQueryModule(swig_module.next, &swig_module, swig_module.type_initial[i]->name);
+            }
+            if (type) {
+                /* Overwrite clientdata field */
+                if (swig_module.type_initial[i]->clientdata) type->clientdata = swig_module.type_initial[i]->clientdata;
+            } else {
+                type = swig_module.type_initial[i];
+            }
+            
+            /* Insert casting types */
+            cast = swig_module.cast_initial[i];
+            while (cast->type) {
+                /* Don't need to add information already in the list */
+                ret = 0;
+                if (swig_module.next != &swig_module) {
+                    ret = SWIG_MangledTypeQueryModule(swig_module.next, &swig_module, cast->type->name);
+                }
+                if (ret && type == swig_module.type_initial[i]) {
+                    cast->type = ret;
+                    ret = 0;
+                }
+                
+                if (!ret) {
+                    if (type->cast) {
+                        type->cast->prev = cast;
+                        cast->next = type->cast;
+                    }
+                    type->cast = cast;
+                }
+                
+                cast++;
+            }
+            
+            /* Set entry in modules->types array equal to the type */
+            swig_module.types[i] = type;
+        }
+    }
+    
+    /* This function will propagate the clientdata field of type to
+    * any new swig_type_info structures that have been added into the list
+    * of equivalent types.  It is like calling
+    * SWIG_TypeClientData(type, clientdata) a second time.
+    */
+    SWIGRUNTIME void
+    SWIG_PropagateClientData(void) {
+        size_t i;
+        swig_cast_info *equiv;
+        static int init_run = 0;
+        
+        if (init_run) return;
+        init_run = 1;
+        
+        for (i = 0; i < swig_module.size; i++) {
+            if (swig_module.types[i]->clientdata) {
+                equiv = swig_module.types[i]->cast;
+                while (equiv) {
+                    if (!equiv->converter) {
+                        if (equiv->type && !equiv->type->clientdata)
+                        SWIG_TypeClientData(equiv->type, swig_module.types[i]->clientdata);
+                    }
+                    equiv = equiv->next;
+                }
+            }
+        }
+    }
+    
+#ifdef __cplusplus
+}
+#endif
+
+
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+    
     /* Python-specific SWIG API */
 #define SWIG_newvarlink()                             SWIG_Python_newvarlink()
 #define SWIG_addvarlink(p, name, get_attr, set_attr)  SWIG_Python_addvarlink(p, name, get_attr, set_attr)
@@ -6525,7 +6803,7 @@
     
     typedef struct swig_globalvar {
         char       *name;                  /* Name of global variable */
-        PyObject *(*get_attr)();           /* Return the current value */
+        PyObject *(*get_attr)(void);       /* Return the current value */
         int       (*set_attr)(PyObject *); /* Set the value */
         struct swig_globalvar *next;
     } swig_globalvar;
@@ -6535,13 +6813,13 @@
         swig_globalvar *vars;
     } swig_varlinkobject;
     
-    static PyObject *
+    SWIGINTERN PyObject *
     swig_varlink_repr(swig_varlinkobject *v) {
         v = v;
         return PyString_FromString("<Swig global variables>");
     }
     
-    static int
+    SWIGINTERN int
     swig_varlink_print(swig_varlinkobject *v, FILE *fp, int flags) {
         swig_globalvar  *var;
         flags = flags;
@@ -6554,7 +6832,7 @@
         return 0;
     }
     
-    static PyObject *
+    SWIGINTERN PyObject *
     swig_varlink_getattr(swig_varlinkobject *v, char *n) {
         swig_globalvar *var = v->vars;
         while (var) {
@@ -6567,7 +6845,7 @@
         return NULL;
     }
     
-    static int
+    SWIGINTERN int
     swig_varlink_setattr(swig_varlinkobject *v, char *n, PyObject *p) {
         swig_globalvar *var = v->vars;
         while (var) {
@@ -6580,72 +6858,89 @@
         return 1;
     }
     
-    static PyTypeObject varlinktype = {
-        PyObject_HEAD_INIT(0)              
-        0,                                  /* Number of items in variable part (ob_size) */
-        (char *)"swigvarlink",              /* Type name (tp_name) */
-        sizeof(swig_varlinkobject),         /* Basic size (tp_basicsize) */
-        0,                                  /* Itemsize (tp_itemsize) */
-        0,                                  /* Deallocator (tp_dealloc) */ 
-        (printfunc) swig_varlink_print,     /* Print (tp_print) */
-        (getattrfunc) swig_varlink_getattr, /* get attr (tp_getattr) */
-        (setattrfunc) swig_varlink_setattr, /* Set attr (tp_setattr) */
-        0,                                  /* tp_compare */
-        (reprfunc) swig_varlink_repr,       /* tp_repr */
-        0,                                  /* tp_as_number */
-        0,                                  /* tp_as_sequence */
-        0,                                  /* tp_as_mapping */
-        0,                                  /* tp_hash */
-        0,                                  /* tp_call */
-        0,                                  /* tp_str */
-        0,                                  /* tp_getattro */
-        0,                                  /* tp_setattro */
-        0,                                  /* tp_as_buffer */
-        0,                                  /* tp_flags */
-        0,                                  /* tp_doc */
+    SWIGINTERN PyTypeObject*
+    swig_varlink_type(void) {
+        static char varlink__doc__[] = "Swig var link object";
+        static PyTypeObject varlink_type
+#if !defined(__cplusplus)
+        ;
+        static int type_init = 0;  
+        if (!type_init) {
+            PyTypeObject tmp
+#endif
+            = {
+                PyObject_HEAD_INIT(&PyType_Type)
+                0,                                  /* Number of items in variable part (ob_size) */
+                (char *)"swigvarlink",              /* Type name (tp_name) */
+                sizeof(swig_varlinkobject),         /* Basic size (tp_basicsize) */
+                0,                                  /* Itemsize (tp_itemsize) */
+                0,                                  /* Deallocator (tp_dealloc) */ 
+                (printfunc) swig_varlink_print,     /* Print (tp_print) */
+                (getattrfunc) swig_varlink_getattr, /* get attr (tp_getattr) */
+                (setattrfunc) swig_varlink_setattr, /* Set attr (tp_setattr) */
+                0,                                  /* tp_compare */
+                (reprfunc) swig_varlink_repr,       /* tp_repr */
+                0,                                  /* tp_as_number */
+                0,                                  /* tp_as_sequence */
+                0,                                  /* tp_as_mapping */
+                0,                                  /* tp_hash */
+                0,                                  /* tp_call */
+                0,                                  /* tp_str */
+                0,                                  /* tp_getattro */
+                0,                                  /* tp_setattro */
+                0,                                  /* tp_as_buffer */
+                0,                                  /* tp_flags */
+                varlink__doc__,                     /* tp_doc */
 #if PY_VERSION_HEX >= 0x02000000
-        0,                                  /* tp_traverse */
-        0,                                  /* tp_clear */
+                0,                                  /* tp_traverse */
+                0,                                  /* tp_clear */
 #endif
 #if PY_VERSION_HEX >= 0x02010000
-        0,                                  /* tp_richcompare */
-        0,                                  /* tp_weaklistoffset */
+                0,                                  /* tp_richcompare */
+                0,                                  /* tp_weaklistoffset */
 #endif
 #if PY_VERSION_HEX >= 0x02020000
-        0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, /* tp_iter -> tp_weaklist */
+                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, /* tp_iter -> tp_weaklist */
 #endif
 #if PY_VERSION_HEX >= 0x02030000
-        0,                                  /* tp_del */
+                0,                                  /* tp_del */
 #endif
 #ifdef COUNT_ALLOCS
-        0,0,0,0                             /* tp_alloc -> tp_next */
+                0,0,0,0                             /* tp_alloc -> tp_next */
 #endif
-    };
+            };
+#if !defined(__cplusplus)
+            varlink_type = tmp;
+            type_init = 1;
+        }
+#endif
+        return &varlink_type;
+    }
     
     /* Create a variable linking object for use later */
-    static PyObject *
+    SWIGINTERN PyObject *
     SWIG_Python_newvarlink(void) {
-        swig_varlinkobject *result = 0;
-        result = PyMem_NEW(swig_varlinkobject,1);
-        varlinktype.ob_type = &PyType_Type;    /* Patch varlinktype into a PyType */
-        result->ob_type = &varlinktype;
-        result->vars = 0;
-        result->ob_refcnt = 0;
-        Py_XINCREF((PyObject *) result);
+        swig_varlinkobject *result = PyObject_NEW(swig_varlinkobject, swig_varlink_type());
+        if (result) {
+            result->vars = 0;
+        }
         return ((PyObject*) result);
     }
     
-    static void
+    SWIGINTERN void 
     SWIG_Python_addvarlink(PyObject *p, char *name, PyObject *(*get_attr)(void), int (*set_attr)(PyObject *p)) {
-        swig_varlinkobject *v;
-        swig_globalvar *gv;
-        v= (swig_varlinkobject *) p;
-        gv = (swig_globalvar *) malloc(sizeof(swig_globalvar));
-        gv->name = (char *) malloc(strlen(name)+1);
-        strcpy(gv->name,name);
-        gv->get_attr = get_attr;
-        gv->set_attr = set_attr;
-        gv->next = v->vars;
+        swig_varlinkobject *v = (swig_varlinkobject *) p;
+        swig_globalvar *gv = (swig_globalvar *) malloc(sizeof(swig_globalvar));
+        if (gv) {
+            size_t size = strlen(name)+1;
+            gv->name = (char *)malloc(size);
+            if (gv->name) {
+                strncpy(gv->name,name,size);
+                gv->get_attr = get_attr;
+                gv->set_attr = set_attr;
+                gv->next = v->vars;
+            }
+        }
         v->vars = gv;
     }
     
@@ -6654,11 +6949,11 @@
      * ----------------------------------------------------------------------------- */
     
     /* Install Constants */
-    static void
+    SWIGINTERN void
     SWIG_Python_InstallConstants(PyObject *d, swig_const_info constants[]) {
         PyObject *obj = 0;
         size_t i;
-        for (i = 0; constants[i].type; i++) {
+        for (i = 0; constants[i].type; ++i) {
             switch(constants[i].type) {
                 case SWIG_PY_INT:
                 obj = PyInt_FromLong(constants[i].lvalue);
@@ -6695,7 +6990,7 @@
     /* Fix SwigMethods to carry the callback ptrs when needed */
     /* -----------------------------------------------------------------------------*/
     
-    static void
+    SWIGINTERN void
     SWIG_Python_FixMethods(PyMethodDef *methods,
     swig_const_info *const_table,
     swig_type_info **types,
@@ -6707,7 +7002,7 @@
                 int j;
                 swig_const_info *ci = 0;
                 char *name = c + 10;
-                for (j = 0; const_table[j].type; j++) {
+                for (j = 0; const_table[j].type; ++j) {
                     if (strncmp(const_table[j].name, name, 
                     strlen(const_table[j].name)) == 0) {
                         ci = &(const_table[j]);
@@ -6720,14 +7015,18 @@
                     size_t ldoc = (c - methods[i].ml_doc);
                     size_t lptr = strlen(ty->name)+2*sizeof(void*)+2;
                     char *ndoc = (char*)malloc(ldoc + lptr + 10);
-                    char *buff = ndoc;
-                    void *ptr = (ci->type == SWIG_PY_POINTER) ? ci->pvalue: (void *)(ci->lvalue);
-                    strncpy(buff, methods[i].ml_doc, ldoc);
-                    buff += ldoc;
-                    strncpy(buff, "swig_ptr: ", 10);
-                    buff += 10;
-                    SWIG_PackVoidPtr(buff, ptr, ty->name, lptr);
-                    methods[i].ml_doc = ndoc;
+                    if (ndoc) {
+                        char *buff = ndoc;
+                        void *ptr = (ci->type == SWIG_PY_POINTER) ? ci->pvalue : 0;
+                        if (ptr) {
+                            strncpy(buff, methods[i].ml_doc, ldoc);
+                            buff += ldoc;
+                            strncpy(buff, "swig_ptr: ", 10);
+                            buff += 10;
+                            SWIG_PackVoidPtr(buff, ptr, ty->name, lptr);
+                            methods[i].ml_doc = ndoc;
+                        }
+                    }
                 }
             }
         }
@@ -6740,7 +7039,7 @@
 #if PY_MAJOR_VERSION < 2
     /* PyModule_AddObject function was introduced in Python 2.0.  The following function
     is copied out of Python/modsupport.c in python version 2.3.4 */
-    static int
+    SWIGINTERN int
     PyModule_AddObject(PyObject *m, char *name, PyObject *o)
     {
         PyObject *dict;
@@ -6769,37 +7068,6 @@
     }
 #endif
     
-    static swig_type_info **
-    SWIG_Python_SetTypeListHandle(swig_type_info **type_list_handle) {
-        static PyMethodDef swig_empty_runtime_method_table[] = {
-            {
-                NULL, NULL, 0, NULL
-            } 
-        };/* Sentinel */
-        
-        PyObject *module = Py_InitModule((char*)"swig_runtime_data" SWIG_RUNTIME_VERSION,
-        swig_empty_runtime_method_table);
-        PyObject *pointer = PyCObject_FromVoidPtr((void *) type_list_handle, NULL);
-        if (pointer && module) {
-            PyModule_AddObject(module, (char*)"type_pointer" SWIG_TYPE_TABLE_NAME, pointer);
-        }
-        return type_list_handle;
-    } 
-    
-    static swig_type_info **
-    SWIG_Python_LookupTypePointer(swig_type_info **type_list_handle) {
-        swig_type_info **type_pointer;
-        
-        /* first check if module already created */
-        type_pointer = SWIG_Python_GetTypeListHandle();
-        if (type_pointer) {
-            return type_pointer;
-        } else {
-            /* create a new module and variable */
-            return SWIG_Python_SetTypeListHandle(type_list_handle);
-        }
-    }
-    
 #ifdef __cplusplus
 }
 #endif
@@ -6808,42 +7076,21 @@
  *  Partial Init method
  * -----------------------------------------------------------------------------*/
 
-#ifdef SWIG_LINK_RUNTIME
 #ifdef __cplusplus
 extern "C"
 #endif
-SWIGEXPORT(void *) SWIG_ReturnGlobalTypeList(void *);
-#endif
-
-#ifdef __cplusplus
-extern "C"
-#endif
-SWIGEXPORT(void) SWIG_init(void) {
+SWIGEXPORT void SWIG_init(void) {
     static PyObject *SWIG_globals = 0; 
-    static int       typeinit = 0;
     PyObject *m, *d;
-    int       i;
     if (!SWIG_globals) SWIG_globals = SWIG_newvarlink();
     
     /* Fix SwigMethods to carry the callback ptrs when needed */
-    SWIG_Python_FixMethods(SwigMethods, swig_const_table, swig_types, swig_types_initial);
+    SWIG_Python_FixMethods(SwigMethods, swig_const_table, swig_types, swig_type_initial);
     
     m = Py_InitModule((char *) SWIG_name, SwigMethods);
     d = PyModule_GetDict(m);
     
-    if (!typeinit) {
-#ifdef SWIG_LINK_RUNTIME
-        swig_type_list_handle = (swig_type_info **) SWIG_ReturnGlobalTypeList(swig_type_list_handle);
-#else
-#  ifndef SWIG_STATIC_RUNTIME
-        swig_type_list_handle = SWIG_Python_LookupTypePointer(swig_type_list_handle);
-#  endif
-#endif
-        for (i = 0; swig_types_initial[i]; i++) {
-            swig_types[i] = SWIG_TypeRegister(swig_types_initial[i]);
-        }
-        typeinit = 1;
-    }
+    SWIG_InitializeModule(0);
     SWIG_InstallConstants(d,swig_const_table);
     
     PyDict_SetItemString(d,(char*)"cvar", SWIG_globals);

Modified: trunk/source/tml/eventmanager.cpp
===================================================================
--- trunk/source/tml/eventmanager.cpp	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/tml/eventmanager.cpp	2005-08-15 19:18:30 UTC (rev 180)
@@ -174,6 +174,16 @@
   return distanceXThen<TEventDistanceLessThen2Obj>(obj1, obj2, dist, script);
 }
 
+int EventManager::jumpToSystem(const std::string& system, const std::string& script)
+{
+	STACKTRACE;
+	TEventJumpToSystem* e = new TEventJumpToSystem();
+    boost::shared_ptr<TGameEvent> ev( e );
+    int ret = e->setUp(system, script);
+    g_events.push_back(ev);
+    return ret;
+}
+
 void EventManager::AddEventCondition(double id, const std::string& script)
 {
   std::list<boost::shared_ptr<TGameEvent> >::iterator e = std::find_if(g_events.begin(), 

Modified: trunk/source/tml/eventmanager.h
===================================================================
--- trunk/source/tml/eventmanager.h	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/tml/eventmanager.h	2005-08-15 19:18:30 UTC (rev 180)
@@ -108,6 +108,14 @@
   /// @return event id
   static int distanceLessThen(double obj1, double obj2, double dist, const std::string& script);
 
+  /// Call function if player enter star system
+  ///
+  ///
+  /// @param system - system where player must enter
+  /// @param script - function to call
+  /// @return event id
+  static int jumpToSystem(const std::string& system, const std::string& script);
+
   /// Additional condition must be true to trigger event
   static void AddEventCondition(double id, const std::string& script);
 

Modified: trunk/source/tml/gameevent.cpp
===================================================================
--- trunk/source/tml/gameevent.cpp	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/tml/gameevent.cpp	2005-08-15 19:18:30 UTC (rev 180)
@@ -541,4 +541,22 @@
 }
 ////////////////////////////////////////////////////////////////////////////////////////////////////
 
+bool TEventJumpToSystem::calculate()
+{
+	if(game->_name==m_destSystem)
+	{
+		trigger();
+		return true;
+	}
+	return false;
+}
 
+int TEventJumpToSystem::setUp(const std::string& system, const std::string& script)
+{
+	_script      = script;
+	m_destSystem = system;
+	return id;
+}
+
+
+

Modified: trunk/source/tml/gameevent.h
===================================================================
--- trunk/source/tml/gameevent.h	2005-08-14 20:14:57 UTC (rev 179)
+++ trunk/source/tml/gameevent.h	2005-08-15 19:18:30 UTC (rev 180)
@@ -36,6 +36,7 @@
       SHIP_DEATH_BY_TYPE,
       DISTANCE,
       MOVE,
+	  JUMPED_TO_SYSTEM,
   };
 };
 
@@ -301,4 +302,20 @@
 };
 
 
+typedef TOneTimeEvent TEventJumpToSystemBase;
+
+class TEventJumpToSystem : public TEventJumpToSystemBase
+{
+	std::string m_destSystem;
+ public:
+  virtual bool calculate();
+  /// setup event 
+  ///
+  /// @param system system to jump
+  /// @param script function to call
+  /// @return event id
+  virtual int setUp(const std::string& system, const std::string& script);
+  virtual int type(){return TGameEventType::JUMPED_TO_SYSTEM;}
+};
+
 #endif



From yurand at berlios.de  Wed Aug 17 19:20:36 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Wed, 17 Aug 2005 19:20:36 +0200
Subject: [Tw-light-svn] r181 - in trunk: . doc gamedata/default_ini gamedata/games/test_game/scripts gamedata/games/test_game/scripts/systems gamedata/python source/generated source/tml
Message-ID: <200508171720.j7HHKauQ012101@sheep.berlios.de>

Author: yurand
Date: 2005-08-17 19:20:16 +0200 (Wed, 17 Aug 2005)
New Revision: 181

Modified:
   trunk/doc/Doxyfile
   trunk/gamedata/default_ini/fleets.ini
   trunk/gamedata/default_ini/scp.ini
   trunk/gamedata/games/test_game/scripts/flags.py
   trunk/gamedata/games/test_game/scripts/quests.py
   trunk/gamedata/games/test_game/scripts/start.py
   trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
   trunk/gamedata/python/tml.py
   trunk/makefile
   trunk/source/generated/tml.py
   trunk/source/generated/tml_wrap.cpp
   trunk/source/tml/gameaction.cpp
   trunk/source/tml/gameaction.h
Log:
Zoq-Fot-Pik quest

Modified: trunk/doc/Doxyfile
===================================================================
--- trunk/doc/Doxyfile	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/doc/Doxyfile	2005-08-17 17:20:16 UTC (rev 181)
@@ -4,7 +4,7 @@
 # General configuration options
 #---------------------------------------------------------------------------
 PROJECT_NAME           = TW-Light
-PROJECT_NUMBER=0.3r148M
+PROJECT_NUMBER=0.3r179M
 OUTPUT_DIRECTORY       = ./doc
 OUTPUT_LANGUAGE        = English
 USE_WINDOWS_ENCODING   = YES

Modified: trunk/gamedata/default_ini/fleets.ini
===================================================================
--- trunk/gamedata/default_ini/fleets.ini	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/default_ini/fleets.ini	2005-08-17 17:20:16 UTC (rev 181)
@@ -1,75 +1,76 @@
-[Player1]
-Slot0 = earcr
-Slot1 = thrto
-Slot2 = chebr
-Slot3 = orzne
-Slot4 = druma
-Slot5 = meltr
-Slot6 = chmav
-Slot7 = kohma
-Slot8 = utwju
-Slot9 = andgu
-Slot10 = ilwav
-Slot11 = kzedr
-Slot12 = yehte
-Slot13 = syrpe
-Slot14 = spael
-Slot15 = vuxin
-Slot16 = umgdr
-Slot17 = supbl
-Slot18 = pkufu
-Slot19 = slypr
-Slot20 = arisk
-Slot21 = zfpst
-Slot22 = mycpo
-Slot23 = mmrxf
-Slot24 = shosc
-Size = 25
-MaxFleetCost = 500
-Name = Player1
-Type = Keyboard/Joystick
-Team = 1
-Channel = 12
-StartingFleetCost = 633
-StartingFleetSize = 24
-
-[Player2]
-Slot0 = tauar
-Slot1 = tauda
-Slot2 = hydcr
-Slot3 = forsh
-Slot4 = dragr
-Slot5 = tausl
-Slot6 = tauto
-Slot7 = garty
-Slot8 = djila
-Slot9 = zeksh
-Slot10 = conca
-Slot11 = choex
-Slot12 = conho
-Slot13 = ilwsp
-Slot14 = rekas
-Slot15 = bahbu
-Slot16 = bipka
-Slot17 = earc2
-Slot18 = earc3
-Slot19 = kahbo
-Size = 20
-MaxFleetCost = 500
-Name = Player2
-Type = WussieBot
-Team = 2
-Channel = 12
-StartingFleetCost = 513
-StartingFleetSize = 22
-
-[Player3]
-Slot0 = alabc
-Slot1 = staba
-Size = 2
-MaxFleetCost = 500
-Type = WussieBot
-Team = 2
-Channel = 12
-StartingFleetCost = 513
-StartingFleetSize = 22
+[Player1]
+Slot0 = earcr
+Slot1 = thrto
+Slot2 = chebr
+Slot3 = orzne
+Slot4 = druma
+Slot5 = meltr
+Slot6 = chmav
+Slot7 = kohma
+Slot8 = utwju
+Slot9 = andgu
+Slot10 = ilwav
+Slot11 = kzedr
+Slot12 = yehte
+Slot13 = syrpe
+Slot14 = spael
+Slot15 = vuxin
+Slot16 = umgdr
+Slot17 = supbl
+Slot18 = pkufu
+Slot19 = slypr
+Slot20 = arisk
+Slot21 = zfpst
+Slot22 = mycpo
+Slot23 = mmrxf
+Slot24 = shosc
+Size = 25
+MaxFleetCost = 500
+Name = Player1
+Type = Keyboard/Joystick
+Team = 1
+Channel = 12
+StartingFleetCost = 633
+StartingFleetSize = 24
+
+[Player2]
+Slot0 = tauar
+Slot1 = tauda
+Slot2 = hydcr
+Slot3 = forsh
+Slot4 = dragr
+Slot5 = tausl
+Slot6 = tauto
+Slot7 = garty
+Slot8 = djila
+Slot9 = zeksh
+Slot10 = conca
+Slot11 = choex
+Slot12 = conho
+Slot13 = ilwsp
+Slot14 = rekas
+Slot15 = bahbu
+Slot16 = bipka
+Slot17 = earc2
+Slot18 = earc3
+Slot19 = kahbo
+Size = 20
+MaxFleetCost = 500
+Name = Player2
+Type = WussieBot
+Team = 2
+Channel = 12
+StartingFleetCost = 513
+StartingFleetSize = 22
+
+[Player3]
+Slot0 = staba
+Slot1 = staba
+Size = 3
+MaxFleetCost = 500
+Type = WussieBot
+Team = 2
+Channel = 12
+StartingFleetCost = 513
+StartingFleetSize = 22
+Slot2 = staba

Modified: trunk/gamedata/default_ini/scp.ini
===================================================================
--- trunk/gamedata/default_ini/scp.ini	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/default_ini/scp.ini	2005-08-17 17:20:16 UTC (rev 181)
@@ -1,188 +1,188 @@
-[Limits]
-MaxPlayers = 20
-MaxConfigurations = 4
-MaxTeams = 6
-
-
-[Config0]
-Thrust = 84
-Left = 82
-Right = 83
-Fire = 67
-AltFire = 63
-Special = 106
-Next_Target = 65
-Prev_Target = 66
-Closest_Target = 16
-Backwards = 85
-Extra1 = 0
-Extra2 = 0
-Extra3 = 0
-Extra4 = 0
-Extra5 = 0
-Extra6 = 0
-
-[Config1]
-Backwards = 19
-Thrust = 23
-Left = 1
-Right = 4
-Fire = 10
-AltFire = 14
-Special = 11
-Next_Target = 6
-Prev_Target = 7
-Closest_Target = 7
-Extra1 = 0
-Extra2 = 0
-Extra3 = 0
-Extra4 = 0
-Extra5 = 0
-Extra6 = 0
-
-
-[Config2]
-Thrust = 0
-Left = 0
-Right = 0
-Fire = 0
-AltFire = 0
-Special = 0
-Next_Target = 0
-Prev_Target = 0
-Closest_Target = 0
-
-
-[Config3]
-Thrust = 0
-Left = 0
-Right = 0
-Fire = 0
-AltFire = 0
-Special = 0
-Next_Target = 0
-Prev_Target = 0
-Closest_Target = 0
-
-
-[Player1]
-Type = Human
-Config = 0
-Team = 1
-
-
-[Player2]
-Type = WussieBot
-Config = 1
-Team = 2
-
-
-[Player3]
-Type = WussieBot
-Config = 2
-Team = 2
-
-
-[Player4]
-Type = none
-Config = 3
-Team = 2
-
-
-[Player5]
-Type = none
-Config = 0
-Team = 2
-
-
-[Player6]
-Type = none
-Config = 1
-Team = 2
-
-
-[Player7]
-Type = none
-Config = 2
-Team = 1
-
-
-[Player8]
-Type = none
-Config = 3
-Team = 1
-
-
-[Player9]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player10]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player11]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player12]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player13]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player14]
-Type = none
-Config = 1
-Team = 0
-
-
-[Player15]
-Type = none
-Config = 2
-Team = 0
-
-
-[Player16]
-Type = none
-Config = 3
-Team = 0
-
-
-[Player17]
-Type = none
-Config = 0
-Team = 0
-
-
-[Player18]
-Type = none
-Config = 1
-Team = 0
-
-
-[Player19]
-Type = none
-Config = 2
-Team = 0
-
-
-[Player20]
-Type = none
-Config = 3
-Team = 0
-
-
-
+[Limits]
+MaxPlayers = 20
+MaxConfigurations = 4
+MaxTeams = 6
+
+
+[Config0]
+Thrust = 84
+Left = 82
+Right = 83
+Fire = 67
+AltFire = 63
+Special = 106
+Next_Target = 65
+Prev_Target = 66
+Closest_Target = 16
+Backwards = 85
+Extra1 = 0
+Extra2 = 0
+Extra3 = 0
+Extra4 = 0
+Extra5 = 0
+Extra6 = 0
+
+[Config1]
+Backwards = 19
+Thrust = 23
+Left = 1
+Right = 4
+Fire = 10
+AltFire = 14
+Special = 11
+Next_Target = 6
+Prev_Target = 7
+Closest_Target = 7
+Extra1 = 0
+Extra2 = 0
+Extra3 = 0
+Extra4 = 0
+Extra5 = 0
+Extra6 = 0
+
+
+[Config2]
+Thrust = 0
+Left = 0
+Right = 0
+Fire = 0
+AltFire = 0
+Special = 0
+Next_Target = 0
+Prev_Target = 0
+Closest_Target = 0
+
+
+[Config3]
+Thrust = 0
+Left = 0
+Right = 0
+Fire = 0
+AltFire = 0
+Special = 0
+Next_Target = 0
+Prev_Target = 0
+Closest_Target = 0
+
+
+[Player1]
+Type = Human
+Config = 0
+Team = 1
+
+
+[Player2]
+Type = WussieBot
+Config = 1
+Team = 1
+
+
+[Player3]
+Type = WussieBot
+Config = 2
+Team = 2
+
+
+[Player4]
+Type = none
+Config = 3
+Team = 2
+
+
+[Player5]
+Type = none
+Config = 0
+Team = 2
+
+
+[Player6]
+Type = none
+Config = 1
+Team = 2
+
+
+[Player7]
+Type = none
+Config = 2
+Team = 1
+
+
+[Player8]
+Type = none
+Config = 3
+Team = 1
+
+
+[Player9]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player10]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player11]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player12]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player13]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player14]
+Type = none
+Config = 1
+Team = 0
+
+
+[Player15]
+Type = none
+Config = 2
+Team = 0
+
+
+[Player16]
+Type = none
+Config = 3
+Team = 0
+
+
+[Player17]
+Type = none
+Config = 0
+Team = 0
+
+
+[Player18]
+Type = none
+Config = 1
+Team = 0
+
+
+[Player19]
+Type = none
+Config = 2
+Team = 0
+
+
+[Player20]
+Type = none
+Config = 3
+Team = 0
+
+
+

Modified: trunk/gamedata/games/test_game/scripts/flags.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/flags.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/games/test_game/scripts/flags.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -26,11 +26,14 @@
     
     # Mission 4 Zoq-Fot-Pik ambassador
     m4_status     = 0
+    m4_terrorist1 = -1
+    m4_terrorist2 = -1
     
     # Locations
-    ixis_mining_station  = -1
-    ixis_chorali_station = -1
-    precursor_wreck_id   = -1
+    ixis_mining_station         = -1
+    ixis_chorali_station        = -1
+    precursor_wreck_id          = -1
+    gamaonyx_drax_station       = -1
     
     # Know How
     use_tin_device = 0

Modified: trunk/gamedata/games/test_game/scripts/quests.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/quests.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/games/test_game/scripts/quests.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -63,8 +63,54 @@
 def zoq_fot_pik_ambassador_func():
     gflag.current_mission = """ You must escort Zoq-Fot-Pik ambassador."""
     gflag.m4_status = MISSION_IN_PROGRESS
+    tml.EventManager.jumpToSystem('Gama Onyx', 'zoq_fot_pik_ambassador_jump_to_gama_onyx')
+
+def zoq_fot_pik_ambassador_jump_to_gama_onyx():
+    gflag.m4_ambasador = tml.GameAction.add_ship('Gama Onyx',"zfpst",
+                                                 tml.GameAction.get_location_pos_x(tml.GameAction.get_player_ship_id())+50,
+                                                 tml.GameAction.get_location_pos_y(tml.GameAction.get_player_ship_id())+50,
+                                                 tml.GameAction.get_player_team())
+    dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/zoq-fot-pik.xml"))
+    tml.GameAction.guard_location(gflag.m4_ambasador, tml.GameAction.get_player_ship_id(), 300)
+    tml.GameAction.set_crew(gflag.m4_ambasador, 1)
+    tml.EventManager.shipDeathById(gflag.m4_ambasador,'zoq_fot_pik_ambassador_death')
+    tml.EventManager.distanceLessThen(gflag.m4_ambasador,
+                                      gflag.gamaonyx_drax_station,
+                                      500,  'drax_terrorist_attack')
     gflag.m4_status = MISSION_COMPLETED
+
+def zoq_fot_pik_ambassador_death():
+    if gflag.m4_status == MISSION_COMPLETED:
+        return
+    if tml.GameAction.exist(gflag.m4_terrorist1) or tml.GameAction.exist(gflag.m4_terrorist2):
+        return
+    gflag.m4_status == MISSION_FAILED
     
+def drax_terrorist_attack():
+    gflag.m4_terrorist1 = tml.GameAction.add_ship('Gama Onyx', "dragr",
+                                                  tml.GameAction.get_location_pos_x(gflag.gamaonyx_drax_station),
+                                                  tml.GameAction.get_location_pos_y(gflag.gamaonyx_drax_station)+25,
+                                                  tml.GameAction.get_enemy_team())
+
+    gflag.m4_terrorist2 = tml.GameAction.add_ship('Gama Onyx', "dragr",
+                                                  tml.GameAction.get_location_pos_x(gflag.gamaonyx_drax_station),
+                                                  tml.GameAction.get_location_pos_y(gflag.gamaonyx_drax_station)-25,
+                                                  tml.GameAction.get_enemy_team())
+    tml.EventManager.shipDeathById(gflag.m4_terrorist1,'zoq_fot_pik_ambassador_terrorist_death')
+    tml.EventManager.shipDeathById(gflag.m4_terrorist2,'zoq_fot_pik_ambassador_terrorist_death')
+    tml.GameAction.set_target(gflag.m4_terrorist1, gflag.m4_ambasador)
+    tml.GameAction.set_target(gflag.m4_terrorist2, gflag.m4_ambasador)
+    tml.GameAction.set_crew(gflag.m4_terrorist1, 1)
+    tml.GameAction.set_crew(gflag.m4_terrorist2, 1)
+    
+def zoq_fot_pik_ambassador_terrorist_death():
+    if tml.GameAction.exist(gflag.m4_terrorist1) or tml.GameAction.exist(gflag.m4_terrorist2):
+        return
+    gflag.m4_status = MISSION_COMPLETED
+    if tml.GameAction.exist(gflag.m4_ambasador):
+        dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/zoq-fot-pik.xml"))
+        tml.GameAction.remove_location(gflag.m4_ambasador)
+    
 ############################################################################################################
 # Mission 5
 def capture_precursor_battleship_func():

Modified: trunk/gamedata/games/test_game/scripts/start.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/start.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/games/test_game/scripts/start.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -26,6 +26,15 @@
 def print_hello_world():
     print "Hello world Jump to system works"
 
+zoq_fot_pik_ambassador_func()
+
+# tml.EventManager.setRepeatableTimeEvent(1, "print_pos")
+
+
+# def print_pos():
+#     print tml.GameAction.get_location_pos_x(tml.GameAction.get_player_ship_id())
+#     print tml.GameAction.get_location_pos_y(tml.GameAction.get_player_ship_id())
+    
 # Start quests
 
 #capture_precursor_battleship_func()

Modified: trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/games/test_game/scripts/systems/gamaonyx.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -6,7 +6,8 @@
 tml.GameAction.add_system('Gama Onyx',200, 200)
 
 tml.GameAction.add_planet('Gama Onyx','I', 1500, 1800)
-tml.GameAction.add_orbiter_station('Gama Onyx',
+
+gflag.gamaonyx_drax_station = tml.GameAction.add_orbiter_station('Gama Onyx',
                            'I',
                            'gob.dat',
                            'station0sprite',

Modified: trunk/gamedata/python/tml.py
===================================================================
--- trunk/gamedata/python/tml.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/gamedata/python/tml.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -91,6 +91,12 @@
     if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
     __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
     if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
+    __swig_getmethods__["get_location_pos_x"] = lambda x: _tml.GameAction_get_location_pos_x
+    if _newclass:get_location_pos_x = staticmethod(_tml.GameAction_get_location_pos_x)
+    __swig_getmethods__["get_location_pos_y"] = lambda x: _tml.GameAction_get_location_pos_y
+    if _newclass:get_location_pos_y = staticmethod(_tml.GameAction_get_location_pos_y)
+    __swig_getmethods__["exist"] = lambda x: _tml.GameAction_exist
+    if _newclass:exist = staticmethod(_tml.GameAction_exist)
     __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
     if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
     __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
@@ -163,6 +169,12 @@
 
 GameAction_set_crew = _tml.GameAction_set_crew
 
+GameAction_get_location_pos_x = _tml.GameAction_get_location_pos_x
+
+GameAction_get_location_pos_y = _tml.GameAction_get_location_pos_y
+
+GameAction_exist = _tml.GameAction_exist
+
 GameAction_end_game = _tml.GameAction_end_game
 
 GameAction_scroll_text = _tml.GameAction_scroll_text

Modified: trunk/makefile
===================================================================
--- trunk/makefile	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/makefile	2005-08-17 17:20:16 UTC (rev 181)
@@ -174,7 +174,7 @@
 
 
 source/generated/tml_wrap.cpp: source/python/game.i source/tml/gameaction.h source/util/sound.h source/tml/gameconfig.h source/tml/gamedialog.h source/tml/eventmanager.h
-	$(SWIG) -c++ -python -o source/generated/tml_wrap.cpp source/python/game.i
+	$(SWIG) -c++ -python -o source/generated/tml_wrap.cpp -outdir source/generated/ source/python/game.i
 	cp source/generated/tml.py $(DATAPATH)/python/
 
 

Modified: trunk/source/generated/tml.py
===================================================================
--- trunk/source/generated/tml.py	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/source/generated/tml.py	2005-08-17 17:20:16 UTC (rev 181)
@@ -91,6 +91,12 @@
     if _newclass:remove_location = staticmethod(_tml.GameAction_remove_location)
     __swig_getmethods__["set_crew"] = lambda x: _tml.GameAction_set_crew
     if _newclass:set_crew = staticmethod(_tml.GameAction_set_crew)
+    __swig_getmethods__["get_location_pos_x"] = lambda x: _tml.GameAction_get_location_pos_x
+    if _newclass:get_location_pos_x = staticmethod(_tml.GameAction_get_location_pos_x)
+    __swig_getmethods__["get_location_pos_y"] = lambda x: _tml.GameAction_get_location_pos_y
+    if _newclass:get_location_pos_y = staticmethod(_tml.GameAction_get_location_pos_y)
+    __swig_getmethods__["exist"] = lambda x: _tml.GameAction_exist
+    if _newclass:exist = staticmethod(_tml.GameAction_exist)
     __swig_getmethods__["end_game"] = lambda x: _tml.GameAction_end_game
     if _newclass:end_game = staticmethod(_tml.GameAction_end_game)
     __swig_getmethods__["scroll_text"] = lambda x: _tml.GameAction_scroll_text
@@ -163,6 +169,12 @@
 
 GameAction_set_crew = _tml.GameAction_set_crew
 
+GameAction_get_location_pos_x = _tml.GameAction_get_location_pos_x
+
+GameAction_get_location_pos_y = _tml.GameAction_get_location_pos_y
+
+GameAction_exist = _tml.GameAction_exist
+
 GameAction_end_game = _tml.GameAction_end_game
 
 GameAction_scroll_text = _tml.GameAction_scroll_text

Modified: trunk/source/generated/tml_wrap.cpp
===================================================================
--- trunk/source/generated/tml_wrap.cpp	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/source/generated/tml_wrap.cpp	2005-08-17 17:20:16 UTC (rev 181)
@@ -1568,6 +1568,15 @@
 /*@@*/
 
 
+SWIGINTERNINLINE PyObject*
+  SWIG_From_bool(bool value)
+{
+  PyObject *obj = value ? Py_True : Py_False;
+  Py_INCREF(obj);
+  return obj;
+}
+
+
 #include <limits.h>
 
 
@@ -1714,15 +1723,6 @@
   return SWIG_AsVal_bool(obj, (bool*)0);
 }
 
-
-SWIGINTERNINLINE PyObject*
-  SWIG_From_bool(bool value)
-{
-  PyObject *obj = value ? Py_True : Py_False;
-  Py_INCREF(obj);
-  return obj;
-}
-
 extern SoundSystem *tw_sound;
 SoundSystem *GetSoundSystem();
 
@@ -3859,6 +3859,72 @@
 }
 
 
+static PyObject *_wrap_GameAction_get_location_pos_x(PyObject *, PyObject *args) {
+    PyObject *resultobj = NULL;
+    double arg1 ;
+    int result;
+    PyObject * obj0 = 0 ;
+    
+    if(!PyArg_ParseTuple(args,(char *)"O:GameAction_get_location_pos_x",&obj0)) goto fail;
+    {
+        arg1 = (double)(SWIG_As_double(obj0)); 
+        if (SWIG_arg_fail(1)) SWIG_fail;
+    }
+    result = (int)GameAction::get_location_pos_x(arg1);
+    
+    {
+        resultobj = SWIG_From_int((int)(result)); 
+    }
+    return resultobj;
+    fail:
+    return NULL;
+}
+
+
+static PyObject *_wrap_GameAction_get_location_pos_y(PyObject *, PyObject *args) {
+    PyObject *resultobj = NULL;
+    double arg1 ;
+    int result;
+    PyObject * obj0 = 0 ;
+    
+    if(!PyArg_ParseTuple(args,(char *)"O:GameAction_get_location_pos_y",&obj0)) goto fail;
+    {
+        arg1 = (double)(SWIG_As_double(obj0)); 
+        if (SWIG_arg_fail(1)) SWIG_fail;
+    }
+    result = (int)GameAction::get_location_pos_y(arg1);
+    
+    {
+        resultobj = SWIG_From_int((int)(result)); 
+    }
+    return resultobj;
+    fail:
+    return NULL;
+}
+
+
+static PyObject *_wrap_GameAction_exist(PyObject *, PyObject *args) {
+    PyObject *resultobj = NULL;
+    double arg1 ;
+    bool result;
+    PyObject * obj0 = 0 ;
+    
+    if(!PyArg_ParseTuple(args,(char *)"O:GameAction_exist",&obj0)) goto fail;
+    {
+        arg1 = (double)(SWIG_As_double(obj0)); 
+        if (SWIG_arg_fail(1)) SWIG_fail;
+    }
+    result = (bool)GameAction::exist(arg1);
+    
+    {
+        resultobj = SWIG_From_bool((bool)(result)); 
+    }
+    return resultobj;
+    fail:
+    return NULL;
+}
+
+
 static PyObject *_wrap_GameAction_end_game(PyObject *, PyObject *args) {
     PyObject *resultobj = NULL;
     
@@ -6477,6 +6543,9 @@
 	 { (char *)"GameAction_get_player_team", _wrap_GameAction_get_player_team, METH_VARARGS, NULL},
 	 { (char *)"GameAction_remove_location", _wrap_GameAction_remove_location, METH_VARARGS, NULL},
 	 { (char *)"GameAction_set_crew", _wrap_GameAction_set_crew, METH_VARARGS, NULL},
+	 { (char *)"GameAction_get_location_pos_x", _wrap_GameAction_get_location_pos_x, METH_VARARGS, NULL},
+	 { (char *)"GameAction_get_location_pos_y", _wrap_GameAction_get_location_pos_y, METH_VARARGS, NULL},
+	 { (char *)"GameAction_exist", _wrap_GameAction_exist, METH_VARARGS, NULL},
 	 { (char *)"GameAction_end_game", _wrap_GameAction_end_game, METH_VARARGS, NULL},
 	 { (char *)"GameAction_scroll_text", _wrap_GameAction_scroll_text, METH_VARARGS, NULL},
 	 { (char *)"GameAction_print_message", _wrap_GameAction_print_message, METH_VARARGS, NULL},

Modified: trunk/source/tml/gameaction.cpp
===================================================================
--- trunk/source/tml/gameaction.cpp	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/source/tml/gameaction.cpp	2005-08-17 17:20:16 UTC (rev 181)
@@ -295,3 +295,34 @@
       tw_error( (std::string("Requesting unknown camera mode : ") + mode).c_str());
     }
 }
+
+int GameAction::get_location_pos_x(double id)
+{
+	SpaceLocation* l  =  twl::get_location((int)id);
+	if(l && l->exists())
+	{
+		return l->normal_pos().x;
+	}
+	return -1;
+}
+
+ 
+int GameAction::get_location_pos_y(double id)
+{
+	SpaceLocation* l  =  twl::get_location((int)id);
+	if(l && l->exists())
+	{
+		return l->normal_pos().y;
+	}
+	return -1;
+}
+
+bool GameAction::exist(double id)
+{
+	SpaceLocation* l  =  twl::get_location((int)id);
+	if(l && l->exists())
+	{
+		return true;
+	}
+	return false;
+}

Modified: trunk/source/tml/gameaction.h
===================================================================
--- trunk/source/tml/gameaction.h	2005-08-15 19:18:30 UTC (rev 180)
+++ trunk/source/tml/gameaction.h	2005-08-17 17:20:16 UTC (rev 181)
@@ -182,6 +182,21 @@
   /// @param crew new crew
   static void set_crew(double id, double crew);
 
+  /// Get x position of location
+  ///
+  /// @param id of location
+  static int get_location_pos_x(double id);
+
+  /// Get y position of location
+  ///
+  /// @param id of location
+  static int get_location_pos_y(double id);
+
+  /// Return true if location exist, false otherwise
+  ///
+  /// @param id of location
+  static bool exist(double id);
+
   /// The game is finished, return to main menu
   static void end_game();
 



From yurand at berlios.de  Wed Aug 17 20:08:09 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Wed, 17 Aug 2005 20:08:09 +0200
Subject: [Tw-light-svn] r182 - in trunk: gamedata/games/test_game/dialogs gamedata/games/test_game/scripts rawgraphic
Message-ID: <200508171808.j7HI89uL004850@sheep.berlios.de>

Author: yurand
Date: 2005-08-17 20:08:08 +0200 (Wed, 17 Aug 2005)
New Revision: 182

Added:
   trunk/gamedata/games/test_game/dialogs/drax.xml
   trunk/gamedata/games/test_game/dialogs/drax_terr.xml
   trunk/gamedata/games/test_game/dialogs/zoq-fot-pik.xml
   trunk/rawgraphic/Guph.jpg
   trunk/rawgraphic/pkunkyehat.jpg
   trunk/rawgraphic/vuxspathi.jpg
Modified:
   trunk/gamedata/games/test_game/scripts/quests.py
   trunk/gamedata/games/test_game/scripts/start.py
Log:
Adding missing files

Added: trunk/gamedata/games/test_game/dialogs/drax.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/drax.xml	2005-08-17 17:20:16 UTC (rev 181)
+++ trunk/gamedata/games/test_game/dialogs/drax.xml	2005-08-17 18:08:08 UTC (rev 182)
@@ -0,0 +1 @@
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Meet Druuge" music="music/races/yehat.mod" background="images/alien/drax.jpg" alien_text="Hello human, alien. We are temporary goverment of Drax nation. Unfortunatly we can't guarant your safty so please leave as soon as possible. " font="" text_location="(50,10)"><PLAYER_ANSWER text="About this..." appear_condition="1"><ACTION condition="1" action="goto(1)"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="Take this shit and leave" music="music/races/yehat.mod" background="images/alien/drax.jpg" alien_text="Oh, You want something for your trouble, here take this precursor artifact we borrow from Chorali and leave." font="" text_location="(50,10)"><PLAYER_ANSWER text="Bye" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION><ACTION condition="1" action="gflag.tin_device=1"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Added: trunk/gamedata/games/test_game/dialogs/drax_terr.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/drax_terr.xml	2005-08-17 17:20:16 UTC (rev 181)
+++ trunk/gamedata/games/test_game/dialogs/drax_terr.xml	2005-08-17 18:08:08 UTC (rev 182)
@@ -0,0 +1 @@
+<DIALOG><START_DIALOG></START_DIALOG><END_DIALOG></END_DIALOG><NODES><NODE id="0" name="Drax meet" music="music/races/yehat.mod" background="images/alien/drax.jpg" alien_text="Invader, you must die!!!!!!!!" font="" text_location="(50,10)"><PLAYER_ANSWER text="..." appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Added: trunk/gamedata/games/test_game/dialogs/zoq-fot-pik.xml
===================================================================
--- trunk/gamedata/games/test_game/dialogs/zoq-fot-pik.xml	2005-08-17 17:20:16 UTC (rev 181)
+++ trunk/gamedata/games/test_game/dialogs/zoq-fot-pik.xml	2005-08-17 18:08:08 UTC (rev 182)
@@ -0,0 +1 @@
+<DIALOG><START_DIALOG><ACTION condition="1" action="if gflag.m4_status == MISSION_COMPLETED:&#10;  goto(1)"></ACTION></START_DIALOG><END_DIALOG><ACTION condition="1" action=""></ACTION></END_DIALOG><NODES><NODE id="0" name="Meet Druuge" music="music/races/zoqfot.mod" background="images/alien/zoqfot.jpg" alien_text="Hello, human. Lets fly to 5000, 5000 Drax homeworld in this region of space" font="" text_location="(50,10)"><PLAYER_ANSWER text="With plesure" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE><NODE id="1" name="New node name" music="music/races/zoqfot.mod" background="images/alien/zoqfot.jpg" alien_text="Thanks, you really save me" font="" text_location="(50,10)"><PLAYER_ANSWER text="You are welcome" appear_condition="1"><ACTION condition="1" action="endDialog()"></ACTION></PLAYER_ANSWER></NODE></NODES></DIALOG>
\ No newline at end of file

Modified: trunk/gamedata/games/test_game/scripts/quests.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/quests.py	2005-08-17 17:20:16 UTC (rev 181)
+++ trunk/gamedata/games/test_game/scripts/quests.py	2005-08-17 18:08:08 UTC (rev 182)
@@ -76,7 +76,7 @@
     tml.EventManager.shipDeathById(gflag.m4_ambasador,'zoq_fot_pik_ambassador_death')
     tml.EventManager.distanceLessThen(gflag.m4_ambasador,
                                       gflag.gamaonyx_drax_station,
-                                      500,  'drax_terrorist_attack')
+                                      600,  'drax_terrorist_attack')
     gflag.m4_status = MISSION_COMPLETED
 
 def zoq_fot_pik_ambassador_death():
@@ -87,6 +87,7 @@
     gflag.m4_status == MISSION_FAILED
     
 def drax_terrorist_attack():
+    dialog.runDialogFile(tml.GameConfig.GetAbsolutePath("dialogs/drax_terr.xml"))
     gflag.m4_terrorist1 = tml.GameAction.add_ship('Gama Onyx', "dragr",
                                                   tml.GameAction.get_location_pos_x(gflag.gamaonyx_drax_station),
                                                   tml.GameAction.get_location_pos_y(gflag.gamaonyx_drax_station)+25,
@@ -100,8 +101,6 @@
     tml.EventManager.shipDeathById(gflag.m4_terrorist2,'zoq_fot_pik_ambassador_terrorist_death')
     tml.GameAction.set_target(gflag.m4_terrorist1, gflag.m4_ambasador)
     tml.GameAction.set_target(gflag.m4_terrorist2, gflag.m4_ambasador)
-    tml.GameAction.set_crew(gflag.m4_terrorist1, 1)
-    tml.GameAction.set_crew(gflag.m4_terrorist2, 1)
     
 def zoq_fot_pik_ambassador_terrorist_death():
     if tml.GameAction.exist(gflag.m4_terrorist1) or tml.GameAction.exist(gflag.m4_terrorist2):

Modified: trunk/gamedata/games/test_game/scripts/start.py
===================================================================
--- trunk/gamedata/games/test_game/scripts/start.py	2005-08-17 17:20:16 UTC (rev 181)
+++ trunk/gamedata/games/test_game/scripts/start.py	2005-08-17 18:08:08 UTC (rev 182)
@@ -26,7 +26,7 @@
 def print_hello_world():
     print "Hello world Jump to system works"
 
-zoq_fot_pik_ambassador_func()
+#zoq_fot_pik_ambassador_func()
 
 # tml.EventManager.setRepeatableTimeEvent(1, "print_pos")
 

Added: trunk/rawgraphic/Guph.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/rawgraphic/Guph.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/rawgraphic/pkunkyehat.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/rawgraphic/pkunkyehat.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/rawgraphic/vuxspathi.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/rawgraphic/vuxspathi.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From youbastrd at berlios.de  Thu Aug 18 06:30:48 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Thu, 18 Aug 2005 06:30:48 +0200
Subject: [Tw-light-svn] r183 - trunk/source/melee
Message-ID: <200508180430.j7I4UmRF005989@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-18 06:30:43 +0200 (Thu, 18 Aug 2005)
New Revision: 183

Modified:
   trunk/source/melee/mmain.cpp
Log:
Fix for the note attached to issue 62: for teamkills, report the
kill as a team-kill, not a regular kill.  This should draw 
emphasis to poor teamwork.

Modified: trunk/source/melee/mmain.cpp
===================================================================
--- trunk/source/melee/mmain.cpp	2005-08-17 18:08:08 UTC (rev 182)
+++ trunk/source/melee/mmain.cpp	2005-08-18 04:30:43 UTC (rev 183)
@@ -360,9 +360,12 @@
       message.print(5000,15,"%s dove into a planet.", victimName);
     else {
       if (strlen(killerName) > 0) {
-	message.print(5000,15,"%s killed %s.", killerName, victimName);
-      }
-      else {
+	if (who->get_team() == source->get_team()) {
+	  message.print(5000,15,"%s team-killed %s.", killerName, victimName);
+	} else {
+	  message.print(5000,15,"%s killed %s.", killerName, victimName);
+        }
+      } else {
 	message.print(5000,15,"%s died.", victimName);
       }
     }



From youbastrd at berlios.de  Thu Aug 18 06:52:30 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Thu, 18 Aug 2005 06:52:30 +0200
Subject: [Tw-light-svn] r184 - trunk/source/melee
Message-ID: <200508180452.j7I4qU5r025458@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-18 06:52:11 +0200 (Thu, 18 Aug 2005)
New Revision: 184

Modified:
   trunk/source/melee/mgame.cpp
Log:
Fix: 61 and 63: "Teamkilling should not play killer's victory
ditty" and "Victory ditty should not play on suicide"

Modified: trunk/source/melee/mgame.cpp
===================================================================
--- trunk/source/melee/mgame.cpp	2005-08-18 04:30:43 UTC (rev 183)
+++ trunk/source/melee/mgame.cpp	2005-08-18 04:52:11 UTC (rev 184)
@@ -761,6 +761,15 @@
   STACKTRACE;
   if (source && source->data) 
     {
+      // don't play a victory ditty for a ship that has just killed itself
+      if (who == source)
+	 return;
+	 
+      // don't play a victory ditty for a teamkill
+      if (who && source && 
+          who->get_team() == source->get_team())
+         return;
+
       std::string tmp = "";
       //if (source && source->ship && source->ship->data) tmp = source->ship->data->moduleVictory;
       // note: it's not guaranteed that a ship exists longer than its weapon, while data keep existing, right ?
@@ -771,9 +780,7 @@
 	{
 	  tw_sound->play_music(data_full_path(tmp), 1);
 	}
-      
     }
-  return;
 }
 
 



From youbastrd at berlios.de  Fri Aug 19 06:14:36 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Fri, 19 Aug 2005 06:14:36 +0200
Subject: [Tw-light-svn] r185 - trunk/source/melee
Message-ID: <200508190414.j7J4EaqU009872@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-19 06:14:29 +0200 (Fri, 19 Aug 2005)
New Revision: 185

Modified:
   trunk/source/melee/mmain.cpp
Log:
Fix: bug 63: Team indicators should be the same colour for
each team.  This implementation fixes this issue, but there's
no reasoning as to which colour in the palette to use.  Each
team number+1 (1-20) matches to the same colour in the palette.

This revision also fixes a bug where the teams list could be 
free'd multiple times, causing a crash.

Modified: trunk/source/melee/mmain.cpp
===================================================================
--- trunk/source/melee/mmain.cpp	2005-08-18 04:52:11 UTC (rev 184)
+++ trunk/source/melee/mmain.cpp	2005-08-19 04:14:29 UTC (rev 185)
@@ -487,7 +487,7 @@
       fleet->Sort();
       
       s->locate();
-      add ( new WedgeIndicator ( s, 30, i+1 ) );
+      add ( new WedgeIndicator ( s, 30, player_team[i+1] ) );
       ShipPanel *panel = new ShipPanel(s);
       panel->window->init(window);
       panel->window->locate(
@@ -594,8 +594,11 @@
 	sprintf(victoryMessage, "Match ends in a draw!");
 	sprintf(victoryAcknowledgeText, "Darn, maybe next time!");
       }
+      
+      // Note the spaghetti code.  We only execute this if the
+      // game is over.      
+      free(teams);
     }
-    free(teams);
   }
   
   bool done = Game::isGameDone();



From youbastrd at berlios.de  Fri Aug 19 07:56:11 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Fri, 19 Aug 2005 07:56:11 +0200
Subject: [Tw-light-svn] r186 - trunk/source/melee
Message-ID: <200508190556.j7J5uBNE032618@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-19 07:55:05 +0200 (Fri, 19 Aug 2005)
New Revision: 186

Modified:
   trunk/source/melee/mmain.cpp
Log:
Fix: Bug #63 : fixing a dumb mistake which caused an array to go out of bounds

Modified: trunk/source/melee/mmain.cpp
===================================================================
--- trunk/source/melee/mmain.cpp	2005-08-19 04:14:29 UTC (rev 185)
+++ trunk/source/melee/mmain.cpp	2005-08-19 05:55:05 UTC (rev 186)
@@ -487,7 +487,7 @@
       fleet->Sort();
       
       s->locate();
-      add ( new WedgeIndicator ( s, 30, player_team[i+1] ) );
+      add ( new WedgeIndicator ( s, 30, player_team[i]+1 ) );
       ShipPanel *panel = new ShipPanel(s);
       panel->window->init(window);
       panel->window->locate(



From youbastrd at berlios.de  Mon Aug 22 04:28:17 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Mon, 22 Aug 2005 04:28:17 +0200
Subject: [Tw-light-svn] r187 - trunk/source/games
Message-ID: <200508220228.j7M2SHXs014831@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-22 04:27:59 +0200 (Mon, 22 Aug 2005)
New Revision: 187

Modified:
   trunk/source/games/ggob.cpp
Log:
Fix: Bug 57: Exiting starbase screen dialog creates visual error
At the end of the GobStation::station_screen(), a call to 
game->redraw() is made.
Also, I've reformatted the code slightly to aid readability.

Modified: trunk/source/games/ggob.cpp
===================================================================
--- trunk/source/games/ggob.cpp	2005-08-19 05:55:05 UTC (rev 186)
+++ trunk/source/games/ggob.cpp	2005-08-22 02:27:59 UTC (rev 187)
@@ -948,80 +948,68 @@
     int r = 0;
     if (game->is_local(gobgame->_player_control->channel)) 
       r = tw_do_dialog(game->window, station_dialog, STATION_DIALOG_DEPART);
-        game->log_int(gobgame->_player_control->channel, r);
-        switch (r) {
-        case STATION_DIALOG_UPGRADE: {
-          upgrade_menu(this, s);
-                aa_set_mode(AA_DITHER);
-                aa_stretch_blit(background, game->window->surface, 
-                        0,0,background->w,background->h, 
-                        game->window->x,game->window->y,
-                        game->window->w, game->window->h);
-        }
-          break;
-        case STATION_DIALOG_NEWSHIP: 
-          {
-            buy_new_ship_menu(s);
-          }
-          break;
-        case STATION_DIALOG_REPAIR: 
-          {
-            if (s->ship->crew == s->ship->crew_max) 
-              {
-            if (game->is_local(gobgame->_player_control->channel)) 
-              alert("You don't need repairs", "", "", "Oh, okay", "I knew that", 0, 0);         
-            break;
-              }
-            int p = 0;
-            if (game->is_local(gobgame->_player_control->channel)) 
-              p = alert3("Which would you prefer", "to pay for your repairs", "", "1 &Starbuck", "1 &Buckazoid", "&Nothing!", 's', 'b', 'n');
-            game->log_int(gobgame->_player_control->channel, p);
-            switch (p) {
-            case 1: 
-              {
-            if (s->starbucks) 
-              {
-                s->starbucks -= 1;
-                s->ship->crew = s->ship->crew_max;
-              }
-            else 
-              {
-                if (game->is_local(gobgame->_player_control->channel)) 
-                  alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
-              }
-              }
-              break;
-            case 2: 
-              {
-            if (s->buckazoids) 
-              {
-                s->buckazoids -= 1;
-                s->ship->crew = s->ship->crew_max;
-              }
-            else 
-              {
-                if (game->is_local(gobgame->_player_control->channel)) 
-                  alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
-              }
-              }
-              break;
-            case 3: 
-              {
-            r = STATION_DIALOG_DEPART;
-              }
-              break;
-            }
-          }
-          break;
-        case STATION_DIALOG_COMMANDER:
-          {
-            chat_with_player();
-          }
-          break;
-        }
-        if (r == STATION_DIALOG_DEPART) 
-          break;
+        
+    game->log_int(gobgame->_player_control->channel, r);
+    
+    // Which button did the user click?
+    switch (r) {
+	case STATION_DIALOG_UPGRADE:
+		upgrade_menu(this, s);
+		aa_set_mode(AA_DITHER);
+		aa_stretch_blit(background, game->window->surface, 
+			0,0,background->w,background->h, 
+			game->window->x,game->window->y,
+			game->window->w, game->window->h);
+		break;
+	case STATION_DIALOG_NEWSHIP: 
+		buy_new_ship_menu(s);
+		break;
+	case STATION_DIALOG_REPAIR: 
+		if (s->ship->crew == s->ship->crew_max) 
+		{
+			if (game->is_local(gobgame->_player_control->channel)) 
+				alert("You don't need repairs", "", "", "Oh, okay", "I knew that", 0, 0);         
+		} else {
+			int repairPaymentMethod = 0;
+			if (game->is_local(gobgame->_player_control->channel)) 
+				repairPaymentMethod = alert3("Which would you prefer", "to pay for your repairs", "", "1 &Starbuck", "1 &Buckazoid", "&Nothing!", 's', 'b', 'n');
+			game->log_int(gobgame->_player_control->channel, repairPaymentMethod);
+			
+			// choice of how player wants to pay for ship repairs
+			switch (repairPaymentMethod) {
+				case 1: 
+					if (s->starbucks > 0) {
+						s->starbucks -= 1;
+						s->ship->crew = s->ship->crew_max;
+					} else {
+						if (game->is_local(gobgame->_player_control->channel)) 
+						alert("You don't have enough!", NULL, NULL, "&Shit", NULL, 's', 0);
+					}
+					break;
+				case 2: 
+					if (s->buckazoids > 0) {
+						s->buckazoids -= 1;
+						s->ship->crew = s->ship->crew_max;
+					} else {
+						if (game->is_local(gobgame->_player_control->channel)) 
+							alert("You don't have enough!", NULL, NULL, "&Ok", NULL, 's', 0);
+					}
+					break;
+				case 3: 
+					r = STATION_DIALOG_DEPART;
+					break;
+			} //switch (choice of repair payment method)
+		}
+		break;
+	case STATION_DIALOG_COMMANDER:
+		chat_with_player();
+		break;
+     } // switch (choice of menu button)
+
+     if (r == STATION_DIALOG_DEPART) 
+        break;
   }
+  game->redraw();
   return;
 }
 void GobStation::inflict_damage(SpaceObject *other) {
@@ -1042,6 +1030,7 @@
     p->write_pair(buffy, a+1);
     station_screen(p);
     gobgame->unpause();
+    //gobgame->redraw();
     return;
     }
 



From yurand at berlios.de  Mon Aug 22 19:56:31 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Mon, 22 Aug 2005 19:56:31 +0200
Subject: [Tw-light-svn] r188 - in trunk: . gamedata/images/ships/shpconho gamedata/images/ships/shptauda source source/games source/python source/util
Message-ID: <200508221756.j7MHuVSE015300@sheep.berlios.de>

Author: yurand
Date: 2005-08-22 19:56:30 +0200 (Mon, 22 Aug 2005)
New Revision: 188

Removed:
   trunk/source/python/fileops.cpp
   trunk/source/python/fileops.h
   trunk/source/python/types.h
Modified:
   trunk/SConstruct
   trunk/gamedata/images/ships/shpconho/SHIP_P01_PCX.bmp
   trunk/gamedata/images/ships/shpconho/SHIP_P02_PCX.bmp
   trunk/gamedata/images/ships/shpconho/SHIP_P03_PCX.bmp
   trunk/gamedata/images/ships/shpconho/SHIP_P04_PCX.bmp
   trunk/gamedata/images/ships/shpconho/SHIP_P05_PCX.bmp
   trunk/gamedata/images/ships/shpconho/SHIP_P06_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P01_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P02_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P03_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P04_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P05_PCX.bmp
   trunk/gamedata/images/ships/shptauda/SHIP_P06_PCX.bmp
   trunk/source/games/gamehierarchy.cpp
   trunk/source/games/gamehierarchy.h
   trunk/source/games/ggob.cpp
   trunk/source/games/ggob.h
   trunk/source/python/game.h
   trunk/source/python/python_class.cpp
   trunk/source/python/python_class.h
   trunk/source/scp.cpp
   trunk/source/scp.h
   trunk/source/util/sound.cpp
   trunk/source/util/sound.h
   trunk/sources.lst
Log:
Here are new ship captain icons for the Confed Hornet and Tau Dagger. They are all tested and should work fine.

Deeko 

Modified: trunk/SConstruct
===================================================================
--- trunk/SConstruct	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/SConstruct	2005-08-22 17:56:30 UTC (rev 188)
@@ -68,7 +68,6 @@
   source/other/twconfig.cpp
   source/other/vbodies.cpp
   source/other/vtarget.cpp
-  source/python/fileops.cpp
   source/python/game.cpp
   source/python/python_class.cpp
   source/sc1ships/shpandgu.cpp
@@ -159,7 +158,6 @@
 source/util/endian.h
 source/util/errors.h
 source/tml/eventmanager.h
-source/python/fileops.h
 source/other/fontmorph.h
 source/frame.h
 source/python/game.h
@@ -215,7 +213,6 @@
 source/other/starmap.h
 source/tests/testmain.h
 source/other/twconfig.h
-source/python/types.h
 source/util/types.h
 source/other/vbodies.h
 source/util/vector2.h
@@ -232,6 +229,7 @@
 
 if str(Platform()) == "win32":
     env = Environment()
+    env.Append(CPPDEFINES=['WIN32'])
     if env["CC"] == "cl":
         env['PDB'] = 'tw-light.pdb'
         env.AppendENVPath('PATH', os.environ['PATH'])

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P01_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P02_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P03_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P04_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P05_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconho/SHIP_P06_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P01_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P02_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P03_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P04_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P05_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shptauda/SHIP_P06_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/source/games/gamehierarchy.cpp
===================================================================
--- trunk/source/games/gamehierarchy.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/games/gamehierarchy.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -14,7 +14,6 @@
   GNU General Public License for more details.
 */
 
-
 #include <allegro.h>
 #include <stdio.h>
 #include <string.h>
@@ -26,96 +25,102 @@
 #include "melee/mframe.h"
 #include "melee/mview.h"
 #include "melee/mitems.h"
+#include "melee/mhelpers.h"
 
 #include "scp.h"
 #include "util/history.h"
+#include "util/sound.h"
 
-
 #include "gamehierarchy.h"
 #include "ggob.h"
 
 #include <algorithm>
 
-MainGame* g_maingame = NULL;
+MainGame::MainGame(const std::string& game_path)
+{
+}
 
-
-MainGame::MainGame()
-{
-  STACKTRACE;
-  g_maingame = this;
-  _active_subgame = "";
+int MainGame::Load(const std::string& save)
+{
+	return 0;
 }
 
-void MainGame::addsubgame(Game *asubgame, const std::string& name)
-{
-  STACKTRACE;
+//################################################################################################
+//  Intro
 
-  asubgame->_name = name;
-  ((SubGame<MainGame>*)asubgame)->maingame = this;
+void MainGame::intro()
+{
+  BITMAP* d_buf;
+  std::vector<std::string> intro_text;
 
-  asubgame->preinit();
-  asubgame->window = new VideoWindow;
-  asubgame->window->preinit();
-  asubgame->window->init(&videosystem->window);
-  asubgame->window->locate(0,0,0,0,0,1,0,1);
+  intro_text.push_back("The Ur-quan are defeated - the destruction");
+  intro_text.push_back("of the Sa-matra threw them into chaos,");
+  intro_text.push_back("making them easy prey for");
+  intro_text.push_back("the New Alliance of Free Stars.");
+  intro_text.push_back("Within weeks the NAFS forces managed");
+  intro_text.push_back("to destroy most of the fleets of the two ");
+  intro_text.push_back("races who terrorized the galaxy");
+  intro_text.push_back("for the past 20,000 years!");
+  intro_text.push_back("");
+  intro_text.push_back("Thanks to captain Zelnick, hope is given");
+  intro_text.push_back("to the entire galaxy, and especially to");
+  intro_text.push_back("the human race. Now free from their prison");
+  intro_text.push_back("under a Slaveshield it's Humanity's time");
+  intro_text.push_back("to rebuild.");
+  intro_text.push_back("");
+  intro_text.push_back("However, it seems there are more troubles");
+  intro_text.push_back("ahead. It is time for great space");
+  intro_text.push_back("exploration, colonization and piracy.");
+  intro_text.push_back("You have to live in this world,");
+  intro_text.push_back("young earth captain!!!");
 
-  asubgame->init(log, "");	// all subgames share the same log (is this ok?)
+  d_buf = create_bitmap(SCREEN_W, SCREEN_H);
+  clear(d_buf);
+  copy_buf();
 
-  _subgame[name]=asubgame;
-}
+  tw_sound->play_music(data_full_path("music/intro.xm"), -1);
+  clear(d_buf);
+  BITMAP* logo = load_bitmap(data_full_path("images/3dlogo.jpg").c_str(), NULL);
+  stretch_blit(logo, d_buf, 0, 0, logo->w, logo->h, 0, 0, screen->w, screen->h);
+  destroy_bitmap(logo);
 
+  textout_centre(d_buf, D_FONT_ENGLISH, "TimeWarp development team", screen->w/2, screen->h-50, -1);
+  copy_buf();
+  HAVE_A_WAIT(2500);
+ 
+  clear(d_buf);
+  textout_centre(d_buf, D_FONT_ENGLISH, "somewhat proudly", screen->w/2, screen->h/2, -1);
+  textout_centre(d_buf, D_FONT_ENGLISH, "present", screen->w/2, screen->h/2+40, -1);
+  copy_buf();
+  HAVE_A_WAIT(2500);
+  clear(d_buf);
 
-void MainGame::removesubgame(Game* g)
-{
-  STACKTRACE;
+  BITMAP* pkunk = load_bitmap(data_full_path("images/PkunkQueen.jpg").c_str(), NULL);
+  blit(pkunk, d_buf, 0, 0,  (screen->w-pkunk->w)/2, 20, pkunk->w, pkunk->h);
+  textout_centre(d_buf, D_FONT_ENGLISH, "TW-Light : Legacies", screen->w/2, pkunk->h+60, -1);
+  destroy_bitmap(pkunk);
+  copy_buf();
+  HAVE_A_WAIT(2500);
+  
+  ScrollText(intro_text,  D_FONT_ENGLISH, -1, "images/background.jpg", "c", 2);
 
-  _subgame.erase(_subgame.find(g->_name));
-  g->log->deinit();	// this is empty, dunno why
-  game = NULL;
-  delete g;	// this _must_ be deleted completely, otherwise the gamedata aren't removed  
+
+  clear(d_buf);
+  copy_buf();	
+  destroy_bitmap(d_buf);
 }
 
-
 int MainGame::play()
-{
-  STACKTRACE;
-
-  // Nothing to play
-  if(!_subgame.size())
-    return GAME_STATE_FINISHED;
-
-  set_resolution(window->w, window->h);
-  prepare();
-  if (is_paused()) unpause();
-  
-  while(isGameDone() == GAME_STATE_PLAYING)
-    {
-      poll_input(); 
-      videosystem->poll_redraw();     
-      if(!switch_to(_active_subgame))
-	{
-	  tw_error(("Unknown sybgame: " + _active_subgame).c_str());
-	}
-      (_subgame[_active_subgame])->play();
-    }
-  return isGameDone();
+{
+	// Show Intro
+	RGB tmpPal[256];
+	memcpy(tmpPal, palette_color, sizeof(RGB) * 256);
+	set_palette((const RGB*)g_game_data[TW_FONT_PALETTE].dat);
+      
+	intro();
+	videosystem->set_palette(tmpPal);
+	play_game("GOB", "", NULL);
+	
+	return 0;
 }
 
-void MainGame::setActiveGame(const std::string& name)
-{
-  STACKTRACE;
-  _active_subgame = name;
-}
-
-bool MainGame::switch_to(const std::string& name)
-{
-  STACKTRACE;
-  if(_subgame.find(name)!=_subgame.end())
-    {
-      setActiveGame(name);
-      (_subgame[_active_subgame])->prepare();
-      (_subgame[_active_subgame])->setGameDone(GAME_STATE_PLAYING);
-      return true;
-    }
-  return false;
-}

Modified: trunk/source/games/gamehierarchy.h
===================================================================
--- trunk/source/games/gamehierarchy.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/games/gamehierarchy.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -24,115 +24,17 @@
 
 #include "util/history.h"
 
-class MainGame;
-
-
-/// an extended game class, which can be embedded in a sequence
-/// of initiated games ...
-template<class TMainGame>
-class SubGame : public Game
-{
- public:
-
-  TMainGame	*maingame;		///< Main game handle multiple game subgames
-
-  SubGame()
-  {
-  }
-  
-  ~SubGame()
-  {
-  }
-
-  /// This init is cutted so it can be called safe several times by different subgames
-  virtual void init(Log *_log, const std::string& save)
-    {
-      STACKTRACE;
-      
-      log = _log;
-      if (!log) 
-	{
-	  log = new Log();
-	  log->init();
-	}
-  
-      lag_frames = 0;
-      show_fps = 0;
-      game_time = 0;
-      frame_time = 1;
-      frame_number = 0;
-      hiccup_margin = 100;
-      next_tic_time = get_time();
-      next_render_time = game_time;
-      next_fps_time = game_time;
-      view_locked = false;
-      local_checksum = client_checksum = server_checksum = 0;
-      
-      Physics::init();
-      prepare();
-      
-      if (!window) 
-	{
-	  window = new VideoWindow();
-	  window->preinit();
-	}
-      
-      change_view(get_config_string("View", "View", "Hero")); 
-      
-      
-      if (!is_paused()) pause();
-      
-      text_mode(-1);
-      
-      
-      msecs_per_fps	= maingame->msecs_per_fps;
-      msecs_per_render	= maingame->msecs_per_render;
-      frame_time	= maingame->frame_time;
-      normal_turbo	= maingame->normal_turbo;
-      f4_turbo		= maingame->f4_turbo;
-      turbo             = normal_turbo;
-      friendly_fire	= maingame->friendly_fire;
-      shot_relativity	= maingame->shot_relativity;
-      
-      
-      lag_frames = maingame->lag_frames;
-      
-      tic_history = new Histograph(128);
-      render_history = new Histograph(128);
-      
-      prepare();
-      
-      return;
-      }
- protected:
-  
-};
-
-
-
-
 ///  This class should allow you to start, play, end a game from within a game (while the
 ///  other games are also running in the background). Games and their physics are independent.
-class MainGame : public Game
+class MainGame
 {
- protected:
-  std::string _active_subgame;
-  std::map<std::string,Game*> _subgame;
-  
-    /// Switch to subgame by name
-  bool switch_to(const std::string& name);
  public:
-  
-  MainGame();
- 
-  virtual void setActiveGame(const std::string& name);
-  virtual void addsubgame(Game *asubgame,  const std::string& name);
-  virtual void removesubgame(Game* g);
-
+  MainGame(const std::string& game_path);
+  virtual int Load(const std::string& save);
+  virtual void intro();
   virtual int play();
 };
 
-
 #endif
 
 

Modified: trunk/source/games/ggob.cpp
===================================================================
--- trunk/source/games/ggob.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/games/ggob.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -371,11 +371,6 @@
   delete s;
   _exec_py_script(GameConfig::GetAbsolutePath("scripts/start.py").c_str(), 0, 0);
   
-  
-  //add ( new RainbowRift() );
-  
-  next_add_new_enemy_time = 1000;
-
   this->change_view("Hero");
   view->window->locate(
                0,0,
@@ -483,31 +478,8 @@
 void GobGame::calculate() 
 {
   STACKTRACE;
-  
-  if (next_add_new_enemy_time <= game_time) 
-    {
-      next_add_new_enemy_time = game_time;
-      int t = 28;
-      if ((random() % t) < 4) add_new_enemy();
-      int e = gobenemies;
-      e -= random() % (1 + game_time / (250 * 1000));
-      if (0) ;
-      else if (e >=12) 
-    next_add_new_enemy_time += 15000;
-      else if (e >= 7) 
-    next_add_new_enemy_time += 7000;
-      else if (e >= 4) 
-    next_add_new_enemy_time += 5000;
-      else if (e >= 2) 
-    next_add_new_enemy_time += 3000;
-      else if (e >= 1) 
-    next_add_new_enemy_time += 2000;
-      else 
-    next_add_new_enemy_time += 1000;
-    }
   Game::calculate();
   EventManager::calculate();
-  return;
 }
 
 int GobGame::get_enemy_index(SpaceLocation *what) 

Modified: trunk/source/games/ggob.h
===================================================================
--- trunk/source/games/ggob.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/games/ggob.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -180,16 +180,13 @@
 
   // For Python interface
   void add_new_enemy();
-  
   int add_ship(const std::string& system, const std::string& shptype, Vector2 pos, double team );
-
   void add_stars();
-  int add_asteroid(const std::string system, Vector2 pos, double angle, int speed);
+  int  add_asteroid(const std::string system, Vector2 pos, double angle, int speed);
   void add_system(std::string name, int x, int y);;
-  int add_player(const std::string& system, const std::string& shptype, int x, int y);
- 
-  int next_add_new_enemy_time;
+  int  add_player(const std::string& system, const std::string& shptype, int x, int y);
   
+
   SpaceSprite *defenderSprite;
 
  protected:
@@ -262,6 +259,10 @@
 };
 
 
+class GameManager
+{
+	public:
+};
 
 #endif // TW_GOB_H_INCLUDES
 

Deleted: trunk/source/python/fileops.cpp
===================================================================
--- trunk/source/python/fileops.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/fileops.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -1,404 +0,0 @@
-/*
-   $Id: fileops.cc,v 1.13 2003/01/24 22:15:43 ksterker Exp $
-
-   Copyright (C) 1999/2000/2001/2002/2003 Alexandre Courbot
-   Part of the Adonthell Project http://adonthell.linuxgames.com
-
-   This program is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License.
-   This program is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY.
-
-   See the COPYING file for more details.
-*/
-
-
-
-/**
- * @file   fileops.cc
- * @author Alexandre Courbot <alexandrecourbot at linuxgames.com>
- * 
- * @brief  Defines the igzstream, ogzstream and fileops classes.
- * 
- */
-
-#include <stdio.h>
-#include <iostream>
-#include <SDL/SDL_endian.h>
-#include "fileops.h"
-
-
-using namespace std;
-
-
-gz_file::gz_file ()
-{
-    opened = false;
-}
-
-gz_file::gz_file (const string & fname, gz_type t)
-{
-    opened = false;
-    open (fname, t);
-}
-
-gz_file::~gz_file ()
-{
-    if (is_open ()) gzclose (file);
-}
-
-bool gz_file::open (const string & fname, gz_type t)
-{
-    if (t == READ) file = gzopen (fname.c_str (),"rb6");
-    else file = gzopen (fname.c_str (),"wb6");
-    if (!file) return false;
-    opened = true;
-    return true;
-}
-
-void gz_file::close ()
-{
-    if (is_open ()) gzclose (file);
-    opened = false;
-}
-
-igzstream::igzstream () : gz_file ()
-{
-}
-
-igzstream::igzstream (const string & fname) : gz_file (fname, READ)
-{
-}
-
-igzstream::~igzstream ()
-{
-}
-
-bool igzstream::open (const string & fname)
-{
-    return gz_file::open (fname, READ);
-}
-
-/// Reads a boolean.
-bool& operator << (bool& n, igzstream& gfile)
-{
-    u_int8 b;
-    gzread (gfile.file, &b, sizeof (b));
-    return (n = b);
-}
-
-/// Reads a boolean.
-bool igzstream::get_bool ()
-{
-    u_int8 b;
-    gzread (file, &b, sizeof (b));
-    return b;
-}
-
-/// Reads a char.
-char& operator << (char& n, igzstream& gfile)
-{
-    gzread (gfile.file, &n, sizeof (n));
-    return n;
-}
-
-/// Read a block of size chars
-void igzstream::get_block (void * to, u_int32 size)
-{
-    gzread (file, to, size); 
-}
-
-/// Reads a u_int8.
-u_int8& operator << (u_int8& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    return n;
-}
-
-/// Reads a u_int8.
-u_int8 igzstream::get_uint8 ()
-{
-    u_int8 n;
-    gzread (file, &n, sizeof (n));
-    return n;
-}
-
-/// Reads a s_int8.
-s_int8& operator << (s_int8& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    return n;
-}
-
-/// Reads a s_int8.
-s_int8 igzstream::get_sint8 ()
-{
-    s_int8 n;
-    gzread (file, &n, sizeof (n));
-    return n;
-}
-
-/// Reads a u_int16.
-u_int16& operator << (u_int16& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    n = SDL_SwapLE16(n);
-    return n;
-}
-
-/// Reads a u_int16.
-u_int16 igzstream::get_uint16 ()
-{
-    u_int16 n;
-    gzread (file, &n, sizeof (n));
-    return SDL_SwapLE16(n);
-}
-
-/// Reads a s_int16.
-s_int16& operator << (s_int16& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    n = SDL_SwapLE16(n);
-    return n;
-}
-
-/// Reads a s_int16.
-s_int16 igzstream::get_sint16 ()
-{
-    s_int16 n;
-    gzread (file, &n, sizeof (n));
-    return SDL_SwapLE16(n);
-}
-
-/// Reads a u_int32.
-u_int32& operator << (u_int32& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    n = SDL_SwapLE32(n);
-    return n;
-}
-
-/// Reads a u_int32.
-u_int32 igzstream::get_uint32 ()
-{
-    u_int32 n;
-    gzread (file, &n, sizeof (n));
-    return SDL_SwapLE32(n);
-}
-
-/// Reads a s_int32.
-s_int32& operator << (s_int32& n, igzstream& gfile)
-{
-    gzread(gfile.file, &n, sizeof (n));
-    n = SDL_SwapLE32(n);
-    return n;
-}
-
-/// Reads a s_int32.
-s_int32 igzstream::get_sint32 ()
-{
-    s_int32 n;
-    gzread (file, &n, sizeof (n));
-    return SDL_SwapLE32(n);
-}
-
-/// Reads a string.
-string& operator << (string& s, igzstream& gfile)
-{
-    u_int16 strl;
-    char c;
-    s = ""; 
-    strl << gfile;
-    while (strl)
-    {
-	c << gfile;
-	s += c;
-	strl --;
-    }
-    return s;
-}
-
-/// Reads a string.
-string igzstream::get_string ()
-{
-    string s;
-    s << *this;
-    return s;
-}
-
-/// Reads a float.
-float& operator << (float& f, igzstream& gfile)
-{
-    string sf;
-    sf << gfile;
-    
-    // floats saved as strings to remain independent of architecture
-    sscanf (sf.c_str (), "%f", &f);
-    
-    return f;
-}
-
-/// Reads a float.
-float igzstream::get_float ()
-{
-    float f;
-    f << *this;
-    return f;
-}
-
-
-ogzstream::ogzstream () : gz_file ()
-{
-}
-
-ogzstream::ogzstream (const string & fname) : gz_file (fname, WRITE)
-{
-}
-
-ogzstream::~ogzstream ()
-{
-}
-
-bool ogzstream::open (const string & fname)
-{
-    return gz_file::open (fname, WRITE);
-}
-
-void ogzstream::put_block (void * to, u_int32 size)
-{
-    gzwrite (file, to, size); 
-}
-
-/// Writes a boolean.
-const bool& operator >> (const bool& n, ogzstream& gfile)
-{
-    u_int8 b = n;
-    gzwrite (gfile.file, &b, sizeof (b));
-    return n;
-}
-
-/// Writes a char.
-const char& operator >> (const char& n, ogzstream& gfile)
-{
-    gzwrite (gfile.file, (char *) &n, sizeof (n));
-    return n;
-}
-
-/// Writes a u_int8.
-const u_int8& operator >> (const u_int8& n, ogzstream& gfile)
-{
-    gzwrite(gfile.file, (u_int8 *) &n, sizeof (n));
-    return n;
-}
-
-/// Writes a s_int8.
-const s_int8& operator >> (const s_int8& n, ogzstream& gfile)
-{
-    gzwrite(gfile.file, (s_int8 *) &n, sizeof (n));
-    return n;
-}
-
-/// Writes a u_int16.
-const u_int16& operator >> (const u_int16& n, ogzstream& gfile)
-{
-    u_int16 s = SDL_SwapLE16(n);
-    gzwrite(gfile.file, (u_int16 *) &s, sizeof (n));
-    return n;
-}
-
-/// Writes a s_int16.
-const s_int16& operator >> (const s_int16& n, ogzstream& gfile)
-{
-    s_int16 s = SDL_SwapLE16(n);
-    gzwrite(gfile.file, (s_int16 *) &s, sizeof (n));
-    return n;
-}
-
-/// Writes a u_int32.
-const u_int32& operator >> (const u_int32& n, ogzstream& gfile)
-{
-    u_int32 s = SDL_SwapLE32(n);
-    gzwrite(gfile.file, (u_int32 *) &s, sizeof (n));
-    return n;
-}
-
-/// Writes a s_int32.
-const s_int32& operator >> (const s_int32& n, ogzstream& gfile)
-{
-    s_int32 s = SDL_SwapLE32(n);
-    gzwrite(gfile.file, (s_int32 *) &s, sizeof (n));
-    return n;
-}
-
-/// Writes a string.
-string& operator >> (const string& s, ogzstream& gfile)
-{
-    u_int16 strl = s.length ();
-    string::iterator i; 
-    strl >>  gfile;
-    
-    for (i = ((string&) s).begin (); i != ((string&) s).end (); i++) 
-        (*i) >>  gfile;
-    return (string&) s;
-}
-
-/// Writes a float.
-const float& operator >> (const float& f, ogzstream& gfile)
-{
-    char sf[16];
-    
-    // floats saved as strings to remain independent of architecture
-    #ifdef _MSC_VER
-    _snprintf (sf, 16, "%f", f);
-    #else
-    snprintf (sf, 16, "%f", f);
-    #endif
-    sf >> gfile;
-    
-    return f;
-}
-
-void fileops::put_version (ogzstream& file, u_int16 version)
-{
-    char c = 'v'; 
-    c >> file;
-    version >> file; 
-}
-
-// read version info from file and check whether we can handle it
-bool fileops::get_version (igzstream& file, u_int16 min, u_int16 max, string name)
-{
-    char vinfo;
-    u_int16 version;
-
-    vinfo << file;
-
-    if (name == "") name = "<unknown>";
-
-    // file contains no version info
-    if (vinfo != 'v')
-    {
-        cerr << "Version information missing in file \"" << name << endl;
-        cerr << "You should get a more recent data package.\n";
-        return false;
-    }
-    
-    // check whether file has the version we expect
-    version << file;
-
-    if (version < min || version > max)
-    {
-        cerr << "File \"" << name << "\" has\nversion number " << version << ", ";
-        cerr <<  "but I was expecting " << min << " <= version <= " << max << endl;
-	
-        // file is newer than code
-        if (version > max)
-            cerr << "You should get an up-to-date version of this program.\n\n";
-        // file is older than code
-        else
-            cerr << "You should probably get a more recent data package.\n";
-
-        return false;
-    } 
-    return true;
-}

Deleted: trunk/source/python/fileops.h
===================================================================
--- trunk/source/python/fileops.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/fileops.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -1,338 +0,0 @@
-/*
-   $Id: fileops.h,v 1.17 2003/01/20 20:18:43 ksterker Exp $
-
-   Copyright (C) 2001/2003 Alexandre Courbot
-   Part of the Adonthell Project http://adonthell.linuxgames.com
-
-   This program is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License.
-   This program is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY.
-
-   See the COPYING file for more details.
-*/
-
-
-
-/**
- * @file   fileops.h
- * @author Alexandre Courbot <alexandrecourbot at linuxgames.com>
- * 
- * @brief  Declares the igzstream, ogzstream and fileops classes.
- * 
- */
-
-
-
-
-#ifndef FILEOPS_H_
-#define FILEOPS_H_
-
-#include <zlib.h>
-#include <string>
-#include "types.h"
-
-
-#ifndef SWIG
-//using namespace std; 
-#endif
-
-
-/**
- * Enumeration to know whether a file is read or write opened.
- * 
- */ 
-typedef enum { READ, WRITE } gz_type;
-
-
-/**
- * Base class for igzstream and ogzstream.
- * 
- */ 
-class gz_file
-{
-public:
-    /** 
-     * Default constructor.
-     * 
-     */
-    gz_file ();
-
-#ifndef SWIG
-    /** 
-     * 
-     * 
-     * @param fname name of the file to open.
-     * @param t access (READ or WRITE).
-     */
-    gz_file (const std::string & fname, gz_type t);
-#endif
-
-    /** 
-     * Destructor.
-     * 
-     */
-    virtual ~gz_file ();
-    
-    /** 
-     * Opens a file.
-     * 
-     * @param fname name of the file to open.
-     * @param t access (READ or WRITE).
-     * 
-     * @return true if succeed, false otherwise.
-     */
-    bool open (const std::string & fname, gz_type t);
-
-    /** 
-     * Close the file that was opened.
-     * 
-     */
-    void close ();
-
-    /** 
-     * Returns whether the file is opened or not.
-     * 
-     * 
-     * @return true if the file is opened, false otherwise.
-     */
-    bool is_open () { return opened; }
-
-    /** 
-     * Returns whether the file is at it's end or not.
-     * 
-     * 
-     * @return true if the end of file is reached, else otherwise.
-     */
-    bool eof () 
-    {
-        return gzeof (file); 
-    }
-    
-protected:
-    /** 
-     * The actual gzFile.
-     * 
-     */ 
-    gzFile file;
-
-private:
-    /// NEVER pass this by value.
-    gz_file (gz_file& src); 
-    
-    /// Opened or not?
-    bool opened; 
-};
-
-
-/** 
- * Class to read data from a Gzip compressed file.
- */ 
-class igzstream : public gz_file
-{
-public:
-    /**
-     * Default constructor.
-     * 
-     */ 
-    igzstream ();
-
-#ifndef SWIG
-    /** 
-     * Opens a file for read access.
-     * 
-     * @param fname name of the file to open.
-     * 
-     */ 
-    igzstream (const std::string & fname);
-#endif
-    
-    /**
-     * Destructor.
-     * 
-     */ 
-    ~igzstream ();
-
-    /** 
-     * Opens a file for read access.
-     * 
-     * @param fname name of the file to open.
-     * 
-     * @return true if succeed, false otherwise.
-     */
-    bool open (const std::string & fname);
-
-    /** 
-     * Reads a block of bytes from the file.
-     * 
-     * @param to pointer to the buffer where to read.
-     * @param size number of bytes to read.
-     */
-    void get_block (void * to, u_int32 size); 
-
-#ifndef SWIG
-    /// Reads a boolean.
-    friend bool& operator << (bool& n, igzstream& gfile);
-
-    /// Reads a char.
-    friend char& operator << (char& n, igzstream& gfile);
-
-    /// Reads a u_int8.
-    friend u_int8& operator << (u_int8& n, igzstream& gfile);
-
-    /// Reads a s_int8.
-    friend s_int8& operator << (s_int8& n, igzstream& gfile);
-
-    /// Reads a u_int16.
-    friend u_int16& operator << (u_int16& n, igzstream& gfile);
-
-    /// Reads a s_int16.
-    friend s_int16& operator << (s_int16& n, igzstream& gfile);
-
-    /// Reads a u_int32.
-    friend u_int32& operator << (u_int32& n, igzstream& gfile);
-
-    /// Reads a s_int32.
-    friend s_int32& operator << (s_int32& n, igzstream& gfile);
-
-    /// Reads a string.
-    friend std::string& operator << (std::string& s, igzstream& gfile);
-    
-    /// Reads a float.
-    friend float& operator << (float& s, igzstream& gfile);
-#endif
-
-    bool get_bool ();
-    u_int8 get_uint8 ();
-    s_int8 get_sint8 ();
-    u_int16 get_uint16 ();
-    s_int16 get_sint16 ();
-    u_int32 get_uint32 ();
-    s_int32 get_sint32 ();
-    std::string get_string ();
-    float get_float ();
-
-private:
-    /// NEVER pass this by value.
-    igzstream (igzstream& src);  
-};
-
-/** 
- * Class to write data from a Gzip compressed file.
- */ 
-class ogzstream : public gz_file
-{
-public:
-    /**
-     * Default constructor.
-     * 
-     */ 
-    ogzstream ();
-
-#ifndef SWIG
-    /** 
-     * Opens a file for write access.
-     * 
-     * @param fname name of the file to open.
-     * 
-     */ 
-    ogzstream (const std::string & fname);
-#endif
-    
-    /**
-     * Destructor.
-     * 
-     */
-    ~ogzstream ();
-
-    /** 
-     * Opens a file for write access.
-     * 
-     * @param fname name of the file to open.
-     * 
-     * @return true if succeed, false otherwise.
-     */
-    bool open (const std::string & fname);
-
-    /** 
-     * Writes a block of bytes to the file.
-     * 
-     * @param to pointer to the buffer to write.
-     * @param size number of bytes to write.
-     */
-    void put_block (void * to, u_int32 size); 
-
-#ifndef SWIG
-    /// Writes a boolean.
-    friend const bool& operator >> (const bool& n, ogzstream& gfile);
-
-    /// Writes a char.
-    friend const char& operator >> (const char& n, ogzstream& gfile);
-
-    /// Writes a u_int8.
-    friend const u_int8& operator >> (const u_int8& n, ogzstream& gfile);
-
-    /// Writes a s_int8.
-    friend const s_int8& operator >> (const s_int8& n, ogzstream& gfile);
-
-    /// Writes a u_int16.
-    friend const u_int16& operator >> (const u_int16& n, ogzstream& gfile);
-
-    /// Writes a s_int16.
-    friend const s_int16& operator >> (const s_int16& n, ogzstream& gfile);
-
-    /// Writes a u_int32.
-    friend const u_int32& operator >> (const u_int32& n, ogzstream& gfile);
-
-    /// Writes a s_int32.
-    friend const s_int32& operator >> (const s_int32& n, ogzstream& gfile);
-
-    /// Writes a string.
-    friend std::string& operator >> (const std::string& s, ogzstream& gfile);
-    
-    /// Writes a float.
-    friend const float& operator >> (const float& s, ogzstream& gfile);
-#endif
-
-    void put_bool (const bool &n)         { n >> *this; }
-    void put_uint8 (const u_int8 &n)      { n >> *this; }
-    void put_sint8 (const s_int8 &n)      { n >> *this; }
-    void put_uint16 (const u_int16 &n)    { n >> *this; }
-    void put_sint16 (const s_int16 &n)    { n >> *this; }
-    void put_uint32 (const u_int32 &n)    { n >> *this; }
-    void put_sint32 (const s_int32 &n)    { n >> *this; }
-    void put_string (const std::string& s)     { s >> *this; }
-    void put_float (const float &n)       { n >> *this; }
-    
-private:
-    /// NEVER pass this by value.
-    ogzstream (ogzstream& src);   
-};
-
-/// File version control class.
-class fileops
-{
-public:
-    /** 
-     * Sets the version number of a file.
-     * 
-     * @param file file where to write the version number.
-     * @param version version number to write.
-     */
-    static void put_version (ogzstream& file, u_int16 version);  // Set version of a file
-
-    /** 
-     * 
-     * 
-     * @param file file to check version.
-     * @param min minimum expected version number.
-     * @param max maximum expected version number.
-     * @param name filename of the passed file.
-     * 
-     * @return true if 
-     */
-    static bool get_version (igzstream& file, u_int16 min, u_int16 max, std::string name); // Check version
-};
-
-
-#endif // __FILEOPS_H__

Modified: trunk/source/python/game.h
===================================================================
--- trunk/source/python/game.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/game.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -31,7 +31,7 @@
 
 
 #include <string>
-#include "types.h"
+//#include "types.h"
 
 #ifndef SWIG 
 //using std::string; 

Modified: trunk/source/python/python_class.cpp
===================================================================
--- trunk/source/python/python_class.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/python_class.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -90,7 +90,7 @@
 /*
  * Execute the file given by 'filename'
  */
-bool python::exec_file (std::string filename)
+bool python::exec_file (const std::string& filename)
 {
   std::string content;
   FILE * f = fopen(GameConfig::GetAbsolutePath(filename).c_str(), "rt");
@@ -124,7 +124,7 @@
 }
 
 /* Import a module, return module ptr */
-PyObject *python::import_module (std::string filename)
+PyObject *python::import_module (const std::string& filename)
 {
     PyObject *result = PyImport_ImportModule ((char *) filename.c_str ());
     
@@ -171,10 +171,10 @@
   if (pValue != NULL) 
     {
       if(PyInt_Check(pValue))
-	{
-	  if(PyInt_AsLong(pValue)!=0)
-	    ret = true;
-	}
+    {
+      if(PyInt_AsLong(pValue)!=0)
+        ret = true;
+    }
       Py_DECREF(pValue);
     }
   else 

Modified: trunk/source/python/python_class.h
===================================================================
--- trunk/source/python/python_class.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/python_class.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -29,11 +29,14 @@
 #define PYTHON_CLASS_H__
 
 #undef _POSIX_C_SOURCE
+
+#include <string>
+
 #include "Python.h"
 #include "compile.h"
 #include "eval.h"
 #include "node.h"
-#include "fileops.h"
+//#include "fileops.h"
 
 /**
  * Grant simplified access to the Python interpreter.
@@ -77,7 +80,7 @@
      * 
      * @return true in case of success, false otherwise.
      */ 
-    static bool exec_file (std::string filename);
+    static bool exec_file (const std::string& filename);
     
     /** 
      * Imports a Python module.
@@ -86,7 +89,7 @@
      * 
      * @return pointer to the imported module.
      */
-    static PyObject *import_module (std::string filename);
+    static PyObject *import_module (const std::string& filename);
     
     static bool exec_function(const std::string& name);
     

Deleted: trunk/source/python/types.h
===================================================================
--- trunk/source/python/types.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/python/types.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -1,55 +0,0 @@
-// $Id: types.h,v 1.16 2002/04/25 15:34:11 gnurou Exp $
-/*
-   Copyright (C) 1999/2000/2001 Alexandre Courbot.
-
-   This program is free software; you can redistribute it and/or modify
-   it under the terms of the GNU General Public License.
-   This program is distributed in the hope that it will be useful,
-   but WITHOUT ANY WARRANTY.
-   See the COPYING file for more details.
-
- */
-
-
-/** @file types.h
- *  @author Alexandre Courbot <alexandrecourbot at linuxgames.com>
- *  @brief Declares some basic types.
- */ 
-
- 
-#ifndef TYPES_H__
-#define TYPES_H__
-
-#include "SDL.h"
-
-// We should put ifdefs here to put the correct int values accordingly to the system type
-
-
-/// 8 bits long unsigned integer
-#define u_int8 unsigned char
-
-/// 16 bits long unsigned integer
-#define u_int16 unsigned short
-
-/// 32 bits long unsigned integer
-#define u_int32 unsigned int
-
-/// 8 bits long signed integer
-#define s_int8 signed char
-
-/// 16 bits long signed integer
-#define s_int16 signed short
-
-/// 32 bits long signed integer
-#define s_int32 signed int
-
-
-/* 
-typedef Uint8 u_int8;
-typedef Uint16 u_int16;
-typedef Uint32 u_int32;
-typedef Sint8 s_int8;
-typedef Sint16 s_int16;
-typedef Sint32 s_int32;
-*/ 
-#endif

Modified: trunk/source/scp.cpp
===================================================================
--- trunk/source/scp.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/scp.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -74,14 +74,12 @@
 #include "melee/mship.h" //remove
 #include "melee/mfleet.h"
 #include "tml/gameconfig.h"
-
+#include "games/gamehierarchy.h"
 #include "python/python_class.h"
 
 
 DATAFILE* g_game_data = NULL;
 
-void GOBIntro();
-
 ///the server port to connect to in client mode.  
 unsigned serverPort = DEFAULT_SERVER_PORT;
 ///the server address to connect to in client mode.
@@ -181,7 +179,6 @@
 
 
 void play_demo(const char *file_name = "demo.dmo") ;
-void play_game(const char *_gametype_name, const std::string& save, Log *_log = NULL) ;
 void play_net1client ( const char * address = NULL, int port = -1 ) ;
 void play_net1server ( int port = -1 ) ;
 
@@ -411,9 +408,9 @@
       
       GameType *type = gametype(gametype_name);
       if (type)
-	new_game = type->new_game();
+		new_game = type->new_game();
       else
-	tw_error("wait a sec... I can't find that game type");
+		tw_error("wait a sec... I can't find that game type");
     
       new_game->preinit();
       new_game->window = new VideoWindow;
@@ -431,7 +428,6 @@
       delete new_game;
       game = NULL;
     }
-  
   catch (int i) 
     {
       if (i == -1) 
@@ -459,7 +455,7 @@
       if (__error_flag & 1) 
 	throw;
     }
-  
+
   prepareTitleScreenAssets();
   showTitle();
   return;
@@ -713,17 +709,10 @@
 	break;
       case MAIN_DIALOG_NEW_GAME:
 	{
-	  // Show Intro
-	  RGB tmpPal[256];
-	  memcpy(tmpPal, palette_color, sizeof(RGB) * 256);
-	  set_palette((const RGB*)g_game_data[TW_FONT_PALETTE].dat);
-      
-	  GOBIntro();
-	  videosystem->set_palette(tmpPal);
-
-	  disable();
-	  play_game("GOB", "", NULL);
-	  enable();
+		disable();
+		std::auto_ptr<MainGame> maingame(new MainGame(""));
+		maingame->play();
+		enable();
 	  break;
 	}
 	case MAIN_DIALOG_ABOUT:
@@ -2090,75 +2079,3 @@
   return 0;
 }
 
-
-//################################################################################################
-//  Intro
-
-
-
-
-
-void GOBIntro()
-{
-  BITMAP* d_buf;
-  std::vector<std::string> intro_text;
-
-  intro_text.push_back("The Ur-quan are defeated - the destruction");
-  intro_text.push_back("of the Sa-matra threw them into chaos,");
-  intro_text.push_back("making them easy prey for");
-  intro_text.push_back("the New Alliance of Free Stars.");
-  intro_text.push_back("Within weeks the NAFS forces managed");
-  intro_text.push_back("to destroy most of the fleets of the two ");
-  intro_text.push_back("races who terrorized the galaxy");
-  intro_text.push_back("for the past 20,000 years!");
-  intro_text.push_back("");
-  intro_text.push_back("Thanks to captain Zelnick, hope is given");
-  intro_text.push_back("to the entire galaxy, and especially to");
-  intro_text.push_back("the human race. Now free from their prison");
-  intro_text.push_back("under a Slaveshield it's Humanity's time");
-  intro_text.push_back("to rebuild.");
-  intro_text.push_back("");
-  intro_text.push_back("However, it seems there are more troubles");
-  intro_text.push_back("ahead. It is time for great space");
-  intro_text.push_back("exploration, colonization and piracy.");
-  intro_text.push_back("You have to live in this world,");
-  intro_text.push_back("young earth captain!!!");
-
-  d_buf = create_bitmap(SCREEN_W, SCREEN_H);
-  clear(d_buf);
-  copy_buf();
-
-  tw_sound->play_music(data_full_path("music/intro.xm"), -1);
-  clear(d_buf);
-  BITMAP* logo = load_bitmap(data_full_path("images/3dlogo.jpg").c_str(), NULL);
-  stretch_blit(logo, d_buf, 0, 0, logo->w, logo->h, 0, 0, screen->w, screen->h);
-  destroy_bitmap(logo);
-
-  textout_centre(d_buf, D_FONT_ENGLISH, "TimeWarp development team", screen->w/2, screen->h-50, -1);
-  copy_buf();
-  HAVE_A_WAIT(2500);
- 
-  clear(d_buf);
-  textout_centre(d_buf, D_FONT_ENGLISH, "somewhat proudly", screen->w/2, screen->h/2, -1);
-  textout_centre(d_buf, D_FONT_ENGLISH, "present", screen->w/2, screen->h/2+40, -1);
-  copy_buf();
-  HAVE_A_WAIT(2500);
-  clear(d_buf);
-
-  BITMAP* pkunk = load_bitmap(data_full_path("images/PkunkQueen.jpg").c_str(), NULL);
-  blit(pkunk, d_buf, 0, 0,  (screen->w-pkunk->w)/2, 20, pkunk->w, pkunk->h);
-  textout_centre(d_buf, D_FONT_ENGLISH, "TW-Light : Legacies", screen->w/2, pkunk->h+60, -1);
-  destroy_bitmap(pkunk);
-  copy_buf();
-  HAVE_A_WAIT(2500);
-  
-  ScrollText(intro_text,  D_FONT_ENGLISH, -1, "images/background.jpg", "c", 2);
-
-
-  clear(d_buf);
-  copy_buf();	
-  destroy_bitmap(d_buf);
-}
-
-
-

Modified: trunk/source/scp.h
===================================================================
--- trunk/source/scp.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/scp.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -25,9 +25,12 @@
 
 #include <string>
 class VideoWindow;
+class Log;
 
 std::string tw_version();
 
+void play_game(const char *_gametype_name, const std::string& save, Log *_log = NULL) ;
+
 /// TEAMS dialog - from here you can select controllers for each player, and access their respective fleets. (FLEET dialog)
 void change_teams();
 

Modified: trunk/source/util/sound.cpp
===================================================================
--- trunk/source/util/sound.cpp	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/util/sound.cpp	2005-08-22 17:56:30 UTC (rev 188)
@@ -22,6 +22,10 @@
 #include <iostream>
 #include <map>
 
+#ifdef main
+#undef main
+#endif
+
 #include <allegro.h>
 #include "other/twconfig.h"
 #include "errors.h"
@@ -29,6 +33,9 @@
 
 SoundSystem* tw_sound = NULL;
 
+static std::map<std::string,Mix_Chunk*> sound_cache;
+static std::map<std::string,Mix_Music*> music_cache;
+
 SoundSystem::SoundSystem(bool sound_on)
 {
   STACKTRACE;
@@ -56,7 +63,7 @@
 
   
   int res = Mix_OpenAudio(MIX_DEFAULT_FREQUENCY,MIX_DEFAULT_FORMAT,2,buf_size_);
-  //int res = Mix_OpenAudio(44100,MIX_DEFAULT_FORMAT,2,buf_size_);
+  
   if(res >= 0) 
     {
       mix_ok = true;
@@ -121,15 +128,15 @@
       const std::string& filename = absolute_file;
       
       if(filename.empty()) 
-	{
-	  return;
-	}
+    {
+      return;
+    }
       
       Mix_Music* const music = Mix_LoadMUS(filename.c_str());
       if(music == NULL) {
-	std::cerr << "Could not load music file '" << filename << "': "
-		  << SDL_GetError() << "\n";
-	return;
+    std::cerr << "Could not load music file '" << filename << "': "
+          << SDL_GetError() << "\n";
+    return;
       }
       
       itor = music_cache.insert(std::pair<std::string,Mix_Music*>(file,music)).first;
@@ -161,17 +168,17 @@
       const std::string& filename = file;
       
       if(filename.empty()) 
-	{
-	  return;
-	}
+    {
+      return;
+    }
       
       Mix_Chunk* const sfx = Mix_LoadWAV(filename.c_str());
       if(sfx == NULL) 
-	{
-	  std::cerr << "Could not load sound file '" << filename << "': "
-		    << SDL_GetError() << "\n";
-	  return;
-	}
+    {
+      std::cerr << "Could not load sound file '" << filename << "': "
+            << SDL_GetError() << "\n";
+      return;
+    }
       
       itor = sound_cache.insert(std::pair<std::string,Mix_Chunk*>(file,sfx)).first;
     }
@@ -205,10 +212,10 @@
     {
       Mix_Chunk * chunk = Mix_GetChunk(i);
       if(chunk == itor->second)
-	{
-	  Mix_HaltChannel(i);
-	}
+    {
+      Mix_HaltChannel(i);
     }
+    }
 }
 
 void SoundSystem::set_music_volume(double vol)
@@ -236,10 +243,10 @@
       const std::string music = current_music;
       current_music = "";
       if(!music.empty()) 
-	{
-	  play_music(music);
-	}
+    {
+      play_music(music);
     }
+    }
 }
 
 void SoundSystem::set_sound_volume(double vol)

Modified: trunk/source/util/sound.h
===================================================================
--- trunk/source/util/sound.h	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/source/util/sound.h	2005-08-22 17:56:30 UTC (rev 188)
@@ -20,15 +20,10 @@
 #include <string>
 #include <map>
 
-#include "SDL_mixer.h"
-
-
 /// \brief All work with sound must be implemented using this class
 class SoundSystem
 {  
   bool mix_ok;
-  std::map<std::string,Mix_Chunk*> sound_cache;
-  std::map<std::string,Mix_Music*> music_cache;
   
   std::string current_music;
   
@@ -36,7 +31,7 @@
   bool sound_off;
   
   int frequency;
-  Uint16 format;
+  unsigned short format;
   int channels;
 
   size_t buf_size_;

Modified: trunk/sources.lst
===================================================================
--- trunk/sources.lst	2005-08-22 02:27:59 UTC (rev 187)
+++ trunk/sources.lst	2005-08-22 17:56:30 UTC (rev 188)
@@ -1,5 +1,4 @@
 source/python/python_class.cpp
-source/python/fileops.cpp
 source/python/game.cpp
 source/other/starmap.cpp
 source/other/planet3d.cpp



From yurand at berlios.de  Fri Aug 26 20:57:02 2005
From: yurand at berlios.de (Yura Semashko at BerliOS)
Date: Fri, 26 Aug 2005 20:57:02 +0200
Subject: [Tw-light-svn] r189 - in trunk: gamedata/images/ships/shpconca source/melee source/ships
Message-ID: <200508261857.j7QIv29r020438@sheep.berlios.de>

Author: yurand
Date: 2005-08-26 20:56:59 +0200 (Fri, 26 Aug 2005)
New Revision: 189

Modified:
   trunk/gamedata/images/ships/shpconca/SHIP_P01_PCX.bmp
   trunk/gamedata/images/ships/shpconca/SHIP_P02_PCX.bmp
   trunk/gamedata/images/ships/shpconca/SHIP_P03_PCX.bmp
   trunk/gamedata/images/ships/shpconca/SHIP_P04_PCX.bmp
   trunk/gamedata/images/ships/shpconca/SHIP_P05_PCX.bmp
   trunk/gamedata/images/ships/shpconca/SHIP_P06_PCX.bmp
   trunk/source/melee/msprite.cpp
   trunk/source/ships/shpconho.cpp
Log:
Fixed bug #67 Confed Hornet Icon Problems
Inserted ship captain icons for the confed cargotran Darryl Koster

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P01_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P02_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P03_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P04_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P05_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/gamedata/images/ships/shpconca/SHIP_P06_PCX.bmp
===================================================================
(Binary files differ)

Modified: trunk/source/melee/msprite.cpp
===================================================================
--- trunk/source/melee/msprite.cpp	2005-08-22 17:56:30 UTC (rev 188)
+++ trunk/source/melee/msprite.cpp	2005-08-26 18:56:59 UTC (rev 189)
@@ -372,9 +372,11 @@
 {
   STACKTRACE;
   int i, j, obpp=0;
-  BITMAP *bmp = NULL, *tmp = NULL;
+  BITMAP *bmp = NULL;
+  BITMAP *tmp = NULL;
   
-  
+  //boost::shared_ptr<BITMAP> tmp;
+
   if (_attributes == -1) 
     _attributes = string_to_sprite_attributes(NULL);
 
@@ -430,7 +432,8 @@
   if (bpp == 0) 
     bpp = obpp;
   if (obpp != bpp) 
-    tmp = create_bitmap_ex(obpp, w, h);
+	  tmp = create_bitmap_ex(obpp, w, h);
+
   if (general_attributes & ALPHA) 
     {
       if (bpp <= 16) bpp = 16;
@@ -485,38 +488,38 @@
     {
       bmp = create_bitmap_ex(bpp, w, h);
       if (!tmp) 
-	tmp = bmp;
+		tmp = bmp;
       if (general_attributes & MASKED) 
-	clear_to_color(bmp, bitmap_mask_color(bmp));
+		clear_to_color(bmp, bitmap_mask_color(bmp));
       if (tmp != bmp) 
-	clear_to_color(tmp, bitmap_mask_color(tmp));
+		clear_to_color(tmp, bitmap_mask_color(tmp));
       switch (originaltype) 
-	{
-	case DAT_RLE_SPRITE: 
-	  {
-	    draw_rle_sprite(tmp, (RLE_SPRITE *)(images[i].dat), 0, 0);
-	    if (general_attributes & ALPHA) 
-	      handle_alpha_load(tmp);
-	    if (tmp != bmp) 
-	      convert_bitmap(tmp, bmp, (general_attributes & MASKED) ? AA_MASKED : 0);
-	  }
+		{
+		case DAT_RLE_SPRITE: 
+		{
+			draw_rle_sprite(tmp, (RLE_SPRITE *)(images[i].dat), 0, 0);
+			if (general_attributes & ALPHA) 
+				handle_alpha_load(tmp);
+			if (tmp != bmp) 
+				convert_bitmap(tmp, bmp, (general_attributes & MASKED) ? AA_MASKED : 0);
+		}
+		break;
+		case DAT_BITMAP: 
+		{
+			if (general_attributes & ALPHA) handle_alpha_load((BITMAP *)(images[i].dat));
+			if (obpp != bpp) 
+			{
+				convert_bitmap((BITMAP *)(images[i].dat), bmp, (general_attributes & MASKED) ? AA_MASKED : 0);
+			}
+			else 
+			{
+				if (general_attributes & MASKED) draw_sprite(bmp, (BITMAP*)images[i].dat, 0, 0);
+				else blit((BITMAP*)images[i].dat, bmp, 0, 0, 0, 0, w, h);
+			}
+		}
 	  break;
-	case DAT_BITMAP: 
-	  {
-	    if (general_attributes & ALPHA) handle_alpha_load((BITMAP *)(images[i].dat));
-	    if (obpp != bpp) 
-	      {
-		convert_bitmap((BITMAP *)(images[i].dat), bmp, (general_attributes & MASKED) ? AA_MASKED : 0);
-	      }
-	    else 
-	      {
-		if (general_attributes & MASKED) draw_sprite(bmp, (BITMAP*)images[i].dat, 0, 0);
-		else blit((BITMAP*)images[i].dat, bmp, 0, 0, 0, 0, w, h);
-	      }
-	  }
-	  break;
 	}
-      color_correct_bitmap(bmp, general_attributes & MASKED);
+    color_correct_bitmap(bmp, general_attributes & MASKED);
 
       if (tmp == bmp) 
 	tmp = NULL;
@@ -917,9 +920,9 @@
       tw_error("SpaceSprite::overlay - index2 %d > count %d", index2, count);
     }
   
-  for(y = 0; y < h; y += 1) 
+  for(y = 0; y < b[0][index1]->h; y += 1) 
     {
-      for(x = 0; x < w; x += 1) 
+      for(x = 0; x < b[0][index1]->w; x += 1) 
 	{
 	  if (getpixel(b[0][index1], x, y) != getpixel(b[0][index2], x, y)) 
 	    {

Modified: trunk/source/ships/shpconho.cpp
===================================================================
--- trunk/source/ships/shpconho.cpp	2005-08-22 17:56:30 UTC (rev 188)
+++ trunk/source/ships/shpconho.cpp	2005-08-26 18:56:59 UTC (rev 189)
@@ -151,32 +151,7 @@
      regenrating = TRUE;
      regenrateCount = regenrateFrames;
    }
-	/*
-   if(shield != shield_old) {
-     bar_x = 0;
-     bar_y = 0;
-     shield_panel = ((shield*8)/shield_max) + 8;
-		 BITMAP *bmp = spritePanel->get_bitmap(0);
-     blit(ship->spritePanel->get_bitmap(shield_panel), bmp, 0, 0, 13, 14, 50, 39);
-     for(i = 0; i < shield_max; i++) {
-        if((i - shield) < 0) {
-         putpixel(bmp, shield_x + bar_x, shield_y + bar_y, pallete_color[shield_color]);
-         putpixel(bmp, shield_x + bar_x + 1, shield_y + bar_y, pallete_color[shield_color]);
-       } else {
-         putpixel(bmp, shield_x + bar_x, shield_y + bar_y, 0);
-         putpixel(bmp, shield_x + bar_x + 1, shield_y + bar_y, 0);
-       }
-       if((i % 2) == 0)
-         bar_x = -3;
-       else {
-         bar_x = 0;
-         bar_y -= 2;
-       }
-     }
-     ship->update_panel = TRUE;
-     shield_old = shield;
-   }
-   */
+
    Ship::calculate();
 
    crew = 1 + shield;



From youbastrd at berlios.de  Wed Aug 31 03:39:10 2005
From: youbastrd at berlios.de (Paul Forest at BerliOS)
Date: Wed, 31 Aug 2005 03:39:10 +0200
Subject: [Tw-light-svn] r190 - trunk/source/ships
Message-ID: <200508310139.j7V1dAxv017326@sheep.berlios.de>

Author: youbastrd
Date: 2005-08-31 03:38:49 +0200 (Wed, 31 Aug 2005)
New Revision: 190

Modified:
   trunk/source/ships/shpalabc.cpp
Log:
This is a "fix" for bug #20 (Alary doesn't give credit to killer); unfortunately, it introduces a worse bug.  The worse bug is that the Alary doesn't always spawn after dying.  This is a work in progress.  

Modified: trunk/source/ships/shpalabc.cpp
===================================================================
--- trunk/source/ships/shpalabc.cpp	2005-08-26 18:56:59 UTC (rev 189)
+++ trunk/source/ships/shpalabc.cpp	2005-08-31 01:38:49 UTC (rev 190)
@@ -23,11 +23,32 @@
 
 class AlaryBCTurret;
 
+/**
+ * Alary Battlecruiser.  A formitable battleship, with auto-firing turrets,
+ * powerful tracking missiles, damage reduction, and large crew and battery
+ * compliments.  
+ *
+ * The primary weapon fires an AlaryBCTorpedo, which homes in on its target.
+ * A collision with this projectile will generally do less damage.  The 
+ * AlaryBCTorpedo will explode into a collection of AlaryBCWarhead's, each
+ * of which will track towards its target.  
+ * @see AlaryBCTorpedo
+ * @see AlaryBCWarhead
+ * 
+ * Pressing the secondary weapon will toggle the ship's auto-firing and aiming
+ * turrets.
+ * @see AlaryBCTShot
+ * @see AlaryBCTurret
+ * 
+ * Additionally, AlaryBattlecruiser will reduce damage dealt to it when hit.
+ * @see AlaryBC::calculate()
+ */
 class AlaryBC : public Ship
 {
-public:
+private:
   int    death_frame, exp_frame;
-  bool   dying;
+  bool   dying; ///< Is this ship dying?
+  //SpaceLocation * killer; ///< When dying, what killed this ship?
   int    engine_phase;
   double weaponProximity, weaponVelocity, weaponAccel, weaponTR;
   double weaponArmour;
@@ -61,22 +82,88 @@
   AlaryBCTurret *turret[3];
   
 public:
+  /**
+   * Constructs an Alary Battlecruiser.  
+   * @param opos the position in game-space to place the ship
+   * @param shipAngle the angle the ship will be when placed in game-space
+   * @param shipData the data structure for graphics, sounds, victory ditty, etc
+   * @param code ???
+   */
   AlaryBC (Vector2 opos, double shipAngle, ShipData *shipData, unsigned int code);
   
+  /**
+   * The ship can be in two modes: not-dying and dying.  
+   * In not-dying mode, the ship performs as normal.  
+   * In dying mode, the ship spins out of control, is drawn as having explosions
+   * on it, and does not respond to Control-fired events.  When a game-tick-timer
+   * has expired, the ship explodes and dies.
+   */
   virtual void calculate();
+  
+  /**
+   *
+   */
   virtual int  activate_weapon();
+  
+  /**
+   *
+   */ 
   virtual void calculate_fire_special();
+  
+  /**
+   *
+   */
   virtual void calculate_thrust();
+  
+  /**
+   *
+   */
   virtual void calculate_turn_left();
+  
+  /**
+   *
+   */
   virtual void calculate_turn_right();
+  
+  /**
+   *
+   */
   virtual void calculate_hotspots();
+  
+  /**
+   *
+   */
   virtual void animate(Frame *space);
+  
+  /**
+   *
+   */
   virtual int  handle_damage(SpaceLocation* source, double normal, double direct);
+  
+  /**
+   *
+   */
   virtual int  handle_fuel_sap(SpaceLocation *source, double normal);
+  
+  /**
+   *
+   */
   virtual double handle_speed_loss(SpaceLocation *source, double normal);
   
+  /**
+   *
+   */
+  virtual void death();
+
+  friend class AlaryBCTorpedo;
+  friend class AlaryBCWarhead;
+  friend class AlaryBCTShot;
+  friend class AlaryBCTurret;
 };
 
+/**
+ * The Alary Battlecruiser's primary weapon.  
+ */
 class AlaryBCTorpedo : public SpaceObject
 {
   int    armour, lifetime, smoke_frame, inactive;
@@ -145,7 +232,8 @@
 
 
 AlaryBC::AlaryBC (Vector2 opos, double shipAngle, ShipData *shipData, unsigned int code) :
-  Ship(opos, shipAngle, shipData, code)
+  Ship(opos, shipAngle, shipData, code)//,
+  //killer(NULL)
 {
 
   engines_armour  = get_config_int("Ship", "EnginesArmour", 99);
@@ -225,15 +313,31 @@
   if (crew <= 0) 
     {
       death_frame -= frame_time;
-      if (death_frame <= 0) handle_damage(this,777,888);
+      
+      //This is the final death phase, after the ship has spun out
+      //of control.
+      if (death_frame <= 0) {
+         //      remove turrets when dead;
+	for (int i=0; i<3; i++)
+	    turret[i]->die();
+	/*if (attributes & ATTRIB_NOTIFY_ON_DEATH) {
+		game->ship_died(this, NULL);
+		attributes &= ~ATTRIB_NOTIFY_ON_DEATH;
+	}*/
+	die();
+	//Ship::calculate();
+	return;
+      }
       turn_step_128 += turn_rate * frame_time;
       
+      // Add small explosions inside the area of the ship.
       double aaa, rrr;
       exp_frame -= frame_time;
       while (exp_frame <= 0) 
 	{
 	  exp_frame += 90+tw_random()%300;
 	  aaa = PI2 * ((tw_random()%1001)/1000.0);
+	  /** @todo find a replacement for this expensive sqrt() call*/
 	  rrr = 66*sqrt((tw_random()%1001)/1000.0);
 	  if (tw_random()%2 == 0) 
 	    {
@@ -562,19 +666,6 @@
 	} 
     }
   
-  
-  if ((source == this) && (dying)) {
-    //      remove turrets when dead;
-    int i;
-    for (i=0; i<3; i++)
-      turret[i]->state = 0;
-    tw_sound->play_sound(data_full_path(MELEE_BOOMSHIP_SOUND));
-    game->add(new Animation(this, pos,
-			    game->meleedata.kaboomSprite, 0, KABOOM_FRAMES, time_ratio, DEPTH_EXPLOSIONS, 2.0));
-    if (attributes & ATTRIB_NOTIFY_ON_DEATH) game->ship_died(this, source);
-    state = 0; return 0;
-  }
-  
   crew -= total;
   
   if(crew > crew_max) 
@@ -587,6 +678,13 @@
       total += crew;
       crew  = 0;
       dying = true;
+      
+      if (attributes & ATTRIB_NOTIFY_ON_DEATH) {
+        game->ship_died(this, source);
+        attributes &= ~ATTRIB_NOTIFY_ON_DEATH;
+      }
+      //die();
+      
       turn_rate = scale_turning(12+tw_random()%80) * (1-2*(tw_random()%2)); 
       if (engines_armour > 0) 
 	{
@@ -620,7 +718,14 @@
   return Ship::handle_speed_loss(source, normal);
 }
 
+void AlaryBC::death() {
+  tw_sound->play_sound(data_full_path(MELEE_BOOMSHIP_SOUND));
+  game->add(new Animation(this, pos,
+                          game->meleedata.kaboomSprite, 0, KABOOM_FRAMES, time_ratio, DEPTH_EXPLOSIONS, 2.0));
+  Ship::death();
+}
 
+
 AlaryBCTorpedo::AlaryBCTorpedo(SpaceLocation *creator, double ox, double oy, double oangle, 
 			       int oinactive, double oaccel, double  omaxspeed,
 			       int olifetime, double oproximity, double oarmour, 
@@ -660,7 +765,7 @@
   if (lifetime < 0) 
     {
       //launch warheads or die
-      state = 0;
+      die();
       return;
   }
   



